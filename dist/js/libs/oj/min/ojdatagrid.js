/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojlogger","ojs/ojcontext","ojs/ojthemeutils","promise","ojs/ojdatasource-common","ojs/ojdatacollection-utils","ojs/ojinputnumber","ojs/ojmenu","ojs/ojpopup","touchr"],function(e,t,i,s,o,n){var r={properties:{bandingInterval:{type:"object",properties:{column:{type:"number",value:0},row:{type:"number",value:0}}},cell:{type:"object",properties:{className:{type:"function|string"},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},cell:{type:"D"},data:{type:"D"},datasource:{type:"oj.DataProvider<K, D>"},indexes:{type:"object",properties:{row:{type:"number"},column:{type:"number"}}},keys:{type:"object",properties:{row:{type:"K"},column:{type:"K"}}},extents:{type:"object",properties:{row:{type:"number"},column:{type:"number"}}},mode:{type:'"edit"|"navigation"'}}},style:{type:"function|string"}}},currentCell:{type:"object",writeback:!0},data:{type:"oj.DataGridDataSource|oj.DataProvider"},dnd:{type:"object",properties:{reorder:{type:"object",properties:{row:{type:"string",enumValues:["disable","enable"],value:"disable"}}}}},editMode:{type:"string",writeback:!0,enumValues:["cellEdit","cellNavigation","none"],value:"none"},gridlines:{type:"object",properties:{horizontal:{type:"string",enumValues:["hidden","visible"],value:"visible"},vertical:{type:"string",enumValues:["hidden","visible"],value:"visible"}}},header:{type:"object",properties:{column:{type:"object",properties:{className:{type:"function|string"},label:{type:"object",properties:{className:{type:"function|string"},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},key:{type:"K"},level:{type:"number"}}},style:{type:"function|string"}}},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},data:{type:"D"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},index:{type:"number"},key:{type:"K"},level:{type:"number"},extent:{type:"number"},depth:{type:"number"}}},resizable:{type:"object",properties:{height:{type:"string",enumValues:["disable","enable"],value:"disable"},width:{type:"string|function",enumValues:["disable","enable"],value:"disable"}}},sortable:{type:"function|string",enumValues:["auto","disable","enable"],value:"auto"},style:{type:"function|string"}}},columnEnd:{type:"object",properties:{className:{type:"function|string"},label:{type:"object",properties:{className:{type:"function|string"},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},key:{type:"K"},level:{type:"number"}}},style:{type:"function|string"}}},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},data:{type:"D"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},index:{type:"number"},key:{type:"K"},level:{type:"number"},extent:{type:"number"},depth:{type:"number"}}},resizable:{type:"object",properties:{height:{type:"string",enumValues:["disable","enable"],value:"disable"},width:{type:"string|function",enumValues:["disable","enable"],value:"disable"}}},style:{type:"function|string"}}},row:{type:"object",properties:{className:{type:"function|string"},label:{type:"object",properties:{className:{type:"function|string"},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},key:{type:"K"},level:{type:"number"}}},style:{type:"function|string"}}},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},data:{type:"D"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},index:{type:"number"},key:{type:"K"},level:{type:"number"},extent:{type:"number"},depth:{type:"number"}}},resizable:{type:"object",properties:{height:{type:"string|function",enumValues:["disable","enable"],value:"disable"},width:{type:"string",enumValues:["disable","enable"],value:"disable"}}},sortable:{type:"function|string",enumValues:["auto","disable","enable"],value:"auto"},style:{type:"function|string"}}},rowEnd:{type:"object",properties:{className:{type:"function|string"},label:{type:"object",properties:{className:{type:"function|string"},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},key:{type:"K"},level:{type:"number"}}},style:{type:"function|string"}}},renderer:{type:"function",properties:{componentElement:{type:"Element"},parentElement:{type:"Element"},data:{type:"D"},datasource:{type:"oj.DataProvider<K, D>"},axis:{type:'"column"|"columnEnd"|"row"|"rowEnd"'},index:{type:"number"},key:{type:"K"},level:{type:"number"},extent:{type:"number"},depth:{type:"number"}}},resizable:{type:"object",properties:{height:{type:"string|function",enumValues:["disable","enable"],value:"disable"},width:{type:"string",enumValues:["disable","enable"],value:"disable"}}},style:{type:"function|string"}}}}},scrollPolicy:{type:"string",enumValues:["auto","loadMoreOnScroll","scroll"],value:"auto"},scrollPolicyOptions:{type:"object",properties:{maxColumnCount:{type:"number",value:500},maxRowCount:{type:"number",value:500}}},scrollPosition:{type:"object",writeback:!0,value:{x:0,y:0},properties:{x:{type:"number"},y:{type:"number"},rowIndex:{type:"number"},columnIndex:{type:"number"},rowKey:{type:"any"},columnKey:{type:"any"},offsetX:{type:"number"},offsetY:{type:"number"}}},selection:{type:"Array<Object>",writeback:!0,value:[]},selectionMode:{type:"object",properties:{cell:{type:"string",enumValues:["multiple","none","single"],value:"none"},row:{type:"string",enumValues:["multiple","none","single"],value:"none"}}},translations:{type:"object",value:{},properties:{accessibleActionableMode:{type:"string"},accessibleColumnContext:{type:"string"},accessibleColumnEndHeaderContext:{type:"string"},accessibleColumnHeaderContext:{type:"string"},accessibleColumnSelected:{type:"string"},accessibleColumnSpanContext:{type:"string"},accessibleFirstColumn:{type:"string"},accessibleFirstRow:{type:"string"},accessibleLastColumn:{type:"string"},accessibleLastRow:{type:"string"},accessibleLevelContext:{type:"string"},accessibleMultiCellSelected:{type:"string"},accessibleNavigationMode:{type:"string"},accessibleRangeSelectModeOff:{type:"string"},accessibleRangeSelectModeOn:{type:"string"},accessibleRowCollapsed:{type:"string"},accessibleRowContext:{type:"string"},accessibleRowEndHeaderContext:{type:"string"},accessibleRowExpanded:{type:"string"},accessibleRowHeaderContext:{type:"string"},accessibleRowSelected:{type:"string"},accessibleRowSpanContext:{type:"string"},accessibleSelectionAffordanceBottom:{type:"string"},accessibleSelectionAffordanceTop:{type:"string"},accessibleSortAscending:{type:"string"},accessibleSortDescending:{type:"string"},accessibleStateSelected:{type:"string"},accessibleSummaryEstimate:{type:"string"},accessibleSummaryExact:{type:"string"},accessibleSummaryExpanded:{type:"string"},labelCut:{type:"string"},labelDisableNonContiguous:{type:"string"},labelEnableNonContiguous:{type:"string"},labelPaste:{type:"string"},labelResize:{type:"string"},labelResizeDialogSubmit:{type:"string"},labelResizeHeight:{type:"string"},labelResizeWidth:{type:"string"},labelSortCol:{type:"string"},labelSortColAsc:{type:"string"},labelSortColDsc:{type:"string"},labelSortRow:{type:"string"},labelSortRowAsc:{type:"string"},labelSortRowDsc:{type:"string"},msgFetchingData:{type:"string"},msgNoData:{type:"string"}}}},methods:{refresh:{},getContextByNode:{},setProperty:{},getProperty:{},setProperties:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojResize:{},ojSort:{},ojScroll:{},ojBeforeCurrentCell:{},ojBeforeEdit:{},ojBeforeEditEnd:{}},extension:{}};e.DataGridResources=function(e,t,s,n){this.rtlMode=e,this.translationFunction=t,this.defaultOptions=s,this.widgetName=n,this.styles={},this.styles.datagrid="oj-datagrid",this.styles.cell="oj-datagrid-cell",this.styles.banded="oj-datagrid-banded",this.styles.row="oj-datagrid-row",this.styles.databody="oj-datagrid-databody",this.styles.topcorner="oj-datagrid-top-corner",this.styles.bottomcorner="oj-datagrid-bottom-corner",this.styles.rowheaderspacer="oj-datagrid-row-header-spacer",this.styles.colheaderspacer="oj-datagrid-column-header-spacer",this.styles.status="oj-datagrid-status",this.styles.loadingicon="oj-icon oj-datagrid-loading-icon",this.styles.emptytext="oj-datagrid-empty-text",this.styles.header="oj-datagrid-header",this.styles.endheader="oj-datagrid-end-header",this.styles.groupingcontainer="oj-datagrid-header-grouping",this.styles.headercell="oj-datagrid-header-cell",this.styles.rowheader="oj-datagrid-row-header",this.styles.colheader="oj-datagrid-column-header",this.styles.colheadercell="oj-datagrid-column-header-cell",this.styles.rowheadercell="oj-datagrid-row-header-cell",this.styles.endheadercell="oj-datagrid-end-header-cell",this.styles.rowendheader="oj-datagrid-row-end-header",this.styles.colendheader="oj-datagrid-column-end-header",this.styles.colendheadercell="oj-datagrid-column-end-header-cell",this.styles.rowendheadercell="oj-datagrid-row-end-header-cell",this.styles.headerlabel="oj-datagrid-header-label",this.styles.rowheaderlabel="oj-datagrid-row-header-label",this.styles.columnheaderlabel="oj-datagrid-column-header-label",this.styles.rowendheaderlabel="oj-datagrid-row-end-header-label",this.styles.columnendheaderlabel="oj-datagrid-column-end-header-label",this.styles["scroller-mobile"]="oj-datagrid-scroller-touch",this.styles.scroller="oj-datagrid-scroller",this.styles.scrollers="oj-datagrid-scrollers",this.styles.focus="oj-focus",this.styles.hover="oj-hover",this.styles.active="oj-active",this.styles.selected="oj-selected",this.styles.topSelected="oj-datagrid-selected-top",this.styles.bottomSelected="oj-datagrid-selected-bottom",this.styles.disabled="oj-disabled",this.styles.enabled="oj-enabled",this.styles.default="oj-default",this.styles.sortcontainer="oj-datagrid-sort-icon-container",this.styles.sortascending="oj-datagrid-sort-ascending-icon",this.styles.sortdescending="oj-datagrid-sort-descending-icon",this.styles.icon="oj-component-icon",this.styles.clickableicon="oj-clickable-icon-nocontext",this.styles.info="oj-helper-hidden-accessible",this.styles.rowexpander="oj-rowexpander",this.styles.cut="oj-datagrid-cut",this.styles.selectaffordancetop="oj-datagrid-touch-selection-affordance-top",this.styles.selectaffordancebottom="oj-datagrid-touch-selection-affordance-bottom",this.styles.toucharea="oj-datagrid-touch-area",this.styles.readOnly="oj-read-only",this.styles.editable="oj-datagrid-editable",this.styles.cellEdit="oj-datagrid-cell-edit",this.styles.draggable="oj-draggable",this.styles.drag="oj-drag",this.styles.drop="oj-drop",this.styles.activedrop="oj-active-drop",this.styles.validdrop="oj-valid-drop",this.styles.invaliddrop="oj-invalid-drop",this.styles.formcontrol="oj-form-control-inherit",this.styles.borderHorizontalNone="oj-datagrid-border-horizontal-none",this.styles.borderVerticalNone="oj-datagrid-border-vertical-none",this.styles.borderHorizontalSmall="oj-datagrid-small-content-border-horizontal",this.styles.borderVerticalSmall="oj-datagrid-small-content-border-vertical",this.styles.offsetOutline="oj-datagrid-focus-offset",this.styles.depth="oj-datagrid-depth-",this.styles.popupHeader="oj-datagrid-popup-header",this.styles.popupContent="oj-datagrid-popup-content",this.styles.popupFooter="oj-datagrid-popup-footer",this.commands={},this.commands.sortCol="oj-datagrid-sortCol",this.commands.sortColAsc="oj-datagrid-sortColAsc",this.commands.sortColDsc="oj-datagrid-sortColDsc",this.commands.sortRow="oj-datagrid-sortRow",this.commands.sortRowAsc="oj-datagrid-sortRowAsc",this.commands.sortRowDsc="oj-datagrid-sortRowDsc",this.commands.resize="oj-datagrid-resize",this.commands.resizeWidth="oj-datagrid-resizeWidth",this.commands.resizeHeight="oj-datagrid-resizeHeight",this.commands.cut="oj-datagrid-cut",this.commands.paste="oj-datagrid-paste",this.commands.discontiguousSelection="oj-datagrid-discontiguousSelection",this.attributes={},this.attributes.busyContext=o._OJ_CONTEXT_ATTRIBUTE,this.attributes.context="data-oj-cellContext",this.attributes.resizable="data-oj-resizable",this.attributes.sortable="data-oj-sortable",this.attributes.sortDir="data-oj-sortdir",this.attributes.expander="data-oj-expander",this.attributes.expanderIndex="data-oj-expander-index",this.attributes.container=i._OJ_CONTAINER_ATTR,this.attributes.extent="data-oj-extent",this.attributes.start="data-oj-start",this.attributes.depth="data-oj-depth",this.attributes.level="data-oj-level",this.attributes.tabMod="data-oj-tabmod"},e.DataGridResources.prototype.isRTLMode=function(){return"rtl"===this.rtlMode},e.DataGridResources.prototype.getTranslatedText=function(e,t){return this.translationFunction(e,t)},e.DataGridResources.prototype.getDefaultOption=function(e){return this.defaultOptions?this.defaultOptions[e]:null},e.DataGridResources.prototype.getMappedStyle=function(e){return null!=e?this.styles[e]:null},e.DataGridResources.prototype.getMappedCommand=function(e){return null!=e?this.commands[e]:null},e.DataGridResources.prototype.getMappedAttribute=function(e){return null!=e?this.attributes[e]:null};var l=function(e){this.m_root=e,this.MAX_COLUMN_THRESHOLD=20,this.MAX_ROW_THRESHOLD=30,this.m_utils=new h(this),this.m_discontiguousSelection=!1,this.m_sizingManager=new a,this.m_keyboardHandler=new p(this),this.m_rowHeaderWidth=null,this.m_rowEndHeaderWidth=null,this.m_colHeaderHeight=null,this.m_colEndHeaderHeight=null,this.m_styleClassDimensionMap={width:{},height:{}},this.m_isEstimateRowCount=void 0,this.m_isEstimateColumnCount=void 0,this.m_stopRowFetch=!1,this.m_stopRowHeaderFetch=!1,this.m_stopRowEndHeaderFetch=!1,this.m_stopColumnFetch=!1,this.m_stopColumnHeaderFetch=!1,this.m_stopColumnEndHeaderFetch=!1,this.m_initialized=!1,this.m_shouldFocus=null,this.callbacks={},this._setupActions(),this.m_readinessStack=[],this.m_modelEvents=[],this.m_databodyMap=new Map};l.keyCodes={TAB_KEY:9,ENTER_KEY:13,SHIFT_KEY:16,CTRL_KEY:17,ALT_KEY:18,ESC_KEY:27,SPACE_KEY:32,PAGEUP_KEY:33,PAGEDOWN_KEY:34,END_KEY:35,HOME_KEY:36,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,NUM5_KEY:53,V_KEY:86,X_KEY:88,F1_KEY:112,F2_KEY:113,F8_KEY:119,F10_KEY:121,F15_KEY:126,A_KEY:65},l.UPDATE_ANIMATION_FADE_INOUT=1,l.UPDATE_ANIMATION_SLIDE_INOUT=2,l.UPDATE_ANIMATION_DURATION=250,l.EXPAND_ANIMATION_DURATION=500,l.COLLAPSE_ANIMATION_DURATION=400,l.MAX_OVERSCROLL_PIXEL=50,l.BOUNCE_ANIMATION_DURATION=500,l.DECELERATION_FACTOR=6e-4,l.TAP_AND_SCROLL_RESET=300,l.MIN_SWIPE_DURATION=200,l.MAX_SWIPE_DURATION=400,l.MIN_SWIPE_DISTANCE=10,l.MIN_SWIPE_TRANSITION_DURATION=100,l.MAX_SWIPE_TRANSITION_DURATION=500,l.CONTEXT_MENU_TAP_HOLD_DURATION=750,l.HEADER_TAP_SHORT_HOLD_DURATION=300,l.FETCH_PIXEL_THRESHOLD=5,l.VISIBILITY_STATE_HIDDEN="hidden",l.VISIBILITY_STATE_REFRESH="refresh",l.VISIBILITY_STATE_RENDER="render",l.VISIBILITY_STATE_VISIBLE="visible",l.prototype.SetOptions=function(e,t){this.m_options=new d(e,t)},l.prototype.SetSortOriginalEvent=function(e){this.m_sortInfo.originalEvent=e},l.prototype.UpdateOptions=function(e,t){var i,s,o=Object.keys(e);for(s=0;s<o.length;s++)(i=o[s])in this.m_options.options&&this.m_options.options[i]!==e[i]&&(this.m_options.options[i]=e[i]);for(s=0;s<o.length;s++)if(i=o[s],!this._updateDataGrid(i,t)){this.empty(),this.refresh(this.m_root);break}},l.prototype._updateDataGrid=function(e,t){var i;switch(e){case"bandingInterval":this._removeBanding(),this.updateColumnBanding(),this.updateRowBanding();break;case"currentCell":i=this.m_options.getCurrentCell(),this._updateActive(i,!0,!1);break;case"editMode":this.m_editMode=this.m_options.getEditMode();break;case"gridlines":this._updateGridlines();break;case"header":i=this.m_options.options.header,this._updateHeaderOptions(i,t);break;case"scrollPosition":i=this.m_options.getScrollPosition(),this._updateScrollPosition(i);break;case"selection":i=this.m_options.getSelection(),this._updateSelection(i);break;case"selectionMode":this._clearSelection(null);break;default:return!1}return!0},l.prototype._updateSelection=function(e){null!=e&&(this._isSelectionEnabled()?this.SetSelection(e):e.length=0)},l.prototype._updateHeaderOptions=function(e,t){if(null!=t&&null!=t.subkey){var i,s=t.subkey.split("."),o=s[0],n=s[1];if("column"===o&&null!=this.m_colHeader&&null!=this.m_colHeader.firstChild?i=this.m_colHeader.firstChild.childNodes:"row"===o&&null!=this.m_rowHeader&&null!=this.m_rowHeader.firstChild?i=this.m_rowHeader.firstChild.childNodes:"columnEnd"===o&&null!=this.m_colEndHeader&&null!=this.m_colEndHeader.firstChild?i=this.m_colEndHeader.firstChild.childNodes:"rowEnd"===o&&null!=this.m_rowEndHeader&&null!=this.m_rowEndHeader.firstChild&&(i=this.m_rowEndHeader.firstChild.childNodes),null!=i)for(var r=0;r<i.length;r++){var l=i[r],a=l[this.getResources().getMappedAttribute("context")];if(a.index=this.getHeaderCellIndex(l),"resizable"===n)this._isHeaderResizeEnabled(o,a)?this._setAttribute(l,n,"true"):this._setAttribute(l,n,"false");else if("sortable"===n){var h=this.m_utils.containsCSSClassName(l.lastChild,this.getMappedStyle("sortcontainer"));if(this._isSortEnabled(o,a)){if(!h){var d=this._buildSortIcon(a);l.appendChild(d)}this._setAttribute(l,n,"true")}else h&&this._remove(l.lastChild),this._setAttribute(l,n,"false")}}}},l.prototype._updateGridlines=function(){for(var e=this.m_options.getHorizontalGridlines(),t=this.m_options.getVerticalGridlines(),i=this.getResources().isRTLMode()?"right":"left",s=this.m_startRow;s<=this.m_endRow;s++)for(var o=this.m_startCol;o<=this.m_endCol;o++){var n=this._getCellByIndex(this.createIndex(s,o));null!=n&&("hidden"===t||this._isLastColumn(o)&&this.getRowHeaderWidth()+this.getElementDir(n,i)+this.calculateColumnWidth(n)>=this.getWidth()?this.m_utils.addCSSClassName(n,this.getMappedStyle("borderVerticalNone")):this.m_utils.removeCSSClassName(n,this.getMappedStyle("borderVerticalNone")),"hidden"===e||this._isLastRow(s)&&this.getRowBottom(n,null)>=this.getHeight()?this.m_utils.addCSSClassName(n,this.getMappedStyle("borderHorizontalNone")):this.m_utils.removeCSSClassName(n,this.getMappedStyle("borderHorizontalNone")))}},l.prototype._updateEdgeCellBorders=function(e){if(null!=this.m_active&&"header"!==this.m_active.type){var t=this._getActiveElement();null!=t&&(this._isLastRow(this.m_active.indexes.row)&&("none"===e?this.m_utils.addCSSClassName(t,this.getMappedStyle("borderHorizontalNone")):this.m_utils.removeCSSClassName(t,this.getMappedStyle("borderHorizontalNone"))),this._isLastColumn(this.m_active.indexes.column)&&("none"===e?this.m_utils.addCSSClassName(t,this.getMappedStyle("borderVerticalNone")):this.m_utils.removeCSSClassName(t,this.getMappedStyle("borderVerticalNone"))))}},l.prototype.SetResources=function(e){this.m_resources=e},l.prototype.getResources=function(){return this.m_resources},l.prototype.getStartRowHeader=function(){return this.m_startRowHeader},l.prototype.getStartColumnHeader=function(){return this.m_startColHeader},l.prototype.getStartRowEndHeader=function(){return this.m_startRowEndHeader},l.prototype.getStartColumnEndHeader=function(){return this.m_startColEndHeader},l.prototype.getMappedStyle=function(e){return this.getResources().getMappedStyle(e)},l.prototype.SetDataSource=function(e){this.m_modelEvents=[],this.m_dataSource=e},l.prototype.getDataSource=function(){return this.m_dataSource},l.prototype.setVisibility=function(e){this.m_visibility=e},l.prototype.getVisibility=function(){return null==this.m_visibility&&(null!=this.m_root.offsetParent?this.setVisibility(l.VISIBILITY_STATE_VISIBLE):this.setVisibility(l.VISIBILITY_STATE_HIDDEN)),this.m_visibility},l.prototype.SetOptionCallback=function(e){this.m_setOptionCallback=e},l.prototype.SetContextCallback=function(e){this.m_contextCallback=e},l.prototype.SetRemoveCallback=function(e){this.m_removeCallback=e},l.prototype.SetUniqueIdCallback=function(e){this._uniqueIdCallback=e},l.prototype.SetCompareValuesCallback=function(e){this._compareValuesCallback=e},l.prototype.SetSubtreeAttachedCallback=function(e){this.m_subtreeAttachedCallback=e},l.prototype.SetUpdateScrollPostionOnRefreshCallback=function(e){this.m_updateScrollPostionOnRefreshCallback=e},l.prototype._remove=function(e){this._uniqueIdCallback(e,!0),null!=this.m_removeCallback?this.m_removeCallback.call(null,e):e.parentNode.removeChild(e)},l.prototype._removeFromArray=function(e){for(var t=0;t<e.length;t++)this._remove(e[t])},l.prototype.SetNotReadyCallback=function(e){this.m_notReady=e},l.prototype.SetMakeReadyCallback=function(e){this.m_makeReady=e},l.prototype._signalTaskStart=function(){this.m_readinessStack&&(0===this.m_readinessStack.length&&this.m_notReady(),this.m_readinessStack.push(1))},l.prototype._signalTaskEnd=function(){this.m_readinessStack&&this.m_readinessStack.length>0&&(this.m_readinessStack.pop(),0===this.m_readinessStack.length&&this.m_makeReady())},l.prototype._indexes=function(e,t){var i=this,s=this.getDataSource().indexes(e);"function"==typeof s.then?(i._signalTaskStart(),s.then(function(s){t.call(i,s,e),i._signalTaskEnd()},function(){t.call(i,{row:-1,column:-1},e),i._signalTaskEnd()})):t.call(i,s,e)},l.prototype._keys=function(e,t){var i=this,s=this.getDataSource().keys(e);"function"==typeof s.then?(i._signalTaskStart(),s.then(function(s){t.call(i,s,e),i._signalTaskEnd()},function(){t.call(i,{row:null,column:null},e),i._signalTaskEnd()})):t.call(i,s,e)},l.prototype.SetCreateContextCallback=function(e){this.m_createContextCallback=e},l.prototype.SetFocusableCallback=function(e,t){this.m_focusInHandler=e,this.m_focusOutHandler=t},l.prototype.SetFixContextCallback=function(e){this.m_fixContextCallback=e},l.prototype._isHighWatermarkScrolling=function(){return"scroll"!==this.m_options.getScrollPolicy()},l.prototype.destroy=function(){delete this.m_fetching,this._removeDataSourceEventListeners(),this._removeDomEventListeners(),delete this.m_styleClassDimensionMap,this.m_styleClassDimensionMap={width:{},height:{}}},l.prototype._addDataSourceEventListeners=function(){this._removeDataSourceEventListeners(),null!=this.m_dataSource&&(this.m_handleModelEventListener=this.handleModelEvent.bind(this),this.m_handleExpandEventListener=this.handleExpandEvent.bind(this),this.m_handleCollapseEventListener=this.handleCollapseEvent.bind(this),this.m_dataSource.on("change",this.m_handleModelEventListener,this),this.m_dataSource.on("expand",this.m_handleExpandEventListener,this),this.m_dataSource.on("collapse",this.m_handleCollapseEventListener,this))},l.prototype._removeDataSourceEventListeners=function(){null!=this.m_dataSource&&(this.m_dataSource.off("change",this.m_handleModelEventListener),this.m_dataSource.off("expand",this.m_handleExpandEventListener),this.m_dataSource.off("collapse",this.m_handleCollapseEventListener))},l.prototype._addDomEventListeners=function(){this.m_handleDatabodyKeyDown||(this.m_handleDatabodyKeyDown=this.handleDatabodyKeyDown.bind(this)),this.m_handleRootFocus||(this.m_handleRootFocus=this.handleRootFocus.bind(this)),this.m_handleRootBlur||(this.m_handleRootBlur=this.handleRootBlur.bind(this)),this.m_root.addEventListener("keydown",this.m_handleDatabodyKeyDown,!1),this.m_root.addEventListener("focus",this.m_handleRootFocus,!0),this.m_root.addEventListener("blur",this.m_handleRootBlur,!0)},l.prototype._removeDomEventListeners=function(){document.removeEventListener("mousemove",this.m_docMouseMoveListener,!1),document.removeEventListener("mouseup",this.m_docMouseUpListener,!1),null!=this.m_root&&(this.m_handleDatabodyKeyDown&&this.m_root.removeEventListener("keydown",this.m_handleDatabodyKeyDown,!1),this.m_handleRootFocus&&this.m_root.removeEventListener("focus",this.m_handleRootFocus,!0),this.m_handleRootBlur&&this.m_root.removeEventListener("blur",this.m_handleRootBlur,!0))},l.prototype.getRootElement=function(){return this.m_root},l.prototype.getWidth=function(){return null==this.m_width&&(this.m_width=this.getRootElement().clientWidth),this.m_width},l.prototype.getHeight=function(){return null==this.m_height&&(this.m_height=this.getRootElement().clientHeight),this.m_height},l.prototype.getScrollableWidth=function(){var e=this.m_databody.firstChild;return this.getElementWidth(e)},l.prototype.getViewportWidth=function(){var e=this.getWidth();return Math.round(1.5*e)},l.prototype.getViewportHeight=function(){var e=this.getHeight();return Math.round(1.5*e)},l.prototype._getViewportTop=function(){return this.m_currentScrollTop},l.prototype._getViewportBottom=function(){var e=this._getViewportTop(),t=this.getElementHeight(this.m_databody),i=this.m_utils.getScrollbarSize();return this.m_hasHorizontalScroller?e+t-i:e+t},l.prototype._getViewportLeft=function(){return this.m_currentScrollLeft},l.prototype._getViewportRight=function(){var e=this._getViewportLeft(),t=this.getElementWidth(this.m_databody),i=this.m_utils.getScrollbarSize();return this.m_hasVerticalScroller?e+t-i:e+t},l.prototype.getFetchSize=function(e){return"row"===e?(null==this.m_rowFetchSize&&(this.m_rowFetchSize=Math.max(1,Math.round(this.getViewportHeight()/this.getDefaultRowHeight()))),this.m_rowFetchSize):"column"===e?(null==this.m_columnFetchSize&&(this.m_columnFetchSize=Math.max(1,Math.round(this.getViewportWidth()/this.getDefaultColumnWidth()))),this.m_columnFetchSize):0},l.prototype.getEmptyText=function(){var e=this.m_options.getEmptyText();null==e&&(e=this.getResources().getTranslatedText("msgNoData"));return e},l.prototype._buildEmptyText=function(){var e=this.getEmptyText(),t=document.createElement("div");t.id=this.createSubId("empty"),t.className=this.getMappedStyle("emptytext");var i=this.m_endColHeader>=0?this.getColumnHeaderHeight():0;this.setElementDir(t,i,"top");var s=this.getResources().isRTLMode()?"right":"left",o=this.m_endRowHeader>=0?this.getRowHeaderWidth():0;return this.setElementDir(t,o,s),t.textContent=e,this.m_empty=t,t},l.prototype.getRowThreshold=function(){return 0},l.prototype.getColumnThreshold=function(){return 0},l.prototype.setDefaultDimensions=function(){var e=document.createElement("div");e.style.visibilty="hidden";var t=this.getResources();e.className=t.getMappedStyle("rowheadercell")+" "+t.getMappedStyle("colheadercell")+" "+t.getMappedStyle("headercell"),this.m_root.appendChild(e),this.m_defaultColumnWidth=Math.round(e.getBoundingClientRect().width),this.m_defaultRowHeight=Math.round(e.getBoundingClientRect().height),this.m_root.removeChild(e)},l.prototype.getDefaultRowHeight=function(){return null==this.m_defaultRowHeight&&this.setDefaultDimensions(),this.m_defaultRowHeight},l.prototype.getDefaultColumnWidth=function(){return null==this.m_defaultColumnWidth&&this.setDefaultDimensions(),this.m_defaultColumnWidth},l.prototype._getHeaderDimension=function(e,t,i,s){var o=this.m_sizingManager.getSize(i,t);if(null!=o)return o;if(""!==e.style[s])return o=this.getElementDir(e,s),this.m_sizingManager.setSize(i,t,o),o;var n=e.className;return null==(o=this.m_styleClassDimensionMap[s][n])&&(o=this.getElementDir(e,s)),this.m_sizingManager.setSize(i,t,o),this.m_styleClassDimensionMap[s][n]=o,o},l.prototype.createSubId=function(e){var t=this.getRootElement().id;return null==t&&(t=""),[t,e].join(":")},l.prototype.isHeaderFetchComplete=function(){return!1===this.m_fetching.row&&!1===this.m_fetching.column},l.prototype.isFetchComplete=function(){return null!=this.m_fetching&&this.isHeaderFetchComplete()&&!1===this.m_fetching.cells},l.prototype._isLastRow=function(e){return this._isCountUnknown("row")?e===this.m_endRow&&this.m_stopRowFetch:e+1===this.getDataSource().getCount("row")},l.prototype._isLastColumn=function(e){return this._isCountUnknown("column")?e===this.m_endCol&&this.m_stopColumnFetch:e+1===this.getDataSource().getCount("column")},l.prototype.empty=function(){this.m_empty&&this.m_root.removeChild(this.m_empty),this.m_corner&&this._remove(this.m_corner),this.m_bottomCorner&&this._remove(this.m_bottomCorner),this.m_columnHeaderScrollbarSpacer&&this._remove(this.m_columnHeaderScrollbarSpacer),this.m_rowHeaderScrollbarSpacer&&this._remove(this.m_rowHeaderScrollbarSpacer),this.m_root.removeChild(this.m_placeHolder),this.m_root.removeChild(this.m_status),this.m_root.removeChild(this.m_accSummary),this.m_root.removeChild(this.m_accInfo),this.m_root.removeChild(this.m_stateInfo),this.m_root.removeChild(this.m_contextInfo),this._remove(this.m_colHeader),this._remove(this.m_rowHeader),this._remove(this.m_colEndHeader),this._remove(this.m_rowEndHeader),this._remove(this.m_databody),this._clearDatabodyMap()},l.prototype.refresh=function(e){this.resetInternal(),this.render(e)},l.prototype.resetInternal=function(){this.m_initialized=!1,this.m_readinessStack=[],this._signalTaskStart(),this._signalTaskEnd(),this._clearDatabodyMap(),this.m_cursor=null,this.m_corner=null,this.m_bottomCorner=null,this.m_columnHeaderScrollbarSpacer=null,this.m_rowHeaderScrollbarSpacer=null,this.m_colHeader=null,this.m_colEndHeader=null,this.m_rowHeader=null,this.m_rowEndHeader=null,this.m_databody=null,this.m_empty=null,this.m_accInfo=null,this.m_accSummary=null,this.m_contextInfo=null,this.m_placeHolder=null,this.m_stateInfo=null,this.m_status=null,this.m_headerLabels={row:[],column:[],rowEnd:[],columnEnd:[]},this.m_isEstimateRowCount=void 0,this.m_isEstimateColumnCount=void 0,this.m_stopRowFetch=!1,this.m_stopRowHeaderFetch=!1,this.m_stopRowEndHeaderFetch=!1,this.m_stopColumnFetch=!1,this.m_stopColumnHeaderFetch=!1,this.m_stopColumnEndHeaderFetch=!1,this.m_rowFetchSize=null,this.m_columnFetchSize=null,this.m_fetching=null,this.m_processingModelEvent=!1,this.m_processingEventQueue=!1,this.m_animating=!1,this.m_sizingManager.clear(),this.m_styleClassDimensionMap={width:{},height:{}},this.m_height=null,this.m_width=null,this.m_scrollHeight=null,this.m_scrollWidth=null,this.m_avgRowHeight=void 0,this.m_avgColWidth=void 0,this.m_defaultColumnWidth=null,this.m_defaultRowHeight=null,this.m_colHeaderHeight=null,this.m_colEndHeaderHeight=null,this.m_rowHeaderWidth=null,this.m_rowEndHeaderWidth=null,this.m_rowHeaderLevelWidths=[],this.m_rowEndHeaderLevelWidths=[],this.m_columnHeaderLevelHeights=[],this.m_columnEndHeaderLevelHeights=[],this.m_active=null,this.m_prevActive=null,this.m_trueIndex={},this.m_headerDragState=!1,this.m_databodyDragState=!1,this.m_databodyMove=!1,this.m_moveRow=null,this.m_moveRowHeader=null,this.m_dropTarget=null,this.m_dropTargetHeader=null,this.m_discontiguousSelection=!1,this.m_docMouseMoveListener=null,this.m_docMouseUpListener=null,this.m_modelEvents=[],this.m_hasHorizontalScroller=null,this.m_hasVerticalScroller=null,this.m_currentScrollLeft=null,this.m_currentScrollTop=null,this.m_prevScrollLeft=null,this.m_prevScrollTop=null,this.m_handleScrollOverflow=null,this.m_resizing=!1,this.m_resizingElement=null,this.m_resizingElementMin=null,this.m_startRow=null,this.m_startCol=null,this.m_endRow=null,this.m_endCol=null,this.m_startRowPixel=null,this.m_startColPixel=null,this.m_endRowPixel=null,this.m_endColPixel=null,this.m_startRowHeader=null,this.m_startColHeader=null,this.m_endRowHeader=null,this.m_endColHeader=null,this.m_startRowHeaderPixel=null,this.m_startColHeaderPixel=null,this.m_endRowHeaderPixel=null,this.m_endColHeaderPixel=null,this.m_rowHeaderLevelCount=null,this.m_columnHeaderLevelCount=null,this.m_startRowEndHeader=null,this.m_startColEndHeader=null,this.m_endRowEndHeader=null,this.m_endColEndHeader=null,this.m_startRowEndHeaderPixel=null,this.m_startColEndHeaderPixel=null,this.m_endRowEndHeaderPixel=null,this.m_endColEndHeaderPixel=null,this.m_rowEndHeaderLevelCount=null,this.m_columnEndHeaderLevelCount=null,this.m_sortInfo=null,this.m_resizeRequired=null,this.m_externalFocus=null,this.m_currentMode=null,this.m_editMode=null,this.m_hasCells=null,this.m_hasRowHeader=null,this.m_hasRowEndHeader=null,this.m_hasColHeader=null,this.m_hasColEndHeader=null,this.m_isLongScroll=null,this.m_addBorderBottom=null,this.m_addBorderRight=null},l.prototype._shouldInitialize=function(){return this.isFetchComplete()&&!this.m_initialized&&null!=this.m_databody.parentNode},l.prototype._handleInitialization=function(e){!0===e?(this.resizeGrid(),0===this.m_startRow&&0===this.m_startCol&&this.fillViewport(),this.isFetchComplete()&&(this._updateActive(this.m_options.getCurrentCell(),!1,!1),this.m_initialized=!0,this.fireEvent("ready",{}),this._runModelEventQueue())):(this.m_initialized=!0,this.fireEvent("ready",{}),this._runModelEventQueue())},l.prototype._runModelEventQueue=function(){var e;if(null!=this.m_modelEvents){if(this.m_processingEventQueue=!0,0===this.m_modelEvents.length)return void(this.m_processingEventQueue=!1);"expand"===(e=this.m_modelEvents.shift()).operation?this.handleExpandEvent(e,!0):"collapse"===e.operation?this.handleCollapseEvent(e,!0):this.handleModelEvent(e,!0)}else this.m_processingEventQueue=!1},l.prototype.render=function(e){null!=this.m_databody&&(this.destroy(),this.resetInternal()),this.m_timingStart=new Date,this.m_fetching={},this.m_startRow=0,this.m_startCol=0,this.m_endRow=-1,this.m_endCol=-1,this.m_startRowPixel=0,this.m_startColPixel=0,this.m_endRowPixel=0,this.m_endColPixel=0,this.m_startRowHeader=0,this.m_startColHeader=0,this.m_endRowHeader=-1,this.m_endColHeader=-1,this.m_startRowHeaderPixel=0,this.m_startColHeaderPixel=0,this.m_endRowHeaderPixel=0,this.m_endColHeaderPixel=0,this.m_startRowEndHeader=0,this.m_startColEndHeader=0,this.m_endRowEndHeader=-1,this.m_endColEndHeader=-1,this.m_startRowEndHeaderPixel=0,this.m_startColEndHeaderPixel=0,this.m_endRowEndHeaderPixel=0,this.m_endColEndHeaderPixel=0,this.m_currentScrollLeft=0,this.m_currentScrollTop=0,this.m_prevScrollLeft=0,this.m_prevScrollTop=0,this.m_handleScrollOverflow=!1,this.m_rowHeaderLevelWidths=[],this.m_rowEndHeaderLevelWidths=[],this.m_columnHeaderLevelHeights=[],this.m_columnEndHeaderLevelHeights=[],this.buildGrid(e)},l.prototype.buildGrid=function(e){this.m_root=e,this.m_root.setAttribute("role","application"),this._isCellEditable()?this.m_utils.addCSSClassName(this.m_root,this.getMappedStyle("editable")):this.m_utils.addCSSClassName(this.m_root,this.getMappedStyle("readOnly")),e.tabIndex=0;var t=this.buildStatus();e.appendChild(t),this.m_status=t;var i=this.buildAccSummary();e.appendChild(i),this.m_accSummary=i;var s=this.buildAccInfo();e.appendChild(s),this.m_accInfo=s;var o=this.buildStateInfo();e.appendChild(o),this.m_stateInfo=o;var n=this.buildContextInfo();e.appendChild(n),this.m_contextInfo=n;var r=this.buildPlaceHolder();if(e.appendChild(r),this.m_placeHolder=r,this.m_headerLabels={row:[],column:[],rowEnd:[],columnEnd:[]},null!=this.getDataSource()){this.m_empty=null;var l=this.getResources().isRTLMode(),a=this.buildHeaders("column",this.getMappedStyle("colheader"),this.getMappedStyle("colendheader")),h=a.root,d=a.endRoot;e.insertBefore(h,t),e.insertBefore(d,t);var m=(a=this.buildHeaders("row",this.getMappedStyle("rowheader"),this.getMappedStyle("rowendheader"))).root,c=a.endRoot;e.insertBefore(m,t),e.insertBefore(c,t);var u=this.buildDatabody();if(e.insertBefore(u,t),l&&(h.style.direction="rtl",u.style.direction="rtl"),this.m_isResizing=!1,this.m_resizingElement=null,this.m_resizingElementMin=null,this.m_databodyDragState=!1,this.m_docMouseMoveListener=this.handleMouseMove.bind(this),this.m_docMouseUpListener=this.handleMouseUp.bind(this),this.m_utils.isTouchDevice())u.addEventListener("touchstart",this.handleTouchStart.bind(this),!1),u.addEventListener("touchmove",this.handleTouchMove.bind(this),!1),u.addEventListener("touchend",this.handleTouchEnd.bind(this),!1),u.addEventListener("touchcancel",this.handleTouchCancel.bind(this),!1),h.addEventListener("touchstart",this.handleHeaderTouchStart.bind(this),!1),h.addEventListener("touchmove",this.handleHeaderTouchMove.bind(this),!1),h.addEventListener("touchend",this.handleHeaderTouchEnd.bind(this),!1),h.addEventListener("touchcancel",this.handleHeaderTouchCancel.bind(this),!1),m.addEventListener("touchstart",this.handleHeaderTouchStart.bind(this),!1),m.addEventListener("touchmove",this.handleHeaderTouchMove.bind(this),!1),m.addEventListener("touchend",this.handleHeaderTouchEnd.bind(this),!1),m.addEventListener("touchcancel",this.handleHeaderTouchCancel.bind(this),!1),d.addEventListener("touchstart",this.handleHeaderTouchStart.bind(this),!1),d.addEventListener("touchmove",this.handleHeaderTouchMove.bind(this),!1),d.addEventListener("touchend",this.handleHeaderTouchEnd.bind(this),!1),d.addEventListener("touchcancel",this.handleHeaderTouchCancel.bind(this),!1),c.addEventListener("touchstart",this.handleHeaderTouchStart.bind(this),!1),c.addEventListener("touchmove",this.handleHeaderTouchMove.bind(this),!1),c.addEventListener("touchend",this.handleHeaderTouchEnd.bind(this),!1),c.addEventListener("touchcancel",this.handleHeaderTouchCancel.bind(this),!1);else{var _=this.m_utils.getMousewheelEvent();u.addEventListener(_,this.handleDatabodyMouseWheel.bind(this),!1),u.addEventListener("mousedown",this.handleDatabodyMouseDown.bind(this),!1),u.addEventListener("mousemove",this.handleDatabodyMouseMove.bind(this),!1),u.addEventListener("mouseup",this.handleDatabodyMouseUp.bind(this),!1),u.addEventListener("mouseout",this.handleDatabodyMouseOut.bind(this),!1),u.addEventListener("mouseover",this.handleDatabodyMouseOver.bind(this),!1),u.addEventListener("dblclick",this.handleDatabodyDoubleClick.bind(this),!1),m.addEventListener(_,this.handleDatabodyMouseWheel.bind(this),!1),m.addEventListener("mousedown",this.handleHeaderMouseDown.bind(this),!1),h.addEventListener("mousedown",this.handleHeaderMouseDown.bind(this),!1),m.addEventListener("mouseover",this.handleHeaderMouseOver.bind(this),!1),h.addEventListener("mouseover",this.handleHeaderMouseOver.bind(this),!1),m.addEventListener("mousemove",this.handleRowHeaderMouseMove.bind(this),!1),h.addEventListener("mousemove",this.handleColumnHeaderMouseMove.bind(this),!1),m.addEventListener("mouseup",this.handleHeaderMouseUp.bind(this),!1),h.addEventListener("mouseup",this.handleHeaderMouseUp.bind(this),!1),m.addEventListener("mouseout",this.handleHeaderMouseOut.bind(this),!1),h.addEventListener("mouseout",this.handleHeaderMouseOut.bind(this),!1),m.addEventListener("click",this.handleHeaderClick.bind(this),!1),h.addEventListener("click",this.handleHeaderClick.bind(this),!1),c.addEventListener(_,this.handleDatabodyMouseWheel.bind(this),!1),c.addEventListener("mousedown",this.handleHeaderMouseDown.bind(this),!1),d.addEventListener("mousedown",this.handleHeaderMouseDown.bind(this),!1),c.addEventListener("mouseover",this.handleHeaderMouseOver.bind(this),!1),d.addEventListener("mouseover",this.handleHeaderMouseOver.bind(this),!1),c.addEventListener("mousemove",this.handleRowHeaderMouseMove.bind(this),!1),d.addEventListener("mousemove",this.handleColumnHeaderMouseMove.bind(this),!1),c.addEventListener("mouseup",this.handleHeaderMouseUp.bind(this),!1),d.addEventListener("mouseup",this.handleHeaderMouseUp.bind(this),!1),c.addEventListener("mouseout",this.handleHeaderMouseOut.bind(this),!1),d.addEventListener("mouseout",this.handleHeaderMouseOut.bind(this),!1),c.addEventListener("click",this.handleHeaderClick.bind(this),!1),d.addEventListener("click",this.handleHeaderClick.bind(this),!1)}this._shouldInitialize()&&this._handleInitialization(!0)}else{var p=this._buildEmptyText();this.m_root.appendChild(p),this._handleInitialization(!1)}},l.prototype.HandleResize=function(e,t){e=this.getRootElement().clientWidth,t=this.getRootElement().clientHeight,e===this.m_width&&t===this.m_height||(this.m_width=e,this.m_height=t,this.m_rowFetchSize=null,this.m_columnFetchSize=null,this.m_initialized&&(this.resizeGrid(),this.isFetchComplete()&&(this.m_resizeRequired=!0,this.fillViewport())))},l.prototype.resizeGrid=function(){var e,t,i,s=this.getWidth(),o=this.getHeight(),n=this.m_colHeader,r=this.m_colEndHeader,l=this.m_rowHeader,a=this.m_rowEndHeader,h=this.m_databody,d=h.firstChild,m=this.getColumnHeaderHeight(),c=this.getColumnEndHeaderHeight(),u=this.getRowHeaderWidth(),_=o-m-c,p=s-u-this.getRowEndHeaderWidth(),g=this.m_utils.getScrollbarSize();this._databodyEmpty()&&(null==this.m_empty?(e=this._buildEmptyText(),this.m_root.appendChild(e)):e=this.m_empty,t=this.getElementHeight(e),i=this.getElementWidth(e),t>this.getElementHeight(d)&&this.setElementHeight(d,t),i>this.getElementWidth(d)&&this.setElementWidth(d,i));var C,f,v,y,E,S=this.getElementWidth(h.firstChild),w=this.getElementHeight(h.firstChild),H=this.isDatabodyHorizontalScrollbarRequired(p);if(H)C=this.isDatabodyVerticalScrollbarRequired(_-g),h.style.overflow="auto";else if(C=this.isDatabodyVerticalScrollbarRequired(_))H=this.isDatabodyHorizontalScrollbarRequired(p-g),h.style.overflow="auto";else{this.m_handleScrollOverflow=!1;var b=this;setTimeout(function(){b.m_handleScrollOverflow||b.m_hasVerticalScroller||b.m_hasHorizontalScroller||(h.style.overflow="hidden",b.m_handleScrollOverflow=!0)},10)}this.m_hasHorizontalScroller=H,this.m_hasVerticalScroller=C,-1!==this.m_endColEndHeader?(f=Math.min(w+(H?g:0),_),v=H?f-g:f):(f=_,v=Math.min(w,H?f-g:f)),-1!==this.m_endRowEndHeader?(y=Math.min(S+(C?g:0),p),E=C?y-g:y):(y=p,E=Math.min(S,C?y-g:y));var x=u+E+(C?g:0),R=m+v+(H?g:0),M=this.getResources().isRTLMode()?"right":"left";this.setElementDir(l,0,M),this.setElementDir(l,m,"top"),this.setElementHeight(l,v),this.setElementDir(a,x,M),this.setElementDir(a,m,"top"),this.setElementHeight(a,v),this.setElementDir(n,u,M),this.setElementWidth(n,E),this.setElementDir(r,u,M),this.setElementDir(r,R,"top"),this.setElementWidth(r,E),this.setElementDir(h,m,"top"),this.setElementDir(h,u,M),this.setElementWidth(h,y),this.setElementHeight(h,f),this.m_scrollWidth=S-E,this.m_scrollHeight=w-v,this.buildCorners(),this._adjustHeaderBorders(),this._updateGridlines(),this.m_resizeRequired=!1},l.prototype._sizeDatabodyScroller=function(){var e,t,i=this.m_databody,s=i.firstChild,o=this._databodyEmpty(),n=this._isHighWatermarkScrolling(),r=this.m_utils._getMaxDivHeightForScrolling(),l=this.m_utils._getMaxDivWidthForScrolling(),a=this.getDataSource().getCount("row"),h=this.getDataSource().getCount("column"),d=0,m=0;o?(d=Math.max(Math.max(this.m_endRowHeaderPixel,this.m_endRowEndHeaderPixel),1),m=Math.max(Math.max(this.m_endColHeaderPixel,this.m_endColEndHeaderPixel),1)):(d=this.m_endRowPixel,m=this.m_endColPixel),e=-1===a||n?d:a*this.m_avgRowHeight,t=-1===h||n?m:h*this.m_avgColWidth,this.setElementHeight(s,Math.min(r,e)),this.setElementWidth(s,Math.min(l,t)),this.m_initialized&&(this.m_scrollWidth=this.getElementWidth(s)-Math.min(this.getElementWidth(s),this.getElementWidth(i)-(this.m_hasVerticalScroller?this.m_utils.getScrollbarSize():0)),this.m_scrollHeight=this.getElementHeight(s)-Math.min(this.getElementHeight(s),this.getElementHeight(i)-(this.m_hasHorizontalScroller?this.m_utils.getScrollbarSize():0)))},l.prototype._adjustLastHeadersAlongAxis=function(e,t,i,s,o,n){for(var r=0;r<t;){var l=this._getHeaderByIndex(e,r,i,t,s);n?this.m_utils.removeCSSClassName(l,o):this.m_utils.addCSSClassName(l,o),r+=this.getHeaderCellDepth(l)}},l.prototype._adjustHeaderBordersAlongAxis=function(e,t,i,s,o,n,r,l){null!=e&&i>=0&&(s?this.m_utils.addCSSClassName(o,n):this.m_utils.removeCSSClassName(o,n),t(i)&&this._adjustLastHeadersAlongAxis(i,r,e,l,n,s))},l.prototype._adjustHeaderBorders=function(){var e,t,i,s,o,n=this.m_utils.getScrollbarSize(),r=this.getWidth(),l=this.getHeight(),a=this.getColumnHeaderHeight(),h=this.getElementWidth(this.m_colHeader),d=this.getElementHeight(this.m_colEndHeader),m=this.getRowHeaderWidth(),c=this.getElementHeight(this.m_rowHeader),u=m+h+this.getElementWidth(this.m_rowEndHeader)+(this.m_hasVerticalScroller?n:0)<r,_=a+c+d+(this.m_hasHorizontalScroller?n:0)<l;if(u&&this.m_endRowEndHeader>=0?(e=!0,this.m_addBorderRight=!0):!0===this.m_addBorderRight&&(e=!1),null!=e)for(t=this.getMappedStyle("borderVerticalSmall"),null!=this.m_columnHeaderScrollbarSpacer&&(e?this.m_utils.addCSSClassName(this.m_columnHeaderScrollbarSpacer,t):this.m_utils.removeCSSClassName(this.m_columnHeaderScrollbarSpacer,t)),null!=this.m_bottomCorner&&(e?this.m_utils.addCSSClassName(this.m_bottomCorner,t):this.m_utils.removeCSSClassName(this.m_bottomCorner,t)),s=this.m_rowEndHeader.firstChild.childNodes,i=0;i<s.length;i++)e?this.m_utils.addCSSClassName(s[i],t):this.m_utils.removeCSSClassName(s[i],t);else t=this.getMappedStyle("borderVerticalNone"),o=this._isLastColumn.bind(this),this._adjustHeaderBordersAlongAxis(this.m_colHeader,o,this.m_endColHeader,u,this.m_columnHeaderScrollbarSpacer,t,this.m_columnHeaderLevelCount,this.m_startColHeader),this._adjustHeaderBordersAlongAxis(this.m_colEndHeader,o,this.m_endColEndHeader,u,this.m_bottomCorner,t,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader);if(e=null,_&&this.m_endColEndHeader>=0?(this.m_addBorderBottom=!0,e=!0):!0===this.m_addBorderBottom&&(e=!1),null!=e)for(t=this.getMappedStyle("borderHorizontalSmall"),null!=this.m_rowHeaderScrollbarSpacer&&(e?this.m_utils.addCSSClassName(this.m_rowHeaderScrollbarSpacer,t):this.m_utils.removeCSSClassName(this.m_rowHeaderScrollbarSpacer,t)),null!=this.m_bottomCorner&&(e?this.m_utils.addCSSClassName(this.m_bottomCorner,t):this.m_utils.removeCSSClassName(this.m_bottomCorner,t)),s=this.m_colEndHeader.firstChild.childNodes,i=0;i<s.length;i++)e?this.m_utils.addCSSClassName(s[i],t):this.m_utils.removeCSSClassName(s[i],t);else t=this.getMappedStyle("borderHorizontalNone"),o=this._isLastRow.bind(this),this._adjustHeaderBordersAlongAxis(this.m_rowHeader,o,this.m_endRowHeader,_,this.m_rowHeaderScrollbarSpacer,t,this.m_rowHeaderLevelCount,this.m_startRowHeader),this._adjustHeaderBordersAlongAxis(this.m_rowEndHeader,o,this.m_endRowEndHeader,_,this.m_bottomCorner,t,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader)},l.prototype.buildCorners=function(){var e,t,i,s,o,n,r=this.m_utils.getScrollbarSize(),l=this.getWidth(),a=this.getHeight(),h=this.getColumnHeaderHeight(),d=this.getElementWidth(this.m_colHeader),m=this.getColumnEndHeaderHeight(),c=this.getRowHeaderWidth(),u=this.getRowEndHeaderWidth(),_=this.getElementHeight(this.m_rowHeader),p=this.getResources().isRTLMode()?"right":"left";if(-1!==this.m_endRowHeader&&-1!==this.m_endColHeader){if(null!=this.m_corner?e=this.m_corner:((e=document.createElement("div")).id=this.createSubId("corner"),e.className=this.getMappedStyle("topcorner")),this.setElementWidth(e,c),this.setElementHeight(e,h),null==this.m_corner){this.m_utils.isTouchDevice()?e.addEventListener("touchstart",this.handleCornerMouseDown.bind(this),!1):(e.addEventListener("mousedown",this.handleCornerMouseDown.bind(this),!1),e.addEventListener("mouseover",this.handleCornerMouseOver.bind(this),!1),e.addEventListener("mouseout",this.handleCornerMouseOut.bind(this),!1)),e.addEventListener("click",this.handleCornerClick.bind(this),!1),this.m_root.appendChild(e),this.m_corner=e;var g=this.m_headerLabels.column.length?this.m_columnHeaderLevelHeights[this.m_columnHeaderLevelCount-1]:this.m_colHeaderHeight;for(n=0;n<this.m_headerLabels.row.length;n++)o=this.m_headerLabels.row[n],this.setElementHeight(o,g),e.appendChild(o);for(g=this.m_headerLabels.row.length?this.m_rowHeaderLevelWidths[this.m_rowHeaderLevelCount-1]:this.m_rowHeaderWidth,n=0;n<this.m_headerLabels.column.length;n++)o=this.m_headerLabels.column[n],this.setElementWidth(o,g),e.appendChild(o);if(this.m_headerLabels.column[this.m_columnHeaderLevelCount-1]&&this.m_headerLabels.row[this.m_rowHeaderLevelCount-1]){var C=this._getHeaderByIndex(this.m_startColHeader,this.m_columnHeaderLevelCount-1,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader),f=this.getElementHeight(C);return this.m_colHeaderHeight+=f,this.m_columnHeaderLevelHeights[this.m_columnHeaderLevelCount-1]+=f,this.resizeColumnHeightsAndShift(f,this.m_columnHeaderLevelCount-1,!1),this.setElementHeight(this.m_colHeader,this.m_colHeaderHeight),void this.manageResizeScrollbars()}}}else this.m_headerLabels.row=[],this.m_headerLabels.column=[];if(null!=this.m_corner&&null==e&&(this.m_root.removeChild(this.m_corner),this.m_corner=null),-1!==this.m_endRowHeader)if(this.m_hasHorizontalScroller||-1!==this.m_endColEndHeader){if(null!=this.m_rowHeaderScrollbarSpacer?i=this.m_rowHeaderScrollbarSpacer:((i=document.createElement("div")).id=this.createSubId("rhSbSpacer"),i.className=this.getMappedStyle("rowheaderspacer")),this.setElementDir(i,_+h,"top"),this.setElementDir(i,0,p),this.setElementWidth(i,this.m_rowHeaderWidth),-1!==this.m_endColEndHeader?this.setElementHeight(i,m+(this.m_hasHorizontalScroller?r:0)):this.setElementHeight(i,a-_-h),null==this.m_rowHeaderScrollbarSpacer)for(this.m_utils.isTouchDevice()?i.addEventListener("touchstart",this.handleCornerMouseDown.bind(this),!1):(i.addEventListener("mousedown",this.handleCornerMouseDown.bind(this),!1),i.addEventListener("mouseover",this.handleCornerMouseOver.bind(this),!1),i.addEventListener("mouseout",this.handleCornerMouseOut.bind(this),!1)),this.m_root.appendChild(i),this.m_rowHeaderScrollbarSpacer=i,n=0;n<this.m_headerLabels.columnEnd.length;n++)o=this.m_headerLabels.columnEnd[n],i.appendChild(o)}else null!=this.m_rowHeaderScrollbarSpacer&&this.m_root.removeChild(this.m_rowHeaderScrollbarSpacer),this.m_rowHeaderScrollbarSpacer=null,this.m_headerLabels.columnEnd=[];if(-1!==this.m_endColHeader)if(this.m_hasVerticalScroller||-1!==this.m_endRowEndHeader){if(null!=this.m_columnHeaderScrollbarSpacer?s=this.m_columnHeaderScrollbarSpacer:((s=document.createElement("div")).id=this.createSubId("chSbSpacer"),s.className=this.getMappedStyle("colheaderspacer")),this.setElementDir(s,c+d,p),this.setElementDir(s,0,"top"),-1!==this.m_endRowEndHeader?this.setElementWidth(s,u+(this.m_hasVerticalScroller?r:0)):this.setElementWidth(s,l-d-c),this.setElementHeight(s,this.m_colHeaderHeight),null==this.m_columnHeaderScrollbarSpacer)for(this.m_utils.isTouchDevice()?s.addEventListener("touchstart",this.handleCornerMouseDown.bind(this),!1):(s.addEventListener("mousedown",this.handleCornerMouseDown.bind(this),!1),s.addEventListener("mouseover",this.handleCornerMouseOver.bind(this),!1),s.addEventListener("mouseout",this.handleCornerMouseOut.bind(this),!1)),this.m_root.appendChild(s),this.m_columnHeaderScrollbarSpacer=s,n=0;n<this.m_headerLabels.rowEnd.length;n++)o=this.m_headerLabels.rowEnd[n],s.appendChild(o)}else null!=this.m_columnHeaderScrollbarSpacer&&this.m_root.removeChild(this.m_columnHeaderScrollbarSpacer),this.m_columnHeaderScrollbarSpacer=null,this.m_headerLabels.rowEnd=[];(this.m_hasHorizontalScroller&&this.m_hasVerticalScroller||this.m_hasVerticalScroller&&-1!==this.m_endColEndHeader||this.m_hasHorizontalScroller&&-1!==this.m_endRowEndHeader||-1!==this.m_endRowEndHeader&&-1!==this.m_endColEndHeader)&&(null!=this.m_bottomCorner?t=this.m_bottomCorner:((t=document.createElement("div")).id=this.createSubId("bcorner"),t.className=this.getMappedStyle("bottomcorner")),this.setElementDir(t,_+h,"top"),this.setElementDir(t,c+d,p),-1!==this.m_endRowEndHeader?this.setElementWidth(t,u+(this.m_hasVerticalScroller?r:0)):this.setElementWidth(t,l-d-c),-1!==this.m_endColEndHeader?this.setElementHeight(t,m+(this.m_hasHorizontalScroller?r:0)):this.setElementHeight(t,a-_-h),null==this.m_bottomCorner&&(this.m_root.appendChild(t),this.m_bottomCorner=t)),null!=this.m_bottomCorner&&null==t&&(this.m_root.removeChild(this.m_bottomCorner),this.m_bottomCorner=null)},l.prototype._updateScrollPosition=function(e){this._scrollToScrollPositionObject(e)},l.prototype._setScrollPosition=function(){this.m_setOptionCallback("scrollPosition",this._createScrollPositionObject(this.m_currentScrollLeft,this.m_currentScrollTop),{_context:{writeback:!0,internalSet:!0}})},l.prototype._clearScrollPositionKeys=function(){var e=this.m_options.getScrollPosition();e.rowKey=void 0,e.columnKey=void 0,this.m_setOptionCallback("scrollPosition",e,{_context:{internalSet:!0}})},l.prototype._createScrollPositionObject=function(e,t){var i={x:e,y:t},s=this.getResources().isRTLMode()?"right":"left",o=this._getCellAtPixel(e,t);if(null!=o)i.rowIndex=this._getIndex(o,"row"),i.columnIndex=this._getIndex(o,"column"),i.rowKey=this._getKey(o,"row"),i.columnKey=this._getKey(o,"column"),i.offsetX=e-this.getElementDir(o,s),i.offsetY=t-this.getElementDir(o,"top");else{var n=this._getHeaderAtPixel(t,"row");null!=n&&(i.rowIndex=this._getIndex(n),i.rowKey=this._getKey(n),i.offsetY=t-this.getElementDir(n,"top"));var r=this._getHeaderAtPixel(e,"column");null!=r&&(i.columnIndex=this._getIndex(r),i.columnKey=this._getKey(r),i.offsetX=e-this.getElementDir(r,s))}return i},l.prototype._getCellAtPixel=function(e,t){for(var i=this.m_databody.firstChild.childNodes,s=this.getResources().isRTLMode()?"right":"left",o=0;o<i.length;o++){var n=i[o],r=this.getElementDir(n,s),l=r+this.getElementWidth(n);if(r<=e&&e<l){var a=this.getElementDir(n,"top"),h=a+this.getElementHeight(n);if(a<=t&&t<h)return n}}return null},l.prototype._getHeaderAtPixel=function(e,t){var i,s,o,n,r=this;function l(t){for(var i=0;i<t.length;i++){var s=t[i],l=r.getElementDir(s,o),a=l+r.getElementDir(s,n);if(l<=e&&e<a)return s}}"row"===t?(i=this.m_rowHeader.firstChild.childNodes,s=this.m_rowEndHeader.firstChild.childNodes,o="top",n="height"):"column"===t&&(i=this.m_colHeader.firstChild.childNodes,s=this.m_colEndHeader.firstChild.childNodes,o=this.getResources().isRTLMode()?"right":"left",n="width");var a=l(i);return null==a&&(a=l(s)),a},l.prototype._checkScrollPosition=function(){null!=this.m_desiredScrollPositionObject?this._scrollToScrollPositionObject(this.m_desiredScrollPositionObject):this._setScrollPosition()},l.prototype._scrollToScrollPositionObject=function(e){var t=e.x,i=e.y,s=e.rowIndex,o=e.columnIndex,n=e.rowKey,r=e.columnKey,l=e.offsetX?e.offsetX:0,a=e.offsetY?e.offsetY:0,h=this.getResources().isRTLMode()?"right":"left",d=this;new Promise(function(e){null!=n||null!=r?d._indexes({row:n,column:r},function(t){e({rowIndexFromKey:t.row,columnIndexFromKey:t.column})}):e({rowIndexFromKey:null,columnIndexFromKey:null})}).then(function(m){var c=Math.floor(d._getPositionEstimate("column",h,r,m.columnIndexFromKey,o,t,l,d.m_currentScrollLeft,d._getMaxRightPixel(),d.m_avgColWidth)),u=Math.floor(d._getPositionEstimate("row","top",n,m.rowIndexFromKey,s,i,a,d.m_currentScrollTop,d._getMaxBottomPixel(),d.m_avgRowHeight));c!==d.m_currentScrollLeft&&(d.m_currentScrollLeft!==d.m_scrollWidth||c<d.m_currentScrollLeft)||u!==d.m_currentScrollTop&&(d.m_currentScrollTop!==d.m_scrollHeight||u<d.m_currentScrollTop)?(null==d.m_desiredScrollPositionObject&&d._signalTaskStart("begin scrolling to new desired location"),d.m_desiredScrollPositionObject=e,d._initiateScroll(c,u)):(null!=d.m_desiredScrollPositionObject&&d._signalTaskEnd("reached desired location"),d.m_desiredScrollPositionObject=null,d._setScrollPosition())})},l.prototype._getPositionEstimate=function(e,t,i,s,o,n,r,l,a,h){var d,m,c=this._isHighWatermarkScrolling();return null!=i&&-1!==s&&(null!=(m=this._getCellOrHeaderByKey(i,e))?d=this.getElementDir(m,t)+r:c?d=a:null!=s&&(d=h*s+r),null!=d)?d:d=null!=o?null!=(m=this._getCellOrHeaderByIndex(o,e))?this.getElementDir(m,t)+r:c?a:h*o:null!=n?n:l},l.prototype.isDatabodyHorizontalScrollbarRequired=function(e){var t,i=this.m_databody;t=null==e?this.getElementWidth(i):e;var s=i.firstChild;return this.getElementWidth(s)>t},l.prototype.isDatabodyVerticalScrollbarRequired=function(e){var t,i=this.m_databody;t=null==e?this.getElementHeight(i):e;var s=i.firstChild;return this.getElementHeight(s)>t},l.prototype.buildStatus=function(){var e=document.createElement("div");e.className=this.getMappedStyle("loadingicon");var t=document.createElement("div");return t.id=this.createSubId("status"),t.className=this.getMappedStyle("status"),t.setAttribute("role","status"),t.appendChild(e),t},l.prototype.buildAccInfo=function(){var e=document.createElement("div");return e.id=this.createSubId("info"),e.className=this.getMappedStyle("info"),e.setAttribute("role","status"),e},l.prototype.buildAccSummary=function(){var e=document.createElement("div");return e.id=this.createSubId("summary"),e.className=this.getMappedStyle("info"),e},l.prototype.buildStateInfo=function(){var e=document.createElement("div");return e.id=this.createSubId("state"),e.className=this.getMappedStyle("info"),e},l.prototype.buildContextInfo=function(){var e=document.createElement("div");return e.id=this.createSubId("context"),e.className=this.getMappedStyle("info"),e},l.prototype.buildPlaceHolder=function(){var e=document.createElement("div");return e.id=this.createSubId("placeHolder"),e.className=this.getMappedStyle("info"),e},l.prototype.populateAccInfo=function(){var e=this.getResources().getTranslatedText("accessibleSummaryExact",{rownum:this.m_endRow+1,colnum:this.m_endCol+1});this.getDataSource().getExpandedKeys&&(e=e+". "+this.getResources().getTranslatedText("accessibleSummaryExpanded",{num:this.getDataSource().getExpandedKeys().length}));e+=". ",this.m_accSummary.textContent=e},l.prototype.SetAccessibleContext=function(e){if(null!=e&&(null!=e.context&&(this.m_accessibleContext=e.context),null!=e.state&&(this.m_stateInfo.textContent=e.state),null!=e.ancestors&&this._isDatabodyCellActive())){var t="",i=e.ancestors,s=this.m_active.indexes.column;if(null!=s&&s>=0)for(var o=0;o<i.length;o++){o>0&&(t=t.concat(", "));var n=i[o],r=this._getAxisCellsByKey(n.key,"row");if(null!=r){var l=r[0].textContent;l=null!=l?l.replace(/\n|<br\s*\/?>/gi,"").trim():"",t=t.concat(n.label).concat(" ").concat(l)}}this.m_accessibleContext=t.concat(", ").concat(this.m_accessibleContext)}},l.prototype._updateStateInfo=function(e){for(var t=". ",i=0;i<e.length;i++){var s=this.getResources().getTranslatedText(e[i].key,e[i].args);null!=s&&(t=2===t.length?t+s:t+", "+s)}t=0===t.length?t:t+". ",this.m_stateInfo.textContent=t},l.prototype._updateContextInfo=function(e,t){var i,s,o;e.indexes&&(i=e.indexes.row,s=e.indexes.column);var n=e.level,r=e.rowHeader,l=e.rowEndHeader,a=e.columnHeader,h=e.columnEndHeader,d="";null!=this.m_accessibleContext||isNaN(i)||"row"===t||null!=(o=this.getResources().getTranslatedText("accessibleRowContext",{index:i+1}))&&(d=o),isNaN(s)||"column"===t||null!=(o=this.getResources().getTranslatedText("accessibleColumnContext",{index:s+1}))&&(d=0===d.length?o:d+", "+o),isNaN(r)||"rowHeader"===t||null!=(o=this.getResources().getTranslatedText("accessibleRowHeaderContext",{index:r+1}))&&(d=0===d.length?o:d+", "+o),isNaN(a)||"columnHeader"===t||null!=(o=this.getResources().getTranslatedText("accessibleColumnHeaderContext",{index:a+1}))&&(d=0===d.length?o:d+", "+o),isNaN(l)||"rowEndHeader"===t||null!=(o=this.getResources().getTranslatedText("accessibleRowEndHeaderContext",{index:l+1}))&&(d=0===d.length?o:d+", "+o),isNaN(h)||"columnEndHeader"===t||null!=(o=this.getResources().getTranslatedText("accessibleColumnEndHeaderContext",{index:h+1}))&&(d=0===d.length?o:d+", "+o),isNaN(n)||"level"===t||null!=(o=this.getResources().getTranslatedText("accessibleLevelContext",{level:n+1}))&&(d=0===d.length?o:d+", "+o),d=0===d.length?d:d+". ",null!=this.m_accessibleContext&&(d+=this.m_accessibleContext,this.m_accessibleContext=null),this.m_contextInfo.textContent=d},l.prototype._isCountUnknown=function(e){var t=this.getDataSource();if("row"===e||"rowEnd"===e){if(void 0===this.m_isEstimateRowCount){var i=t.getCountPrecision("row"),s=t.getCount("row");this.m_isEstimateRowCount="estimate"===i||s<0}return this.m_isEstimateRowCount}if("column"===e||"columnEnd"===e){if(void 0===this.m_isEstimateColumnCount){var o=t.getCountPrecision("column"),n=t.getCount("column");this.m_isEstimateColumnCount="estimate"===o||n<0}return this.m_isEstimateColumnCount}return!1},l.prototype._isCountUnknownOrHighwatermark=function(e){return this._isCountUnknown(e)||this._isHighWatermarkScrolling()},l.prototype._hideHeader=function(e){e.style.display="none"},l.prototype._showHeader=function(e){e.style.display=""},l.prototype.buildHeaders=function(e,t,i){var s=this.getMappedStyle("scroller")+(this.m_utils.isTouchDevice()?" "+this.getMappedStyle("scroller-mobile"):""),o=document.createElement("div");o.id=this.createSubId(e+"Header"),o.className=t+" "+this.getMappedStyle("header");var n=document.createElement("div");n.className=s,o.appendChild(n);var r=document.createElement("div");r.id=this.createSubId(e+"EndHeader"),r.className=i+" "+this.getMappedStyle("endheader");var l=document.createElement("div");if(l.className=s,r.appendChild(l),"column"===e?(this.m_colHeader=o,this.m_colEndHeader=r):"row"===e&&(this.m_rowHeader=o,this.m_rowEndHeader=r),this._isHighWatermarkScrolling()){this.fetchHeaders(e,0,o,r,null,null)}else{var a=this,h=this.m_options.getScrollPosition();this._getIndexesFromScrollPosition(h).then(function(t){var i=t[e];"column"===e?(a.m_startColHeader=i,a.m_startColEndHeader=i):"row"===e&&(a.m_startRowHeader=i,a.m_startRowEndHeader=i),a.m_fetching[e]=!1,a.fetchHeaders(e,i,o,r,null,null)}),this.m_fetching[e]=!0}return{root:o,endRoot:r}},l.prototype.fetchHeaders=function(e,t,i,s,o,n){if(!this.m_fetching[e]){null==o&&(o=this.getFetchCount(e,t));var r,l={axis:e,start:t,count:o,header:i,endHeader:s};this.m_fetching[e]=l,r=null!=n&&null!=n.success?n.success:this.handleHeadersFetchSuccess,this.showStatusText(),this._signalTaskStart(),this.getDataSource().fetchHeaders(l,{success:r,error:this.handleHeadersFetchError},{success:this,error:this})}},l.prototype.isHeaderFetchResponseValid=function(e){var t=e.axis;return null!=this.m_fetching&&e===this.m_fetching[t]},l.prototype.isHeaderFetchResponseInViewport=function(e){if(!this.m_initialized)return!0;var t=e.axis,i=e.start;return("row"===t?this._getLongScrollStart(this.m_currentScrollTop,this.m_prevScrollTop,t):this._getLongScrollStart(this.m_currentScrollLeft,this.m_prevScrollLeft,t)).start===i},l.prototype.handleHeadersFetchSuccess=function(e,t,i,s){var o=this.m_options.getScrollPolicyOptions(),n=o?o.maxRowCount:null,r=o?o.maxColumnCount:null;if(this.isHeaderFetchResponseValid(t)){var l=t.axis;if(this.isLongScroll()&&!this.isHeaderFetchResponseInViewport(t))return this.m_fetching[l]=!1,this.m_headerInvalid=!0,void this._signalTaskEnd();this.m_fetching[l]=!1;var a=t.header,h=t.endHeader,d=t.start,m=this.getDataSource().getCount(l);"column"===l?(null!=e&&(this.buildColumnHeaders(a,e,d,m,!1,!1),(e.getCount()<t.count||r&&r>0&&r===d+e.getCount())&&(this.m_stopColumnHeaderFetch=!0)),this.m_endColHeader<0?(this._hideHeader(a),this.m_stopColumnHeaderFetch=!0,this.m_startColHeader=0):(this.m_hasColHeader=!0,this._buildHeaderLabels(l,e)),null!=i&&(this.buildColumnEndHeaders(h,i,d,m,!1,!1),(i.getCount()<t.count||r&&r>0&&r===d+i.getCount())&&(this.m_stopColumnEndHeaderFetch=!0)),this.m_endColEndHeader<0?(this._hideHeader(h),this.m_stopColumnEndHeaderFetch=!0,this.m_startColEndHeader=0):(this.m_hasColEndHeader=!0,this._buildHeaderLabels("columnEnd",i))):"row"===l&&(null!=e&&(this.buildRowHeaders(a,e,d,m,s,!1),(e.getCount()<t.count||n&&n>0&&n===d+e.getCount())&&(this.m_stopRowHeaderFetch=!0)),this.m_endRowHeader<0?(this._hideHeader(a),this.m_stopRowHeaderFetch=!0,this.m_startRowHeader=0):(this.m_hasRowHeader=!0,this._buildHeaderLabels(l,e)),null!=i&&(this.buildRowEndHeaders(h,i,d,m,s,!1),(i.getCount()<t.count||n&&n>0&&n===d+i.getCount())&&(this.m_stopRowEndHeaderFetch=!0)),this.m_endRowEndHeader<0?(this._hideHeader(h),this.m_stopRowEndHeaderFetch=!0,this.m_startRowEndHeader=0):(this.m_hasRowEndHeader=!0,this._buildHeaderLabels("rowEnd",i))),this.isFetchComplete()&&(this.hideStatusText(),this._shouldInitialize()&&!s&&this._handleInitialization(!0)),this.m_initialized&&this._sizeDatabodyScroller(),this._signalTaskEnd()}else this._signalTaskEnd()},l.prototype.handleHeadersFetchError=function(e,t){var i=t.axis;this.m_fetching[i]=!1,this._signalTaskEnd()},l.prototype.createHeaderContext=function(e,t,i,s,o,n,r,l){var a={};a.axis=e,a.index=t,a.data=i,a.component=this,a.datasource=this.getDataSource(),a.level=n,a.depth=l,a.extent=r,null!=o&&(a.parentElement=o);for(var h=Object.keys(s),d=0;d<h.length;d++){var m=h[d];a[m]=s[m]}return null!=this.m_createContextCallback&&this.m_createContextCallback.call(this,a),this.m_fixContextCallback.call(this,a)},l.prototype._createLabelContext=function(e,t,i,s){var o={};return o.axis=e,o.level=t,o.data=i,o.component=this,o.datasource=this.getDataSource(),null!=s&&(o.parentElement=s),null!=this.m_createContextCallback&&this.m_createContextCallback.call(this,o),this.m_fixContextCallback.call(this,o)},l.prototype._buildHeaderLabels=function(e,t){if(0===this.m_headerLabels[e].length&&t&&t.getLabel){var i,s=t.getLevelCount();"rowEnd"===e?i=this.getResources().isRTLMode()?"left":"right":"row"===e?i=this.getResources().isRTLMode()?"right":"left":"column"===e?i="top":"columnEnd"===e&&(i="bottom");var o=0;if(s>0)for(var n=0;n<s;n++){var r,l=document.createElement("div"),a=t.getLabel(n);if(r="row"===e||"rowEnd"===e?"row"===e?this.m_rowHeaderLevelWidths[n]:this.m_rowEndHeaderLevelWidths[n]:"column"===e?this.m_columnHeaderLevelHeights[n]:this.m_columnEndHeaderLevelHeights[n],null!=a){var h=this._createLabelContext(e,n,a,l);l.setAttribute(this.getResources().getMappedAttribute("container"),this.getResources().widgetName),l.setAttribute(this.getResources().getMappedAttribute("busyContext"),""),this._createUniqueId(l),l[this.getResources().getMappedAttribute("context")]=h;var d=this.m_options.getInlineStyle(e,h,!0);null!=d&&(l.style.cssText=d),l.className=this.getMappedStyle("headerlabel")+" "+this.getMappedStyle(e.toLowerCase()+"headerlabel");var m=this.m_options.getStyleClass(e,h,!0);null!=m&&(l.className+=" "+m),"row"===e||"rowEnd"===e?("rowEnd"===e&&(l.style.height="100%"),this.setElementWidth(l,r),this.setElementDir(l,o,i),this.setElementDir(l,0,"bottom")):("columnEnd"===e&&(l.style.width="100%"),this.setElementHeight(l,r),this.setElementDir(l,o,i),this.setElementDir(l,0,this.getResources().isRTLMode()?"left":"right"));var c=this.m_options.getRenderer(e,!0);this._renderContent(c,h,l,a),this.m_headerLabels[e].push(l)}o+=r}}},l.prototype.buildColumnHeaders=function(e,t,i,s,o,n){if(null==this.m_columnHeaderLevelCount&&(this.m_columnHeaderLevelCount=t.getLevelCount()),0!==this.m_columnHeaderLevelCount){var r=t.getCount(),l=i>this.m_endColHeader;!1;var a=l?this.m_endColHeaderPixel:this.m_startColHeaderPixel,h=this.m_endColHeader,d=this.m_columnHeaderLevelCount,m=this.getMappedStyle("colheader")+" "+this.getMappedStyle("header"),c=this.getMappedStyle("headercell")+" "+this.getMappedStyle("colheadercell");!1;var u=this.buildAxisHeaders(e,t,"column",i,r,l,!1,null,a,h,d,m,c,!1);0;var _=u.totalHeaderDimension,p=u.totalLevelDimension;if(0===_||0!==this.m_avgColWidth&&null!=this.m_avgColWidth||(this.m_avgColWidth=_/r),this.m_colHeaderHeight||(this.m_colHeaderHeight=p,this.setElementHeight(e,this.m_colHeaderHeight)),l?(this.m_endColHeader=i+r-1,this.m_endColHeaderPixel=this.m_endColHeaderPixel+_):(this.m_startColHeader=this.m_startColHeader-r,this.m_startColHeaderPixel=this.m_startColHeaderPixel-_),-1===s&&(s=this.m_endColHeader),!this._isCountUnknown("column")&&this._isHighWatermarkScrolling()&&this.m_endColHeader+1>=s?this.m_stopColumnHeaderFetch=!0:this.m_stopColumnHeaderFetch=u.stopFetch,0===this.m_startColHeader&&0!==this.m_startColHeaderPixel&&(this._shiftHeadersAlongAxisInContainer(e.firstChild,0,-1*this.m_startColHeaderPixel,this.getResources().isRTLMode()?"right":"left",this.getMappedStyle("colheadercell")),this.m_startColHeaderPixel=0),!this.m_initialized&&this.m_startColHeader>0){var g=Math.round(this.m_avgColWidth*this.m_startColHeader);this._shiftHeadersAlongAxisInContainer(e.firstChild,this.m_startColHeader,g-this.m_startColHeaderPixel,this.getResources().isRTLMode()?"right":"left",this.getMappedStyle("colheadercell")),this.m_endColHeaderPixel=g+_,this.m_startColHeaderPixel=g}}},l.prototype.buildColumnEndHeaders=function(e,t,i,s,o,n){if(null==this.m_columnEndHeaderLevelCount&&(this.m_columnEndHeaderLevelCount=t.getLevelCount()),0!==this.m_columnEndHeaderLevelCount){var r=t.getCount(),l=i>this.m_endColEndHeader;!1;var a=l?this.m_endColEndHeaderPixel:this.m_startColEndHeaderPixel,h=this.m_endColEndHeader,d=this.m_columnEndHeaderLevelCount,m=this.getMappedStyle("colendheader")+" "+this.getMappedStyle("endheader"),c=this.getMappedStyle("endheadercell")+" "+this.getMappedStyle("colendheadercell");!1;var u=this.buildAxisHeaders(e,t,"columnEnd",i,r,l,!1,null,a,h,d,m,c,!1);0;var _=u.totalHeaderDimension,p=u.totalLevelDimension;if(0===_||0!==this.m_avgColWidth&&null!=this.m_avgColWidth||(this.m_avgColWidth=_/r),this.m_colEndHeaderHeight||(this.m_colEndHeaderHeight=p,this.setElementHeight(e,this.m_colEndHeaderHeight)),l?(this.m_endColEndHeader=i+(r-1),this.m_endColEndHeaderPixel=this.m_endColEndHeaderPixel+_):(this.m_startColEndHeader=this.m_startColEndHeader-r,this.m_startColEndHeaderPixel=this.m_startColEndHeaderPixel-_),-1===s&&(s=this.m_endColEndHeader),!this._isCountUnknown("column")&&this._isHighWatermarkScrolling()&&this.m_endColEndHeader+1>=s?this.m_stopColumnEndHeaderFetch=!0:this.m_stopColumnEndHeaderFetch=u.stopFetch,0===this.m_startColEndHeader&&0!==this.m_startColEndHeaderPixel&&(this._shiftHeadersAlongAxisInContainer(e.firstChild,0,-1*this.m_startColEndHeaderPixel,this.getResources().isRTLMode()?"right":"left",this.getMappedStyle("colendheadercell")),this.m_startColEndHeaderPixel=0),!this.m_initialized&&this.m_startColEndHeader>0){var g=Math.round(this.m_avgColWidth*this.m_startColEndHeader);this._shiftHeadersAlongAxisInContainer(e.firstChild,this.m_startColEndHeader,g-this.m_startColEndHeaderPixel,this.getResources().isRTLMode()?"right":"left",this.getMappedStyle("colendheadercell")),this.m_endColEndHeaderPixel=g+_,this.m_startColEndHeaderPixel=g}}},l.prototype.buildRowHeaders=function(e,t,i,s,o,n){if(null==this.m_rowHeaderLevelCount&&(this.m_rowHeaderLevelCount=t.getLevelCount()),0!==this.m_rowHeaderLevelCount){var r,l=t.getCount(),a=i>this.m_endRowHeader,h=a?this.m_endRowHeaderPixel:this.m_startRowHeaderPixel;o?(r=e.firstChild.childNodes[i-this.m_startRowHeader],h=this.getElementDir(r,"top")):r=null;var d=this.m_endRowHeader,m=this.m_rowHeaderLevelCount,c=this.getMappedStyle("rowheader")+" "+this.getMappedStyle("header"),u=this.getMappedStyle("headercell")+" "+this.getMappedStyle("rowheadercell"),_=this.buildAxisHeaders(e,t,"row",i,l,a,o,r,h,d,m,c,u,n),p=_.totalHeaderDimension,g=_.totalLevelDimension;if(n)return _;if(0===p||0!==this.m_avgRowHeight&&null!=this.m_avgRowHeight||(this.m_avgRowHeight=p/l),this.m_rowHeaderWidth||(this.m_rowHeaderWidth=g,this.setElementWidth(e,this.m_rowHeaderWidth)),a){if(-1!==this.m_endRowHeader&&0!==l){var C=e.firstChild.childNodes[this.m_endRowHeader-this.m_startRowHeader];null!=C&&this.m_utils.removeCSSClassName(C,this.getMappedStyle("borderHorizontalNone"))}this.m_endRowHeader=i+(l-1),this.m_endRowHeaderPixel=this.m_endRowHeaderPixel+p}else o?(i<this.m_startRowHeader&&(this.m_startRowHeader=i,this.m_startRowHeaderPixel=Math.max(0,this.m_startRowHeaderPixel-p)),this.m_endRowHeader=this.m_endRowHeader+l,this.m_endRowHeaderPixel=Math.max(0,this.m_endRowHeaderPixel+p),this.pushRowHeadersDown(r,p)):(this.m_startRowHeader=Math.max(0,this.m_startRowHeader-l),this.m_startRowHeaderPixel=this.m_startRowHeaderPixel-p);if(-1===s&&(s=this.m_endRowHeader),!this._isCountUnknown("row")&&this._isHighWatermarkScrolling()&&this.m_endRowHeader+1>=s?this.m_stopRowHeaderFetch=!0:this.m_stopRowHeaderFetch=_.stopFetch,0===this.m_startRowHeader&&0!==this.m_startRowHeaderPixel&&(this._shiftHeadersAlongAxisInContainer(e.firstChild,0,-1*this.m_startRowHeaderPixel,"top",this.getMappedStyle("rowheadercell")),this.m_startRowHeaderPixel=0),!this.m_initialized&&this.m_startRowHeader>0){var f=Math.round(this.m_avgRowHeight*this.m_startRowHeader);this._shiftHeadersAlongAxisInContainer(e.firstChild,this.m_startRowHeader,f-this.m_startRowHeaderPixel,"top",this.getMappedStyle("rowheadercell")),this.m_endRowHeaderPixel=f+p,this.m_startRowHeaderPixel=f}}},l.prototype.buildRowEndHeaders=function(e,t,i,s,o,n){if(null==this.m_rowEndHeaderLevelCount&&(this.m_rowEndHeaderLevelCount=t.getLevelCount()),0!==this.m_rowEndHeaderLevelCount){var r,l=t.getCount(),a=i>this.m_endRowEndHeader,h=a?this.m_endRowEndHeaderPixel:this.m_startRowEndHeaderPixel;o?(r=e.firstChild.childNodes[i-this.m_startRowEndHeader],h=this.getElementDir(r,"top")):r=null;var d=this.m_endRowEndHeader,m=this.m_rowEndHeaderLevelCount,c=this.getMappedStyle("rowendheader")+" "+this.getMappedStyle("endheader"),u=this.getMappedStyle("endheadercell")+" "+this.getMappedStyle("rowendheadercell"),_=this.buildAxisHeaders(e,t,"rowEnd",i,l,a,o,r,h,d,m,c,u,n);if(n)return _;var p=_.totalHeaderDimension,g=_.totalLevelDimension;if(n)return _;if(0===p||0!==this.m_avgRowHeight&&null!=this.m_avgRowHeight||(this.m_avgRowHeight=p/l),this.m_rowEndHeaderWidth||(this.m_rowEndHeaderWidth=g,this.setElementWidth(e,this.m_rowEndHeaderWidth)),a){if(-1!==this.m_endRowEndHeader&&0!==l){var C=e.firstChild.childNodes[this.m_endRowEndHeader-this.m_startRowEndHeader];null!=C&&this.m_utils.removeCSSClassName(C,this.getMappedStyle("borderHorizontalNone"))}this.m_endRowEndHeader=i+(l-1),this.m_endRowEndHeaderPixel=this.m_endRowEndHeaderPixel+p}else o?(i<this.m_startRowEndHeader&&(this.m_startRowEndHeader=i,this.m_startRowEndHeaderPixel=Math.max(0,this.m_startRowEndHeaderPixel-p)),this.m_endRowEndHeader=this.m_endRowEndHeader+l,this.m_endRowEndHeaderPixel=Math.max(0,this.m_endRowEndHeaderPixel+p),this.pushRowHeadersDown(r,p)):(this.m_startRowEndHeader=Math.max(0,this.m_startRowEndHeader-l),this.m_startRowEndHeaderPixel=this.m_startRowEndHeaderPixel-p);if(-1===s&&(s=this.m_endRowEndHeader),!this._isCountUnknown("row")&&this._isHighWatermarkScrolling()&&this.m_endRowEndHeader+1>=s?this.m_stopRowEndHeaderFetch=!0:this.m_stopRowEndHeaderFetch=_.stopFetch,0===this.m_startRowEndHeader&&0!==this.m_startRowEndHeaderPixel&&(this._shiftHeadersAlongAxisInContainer(e.firstChild,0,-1*this.m_startRowEndHeaderPixel,"top",this.getMappedStyle("rowendheadercell")),this.m_startRowEndHeaderPixel=0),!this.m_initialized&&this.m_startRowEndHeader>0){var f=Math.round(this.m_avgRowHeight*this.m_startRowEndHeader);this._shiftHeadersAlongAxisInContainer(e.firstChild,this.m_startRowEndHeader,f-this.m_startRowEndHeaderPixel,"top",this.getMappedStyle("rowendheadercell")),this.m_endRowEndHeaderPixel=f+p,this.m_startRowEndHeaderPixel=f}}},l.prototype.buildAxisHeaders=function(e,t,i,s,o,n,r,l,a,h,d,m,c,u){var _,p,g=-1!==i.indexOf("column"),C=g?"height":"width",f=!1,v=0,y=0,E=0,S=0;if(!u){if(0===o&&this._isCountUnknown(i))return{totalHeaderDimension:v,totalLevelDimension:y,stopFetch:f=!0};_=e.firstChild,-1===h&&""===e.className&&(e.className=m,e.style[C]="",_.style[C]="")}for(var w=this.m_options.getRenderer(i),H=document.createDocumentFragment(),b=0;o-b>0;){n||r?(p=s+b,E=g?a+v:0,S=g?0:a+v):(p=s+(o-1-b),E=g?a-v:0,S=g?0:a-v);var x=this.buildLevelHeaders(H,p,0,E,S,n,r,w,t,i,c,d);b+=x.count,v+=x.totalHeaderDimension,x.totalLevelDimension>y&&(y=x.totalLevelDimension)}return u?H:(n?_.appendChild(H):r?_.insertBefore(H,l):_.insertBefore(H,_.firstChild),e.hasChildNodes()||r||e.appendChild(_),{totalHeaderDimension:v,totalLevelDimension:y,stopFetch:f})},l.prototype._renderContent=function(e,t,i,s){if(null!=e){var o=e.call(this,t);null!=o&&(null===o.parentNode||o.parentNode instanceof DocumentFragment?(i.appendChild(o),this.m_subtreeAttachedCallback(o)):null!=o.parentNode||o.toString&&i.appendChild(document.createTextNode(o.toString())));var n=this.m_contextCallback(i).getBusyContext(),r=this;n.whenReady().then(function(){r._disableAllFocusableElements(i)})}else null!=s&&"object"==typeof s&&Object.prototype.hasOwnProperty.call(s,"data")&&(s=s.data),null==s&&(s=""),i.appendChild(document.createTextNode(s.toString()))},l.prototype.buildLevelHeaders=function(e,t,i,s,o,n,r,l,a,h,d,m){var c,u,_,p,g,C,f,v,y,E,S,w,H,b,x,R=0,M=0,I=0,A=0;"row"===h?(c="row",u=this.m_rowHeader,_="width",p=this.m_rowHeaderLevelWidths,g="height",C="top",f=o,v=this.getResources().isRTLMode()?"right":"left",y=s,E=this.m_startRowHeader,S=this.m_endRowHeader):"rowEnd"===h?(c="row",u=this.m_rowEndHeader,_="width",p=this.m_rowEndHeaderLevelWidths,g="height",C="top",f=o,v=this.getResources().isRTLMode()?"left":"right",y=s,E=this.m_startRowEndHeader,S=this.m_endRowEndHeader):"column"===h?(c="column",u=this.m_colHeader,_="height",p=this.m_columnHeaderLevelHeights,g="width",C=this.getResources().isRTLMode()?"right":"left",f=s,v="top",y=o,E=this.m_startColHeader,S=this.m_endColHeader):(c="column",u=this.m_colEndHeader,_="height",p=this.m_columnEndHeaderLevelHeights,g="width",C=this.getResources().isRTLMode()?"right":"left",f=s,v="bottom",y=o,E=this.m_startColEndHeader,S=this.m_endColEndHeader);var T=a.getExtent(t,i),D=T.extent,L=T.more.before,N=T.more.after,F=a.getDepth(t,i);if(L&&t===S+1){for(w=this._getHeaderContainer(t-1,i,0,null,u,m),this._setAttribute(w,"extent",this._getAttribute(w,"extent",!0)+D),H=w.firstChild,R=this.getElementDir(H,_),b=0;b<D;)f+=(x="column"===h||"columnEnd"===h?this.buildLevelHeaders(w,t+b,i+F,f,y+R,n,r,l,a,h,d,m):this.buildLevelHeaders(w,t+b,i+F,y+R,f,n,r,l,a,h,d,m)).totalHeaderDimension,I+=x.totalHeaderDimension,A+=x.count,b+=x.count;this.setElementDir(H,this.getElementDir(H,g)+I,g)}else if(N&&t===E-1){for(w=this._getHeaderContainer(t+1,i,0,null,u,m),this._setAttribute(w,"extent",this._getAttribute(w,"extent",!0)+D),this._setAttribute(w,"start",this._getAttribute(w,"start",!0)-D),H=w.firstChild,R=this.getElementDir(H,_),b=0;b<D;)f-=(x="column"===h||"columnEnd"===h?this.buildLevelHeaders(w,t-b,i+F,f,y+R,n,r,l,a,h,d,m):this.buildLevelHeaders(w,t-b,i+F,y+R,f,n,r,l,a,h,d,m)).totalHeaderDimension,I+=x.totalHeaderDimension,A+=x.count,b+=x.count;this.setElementDir(H,this.getElementDir(H,g)+I,g),this.setElementDir(H,f,C)}else{var O=a.getData(t,i),P=a.getMetadata(t,i);H=document.createElement("div");var k=this.createHeaderContext(h,t,O,P,H,i,D,F);H.setAttribute(this.getResources().getMappedAttribute("container"),this.getResources().widgetName),H.setAttribute(this.getResources().getMappedAttribute("busyContext"),""),this._createUniqueId(H),H[this.getResources().getMappedAttribute("context")]=k;var z=this.m_options.getInlineStyle(h,k),B=this.m_options.getStyleClass(h,k);null!=z&&(H.style.cssText=z),H.className=d,H.className+=" "+this.getMappedStyle("depth")+F,null!=B&&(H.className+=" "+B),this.setElementDir(H,y,v),this.setElementDir(H,f,C),R=this._getHeaderLevelDimension(i,H,p,_,F),this.setElementDir(H,R,_);var K=this._getHeaderDimension(H,k.key,c,g);if(this._setAttribute(H,"depth",F),i!==m-1&&((w=document.createElement("div")).className=this.getMappedStyle("groupingcontainer"),w.appendChild(H),this._setAttribute(w,"start",n||r?t:t-D+1),this._setAttribute(w,"extent",D),this._setAttribute(w,"level",i)),i+F===m)this.setElementDir(H,K,g),I+=K,A+=1,M=R,n||r||(f-=K,this.setElementDir(H,f,C));else{for(b=0;b<D;b++){var W=n||r?t+b:t-b;K=(x="column"===h||"columnEnd"===h?this.buildLevelHeaders(w,W,i+F,f,y+R,n,r,l,a,h,d,m):this.buildLevelHeaders(w,W,i+F,y+R,f,n,r,l,a,h,d,m)).totalHeaderDimension,f=n||r?f+K:f-K,I+=K,A+=x.count,b+=x.count-1}M=R+x.totalLevelDimension,n||r||this.setElementDir(H,f,C),this.setElementDir(H,I,g)}if("columnEnd"===h&&this.m_addBorderBottom&&this.m_utils.addCSSClassName(H,this.getMappedStyle("borderHorizontalSmall")),"rowEnd"===h&&this.m_addBorderRight&&this.m_utils.addCSSClassName(H,this.getMappedStyle("borderVerticalSmall")),this._isHeaderResizeEnabled(h,k)&&this._setAttribute(H,"resizable","true"),null!=w?this.m_root.appendChild(w):this.m_root.appendChild(H),this._renderContent(l,k,H,O),"column"===h&&this._isSortEnabled(h,k)){null!=P.sortDirection&&null==this.m_sortInfo&&(this.m_sortInfo={},this.m_sortInfo.key=P.key,this.m_sortInfo.direction=P.sortDirection,this.m_sortInfo.axis=h);var j=this._buildSortIcon(k);H.appendChild(j),this._setAttribute(H,"sortable","true")}n||r?null!=w?e.appendChild(w):e.appendChild(H):null!=w?e.firstChild?this.m_utils.containsCSSClassName(e.firstChild,this.getMappedStyle("groupingcontainer"))?e.insertBefore(w,e.firstChild):(this.m_utils.containsCSSClassName(e.firstChild,this.getMappedStyle("headercell"))||this.m_utils.containsCSSClassName(e.firstChild,this.getMappedStyle("endheadercell")))&&e.insertBefore(w,e.firstChild.nextSibling):e.appendChild(w):this.m_utils.containsCSSClassName(e,this.getMappedStyle("groupingcontainer"))?e.insertBefore(H,e.firstChild.nextSibling):e.insertBefore(H,e.firstChild)}"column"===h||"columnEnd"===h?this._isLastColumn(t+(D-1))&&this.m_utils.addCSSClassName(H,this.getMappedStyle("borderVerticalNone")):this._isLastRow(t+(D-1))&&!r&&this.m_utils.addCSSClassName(H,this.getMappedStyle("borderHorizontalNone"));var U={};return U.totalLevelDimension=M,U.totalHeaderDimension=I,U.count=A,U},l.prototype._getHeaderLevelDimension=function(e,t,i,s,o){for(var n=0,r=0;r<o;r++){var l=i[e+r];if(null==l){n=null;break}n+=l}return null!=n?n:(n=this.getElementDir(t,s),1===o&&(i[e]=n),n)},l.prototype._getHeaderContainer=function(e,t,i,s,o,n){var r;if(null==s?(s=o.firstChild.childNodes,r=0):r=1,i===n-1)return s[0].parentNode;for(;r<s.length;r++){var l=this._getAttribute(s[r],"start",!0),a=this._getAttribute(s[r],"extent",!0),h=this._getAttribute(s[r].firstChild,"depth",!0);if(e>=l&&e<l+a)return t<i+h?s[r]:this._getHeaderContainer(e,t,i+h,s[r].childNodes,o,n)}return null},l.prototype._getHeaderByIndex=function(e,t,i,s,o){var n;if(t<0)return null;if(1===s)return i.firstChild.childNodes[n=e-o];var r=this._getHeaderContainer(e,t,0,null,i,s);return null==r?null:t<=this._getAttribute(r,"level",!0)+this._getAttribute(r.firstChild,"depth",!0)-1?r.firstChild:(n=e-this._getAttribute(r,"start",!0)+1,r.childNodes[n])},l.prototype._getAttribute=function(e,t,i){var s=e.getAttribute(this.getResources().getMappedAttribute(t));return i?parseInt(s,10):s},l.prototype._setAttribute=function(e,t,i){e.setAttribute(this.getResources().getMappedAttribute(t),i)},l.prototype.buildDatabody=function(){var e=document.createElement("div");e.id=this.createSubId("databody"),e.className=this.getMappedStyle("databody"),e.tabIndex="-1",this.m_databody=e,e.addEventListener?e.addEventListener("scroll",this.handleScroll.bind(this),!1):e.attachEvent("onscroll",this.handleScroll.bind(this));var t=document.createElement("div");if(t.className=this.getMappedStyle("scroller")+(this.m_utils.isTouchDevice()?" "+this.getMappedStyle("scroller-mobile"):""),e.appendChild(t),this._isHighWatermarkScrolling()){this.fetchCells(e,0,0)}else{var i=this,s=this.m_options.getScrollPosition();this._getIndexesFromScrollPosition(s).then(function(t){var s=t.row,o=t.column;i.m_startRow=s,i.m_startCol=o,i.m_fetching.cells=!1,i.fetchCells(e,s,o)}),this.m_fetching.cells=!0}return e},l.prototype._getIndexesFromScrollPosition=function(e){var t=this,i=e.rowKey,s=e.columnKey;return new Promise(function(e){null!=i||null!=s?t._indexes({row:i,column:s},function(t){e({rowIndexFromKey:t.row,columnIndexFromKey:t.column})}):e({rowIndexFromKey:null,columnIndexFromKey:null})}).then(function(i){var s={};return null!=i.rowIndexFromKey&&i.rowIndexFromKey>0?s.row=i.rowIndexFromKey:e.rowIndex?s.row=e.rowIndex:e.y?s.row=Math.round(e.y/t.getDefaultRowHeight()):s.row=0,null!=i.columnIndexFromKey&&i.columnIndexFromKey>0?s.column=i.columnIndexFromKey:e.columnIndex?s.column=e.columnIndex:e.x?s.column=Math.round(e.x/t.getDefaultColumnWidth()):s.column=0,s})},l.prototype.getFetchCount=function(e,t){var i=this.getFetchSize(e);if(this._isHighWatermarkScrolling()){var s="row"===e?"maxRowCount":"maxColumnCount",o=this.m_options.getScrollPolicyOptions();o&&null!=o[s]&&o[s]>0&&(i=Math.max(Math.min(i,o[s]-t),0))}return i},l.prototype.fetchCells=function(e,t,i,s,o,n){var r;if(!this.m_fetching.cells){null==s&&(s=this.getFetchCount("row",t)),null==o&&(o=this.getFetchCount("column",i));var l={axis:"row",start:t,count:s},a={axis:"column",start:i,count:o,databody:e};this.m_fetching.cells={rowRange:l,columnRange:a},r=null!=n&&null!=n.success?n.success:this.handleCellsFetchSuccess,this.showStatusText(),this._signalTaskStart(),this.getDataSource().fetchCells([l,a],{success:r,error:this.handleCellsFetchError},{success:this,error:this})}},l.prototype.isCellFetchResponseValid=function(e){if(null==this.m_fetching)return!1;var t=e[0],i=e[1],s=this.m_fetching.cells;return t===s.rowRange&&i===s.columnRange},l.prototype.isLongScroll=function(){return this.m_isLongScroll},l.prototype.isCellFetchResponseInViewport=function(e,t){if(isNaN(this.m_avgRowHeight)||isNaN(this.m_avgColWidth)||null!=this.m_empty||!this.m_initialized)return!0;var i=t[0].start,s=t[1].start,o=this._getLongScrollStart(this.m_currentScrollTop,this.m_prevScrollTop,"row"),n=this._getLongScrollStart(this.m_currentScrollLeft,this.m_prevScrollLeft,"column");return o.start===i&&n.start===s},l.prototype.handleCellsFetchSuccess=function(e,t,i){var s=this.m_options.getScrollPolicyOptions(),o=s?s.maxRowCount:null,n=s?s.maxColumnCount:null,r=this.getDataSource().getCount("row"),l=this.getDataSource().getCount("column");if(void 0===i){if(i=!1,!this.isCellFetchResponseValid(t))return void this._signalTaskEnd();if(this.isLongScroll()&&(!this.isCellFetchResponseInViewport(e,t)||this.m_headerInvalid))return this.m_fetching.cells=!1,this.m_headerInvalid=!1,this.handleLongScroll(this.m_currentScrollLeft,this.m_currentScrollTop),void this._signalTaskEnd();this.m_isLongScroll=!1}var a=t[0],h=a.start,d=e.getCount("row"),m=d>0&&(h>this.m_endRow||h+d<=this.m_startRow);(0===d&&this._isCountUnknown("row")&&a.count>0||m&&this._isHighWatermarkScrolling()&&!this._isCountUnknown("row")&&this.m_endRow+d+1>=r||d<a.count||this._isHighWatermarkScrolling()&&o&&o>0&&h+d===o)&&(this.m_stopRowFetch=!0);var c=t[1],u=c.start,_=e.getCount("column"),p=_>0&&(u>this.m_endCol||u+_===this.m_startCol);(0===_&&this._isCountUnknown("column")&&c.count>0||p&&this._isHighWatermarkScrolling()&&!this._isCountUnknown("column")&&this.m_endCol+_+1>=l||_<c.count||this._isHighWatermarkScrolling()&&n&&n>0&&u+_===n)&&(this.m_stopColumnFetch=!0);var g=this.m_databody;null==g&&(g=c.databody);var C,f,v,y,E,S,w,H,b,x,R=g.firstChild;if(m||i){if(C=!(i||!(h>=this.m_startRow)))f=this.m_endRowPixel;else if(i){var M=this._getCellByIndex({row:h+d,column:this.m_startCol});f=this.getElementDir(M,"top")}else f=this.m_startRowPixel;v=u>=this.m_startCol?this.m_startColPixel:this.m_endColPixel,y=document.createDocumentFragment(),S=(E=this._addCellsToFragment(y,e,h,f,u,v)).totalColumnWidth,w=E.totalRowHeight,H=E.avgWidth,b=w/d,this._populateDatabody(R,y),C?(-1!==this.m_endRow&&0!==d&&this._highlightCellsAlongAxis(this.m_endRow,"row","index","remove",["borderHorizontalNone"]),this.m_endRow=h+(d-1),this.m_endRowPixel=this.m_endRowPixel+w):i?(h<this.m_startRow&&(this.m_startRow=h,this.m_startRowPixel=Math.max(0,this.m_startRowPixel-w)),this.m_endRow=this.m_endRow+d,this.m_endRowPixel=this.m_endRowPixel+w,this.pushRowsDown(h+d,w)):(this.m_startRow=this.m_startRow-d,this.m_startRowPixel=this.m_startRowPixel-w)}else p&&(v=(C=u>=this.m_startCol)?this.m_endColPixel:this.m_startColPixel,f=h>=this.m_startRow?this.m_startRowPixel:this.m_endRowPixel,y=document.createDocumentFragment(),E=this._addCellsToFragment(y,e,h,f,u,v),this._populateDatabody(R,y),S=E.totalColumnWidth);if(null==H||0!==this.m_avgColWidth&&null!=this.m_avgColWidth||(this.m_avgColWidth=H),null==b||0!==this.m_avgRowHeight&&null!=this.m_avgRowHeight||(this.m_avgRowHeight=b),p&&(u<this.m_startCol?(this.m_startCol=this.m_startCol-_,this.m_startColPixel=this.m_startColPixel-S):(this.m_endCol=u+(_-1),this.m_endColPixel=this.m_endColPixel+S)),this._sizeDatabodyScroller(),this.m_endCol>=0&&this.m_endRow>=0?this.m_hasCells=!0:(this.m_startCol=0,this.m_startRow=0),0===this.m_startCol&&0!==this.m_startColPixel&&(this._shiftCellsAlongAxis("column",-this.m_startColPixel,0,!0),this.m_endColPixel+=this.m_startColPixel,this.m_startColPixel=0),0===this.m_startRow&&0!==this.m_startRowPixel&&(this._shiftCellsAlongAxis("row",-this.m_startRowPixel,0,!0),this.m_endRowPixel+=this.m_startRowPixel,this.m_startRowPixel=0),!this.m_initialized&&this.m_startCol>0&&(x=Math.round(this.m_avgColWidth*this.m_startCol),this._shiftCellsAlongAxis("column",x-this.m_startColPixel,this.m_startCol,!0),this.m_endColPixel=x+S,this.m_startColPixel=x),!this.m_initialized&&this.m_startRow>0&&(x=Math.round(this.m_avgRowHeight*this.m_startRow),this._shiftCellsAlongAxis("row",x-this.m_startRowPixel,this.m_startRow,!0),this.m_endRowPixel=x+w,this.m_startRowPixel=x),this.m_fetching.cells=!1,this.isFetchComplete())if(this.hideStatusText(),this._syncScroller(),this.m_initialized?this._checkScroll&&this._checkScrollPosition():this._updateScrollPosition(this.m_options.getScrollPosition()),null!=this.m_scrollIndexAfterFetch?this.scrollToIndex(this.m_scrollIndexAfterFetch):null!=this.m_scrollHeaderAfterFetch?this.scrollToHeader(this.m_scrollHeaderAfterFetch):this.isActionableMode()||null==this._getActiveElement()||this.m_utils.containsCSSClassName(this._getActiveElement(),this.getMappedStyle("focus"))||(!0!==this.m_shouldFocus&&(this.m_shouldFocus=!1),this._highlightActive(),this._manageMoveCursor()),this._isSelectionEnabled()&&this.applySelection(h,h+d,u,u+_),this.populateAccInfo(),this.m_utils.isTouchDevice()&&Object.prototype.hasOwnProperty.call(window,"WebKitCSSMatrix")&&(g.style.webkitTransform="translate3d(0, 0, 0)",null!=this.m_rowHeader&&(this.m_rowHeader.style.webkitTransform="translate3d(0, 0, 0)"),null!=this.m_colHeader&&(this.m_colHeader.style.webkitTransform="translate3d(0, 0, 0)"),null!=this.m_rowEndHeader&&(this.m_rowEndHeader.style.webkitTransform="translate3d(0, 0, 0)"),null!=this.m_colEndHeader&&(this.m_colEndHeader.style.webkitTransform="translate3d(0, 0, 0)")),this._shouldInitialize())this._handleInitialization(!0);else if(this.m_initialized){var I;(!0===this.m_resizeRequired||this.m_endRowPixel-w<this.getElementHeight(g))&&this.resizeGrid(),m?C?I="top":i||(I="bottom"):p&&(I=u===this.m_startCol?"right":"left"),this._cleanupViewport(I),this.fillViewport(),this.isFetchComplete()&&this.fireEvent("ready",{})}this._isSelectionEnabled()&&this.isMultipleSelection()&&this.updateSelectionHeader(),this._signalTaskEnd()},l.prototype._setZIndexBefore=function(e,t,i,s){if("row"===e)for(var o=this.m_startRow,n=this.m_currentScrollTop,r=this.m_rowHeader,l=this.m_rowHeaderLevelCount,a=this.m_startRowHeader,h=this.m_rowEndHeader,d=this.m_rowEndHeaderLevelCount,m=this.m_startRowEndHeader,c=t;c>=o;c--){var u,_=this._getAxisCellsByIndex(c,e);if(this.getElementDir(_[0],"top")<n)break;for(var p=0;p<_.length;p++)this.changeStyleProperty(_[p],this.getCssSupport("z-index"),10);i&&(u=this._getHeaderByIndex(c,0,r,l,a),this.changeStyleProperty(u,this.getCssSupport("z-index"),10)),s&&(u=this._getHeaderByIndex(c,0,h,d,m),this.changeStyleProperty(u,this.getCssSupport("z-index"),10))}},l.prototype._onTransitionEnd=function(e,t,i){var s,o="transitionend";function n(){s&&(clearTimeout(s),s=void 0),e.removeEventListener(o,n),t()}e.addEventListener(o,n),s=setTimeout(n,i+100)},l.prototype._insertRowsWithAnimation=function(e,t,i,s,o,n){var r,a,h,d,m,c,u,_,p,g,C=this,f=0,v=0,y=0;C._signalTaskStart();var E=s>this.m_endRow,S=this.m_databody.firstChild,w=null!=t,H=null!=i;for(s>0&&(y=s-1,g=this._getAxisCellsByIndex(s-1,"row"),f=(v=this.getElementDir(g[0],"top"))+this.getElementHeight(g[0])),this._setZIndexBefore("row",y,w,H),w&&(h=(a=this.m_rowHeader.firstChild).childNodes[s-this.m_startRow-1]),H&&(m=(d=this.m_rowEndHeader.firstChild).childNodes[s-this.m_startRow-1]),r=0;r<e.childNodes.length;r++){var b=e.childNodes[r];_=v-(u=f+this.getElementDir(b,"top"))-this.getElementHeight(b),this.setElementDir(b,u,"top"),this.addTransformMoveStyle(b,0,0,"linear",0,_,0)}if(w)for(r=0;r<t.childNodes.length;r++)c=t.childNodes[r],_=v-(u=f+this.getElementDir(c,"top"))-this.getElementHeight(c),this.setElementDir(c,u,"top"),this.addTransformMoveStyle(c,0,0,"linear",0,_,0);if(H)for(r=0;r<i.childNodes.length;r++)p=i.childNodes[r],_=v-(u=f+this.getElementDir(p,"top"))-this.getElementHeight(p),this.setElementDir(p,u,"top"),this.addTransformMoveStyle(p,0,0,"linear",0,_,0);for(r=s-this.m_startRow;r<=this.m_endRow;r++){var x=this._getAxisCellsByIndex(r,"row");u=n+this.getElementDir(x[0],"top"),_=-n;for(var R=0;R<x.length;R++)this.setElementDir(x[R],u,"top"),this.addTransformMoveStyle(x[R],0,0,"linear",0,_,0);w&&(c=a.childNodes[r],this.setElementDir(c,u,"top"),this.addTransformMoveStyle(c,0,0,"linear",0,_,0)),H&&(p=d.childNodes[r],this.setElementDir(p,u,"top"),this.addTransformMoveStyle(p,0,0,"linear",0,_,0))}this._modifyAxisCellContextIndex("row",s,this.m_endRow-s+1,o),this.m_endRow+=o,this.m_endRowPixel+=n,w&&(this.m_endRowHeader+=t.childNodes.length,this.m_endRowHeaderPixel+=n),H&&(this.m_endRowEndHeader+=i.childNodes.length,this.m_endRowEndHeaderPixel+=n),S.appendChild(e),E?(w&&a.appendChild(t),H&&d.appendChild(i)):(w&&a.insertBefore(t,h.nextSibling),H&&d.insertBefore(i,m.nextSibling)),this.setElementHeight(S,this.m_endRowPixel-this.m_startRowPixel),this.resizeGrid(),this.updateRowBanding(),this._refreshDatabodyMap();var M=this._getCellByIndex(this.createIndex(s+(o-1),this.m_endCol));this.m_animating=!0;var I=C.m_processingEventQueue?1:l.EXPAND_ANIMATION_DURATION;this._onTransitionEnd(M,function(){C.m_stopRowFetch=!1,-1!==C.m_endRowHeader&&(C.m_stopRowHeaderFetch=!1),-1!==C.m_endRowEndHeader&&(C.m_stopRowEndHeaderFetch=!1),C._handleAnimationEnd()},I),setTimeout(function(){for(var e=l.EXPAND_ANIMATION_DURATION,t=s;t<=C.m_endRow;t++){for(var i=C._getAxisCellsByIndex(t,"row"),o=0;o<i.length;o++)C.addTransformMoveStyle(i[o],e+"ms",0,"ease-out",0,0,0);w&&C.addTransformMoveStyle(a.childNodes[t],e+"ms",0,"ease-out",0,0,0),H&&C.addTransformMoveStyle(d.childNodes[t],e+"ms",0,"ease-out",0,0,0)}},0)},l.prototype._addCellsToFragment=function(e,t,i,s,o,n){for(var r=this.getResources().isRTLMode()?"right":"left",l=this.m_options.getRenderer("cell"),a=this.m_options.getColumnBandingInterval(),h=this.m_options.getRowBandingInterval(),d=this.m_options.getHorizontalGridlines(),m=this.m_options.getVerticalGridlines(),c=t.getCount("row"),u=t.getCount("column"),_=i>=this.m_startRow,p=o>=this.m_startCol,g=0,C=s,f=[],v=[],y=0;y<c;y+=1){for(var E,S,w,H,b=n,x=_?i+y:i+(c-1-y),R=Math.floor(x/h)%2==1,M=0;M<u;M+=S.column){var I=0;E=0;var A,T=p?o+M:o+(u-1-M);S={row:(A=t.getExtent?t.getExtent(this.createIndex(x,T)):{row:{extent:1,more:{before:!1,after:!1}},column:{extent:1,more:{before:!1,after:!1}}}).row.extent,column:A.column.extent},p||(T=T-S.column+1);var D=_?x:x-S.row+1,L=this.createIndex(D,T);if(f[y]&&f[y][M])I=f[y][M].width,b=p?b+I:b-I;else{var N=this._patchExistingCells(A,T,D,f);if(N)I=N.width,H=(w=N.cell)[this.getResources().getMappedAttribute("context")];else{var F=t.getData(L),O=t.getMetadata(L);w=document.createElement("div"),H=this.createCellContext(L,F,O,w,S),w.setAttribute(this.getResources().getMappedAttribute("container"),this.getResources().widgetName),w.setAttribute(this.getResources().getMappedAttribute("busyContext"),""),this._createUniqueId(w),w[this.getResources().getMappedAttribute("context")]=H;var P=this.m_options.getInlineStyle("cell",H);null!=P&&(w.style.cssText=P),""!==w.style.height&&(w.style.height=""),""!==w.style.width&&(w.style.width=""),this.m_utils.addCSSClassName(w,this.getMappedStyle("cell")),this.m_utils.addCSSClassName(w,this.getMappedStyle("formcontrol")),(R||Math.floor(T/a)%2==1)&&this.m_utils.addCSSClassName(w,this.getMappedStyle("banded"));var k,z=this.m_options.getStyleClass("cell",H);for(null!=z&&this.m_utils.addCSSClassName(w,z),k=0;k<S.row;k++){var B=0===k?H.keys.row:this._getKey(this._getHeaderByIndex(D+k,0,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader),"row");v[y+k]=this._getCellDimension(w,D+k,B,"row","height"),E+=v[y+k]}for(this.setElementHeight(w,E),k=0;k<S.column;k++){var K=0===k?H.keys.column:this._getKey(this._getHeaderByIndex(T+k,0,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader),"column");I+=this._getCellDimension(w,T,K,"column","width")}this.setElementWidth(w,I),("hidden"===m||this._isLastColumn(T+(S.column-1))&&(this.getRowHeaderWidth()+b+I>=this.getWidth()||-1!==this.m_endRowEndHeader))&&this.m_utils.addCSSClassName(w,this.getMappedStyle("borderVerticalNone")),"hidden"===d?this.m_utils.addCSSClassName(w,this.getMappedStyle("borderHorizontalNone")):this._isLastRow(D+(S.row-1))&&(this.getRowBottom(w,C+E)>=this.getHeight()||-1!==this.m_endColEndHeader)&&this.m_utils.addCSSClassName(w,this.getMappedStyle("borderHorizontalNone")),_?this.setElementDir(w,C,"top"):this.setElementDir(w,C-E,"top"),p?this.setElementDir(w,b,r):this.setElementDir(w,b-I,r),this.m_root.appendChild(w),this._renderContent(l,H,w,F),e.appendChild(w)}this._updateTempArray(f,{width:I},y,M,S.row,S.column),b=p?b+I:b-I,0===y&&(g+=I)}}E=v[y],C=_?C+E:C-E,E}return{avgWidth:g/u,totalRowHeight:v.reduce(function(e,t){return e+t},0),totalColumnWidth:g}},l.prototype._updateCellDimension=function(e,t,i,s,o,n,r,l){var a,h,d,m,c,u=0,_="width"===r?"height":"width",p=this._getCellByIndex(this.createIndex(s,i)),g=this.getElementDir(p,r),C=p[this.getResources().getMappedAttribute("context")];C.extents[n]+=e,"row"===n?(a=s,h=this.m_rowHeader,d=this.m_rowHeaderLevelCount,m=this.m_startRowHeader):(a=i,h=this.m_colHeader,d=this.m_columnHeaderLevelCount,m=this.m_startColHeader);for(var f=1;f<=e;f++){var v=this._getKey(this._getHeaderByIndex(l?a-f:a+f,0,h,d,m),n);u+=this._getCellDimension(p,l?a-f:a+f,v,n,r);for(var y=0;y<t;y++){var E,S;"row"===n?(E=l?s-f:s+f,S=i+y):(E=s+y,S=l?i-f:i+f),this._addIndexToDatabodyMap(this.createIndex(E,S),p.id)}}l&&(c="width"===r?this.getResources().isRTLMode()?"right":"left":"top",this.setElementDir(p,this.getElementDir(p,c)-u,c),C.indexes[n]-=e);this.setElementDir(p,g+u,r);var w={};return w[r]=u,w[_]=this.getElementDir(p,_),w.cell=p,w},l.prototype._patchExistingCells=function(e,t,i,s){var o=e.column.extent,n=e.row.extent,r=e.row.more.before,l=e.row.more.after,a=e.column.more.before,h=e.column.more.after;return t-1===this.m_endCol&&a?this._updateCellDimension(o,n,this.m_endCol,i,s,"column","width",!1):i-1===this.m_endRow&&r?this._updateCellDimension(n,o,t,this.m_endRow,s,"row","height",!1):t+o===this.m_startCol&&h?this._updateCellDimension(o,n,this.m_startCol,i,s,"column","width",!0):!(i+n!==this.m_startRow||!l)&&this._updateCellDimension(n,o,t,this.m_startRow,s,"row","height",!0)},l.prototype._updateTempArray=function(e,t,i,s,o,n){for(var r=0;r<o;r++){null==e[i+r]&&(e[i+r]=[]);for(var l=0;l<n;l++)e[i+r][s+l]=t}},l.prototype._getCellDimension=function(e,t,i,s,o){var n,r,l;if("row"===s?(n=this.getMappedStyle("rowheadercell")+" "+this.getMappedStyle("headercell"),r=this.m_endRowHeader):"column"===s&&(n=this.getMappedStyle("colheadercell")+" "+this.getMappedStyle("headercell"),r=this.m_endColHeader),-1===r){var a=this.createHeaderContext(s,t,null,{key:i},null,0,0,1),h=this.m_options.getInlineStyle(s,a),d=this.m_options.getStyleClass(s,a);(l=document.createElement("div")).style.cssText=h,l.className=n+" "+d}else l=e;return this._getHeaderDimension(l,i,s,o)},l.prototype.pushRowsDown=function(e,t){for(;e<=this.m_endRow;){var i=this._getAxisCellsByIndex(e,"row");if(i.length>0)for(var s=0;s<i.length;s++){var o=i[s],n=this.getElementDir(o,"top")+t;o.style.top=n+"px"}e+=1}},l.prototype.pushRowsUp=function(e,t){this.pushRowsDown(e,-t)},l.prototype.pushRowHeadersDown=function(e,t){for(;e;){var i=this.getElementDir(e,"top")+t;e.style.top=i+"px",e=e.nextSibling}},l.prototype.pushRowHeadersUp=function(e,t){this.pushRowHeadersDown(e,-t)},l.prototype.createCellContext=function(e,t,i,s,o){var n={};n.parentElement=s,n.indexes=e,n.cell=t,n.data=null!=t&&"object"==typeof t&&Object.prototype.hasOwnProperty.call(t,"data")?t.data:t,n.component=this,n.datasource=this.getDataSource(),n.mode="navigation",n.extents=o;for(var r=Object.keys(i),l=0;l<r.length;l++){var a=r[l];n[a]=i[a]}return null!=this.m_createContextCallback&&this.m_createContextCallback.call(this,n),this.m_fixContextCallback.call(this,n)},l.prototype._createUniqueId=function(e){return this._uniqueIdCallback(e,!1)},l.prototype.getRowHeaderWidth=function(){return-1===this.m_endRowHeader?0:this.m_rowHeaderWidth},l.prototype.getColumnHeaderHeight=function(){return-1===this.m_endColHeader?0:this.m_colHeaderHeight},l.prototype.getRowEndHeaderWidth=function(){return-1===this.m_endRowEndHeader?0:this.m_rowEndHeaderWidth},l.prototype.getColumnEndHeaderHeight=function(){return-1===this.m_endColEndHeader?0:this.m_colEndHeaderHeight},l.prototype.getRowBottom=function(e,t){var i=this.getColumnHeaderHeight();if(null!=t)return i+t;var s=this.getElementDir(e,"top"),o=this.calculateRowHeight(e);return isNaN(s)||isNaN(o)?i:i+s+o},l.prototype.handleCellsFetchError=function(e,t){if(this.m_fetching.cells=!1,this.hideStatusText(),null==this.m_databody.firstChild)this._shouldInitialize()&&this._handleInitialization(!0);else{var i=t[0],s=t[1];s.start+(s.count-1)>this.m_endCol&&(this.m_stopColumnFetch=!0,this.m_stopColumnHeaderFetch=!0,this.m_stopColumnEndHeaderFetch=!0),i.start+(i.count-1)>this.m_endRow&&(this.m_stopRowFetch=!0,this.m_stopRowHeaderFetch=!0,this.m_stopRowEndHeaderFetch=!0)}},l.prototype.showStatusText=function(){var e=this;"block"===this.m_status.style.display||this.m_showStatusTimeout||(this.m_showStatusTimeout=setTimeout(function(){var t=e.getResources().getTranslatedText("msgFetchingData");e.m_status.setAttribute("aria-label",t),e.m_status.style.display="block";var i=e.getWidth()/2-e.m_status.offsetWidth/2,s=e.getHeight()/2-e.m_status.offsetHeight/2;e.m_status.style.left=i+"px",e.m_status.style.top=s+"px",e.m_showStatusTimeout=null},this.getShowStatusDelay()))},l.prototype.getShowStatusDelay=function(){var e=parseInt(this.getResources().getDefaultOption("showIndicatorDelay"),10);return isNaN(e)?0:e},l.prototype.hideStatusText=function(){this.m_showStatusTimeout&&(clearTimeout(this.m_showStatusTimeout),this.m_showStatusTimeout=null),this.m_status.style.display="none"},l.prototype.getFocusableElementsInNode=function(e,t){var i,s,o=[],n=this.getResources().getMappedAttribute("tabMod");if(document.evaluate)for(s=(i=document.evaluate(".//*[@tabindex>=0]|.//*[@"+n+">=0]|.//input|.//select|.//textarea|.//button|.//a|.//INPUT|.//SELECT|.//TEXTAREA|.//BUTTON|.//A",e,null,XPathResult.ANY_TYPE,null)).iterateNext();s;)!s.disabled&&"none"!==s.style.display&&(t||!s.tabIndex||s.tabIndex>0||parseInt(s.getAttribute(n),10)>=0)&&o.push(s),s=i.iterateNext();else for(var r=(i=e.querySelectorAll("input, select, button, a, textarea, [tabIndex]:not([tabIndex='-1']), ["+n+"]:not(["+n+"='-1'])")).length,l=0;l<r;l+=1)!(s=i[l]).disabled&&"none"!==s.style.display&&(t||!s.tabIndex||s.tabIndex>=0||parseInt(s.getAttribute(n),10)>=0)&&o.push(s);return o},l.prototype._disableAllFocusableElements=function(e){for(var t=this.getResources().getMappedAttribute("tabMod"),i=this.getFocusableElementsInNode(e),s=0;s<i.length;s++){var o=parseInt(i[s].tabIndex,10);(isNaN(o)||o>=0)&&(i[s].setAttribute(t,isNaN(o)?-1:o),i[s].setAttribute("tabIndex",-1))}},l.prototype._enableAllFocusableElements=function(e){for(var t=this.getResources().getMappedAttribute("tabMod"),i=this.getFocusableElementsInNode(e,!1),s=0;s<i.length;s++){var o=parseInt(i[s].getAttribute(t),10);i[s].removeAttribute(t),-1===o?i[s].removeAttribute("tabIndex"):i[s].setAttribute("tabIndex",o)}},l.prototype._isFocusableElement=function(e){var t=e.tagName;return"INPUT"===t||"TEXTAREA"===t||"SELECT"===t||"BUTTON"===t||"A"===t||null!=e.getAttribute("tabIndex")&&parseInt(e.getAttribute("tabIndex"),10)>=0&&this.findCell(e)!==e},l.prototype._isFocusableElementBeforeCell=function(e){if(null==e||e===this.getRootElement()||this.m_utils.containsCSSClassName(e,this.getMappedStyle("cell")))return!1;var t=e.tagName;return!!("INPUT"===t||"TEXTAREA"===t||"SELECT"===t||"BUTTON"===t||"A"===t||this.m_utils.containsCSSClassName(e,this.getMappedStyle("active"))||null!=e.getAttribute("tabIndex")&&parseInt(e.getAttribute("tabIndex"),10)>=0&&this.findCell(e)!==e)||this._isFocusableElementBeforeCell(e.parentNode)},l.prototype._setFocusToFirstFocusableElement=function(e){var t=this.getFocusableElementsInNode(e,!0);if(t.length>0){var i=t[0];if(i.focus(),i.setSelectionRange&&i.value)try{i.setSelectionRange(i.value.length,i.value.length)}catch(e){}return!0===this._overwriteFlag&&"function"==typeof t[0].select&&i.select(),!0}return!1},l.prototype.handleScroll=function(e){if(this.m_handleScrollOverflow||(this.m_hasVerticalScroller||this.m_hasHorizontalScroller||(this.m_databody.style.overflow="hidden"),this.m_handleScrollOverflow=!0),this.m_animating)e.preventDefault();else if(!this.m_utils.isTouchDevice())if(!0!==this.m_silentScroll){var t;e||(e=window.event),t=e.target?e.target:e.srcElement;var i=this.m_utils.getElementScrollLeft(t),s=t.scrollTop;this.scrollTo(i,s)}else this.m_silentScroll=!1},l.prototype._getMaxScrollWidth=function(){return this._isCountUnknownOrHighwatermark("column")&&!this.m_stopColumnFetch?Number.MAX_VALUE:this.m_scrollWidth},l.prototype._getMaxScrollHeight=function(){return this._isCountUnknownOrHighwatermark("row")&&!this.m_stopRowFetch?Number.MAX_VALUE:this.m_scrollHeight},l.prototype.scroll=function(e){if(null!=e.position){var t={};t.x=Math.max(0,Math.min(this.m_scrollWidth,e.position.scrollX)),t.y=Math.max(0,Math.min(this.m_scrollHeight,e.position.scrollY)),this._scrollToScrollPositionObject(t)}},l.prototype.scrollDelta=function(e,t){this._adjustScrollerSize();var i=Math.max(0,Math.min(this._getMaxScrollWidth(),this.m_currentScrollLeft-e)),s=Math.max(0,Math.min(this._getMaxScrollHeight(),this.m_currentScrollTop-t));this._initiateScroll(i,s)},l.prototype.adjustTouchScroll=function(e,t){return this.m_utils.isTouchDevice()&&0!==e&&0!==t&&(Math.abs(e)>Math.abs(t)?(t=0,this.m_extraScrollOverY=null):(e=0,this.m_extraScrollOverX=null)),[e,t]},l.prototype._initiateScroll=function(e,t){this.m_utils.isTouchDevice()?this.scrollTo(e,t):(this.m_utils.setElementScrollLeft(this.m_databody,e),this.m_databody.scrollTop=t)},l.prototype._disableTouchScrollAnimation=function(){this.m_databody.firstChild.style.webkitTransitionDuration="0ms",this.m_rowHeader.firstChild.style.webkitTransitionDuration="0ms",this.m_colHeader.firstChild.style.webkitTransitionDuration="0ms",this.m_rowEndHeader.firstChild.style.webkitTransitionDuration="0ms",this.m_colEndHeader.firstChild.style.webkitTransitionDuration="0ms"},l.prototype._shouldLongScroll=function(e,t){return!this._isHighWatermarkScrolling()&&(e+this.getViewportWidth()<this._getMaxLeftPixel()||t+this.getViewportHeight()<this._getMaxTopPixel()||e>this._getMaxRightPixel()||t>this._getMaxBottomPixel())},l.prototype.scrollTo=function(e,t){if(e!==this.m_currentScrollLeft&&(this.m_prevScrollLeft=this.m_currentScrollLeft,this.m_currentScrollLeft=e),t!==this.m_currentScrollTop&&(this.m_prevScrollTop=this.m_currentScrollTop,this.m_currentScrollTop=t),this._checkScroll=!1,this.m_utils.isTouchDevice()||(this._shouldLongScroll(e,t)?this.handleLongScroll(e,t):this.fillViewport()),this._checkScroll=!0,this._syncScroller(),this._adjustScrollerSize(),null!=this.m_cellToFocus){var i=this.m_cellToFocus;this.m_cellToFocus=null,this._setActive(i,this._createActiveObject(i),null,!1,!1,!0)}null!=this.m_scrollIndexAfterFetch&&this._isInViewport(this.m_scrollIndexAfterFetch)===l.INSIDE&&(this._isDatabodyCellActive()&&this.m_scrollIndexAfterFetch.row===this.m_active.indexes.row&&this.m_scrollIndexAfterFetch.column===this.m_active.indexes.column&&this._highlightActive(),this.m_scrollIndexAfterFetch=null),null!=this.m_scrollHeaderAfterFetch&&(this._isDatabodyCellActive()||this.m_scrollHeaderAfterFetch.axis!==this.m_active.axis||this.m_scrollHeaderAfterFetch.index!==this.m_active.index||this.m_scrollHeaderAfterFetch.level!==this.m_active.level||this._highlightActive(),this.m_scrollHeaderAfterFetch=null),this.m_utils.isTouchDevice()||this.m_prevScrollTop===t&&this.m_prevScrollLeft===e||this.fireEvent("scroll",{event:null,ui:{scrollX:e,scrollY:t}}),this.isFetchComplete()&&this._checkScrollPosition()},l.prototype._scrollTransitionEnd=function(){null!=this.m_scrollTransitionEnd&&this.m_databody.firstChild.removeEventListener("webkitTransitionEnd",this.m_scrollTransitionEnd),this._isSelectionEnabled()&&this._scrollTouchSelectionAffordance(),this.fireEvent("scroll",{event:null,ui:{scrollX:this.m_currentScrollLeft,scrollY:this.m_currentScrollTop}}),this._shouldLongScroll(this.m_currentScrollLeft,this.m_currentScrollTop)?this.handleLongScroll(this.m_currentScrollLeft,this.m_currentScrollTop):this.fillViewport()},l.prototype._bounceBack=function(){var e=this.m_currentScrollLeft,t=this.m_currentScrollTop,i=this.m_databody.firstChild,s=this.m_colHeader.firstChild,o=this.m_rowHeader.firstChild,n=this.m_colEndHeader.firstChild,r=this.m_rowEndHeader.firstChild;i.removeEventListener("webkitTransitionEnd",this.m_bounceBack),i.style.webkitTransitionDuration=l.BOUNCE_ANIMATION_DURATION+"ms",o.style.webkitTransitionDuration=l.BOUNCE_ANIMATION_DURATION+"ms",r.style.webkitTransitionDuration=l.BOUNCE_ANIMATION_DURATION+"ms",s.style.webkitTransitionDuration=l.BOUNCE_ANIMATION_DURATION+"ms",n.style.webkitTransitionDuration=l.BOUNCE_ANIMATION_DURATION+"ms",null==this.m_scrollTransitionEnd&&(this.m_scrollTransitionEnd=this._scrollTransitionEnd.bind(this)),i.addEventListener("webkitTransitionEnd",this.m_scrollTransitionEnd),this.getResources().isRTLMode()?(i.style.webkitTransform="translate3d("+e+"px, "+-t+"px, 0)",s.style.webkitTransform="translate3d("+e+"px, 0, 0)",n.style.webkitTransform="translate3d("+e+"px, 0, 0)"):(i.style.webkitTransform="translate3d("+-e+"px, "+-t+"px, 0)",s.style.webkitTransform="translate3d("+-e+"px, 0, 0)",n.style.webkitTransform="translate3d("+-e+"px, 0, 0)"),o.style.webkitTransform="translate3d(0, "+-t+"px, 0)",r.style.webkitTransform="translate3d(0, "+-t+"px, 0)",this.m_extraScrollOverX=null,this.m_extraScrollOverY=null},l.prototype._syncScroller=function(){var e=this.m_currentScrollLeft,t=this.m_currentScrollTop,i=this.m_databody.firstChild,s=this.m_colHeader.firstChild,o=this.m_rowHeader.firstChild,n=this.m_colEndHeader.firstChild,r=this.m_rowEndHeader.firstChild;if(this.m_utils.isTouchDevice()&&Object.prototype.hasOwnProperty.call(window,"WebKitCSSMatrix"))null!=this.m_extraScrollOverX||null!=this.m_extraScrollOverY?(null!=this.m_extraScrollOverX?e+=this.m_extraScrollOverX:t+=this.m_extraScrollOverY,null==this.m_bounceBack&&(this.m_bounceBack=this._bounceBack.bind(this)),i.addEventListener("webkitTransitionEnd",this.m_bounceBack)):"0ms"===i.style.webkitTransitionDuration?this._scrollTransitionEnd():(null==this.m_scrollTransitionEnd&&(this.m_scrollTransitionEnd=this._scrollTransitionEnd.bind(this)),i.addEventListener("webkitTransitionEnd",this.m_scrollTransitionEnd)),this.getResources().isRTLMode()?(i.style.webkitTransform="translate3d("+e+"px, "+-t+"px, 0)",s.style.webkitTransform="translate3d("+e+"px, 0, 0)",n.style.webkitTransform="translate3d("+e+"px, 0, 0)"):(i.style.webkitTransform="translate3d("+-e+"px, "+-t+"px, 0)",s.style.webkitTransform="translate3d("+-e+"px, 0, 0)",n.style.webkitTransform="translate3d("+-e+"px, 0, 0)"),o.style.webkitTransform="translate3d(0, "+-t+"px, 0)",r.style.webkitTransform="translate3d(0, "+-t+"px, 0)";else{var l=this.getResources().isRTLMode()?"right":"left";this.setElementDir(s,-e,l),this.setElementDir(n,-e,l),this.setElementDir(o,-t,"top"),this.setElementDir(r,-t,"top")}},l.prototype._adjustScrollerSize=function(){var e=this.m_databody.firstChild,t=this.getElementHeight(e),i=this.getElementWidth(e);(this._getMaxBottomPixel()>t||this.getDataSource().getCount("row")===this._getMaxBottom()+1&&!this._isCountUnknown("row")&&this._getMaxBottom()>-1)&&this.setElementHeight(e,this._getMaxBottomPixel()),(this._getMaxRightPixel()>i||this.getDataSource().getCount("column")===this._getMaxRight()+1&&!this._isCountUnknown("column")&&this._getMaxRight()>-1)&&this.setElementWidth(e,this._getMaxRightPixel())},l.prototype._getLongScrollStart=function(e,t,i){var s,o,n,r,l,a,h;if(t!==e){"row"===i?(s=this.getElementHeight(this.m_databody.firstChild),o=this.m_utils._getMaxDivHeightForScrolling(),n=this._getMaxScrollHeight(),r=this.m_avgRowHeight,l=this.m_hasHorizontalScroller?this.m_utils.getScrollbarSize():0):"column"===i&&(s=this.getElementWidth(this.m_databody.firstChild),o=this.m_utils._getMaxDivWidthForScrolling(),n=this._getMaxScrollWidth(),r=this.m_avgColWidth,l=this.m_hasVerticalScroller?this.m_utils.getScrollbarSize():0);var d=Math.max(Math.min(e/s,1),0),m=this.getDataSource().getCount(i),c=this.getFetchSize(i);a=Math.floor(m*d),h=o<=s?Math.min(e,n):a*r,(1===d||e+c*r>s-l)&&(a=Math.max(m-c,0),h=Math.max(s-c*r,0))}else"row"===i?(a=this.m_startRow,h=this.m_startRowPixel):"column"===i&&(a=this.m_startCol,h=this.m_startColPixel);return{start:a,startPixel:h}},l.prototype.handleLongScroll=function(e,t){if(this.m_isLongScroll=!0,this.isFetchComplete()&&this._isScrollBackToEditable(!0)){var i=this._getLongScrollStart(t,this.m_prevScrollTop,"row"),s=i.start,o=i.startPixel,n=this._getLongScrollStart(e,this.m_prevScrollLeft,"column"),r=n.start,l=n.startPixel;this.m_hasCells&&(this.m_startRow=s,this.m_endRow=-1,this.m_startRowPixel=o,this.m_endRowPixel=o,this.m_startCol=r,this.m_endCol=-1,this.m_startColPixel=l,this.m_endColPixel=l),this.m_hasRowHeader&&(this.m_startRowHeader=s,this.m_endRowHeader=-1,this.m_startRowHeaderPixel=o,this.m_endRowHeaderPixel=o),this.m_hasRowEndHeader&&(this.m_startRowEndHeader=s,this.m_endRowEndHeader=-1,this.m_startRowEndHeaderPixel=o,this.m_endRowEndHeaderPixel=o),this.m_hasColHeader&&(this.m_startColHeader=r,this.m_endColHeader=-1,this.m_startColHeaderPixel=l,this.m_endColHeaderPixel=l),this.m_hasColEndHeader&&(this.m_startColEndHeader=r,this.m_endColEndHeader=-1,this.m_startColEndHeaderPixel=l,this.m_endColEndHeaderPixel=l),this.m_stopRowFetch=!1,this.m_stopRowHeaderFetch=!1,this.m_stopRowEndHeaderFetch=!1,this.m_stopColumnFetch=!1,this.m_stopColumnHeaderFetch=!1,this.m_stopColumnEndHeaderFetch=!1,this.fetchHeaders("row",s,this.m_rowHeader,this.m_rowEndHeader,void 0,{success:function(e,t,i){this.handleRowHeadersFetchSuccessForLongScroll(e,t,i)}}),this.fetchHeaders("column",r,this.m_colHeader,this.m_colEndHeader,void 0,{success:function(e,t,i){this.handleColumnHeadersFetchSuccessForLongScroll(e,t,i)}}),this.fetchCells(this.m_databody,s,r,null,null,{success:function(e,t){this.handleCellsFetchSuccessForLongScroll(e,t,s,r,o,l)}})}},l.prototype.handleRowHeadersFetchSuccessForLongScroll=function(e,t,i){var s=this.m_rowHeader.firstChild,o=this.m_rowEndHeader.firstChild;null!=s&&this.m_utils.empty(s),null!=o&&this.m_utils.empty(o),this.handleHeadersFetchSuccess(e,t,i,!1)},l.prototype.handleColumnHeadersFetchSuccessForLongScroll=function(e,t,i){var s=this.m_colHeader.firstChild,o=this.m_colEndHeader.firstChild;null!=s&&this.m_utils.empty(s),null!=o&&this.m_utils.empty(o),this.handleHeadersFetchSuccess(e,t,i,!1)},l.prototype.handleCellsFetchSuccessForLongScroll=function(e,t,i,s,o,n){var r=this.m_databody.firstChild;null!=r&&this._emptyDatabody(r),this.handleCellsFetchSuccess(e,t)},l.prototype._cleanupViewport=function(e){if(!this._isHighWatermarkScrolling()&&this._isScrollBackToEditable()){null==e&&(this.m_prevScrollLeft>this.m_currentScrollLeft?e="right":this.m_prevScrollLeft<this.m_currentScrollLeft?e="left":this.m_prevScrollTop>this.m_currentScrollTop?e="bottom":this.m_prevScrollTop<this.m_currentScrollTop&&(e="top"));var t=this._getViewportLeft(),i=this._getViewportRight(),s=this._getViewportTop(),o=this._getViewportBottom();"top"===e&&s>this._getMaxTopPixel()?(this.removeRowsFromTop(this.m_databody),this.removeRowHeadersFromTop()):"bottom"===e&&o<this._getMaxBottomPixel()?(this.removeRowsFromBottom(this.m_databody),this.removeRowHeadersFromBottom()):"left"===e&&t>this._getMaxLeftPixel()?(this.removeColumnsFromLeft(this.m_databody),this.removeColumnHeadersFromLeft()):"right"===e&&i<this._getMaxRightPixel()&&(this.removeColumnsFromRight(this.m_databody),this.removeColumnHeadersFromRight())}},l.prototype.fillViewport=function(){var e,t;if(this.isFetchComplete()){var i=this._getViewportLeft(),s=this._getViewportRight()+l.FETCH_PIXEL_THRESHOLD,o=this._getViewportTop(),n=this._getViewportBottom()+l.FETCH_PIXEL_THRESHOLD;if(this._getMaxBottomPixel()<=n&&(!this.m_stopRowHeaderFetch||!this.m_stopRowEndHeaderFetch||!this.m_stopRowFetch))return e=Math.max(0,this._getMaxBottom()+1),t=Math.max(0,this.getFetchCount("row",e)),this.fetchHeaders("row",e,this.m_rowHeader,this.m_rowEndHeader,t),void this.fetchCells(this.m_databody,e,this.m_startCol,t,this.m_endCol-this.m_startCol+1);if(this._getMaxTopPixel()>o||0===this.m_currentScrollTop&&this._getMaxTop()>0)return e=Math.max(0,this._getMaxTop()-this.getFetchSize("row")),t=Math.max(0,this._getMaxTop()-e),this.fetchHeaders("row",e,this.m_rowHeader,this.m_rowEndHeader,t),void this.fetchCells(this.m_databody,e,this.m_startCol,t,this.m_endCol-this.m_startCol+1);if(this._getMaxRightPixel()<=s&&(!this.m_stopColumnHeaderFetch||!this.m_stopColumnEndHeaderFetch||!this.m_stopColumnFetch))return e=Math.max(0,this._getMaxRight()+1),t=Math.max(0,this.getFetchCount("column",e)),this.fetchHeaders("column",e,this.m_colHeader,this.m_colEndHeader,t),void this.fetchCells(this.m_databody,this.m_startRow,e,this.m_endRow-this.m_startRow+1,t);(this._getMaxLeftPixel()>i||0===this.m_currentScrollLeft&&this._getMaxLeft()>0)&&(e=Math.max(0,this._getMaxLeft()-this.getFetchSize("column")),t=Math.max(0,this._getMaxLeft()-e),this.fetchHeaders("column",e,this.m_colHeader,this.m_colEndHeader,t),this.fetchCells(this.m_databody,this.m_startRow,e,this.m_endRow-this.m_startRow+1,t))}},l.prototype._getMaxRight=function(){return Math.max(Math.max(this.m_endCol,this.m_endColHeader),this.m_endColEndHeader)},l.prototype._getMaxLeft=function(){return Math.max(Math.max(this.m_startCol,this.m_startColHeader),this.m_startColEndHeader)},l.prototype._getMaxRightPixel=function(){return Math.max(Math.max(this.m_endColPixel,this.m_endColHeaderPixel),this.m_endColEndHeaderPixel)},l.prototype._getMaxLeftPixel=function(){return Math.max(Math.max(this.m_startColPixel,this.m_startColHeaderPixel),this.m_startColEndHeaderPixel)},l.prototype._getMaxBottom=function(){return Math.max(Math.max(this.m_endRow,this.m_endRowHeader),this.m_endRowEndHeader)},l.prototype._getMaxTop=function(){return Math.max(Math.max(this.m_startRow,this.m_startRowHeader),this.m_startRowEndHeader)},l.prototype._getMaxBottomPixel=function(){return Math.max(Math.max(this.m_endRowPixel,this.m_endRowHeaderPixel),this.m_endRowEndHeaderPixel)},l.prototype._getMaxTopPixel=function(){return Math.max(Math.max(this.m_startRowPixel,this.m_startRowHeaderPixel),this.m_startRowEndHeaderPixel)},l.prototype._isScrollBackToEditable=function(e){var t=this._getCurrentMode(),i=this._getActiveElement();return"edit"!==t||!e&&!this._isCellGoingToBeRemoved(i)||this._handleExitEdit(null,i)},l.prototype._isCellGoingToBeRemoved=function(e){if(!this._isHighWatermarkScrolling()){if(this.m_endRow-this.m_startRow>this.MAX_ROW_THRESHOLD){var t=this.getElementDir(e.parentNode,"top");if(t+this.getElementHeight(e)<this.m_currentScrollTop||t<this.m_currentScrollTop+this.getViewportHeight())return!0}if(this.m_endCol-this.m_startCol>this.MAX_COLUMN_THRESHOLD){var i=this.getElementDir(e,"left");if(i+this.getElementWidth(e)<this.m_currentScrollLeft||i<this.m_currentScrollLeft+this.getViewportHeight())return!0}}},l.prototype._removeCellsAlongAxis=function(e,t,i){var s,o,n,r,l,a,h,d,m,c,u,_,p,g,C=0,f=0;for("row"===e?(o=this.m_startRow,n=this.m_endRow,r=this.m_rowHeader,l=this.m_rowHeaderLevelCount,a=this.m_startRowHeader,h="height",d=this.m_startRowPixel,m=this.m_endRowPixel,c=this.m_currentScrollTop,u="column",_=this.m_startCol,p=this.m_endCol,g="top",s=i?n:o):(o=this.m_startCol,n=this.m_endCol,r=this.m_colHeader,l=this.m_columnHeaderLevelCount,a=this.m_startColHeader,h="width",d=this.m_startColPixel,m=this.m_endColPixel,c=this.m_currentScrollLeft,u="row",_=this.m_startRow,p=this.m_endRow,g=this.getResources().isRTLMode()?"right":"left",s=i?n:o);s<=n&&s>=o;){var v=this._getKey(this._getHeaderByIndex(s,l-1,r,l,a),e);null==v&&(v=this._getKey(this._getCellByIndex("column"===e?this.createIndex(this.m_startRow,s):this.createIndex(s,this.m_startCol)),e));var y=this._getCellDimension(null,s,v,e,h);if(!(i?m-y-C>t:d+y+C<c-t))break;for(var E,S=_;S<=p;S+=E){var w=this._getCellByIndex("column"===e?this.createIndex(S,s):this.createIndex(s,S)),H=w[this.getResources().getMappedAttribute("context")],b=H.extents[e];E=H.extents[u],1===b?this._remove(w):(H.extents[e]-=1,this.setElementDir(w,this.getElementDir(w,h)-y,h),i||(H.indexes[e]+=1,this.setElementDir(w,this.getElementDir(w,g)+y,g)));for(var x=0;x<E;x++){var R="column"===e?this.createIndex(S+x,s):this.createIndex(s,S+x);this._removeIndexFromDatabodyMap(R)}}C+=y,f+=1,s=i?s-1:s+1}return{dimensionChange:C,extentChange:f}},l.prototype.removeHeadersFromStartOfContainer=function(e,t,i,s,o,n,r,l){var a=0,h=0,d=null==t?e.firstChild:t.nextSibling;if(null==d)return{extentChange:0,dimensionChange:0};for(var m=this.m_utils.containsCSSClassName(d,o),c=m?d:d.firstChild,u=this.getElementDir(c,n);i+u<l-s;){if(this._remove(d),h+=u,a+=m?1:this._getAttribute(d,"extent",!0),i+=u,null==(d=null==t?e.firstChild:t.nextSibling))return{extentChange:a,dimensionChange:h};c=(m=this.m_utils.containsCSSClassName(d,o))?d:d.firstChild,u=this.getElementDir(c,n)}if(!m){var _=this.removeHeadersFromStartOfContainer(d,d.firstChild,i,s,o,n,r,l);this._setAttribute(d,"start",this._getAttribute(d,"start",!0)+_.extentChange),this._setAttribute(d,"extent",this._getAttribute(d,"extent",!0)-_.extentChange),this.setElementDir(c,this.getElementDir(c,r)+_.dimensionChange,r),this.setElementDir(c,this.getElementDir(c,n)-_.dimensionChange,n),a+=_.extentChange,h+=_.dimensionChange}return{extentChange:a,dimensionChange:h}},l.prototype.removeHeadersFromEndOfContainer=function(e,t,i,s,o){for(var n=0,r=0,l=e.lastChild,a=this.m_utils.containsCSSClassName(l,s),h=a?l:l.firstChild,d=this.getElementDir(h,o);t-d>i;)this._remove(l),r+=d,n+=a?1:this._getAttribute(l,"extent",!0),t-=d,l=e.lastChild,h=(a=this.m_utils.containsCSSClassName(l,s))?l:l.firstChild,d=this.getElementDir(h,o);if(!a){var m=this.removeHeadersFromEndOfContainer(l,t,i,s,o);this._setAttribute(l,"extent",this._getAttribute(l,"extent",!0)-m.extentChange),this.setElementDir(h,this.getElementDir(h,o)-m.dimensionChange,o),n+=m.extentChange,r+=m.dimensionChange}return{extentChange:n,dimensionChange:r}},l.prototype.removeColumnHeadersFromLeft=function(){var e,t;if(this.m_endColHeader-this.m_startColHeader>this.MAX_COLUMN_THRESHOLD){var i=this.m_colHeader.firstChild;e=this.getColumnThreshold(),this.m_startColHeaderPixel<=this.m_currentScrollLeft-e&&(t=this.removeHeadersFromStartOfContainer(i,null,this.m_startColHeaderPixel,e,this.getMappedStyle("colheadercell"),"width",this.getResources().isRTLMode()?"right":"left",this.m_currentScrollLeft),this.m_startColHeaderPixel+=t.dimensionChange,this.m_startColHeader+=t.extentChange)}if(this.m_endColEndHeader-this.m_startColEndHeader>this.MAX_COLUMN_THRESHOLD){var s=this.m_colEndHeader.firstChild;e=this.getColumnThreshold(),this.m_startColEndHeaderPixel<this.m_currentScrollLeft-e&&(t=this.removeHeadersFromStartOfContainer(s,null,this.m_startColEndHeaderPixel,e,this.getMappedStyle("colendheadercell"),"width",this.getResources().isRTLMode()?"right":"left",this.m_currentScrollLeft),this.m_startColEndHeaderPixel+=t.dimensionChange,this.m_startColEndHeader+=t.extentChange)}},l.prototype.removeColumnsFromLeft=function(e){if(this.m_endCol-this.m_startCol>this.MAX_COLUMN_THRESHOLD){var t=e.firstChild.childNodes,i=this.getColumnThreshold();if(t.length<1)return;var s=this._removeCellsAlongAxis("column",i,!1);this.m_startColPixel+=s.dimensionChange,this.m_startCol+=s.extentChange}},l.prototype.removeColumnHeadersFromRight=function(){var e,t,i=this.m_currentScrollLeft+this.getViewportWidth()+this.getColumnThreshold();this.m_endColHeader-this.m_startColHeader>this.MAX_COLUMN_THRESHOLD&&(e=this.m_colHeader.firstChild,this.m_endColHeaderPixel>i&&(this.m_stopColumnHeaderFetch&&(this.m_stopColumnHeaderFetch=!1),t=this.removeHeadersFromEndOfContainer(e,this.m_endColHeaderPixel,i,this.getMappedStyle("colheadercell"),"width"),this.m_endColHeaderPixel-=t.dimensionChange,this.m_endColHeader-=t.extentChange)),this.m_endColEndHeader-this.m_startColEndHeader>this.MAX_COLUMN_THRESHOLD&&(e=this.m_colEndHeader.firstChild,this.m_endColEndHeaderPixel>i&&(this.m_stopColumnEndHeaderFetch&&(this.m_stopColumnEndHeaderFetch=!1),t=this.removeHeadersFromEndOfContainer(e,this.m_endColEndHeaderPixel,i,this.getMappedStyle("colendheadercell"),"width"),this.m_endColEndHeaderPixel-=t.dimensionChange,this.m_endColEndHeader-=t.extentChange))},l.prototype.removeColumnsFromRight=function(e){if(this.m_endCol-this.m_startCol>this.MAX_COLUMN_THRESHOLD){var t=e.firstChild.childNodes,i=this.m_currentScrollLeft+this.getViewportWidth()+this.getColumnThreshold();if(this.m_endColPixel<=i||t.length<1)return;this.m_stopColumnFetch&&(this.m_stopColumnFetch=!1);var s=this._removeCellsAlongAxis("column",i,!0);this.m_endColPixel-=s.dimensionChange,this.m_endCol-=s.extentChange}},l.prototype.removeRowHeadersFromTop=function(){var e,t;if(this.m_endRowHeader-this.m_startRowHeader>this.MAX_ROW_THRESHOLD){var i=this.m_rowHeader.firstChild;t=this.getRowThreshold(),this.m_startRowHeaderPixel>=this.m_currentScrollTop-t||(e=this.removeHeadersFromStartOfContainer(i,null,this.m_startRowHeaderPixel,t,this.getMappedStyle("rowheadercell"),"height","top",this.m_currentScrollTop),this.m_startRowHeaderPixel+=e.dimensionChange,this.m_startRowHeader+=e.extentChange)}if(this.m_endRowEndHeader-this.m_startRowEndHeader>this.MAX_ROW_THRESHOLD){var s=this.m_rowEndHeader.firstChild;t=this.getRowThreshold(),this.m_startRowEndHeaderPixel>=this.m_currentScrollTop-t||(e=this.removeHeadersFromStartOfContainer(s,null,this.m_startRowEndHeaderPixel,t,this.getMappedStyle("rowendheadercell"),"height","top",this.m_currentScrollTop),this.m_startRowEndHeaderPixel+=e.dimensionChange,this.m_startRowEndHeader+=e.extentChange)}},l.prototype.removeRowsFromTop=function(e){if(this.m_endRow-this.m_startRow>this.MAX_ROW_THRESHOLD){var t=this.getRowThreshold();if(this.m_startRowPixel>=this.m_currentScrollTop-t)return;var i=this._removeCellsAlongAxis("row",t,!1);this.m_startRowPixel+=i.dimensionChange,this.m_startRow+=i.extentChange}},l.prototype.removeRowHeadersFromBottom=function(){var e,t=this.m_currentScrollTop+this.getViewportHeight()+this.getRowThreshold();if(this.m_endRowHeader-this.m_startRowHeader>this.MAX_ROW_THRESHOLD){var i=this.m_rowHeader.firstChild;this.m_endRowHeaderPixel<=t||(this.m_stopRowHeaderFetch&&(this.m_stopRowHeaderFetch=!1),e=this.removeHeadersFromEndOfContainer(i,this.m_endRowHeaderPixel,t,this.getMappedStyle("rowheadercell"),"height"),this.m_endRowHeaderPixel-=e.dimensionChange,this.m_endRowHeader-=e.extentChange)}if(this.m_endRowEndHeader-this.m_startRowEndHeader>this.MAX_ROW_THRESHOLD){var s=this.m_rowEndHeader.firstChild;this.m_endRowEndHeaderPixel<=t||(this.m_stopRowEndHeaderFetch&&(this.m_stopRowEndHeaderFetch=!1),e=this.removeHeadersFromEndOfContainer(s,this.m_endRowEndHeaderPixel,t,this.getMappedStyle("rowendheadercell"),"height"),this.m_endRowEndHeaderPixel-=e.dimensionChange,this.m_endRowEndHeader-=e.extentChange)}},l.prototype.removeRowsFromBottom=function(e){if(this.m_endRow-this.m_startRow>this.MAX_ROW_THRESHOLD){var t=this.m_currentScrollTop+this.getViewportHeight()+this.getRowThreshold();if(this.m_endRowPixel<=t)return;this.m_stopRowFetch&&(this.m_stopRowFetch=!1);var i=this._removeCellsAlongAxis("row",t,!0);this.m_endRowPixel-=i.dimensionChange,this.m_endRow-=i.extentChange}},l.prototype.handleContextMenuGesture=function(e,t,i){var s,o,n,r=e.originalEvent.target,l=this.findCell(r);if("touch"===t&&null!=l&&(s=this.getCellIndexes(l),(!this.isMultipleSelection()||!this._isContainSelection(s)||this._isDatabodyCellActive()&&s.row!==this.m_active.indexes.row&&s.column!==this.m_active.indexes.column)&&(this._isSelectionEnabled()?this.handleDatabodyClickSelection(e.originalEvent):this.handleDatabodyClickActive(e.originalEvent))),!this.m_utils._isNodeEditableOrClickable(r,this.m_root)){if(null!=l)s=this.getCellIndexes(l),this.isMultipleSelection()&&this._isContainSelection(s)?(n=this._getActiveElement(),o=this._isDatabodyCellActive()?"keyboard"===t?this._getCellCapability(n):this._getCellCapability(n,l):this._getHeaderCapability(n,l)):(n=l,o=this._getCellCapability(n));else if(null==(l=this.findHeader(r))){if(null==(l=this.findLabel(r)))return;o={resize:"disable",resizeWidth:"disable",resizeHeight:"disable",sortRow:"disable",sortCol:"disable",cut:"disable",paste:"disable",sortColAsc:"disable",sortColDsc:"disable"},n=l}else o=this._getHeaderCapability(l),n=l;i.call(null,{capabilities:o,launcher:n},e,t)}},l.prototype._getCellCapability=function(e,t){var i=!0,s=!0,o="disable",n="enable",r={resize:o,resizeWidth:o,resizeHeight:o,sortRow:o,sortCol:o,cut:o,paste:o,sortColAsc:o,sortColDsc:o};if(null!=t&&(i=this._getIndex(e,"column")===this._getIndex(t,"column"),!1===(s=this._getKey(e,"row")===this._getKey(t,"row"))&&!1===i))return r;var l=this.getHeaderFromCell(e,"row"),a=this.getHeaderFromCell(e,"column"),h=this.getResources().getMappedAttribute("resizable"),d=this.getResources().getMappedAttribute("sortable");if(null!=a&&i&&("true"===a.getAttribute(h)&&(r.resize=n,r.resizeWidth=n),"true"===a.getAttribute(d))){r.sortCol=n,r.sortColAsc=n,r.sortColDsc=n;var m=a.getAttribute(this.getResources().getMappedAttribute("sortDir"));"ascending"===m?r.sortColAsc=o:"descending"===m&&(r.sortColDsc=o)}return s&&(this._isMoveEnabled("row")&&(r.cut=n,r.paste=n),null!=l&&("true"===l.getAttribute(h)&&(r.resize=n,r.resizeHeight=n),"true"===l.getAttribute(d)&&(r.sortRow=n))),r},l.prototype._getHeaderCapability=function(e,t){var i=!0,s=!0,o="disable",n="enable",r={resize:o,resizeWidth:o,resizeHeight:o,sortRow:o,sortCol:o,cut:o,paste:o,sortColAsc:o,sortColDsc:o};if(null!=t&&(i=this.getHeaderCellIndex(e)===this._getIndex(t,"column"),!1===(s=this._getKey(e,"row")===this._getKey(t,"row"))&&!1===i))return r;var l=this.getHeaderCellAxis(e),a=this.getResources().getMappedAttribute("resizable"),h=this.getResources().getMappedAttribute("sortable");if(null!==e)if("column"!==l&&"columnEnd"!==l||!i)s&&(this._isMoveEnabled("row")&&(r.cut=n,r.paste=n),"true"===e.getAttribute(a)&&(r.resize=n,r.resizeHeight=n),r.resizeWidth=this.m_options.isResizable(l,"width"),"true"===e.getAttribute(h)&&(r.sortRow=n));else if("true"===e.getAttribute(a)&&(r.resizeWidth=n,r.resize=n),r.resizeHeight=this.m_options.isResizable(l,"height"),"true"===e.getAttribute(h)){r.sortCol=n,r.sortColAsc=n,r.sortColDsc=n;var d=e.getAttribute(this.getResources().getMappedAttribute("sortDir"));"ascending"===d?r.sortColAsc=o:"descending"===d&&(r.sortColDsc=o)}return r.resize=r.resizeHeight===n||r.resizeWidth===n?n:o,r},l.prototype.handleContextMenuReturn=function(e,t,i){var s,o;null!=this.m_active&&(s=this._getActiveElement()),t===this.m_resources.getMappedCommand("resizeHeight")||t===this.m_resources.getMappedCommand("resizeWidth")?this.isResizeEnabled()&&this.handleContextMenuResize(e,t,i,s):t===this.m_resources.getMappedCommand("sortColAsc")||t===this.m_resources.getMappedCommand("sortColDsc")?(o=t===this.m_resources.getMappedCommand("sortColAsc")?"ascending":"descending",this.m_utils.containsCSSClassName(s,this.getMappedStyle("cell"))&&(s=this.getHeaderFromCell(s,"column")),this._isDOMElementSortable(s)&&this._handleCellSort(e,o,s)):t===this.m_resources.getMappedCommand("sortRowAsc")||t===this.m_resources.getMappedCommand("sortRowDsc")?(o=t===this.m_resources.getMappedCommand("sortRowAsc")?"ascending":"descending",this.m_utils.containsCSSClassName(s,this.getMappedStyle("cell"))&&(s=this.getHeaderFromCell(s,"row")),this._isDOMElementSortable(s)&&this._handleCellSort(e,o,s)):t===this.m_resources.getMappedCommand("cut")?this._handleCut(e,s):t===this.m_resources.getMappedCommand("paste")?this._handlePaste(e,s):t===this.m_resources.getMappedCommand("discontiguousSelection")&&this.setDiscontiguousSelectionMode(i)},l.prototype._isSortEnabled=function(e,t){var i=this.getDataSource().getCapability("sort"),s=this.m_options.isSortable(e,t);return!("enable"!==s&&"auto"!==s||"full"!==i&&i!==e)},l.prototype._isDOMElementSortable=function(e){if(null==e)return!1;var t=this.findHeader(e);return null!=t&&"true"===t.getAttribute(this.getResources().getMappedAttribute("sortable"))},l.prototype._isSelectionEnabled=function(){return"none"!==this.m_options.getSelectionCardinality()},l.prototype.isMultipleSelection=function(){return"multiple"===this.m_options.getSelectionCardinality()},l.prototype.isResizeEnabled=function(){return this.m_options.isResizable("row","width")||this.m_options.isResizable("row","height")||this.m_options.isResizable("column","width")||this.m_options.isResizable("column","height")||this.m_options.isResizable("rowEnd","width")||this.m_options.isResizable("rowEnd","height")||this.m_options.isResizable("columnEnd","width")||this.m_options.isResizable("columnEnd","height")},l.prototype._isHeaderResizeEnabled=function(e,t){return"column"===e||"columnEnd"===e?"enable"===this.m_options.isResizable(e,"width",t):("row"===e||"rowEnd"===e)&&"enable"===this.m_options.isResizable(e,"height",t)},l.prototype.handleMouseMove=function(e){this.isResizeEnabled()&&!1===this.m_databodyDragState&&this.handleResize(e)},l.prototype.handleRowHeaderMouseMove=function(e){this.m_databodyMove?this._handleMove(e):this.m_headerDragState&&this.m_selectionFrontier&&-1!==this.m_selectionFrontier.axis.indexOf("row")?this.extendSelectionHeader(e.target,e):this.m_isResizing||this.handleMouseMove(e)},l.prototype.handleColumnHeaderMouseMove=function(e){this.m_headerDragState&&this.m_selectionFrontier&&-1!==this.m_selectionFrontier.axis.indexOf("column")?this.extendSelectionHeader(e.target,e):this.m_isResizing||this.handleMouseMove(e)},l.prototype.handleHeaderMouseDown=function(e){var t;this._exitActionableMode();var i=e.target;if(this._isEditOrEnter()){var s=this._getActiveElement();if(!1===this._leaveEditing(e,s,!1))return}if(0===e.button){if((this.m_utils.containsCSSClassName(i,this.getMappedStyle("sortascending"))||this.m_utils.containsCSSClassName(i,this.getMappedStyle("sortdescending")))&&this._isDOMElementSortable(i))return e.preventDefault(),void this._handleSortIconMouseDown(i);this.isResizeEnabled()&&(t=this.handleResizeMouseDown(e)),!this.m_isResizing&&this._isMoveOnElementEnabled(this.findHeader(i))&&(this.m_databodyMove=!0,this.m_currentX=e.pageX,this.m_currentY=e.pageY,t=!0)}if(!this.m_isResizing){this.m_root.contains(document.activeElement)&&document.activeElement!==this.m_root||(this.m_externalFocus=!0);var o=this.m_options.getSelectionMode(),n=this.findHeader(i)[this.getResources().getMappedAttribute("context")];!this._isSelectionEnabled()||!this.isMultipleSelection()||"row"===o&&-1===n.axis.indexOf("row")||this.m_databodyMove?"row"===o&&-1!==n.axis.indexOf("row")&&this._isSelectionEnabled()?this.handleHeaderClickSelection(e):this.handleHeaderClickActive(e):(this.handleHeaderClickSelection(e),0===e.button&&(this.m_headerDragState=!0))}!0===t&&e.preventDefault()},l.prototype.handleMouseUp=function(e){this.m_headerDragState=!1,this.m_databodyDragState=!1,this.m_databodyMove?this._handleMoveMouseUp(e,!1):this.isResizeEnabled()&&this.handleResizeMouseUp(e),this.m_databodyMove=!1},l.prototype.handleHeaderMouseOver=function(e){var t=e.target;this.m_utils.addCSSClassName(this.findHeader(t),this.getMappedStyle("hover")),this._isDOMElementSortable(t)&&this._handleSortMouseOver(e)},l.prototype.handleHeaderMouseOut=function(e){var t=e.target;this.m_utils.removeCSSClassName(this.findHeader(t),this.getMappedStyle("hover")),this._isDOMElementSortable(t)&&this._handleSortMouseOut(e)},l.prototype.handleHeaderMouseUp=function(e){this.handleDragAnchorChange(e),this.m_headerDragState=!1,this.m_databodyDragState=!1,this.m_databodyMove&&this._handleMoveMouseUp(e,!0)},l.prototype.handleCornerMouseDown=function(e){var t=e.target,i=this.findLabel(t);null!=i&&this._setActive(i,this._createActiveObject(i),e,!0)},l.prototype.handleCornerMouseOver=function(e){var t=e.target;this.m_utils.addCSSClassName(this.findLabel(t),this.getMappedStyle("hover"))},l.prototype.handleCornerMouseOut=function(e){var t=e.target;this.m_utils.removeCSSClassName(this.findLabel(t),this.getMappedStyle("hover"))},l.prototype.handleCornerClick=function(e){var t=e.target;null==this.find(t,"headerlabel")&&this._handleSelectAll(e)},l.prototype.handleHeaderClick=function(e){var t=e.target;(this.m_utils.containsCSSClassName(t,this.getMappedStyle("sortascending"))||this.m_utils.containsCSSClassName(t,this.getMappedStyle("sortdescending")))&&this._isDOMElementSortable(t)&&(this._removeTouchSelectionAffordance(),this._handleHeaderSort(e),e.preventDefault())},l.prototype.handleDatabodyMouseDown=function(e){var t=e.target,i=this.findCell(t);if(null!=i){if(this._isEditOrEnter()){var s=this._getActiveElement();if(i===s)return;if(!1===this._leaveEditing(e,s,!1))return}else this._exitActionableMode();0===e.button&&this._isMoveOnElementEnabled(i)&&(this.m_databodyMove=!0,this.m_currentX=e.pageX,this.m_currentY=e.pageY),this.m_root.contains(document.activeElement)&&document.activeElement!==this.m_root||(this.m_externalFocus=!0),this._isGridEditable()&&(this.m_shouldFocus=!this._isFocusableElementBeforeCell(t)),this._isSelectionEnabled()?(this.handleDatabodyClickSelection(e),this.isMultipleSelection()&&0===e.button&&(this.m_databodyDragState=!0)):this.handleDatabodyClickActive(e)}else this.m_scrollbarFocus=!0},l.prototype.handleDatabodyMouseOut=function(e){if(!this.m_databodyMove){var t=e.target,i=this.findCell(t);this._setCellHover(i,"remove")}},l.prototype.handleDatabodyMouseOver=function(e){if(!this.m_databodyMove){var t=e.target,i=this.findCell(t);this._setCellHover(i,"add")}},l.prototype._setCellHover=function(e,t){if(null!=e){var i=this.m_options.getSelectionMode();if("cell"===i)"add"===t?this.m_utils.addCSSClassName(e,this.getMappedStyle("hover")):this.m_utils.removeCSSClassName(e,this.getMappedStyle("hover"));else if("row"===i)for(var s=this._getIndex(e,"row"),o=this._getSelectionStartAndEnd(this.createIndex(s,this.m_startCol),this.createIndex(s,this.m_endCol),0),n=o.min.row;n<=o.max.row;n++)this._highlightCellsAlongAxis(n,"row","index",t,["hover"])}},l.prototype.handleDatabodyDoubleClick=function(e){if(this._isGridEditable()){var t=e.target,i=this.findCell(t);if("edit"===this._getCurrentMode()){var s=this._getActiveElement();if(i===s)return;if(!this._handleExitEdit(e,s))return}this._handleEditable(e,i),this._handleEdit(e,i)}},l.prototype.handleDatabodyMouseMove=function(e){this.m_databodyMove?this._handleMove(e):this.m_databodyDragState&&this.handleDatabodySelectionDrag(e)},l.prototype.handleDatabodyMouseUp=function(e){this.m_databodyDragState=!1,this.m_headerDragState=!1,this.m_databodyMove&&this._handleMoveMouseUp(e,!0)},l.prototype.handleDatabodyKeyDown=function(e){var t,i=this.m_utils.ctrlEquivalent(e);if(!(e.defaultPrevented&&i&&(l.keyCodes.LEFT_KEY||l.keyCodes.RIGHT_KEY)||this.m_animating)){t=null!=this.m_active&&"header"===this.m_active.type?this._getActionFromKeyDown(e,this.m_active.axis,!1):null!=this.m_active&&"label"===this.m_active.type?this._getActionFromKeyDown(e,this.m_active.axis,!0):this._getActionFromKeyDown(e,"cell",!1);var s=this._getActiveElement();null!=t&&t.call(this,e,s)&&e.preventDefault()}},l.prototype.findPos=function(e){if(e){var t=this.findPos(e.offsetParent),i=this.getElementTranslationXYZ(e.offsetParent);return[parseInt(t[0],10)+parseInt(e.offsetLeft,10)+i[0],parseInt(t[1],10)+parseInt(e.offsetTop,10)+i[1]]}return[0,0]},l.prototype.getElementTranslationXYZ=function(e){if(e){var t=document.defaultView.getComputedStyle(e,null),i=t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("-o-transform")||t.getPropertyValue("transform"),s=i.substr(7,i.length-8).split(", ");return[isNaN(parseInt(s[4],10))?0:parseInt(s[4],10),isNaN(parseInt(s[5],10))?0:parseInt(s[5],10),isNaN(parseInt(s[6],10))?0:parseInt(s[6],10)]}return[0,0,0]},l.prototype.handleDatabodyMouseWheel=function(e){if(e.preventDefault(),!this.m_animating){var t=this.m_utils.getMousewheelScrollDelta(e),i=t.deltaX,s=t.deltaY;this.scrollDelta(i,s)}},l.prototype.handleTouchStart=function(e){var t=e.touches.length,i=e.touches[0].target;if(1===t){if(this.m_startX=e.touches[0].pageX,this.m_startY=e.touches[0].pageY,this.m_currentX=this.m_startX,this.m_currentY=this.m_startY,this.m_prevX=this.m_startX,this.m_prevY=this.m_startY,this.m_startTime=(new Date).getTime(),this.m_touchActive=!0,this.isMultipleSelection()){i.className!==this.getMappedStyle("selectaffordancetop")&&i.className!==this.getMappedStyle("selectaffordancebottom")||(i=i.parentNode);var s=null;if(i===this.m_topSelectIconContainer?s="top":i===this.m_bottomSelectIconContainer&&(s="bottom"),s){this.m_touchMultipleSelect=!0;var o=this.GetSelection();this.m_touchSelectAnchor="top"===s?o[o.length-1].endIndex:o[o.length-1].startIndex}}!this.m_touchMultipleSelect&&this._isMoveOnElementEnabled(this.findCell(i))&&(this.m_databodyMove=!0)}else this.handleTouchCancel(e)},l.prototype.handleTouchMove=function(e){var t=e.target;if(this.m_touchActive){e.preventDefault(),this.m_currentX=e.touches[0].pageX,this.m_currentY=e.touches[0].pageY;var i=this.m_currentX-this.m_prevX,s=this.m_currentY-this.m_prevY;if(this.getResources().isRTLMode()&&(i*=-1),this.m_touchMultipleSelect)this.handleDatabodySelectionDrag(e);else if(this.m_databodyMove)this._removeTouchSelectionAffordance(),this._handleMove(e);else if(this._isEditOrEnter()){var o=this._getActiveElement();this.findCell(t)!==o&&this._handleNonSwipeScroll(i,s)}else this._handleNonSwipeScroll(i,s);this.m_prevX=this.m_currentX,this.m_prevY=this.m_currentY}else this.handleTouchCancel(e)},l.prototype.handleTouchEnd=function(e){var t,i=e.target;if(this._isEditOrEnter()){if(t=this._getActiveElement(),this.findCell(i)===t)return void this.handleTouchCancel(e);this._leaveEditing(e,t,!1)}else this._exitActionableMode();if(null!=this.m_lastTapTime&&this.m_startTime-this.m_lastTapTime<250&&this.m_lastTapTarget===i?(this.m_lastTapTime=null,this.m_lastTapTarget=null,null!=(t=this.findCell(i))&&(this._handleEditable(e,t),this._handleEdit(e,t),e.preventDefault())):(this.m_lastTapTarget=e.target,this.m_lastTapTime=(new Date).getTime()),this.m_touchActive&&!e.defaultPrevented)if(this.m_touchMultipleSelect)e.preventDefault(),this.m_touchMultipleSelect=!1;else{var s=this.m_lastTapTime-this.m_startTime;if(this.m_currentX===this.m_startX&&this.m_currentY===this.m_startY)return this.m_databodyMove=!1,this._isSelectionEnabled()&&s<l.CONTEXT_MENU_TAP_HOLD_DURATION?void this.handleDatabodyClickSelection(e):void this.handleDatabodyClickActive(e);if(this.m_databodyMove)return e.preventDefault(),this.m_databodyMove=!1,void this._handleMoveMouseUp(e,!0);this._handleSwipe(e)}this.handleTouchCancel(e)},l.prototype._calculateMomentum=function(e,t,i,s,o,n){var r,a=e-t,h=Math.abs(a)/i,d=h*h/(2*l.DECELERATION_FACTOR)*(a<0?-1:1),m=h/l.DECELERATION_FACTOR;return n&&(d*=-1),s-d>o?(r=Math.max(-1*l.MAX_OVERSCROLL_PIXEL,d),d=s-o,m=(a=o-s)/h):s-d<0&&(r=Math.min(l.MAX_OVERSCROLL_PIXEL,d),d=s,m=(a=s)/h),{destination:Math.round(d),duration:Math.min(Math.max(l.MIN_SWIPE_TRANSITION_DURATION,m),l.MAX_SWIPE_TRANSITION_DURATION),overScroll:r}},l.prototype.handleTouchCancel=function(e){this.m_databodyMove&&(this._handleMoveMouseUp(e,!1),this.m_databodyMove=!1),this.m_touchSelectAnchor=null,this.m_touchMultipleSelect=!1,this.m_touchActive=!1,this.m_startX=0,this.m_startY=0,this.m_prevX=0,this.m_prevY=0,this.m_currentX=0,this.m_currentY=0,this.m_startTime=0},l.prototype.handleHeaderTouchStart=function(e){this.m_touchStart=(new Date).getTime();var t=e.touches.length,i=e.target;if(1===t){this.m_startX=e.touches[0].pageX,this.m_startY=e.touches[0].pageY,this.m_currentX=this.m_startX,this.m_currentY=this.m_startY,this.m_prevX=this.m_startX,this.m_prevY=this.m_startY,this.m_touchActive=!0;var s=this.findHeader(i);this.isResizeEnabled()&&(this.handleResize(e),this.handleResizeMouseDown(e)),!this.m_isResizing&&this._isMoveOnElementEnabled(s)&&(this.m_databodyMove=!0)}else this.handleHeaderTouchCancel(e)},l.prototype.handleHeaderTouchMove=function(e){if(this.m_touchActive){e.preventDefault(),this.m_currentX=e.touches[0].pageX,this.m_currentY=e.touches[0].pageY;var t=this.m_currentX-this.m_prevX,i=this.m_currentY-this.m_prevY;if(this.m_isResizing&&this.isResizeEnabled())this.handleResize(e);else if(this.m_databodyMove)this._removeTouchSelectionAffordance(),this._handleMove(e);else{var s=e.target,o=this.findHeader(s),n=this.getHeaderCellAxis(o);"column"===n||"columnEnd"===n?this._handleNonSwipeScroll(t,0):this._handleNonSwipeScroll(0,i)}this.m_prevX=this.m_currentX,this.m_prevY=this.m_currentY}else this.handleTouchCancel(e)},l.prototype.handleHeaderTouchEnd=function(e){var t;if(this.m_touchActive&&!e.defaultPrevented){var i=e.target;if(this.m_isResizing&&this.isResizeEnabled())this.handleResizeMouseUp(e),this.m_currentX!==this.m_startX&&this.m_currentY!==this.m_startY&&e.preventDefault();else if(this.m_currentX===this.m_startX&&this.m_currentY===this.m_startY){var s=this.m_options.getSelectionMode(),o=(t=this.findHeader(i))[this.getResources().getMappedAttribute("context")];(this.m_utils.containsCSSClassName(i,this.getMappedStyle("sortascending"))||this.m_utils.containsCSSClassName(i,this.getMappedStyle("sortdescending")))&&this._isDOMElementSortable(i)?(e.preventDefault(),this._removeTouchSelectionAffordance(),this._handleSortIconMouseDown(i),this._handleHeaderSort(e)):!this._isSelectionEnabled()||!this.isMultipleSelection()||"row"===s&&-1===o.axis.indexOf("row")||this.m_databodyMove?"row"===s&&-1!==o.axis.indexOf("row")&&this._isSelectionEnabled()?this.handleHeaderClickSelection(e):this.handleHeaderClickActive(e):(this.handleHeaderClickSelection(e),0===e.button&&(this.m_headerDragState=!0))}else this.m_databodyMove?(e.preventDefault(),this.m_databodyMove=!1,this._handleMoveMouseUp(e,!0)):(t=this.findHeader(i),this._handleSwipe(e,this.getHeaderCellAxis(t)))}this.handleHeaderTouchCancel(e)},l.prototype.handleHeaderTouchCancel=function(e){this.m_databodyMove&&(this._handleMoveMouseUp(e,!1),this.m_databodyMove=!1),this.m_touchActive=!1,this.m_startX=0,this.m_startY=0,this.m_prevX=0,this.m_prevY=0,this.m_currentX=0,this.m_currentY=0},l.prototype._handleNonSwipeScroll=function(e,t){var i=(new Date).getTime();this._disableTouchScrollAnimation();var s=this.adjustTouchScroll(e,t);e=s[0],t=s[1],this.scrollDelta(e,t),i-this.m_startTime>l.TAP_AND_SCROLL_RESET&&(this.m_startX=this.m_currentX,this.m_startY=this.m_currentY,this.m_startTime=(new Date).getTime())},l.prototype._handleSwipe=function(e,t){var i=(new Date).getTime()-this.m_startTime,s=this.getResources().isRTLMode(),o=this.m_currentX-this.m_startX,n=this.m_currentY-this.m_startY;if(s&&(o*=-1),Math.abs(o)<l.MIN_SWIPE_DISTANCE&&Math.abs(n)<l.MIN_SWIPE_DISTANCE&&i<l.MIN_SWIPE_DURATION)e.preventDefault(),this._isSelectionEnabled()&&this._scrollTouchSelectionAffordance();else if(i<l.MAX_SWIPE_DURATION){var r,a;e.preventDefault(),"row"!==t&&"rowEnd"!==t?(r=this._calculateMomentum(this.m_currentX,this.m_startX,i,this.m_currentScrollLeft,this.m_scrollWidth,s),isNaN(r.overScroll)||(r.overScroll>0||this.m_stopColumnFetch)&&(this.m_extraScrollOverX=-1*r.overScroll)):(r={duration:0,destination:0},o=0),"column"!==t&&"columnEnd"!==t?(a=this._calculateMomentum(this.m_currentY,this.m_startY,i,this.m_currentScrollTop,this.m_scrollHeight),isNaN(a.overScroll)||(a.overScroll>0||this.m_stopRowFetch)&&(this.m_extraScrollOverY=-1*a.overScroll)):(a={duration:0,destination:0},n=0);var h=Math.max(r.duration,a.duration);this.m_databody.firstChild.style.webkitTransitionDuration=h+"ms",this.m_rowHeader.firstChild.style.webkitTransitionDuration=h+"ms",this.m_colHeader.firstChild.style.webkitTransitionDuration=h+"ms",this.m_rowEndHeader.firstChild.style.webkitTransitionDuration=h+"ms",this.m_colEndHeader.firstChild.style.webkitTransitionDuration=h+"ms",o+=r.destination,n+=a.destination;var d=this.adjustTouchScroll(o,n);o=d[0],n=d[1],this.scrollDelta(o,n)}},l.prototype.fireEvent=function(e,t){if(null!=e&&null!=t){var i=this.callbacks[e];return null==i||i(t)}},l.prototype.addListener=function(e,t){this.callbacks[e]=t},l.prototype.setElementHeight=function(e,t){e.style.height=t+"px"},l.prototype.getElementHeight=function(e){return this.getElementDir(e,"height")},l.prototype.setElementWidth=function(e,t){e.style.width=t+"px"},l.prototype.getElementWidth=function(e){return this.getElementDir(e,"width")},l.prototype.setElementDir=function(e,t,i){e.style[i]=t+"px"},l.prototype.getElementDir=function(e,t){var i;return e.style[t].indexOf("px")>-1&&-1===e.style[t].indexOf("e")?parseFloat(e.style[t]):(document.body.contains(e)?i=Math.round(e["offset"+t.charAt(0).toUpperCase()+t.slice(1)]):(e.style.visibility="hidden",this.m_root.appendChild(e),i=Math.round(e["offset"+t.charAt(0).toUpperCase()+t.slice(1)]),this.m_root.removeChild(e),e.style.visibility=""),i)},l.BEFORE=1,l.AFTER=2,l.INSIDE=3,l.prototype._isInViewport=function(e){var t=e.row,i=e.column;return-1===t&&-1===i?-1:-1===t?i<this.m_startCol?l.BEFORE:i>this.m_endCol?l.AFTER:l.INSIDE:-1===i?t<this.m_startRow?l.BEFORE:t>this.m_endRow?l.AFTER:l.INSIDE:i>=this.m_startCol&&i<=this.m_endCol&&t>=this.m_startRow&&t<=this.m_endRow?l.INSIDE:-1},l.prototype._isCellBoundryInViewport=function(e,t,i,s){var o=this._getViewportTop(),n=this._getViewportBottom(),r=this._getViewportLeft(),l=this._getViewportRight();return(s<=n&&s>o||i>=o&&i<n)&&(t<=l&&t>r||e>=r&&e<l)},l.prototype.queueModelEvent=function(e){return!(this.m_initialized&&!this.m_processingEventQueue&&!this.m_animating&&!this.m_processingModelEvent)&&(null==this.m_modelEvents&&(this.m_modelEvents=[]),this.m_modelEvents.push(e),!0)},l.prototype.handleModelEvent=function(t,i){if(void 0!==i||!this.queueModelEvent(t)){var s=t.operation,o=t.keys,n=t.source,r=t.indexes,l=t.result,a=t.header,h=t.endheader,d=t.silent,m=!1;this.m_processingModelEvent=!0,"insert"===s?(this._adjustActive(s,r),this.m_shouldFocus=!0,this._adjustSelectionOnModelChange(s,o,r),null!=l?(this._handleModelInsertRangeEvent(l,a,h),m=!0):this._handleModelInsertEvent(r,o)):"update"===s?(this._handleModelUpdateEvent(r,o,l),m=!0):"delete"===s?(this._adjustActive(s,r),this._adjustSelectionOnModelChange(s,o,r),n&&e.FlattenedTreeDataGridDataSource&&n instanceof e.FlattenedTreeDataGridDataSource&&this.m_utils.supportsTransitions()?(this._handleModelDeleteEventWithAnimation(o),m=!0):this._handleModelDeleteEvent(r,o,d)):"refresh"===s||"reset"===s?this._handleModelRefreshEvent():"sync"===s&&this._handleModelSyncEvent(t),this.m_processingModelEvent=!1,!m&&i&&this._runModelEventQueue()}},l.prototype._adjustActive=function(e,t){var i,s;if(null!=this.m_active){if("cell"===this.m_active.type)s=!1,i=this.m_active.indexes.row;else{if("header"!==this.m_active.type||"row"!==this.m_active.axis)return;s=!0,i=this.m_active.index}if(Array.isArray(t)||(t=new Array(t)),!0===this.m_moveActive){if("insert"===e)return void(s?this.m_active.index=t[0].row:this.m_active.indexes.row=t[0].row);if("delete"===e&&t[0].row===i)return}for(var o="insert"===e?1:-1,n=0;n<t.length;n++){var r=t[n].row;r<i?s?this.m_active.index+=o:this.m_active.indexes.row+=o:r===i&&"delete"===e&&this._setActive(null,null)}}},l.prototype._adjustSelectionOnModelChange=function(e,t,i){Array.isArray(t)||(t=new Array(t)),Array.isArray(i)||(i=new Array(i));var s=this.GetSelection();if(null!=t&&null!=i&&t.length===i.length&&0!==s.length)for(var o="insert"===e?1:-1,n=0;n<t.length;n++)for(var r,l=t[n].row,a=i[n].row,h=s.length-1;h>=0;h--){var d=s[h],m=d.startKey.row,c=d.endKey.row,u=d.startIndex.row,_=d.endIndex.row;if(m===l){if(c===l&&"delete"===e){s.splice(h,1);continue}r=this._getKey(this._getAxisCellsByIndex(d.startIndex.row+1,"row")[0],"row"),d.startKey.row=r,d.endIndex.row+=o}else c===l?(r=this._getKey(this._getAxisCellsByIndex(d.startIndex.row-1,"row")[0],"row"),d.endKey.row=r,d.endIndex.row+=o):a<=u?(d.startIndex.row+=o,d.endIndex.row+=o):a<_&&(d.endIndex.row+=o)}else if(this.m_moveActive&&"insert"===e){var p;if(this._isSelectionEnabled()&&this._isDatabodyCellActive())p="cell"===this.m_options.getSelectionMode()?this.createRange(this.m_active.indexes,this.m_active.indexes,t[0],t[0]):this.createRange(i[0],i[0],t[0],t[0]),this.m_selectionFrontier=this.m_active.indexes,s.push(p);this.m_moveActive=!1}},l.prototype._handleModelInsertEvent=function(e,t){var i=this._isInViewport(e);if(i===l.INSIDE||i===l.AFTER&&e.row===this.m_endRow+1)null!=t.row&&(this._databodyEmpty()?(this.empty(),this.refresh(this.m_root)):(this._modifyAxisCellContextIndex("row",e.row,this.m_endRow-e.row+1,1),this._refreshDatabodyMap(),this.fetchHeaders("row",e.row,this.m_rowHeader,this.m_rowEndHeader,1,{success:this._handleHeaderInsertsFetchSuccess}),this.fetchCells(this.m_databody,e.row,this.m_startCol,1,this.m_endCol-this.m_startCol+1,{success:this._handleCellInsertsFetchSuccess})));else{if(i===l.BEFORE){this._modifyAxisCellContextIndex("row",0,this.m_endRow+1,1),this._refreshDatabodyMap(),this.m_startRow+=1,this.m_startRowHeader+=1,this.m_endRow+=1,this.m_endRowHeader+=1,this.m_startRowPixel+=this.m_avgRowHeight,this.m_startRowHeaderPixel+=this.m_avgRowHeight,this.m_endRowPixel+=this.m_avgRowHeight,this.m_endRowHeaderPixel+=this.m_avgRowHeight;var s=this.m_databody.firstChild.firstChild;null!=s&&this.pushRowsDown(s,this.m_avgRowHeight);var o=this.m_rowHeader.firstChild.firstChild;null!=o&&this.pushRowsDown(o,this.m_avgRowHeight);var n=this.m_rowEndHeader.firstChild.firstChild;null!=n&&this.pushRowsDown(n,this.m_avgRowHeight)}this.scrollToIndex(e)}},l.prototype._handleCellInsertsFetchSuccess=function(e,t){this.m_initialized=!1,this.handleCellsFetchSuccess(e,t,this.m_endRow>=t[0].start);var i=t[0].start;this._scrollRowIntoViewport(i),this._isHighWatermarkScrolling()||this._cleanupViewport("top"),this.updateRowBanding(),this.m_stopRowFetch=!1,-1!==this.m_endRowHeader&&(this.m_stopRowHeaderFetch=!1),-1!==this.m_endRowEndHeader&&(this.m_stopRowEndHeaderFetch=!1),this.fillViewport()},l.prototype._handleHeaderInsertsFetchSuccess=function(e,t,i){this.m_resizeRequired=!0,this.handleHeadersFetchSuccess(e,t,i,this.m_endRowHeader>=t.start)},l.prototype._scrollRowIntoViewport=function(e){var t=this._getAxisCellsByIndex(e,"row");if(null!=t){var i=this._getViewportTop(),s=this._getViewportBottom(),o=this.getElementDir(t[0],"top"),n=i-o;n>0?this.scrollDelta(0,n):(n=s-o)<0&&this.scrollDelta(0,n)}},l.prototype._handleModelInsertRangeEvent=function(e,t,i){var s,o,n,r,l,a,h,d,m=this._databodyEmpty(),c=e.getStart("row"),u=e.getCount("row"),_=e.getStart("column"),p=e.getCount("column");if(!(c>this.m_endRow+1))if(m)this.empty(),this.refresh(this.m_root);else if(this.m_utils.supportsTransitions()){if(null!=t){s=document.createDocumentFragment();var g=t.getCount();for(r=0,o=0,a=this.getMappedStyle("headercell")+" "+this.getMappedStyle("rowheadercell"),h=this.m_options.getRenderer("row");g-o>0;)n=c+o,o+=(l=this.buildLevelHeaders(s,n,0,0,this.m_startRowPixel+r,!0,c!==this.m_endRowHeader+1,h,t,"row",a,this.m_rowHeaderLevelCount)).count,r+=l.totalHeaderDimension}if(null!=i){d=document.createDocumentFragment();var C=i.getCount();for(r=0,o=0,a=this.getMappedStyle("endheadercell")+" "+this.getMappedStyle("rowendheadercell"),h=this.m_options.getRenderer("rowEnd");C-o>0;)n=c+o,o+=(l=this.buildLevelHeaders(d,n,0,0,this.m_startRowPixel+r,!0,c!==this.m_endRowEndHeader+1,h,i,"rowEnd",a,this.m_rowEndHeaderLevelCount)).count,r+=l.totalHeaderDimension}var f=document.createDocumentFragment();if(l=this._addCellsToFragment(f,e,c,this.m_startRowPixel,_,this.m_startColPixel),!(0!==f.childNodes.length||null!=s&&0!==s.childNodes.length||null!=d&&0!==d.childNodes.length))return;this._insertRowsWithAnimation(f,s,d,c,e.getCount("row"),l.totalRowHeight)}else{var v={axis:"row",start:c,count:u},y={axis:"column",start:_,count:p};if(null!=t){var E={axis:"row",header:this.m_rowHeader,endHeader:this.m_rowEndHeader,start:c,count:t.getCount()};this.m_fetching.row=E,this._handleHeaderInsertsFetchSuccess(t,E,i)}this._modifyAxisCellContextIndex("row",c,this.m_endRow-c+1,u),this._refreshDatabodyMap(),this._handleCellInsertsFetchSuccess(e,[v,y])}},l.prototype._handleModelUpdateEvent=function(e,t,i){if(this._isInViewport(e)===l.INSIDE)if(null!=i){var s=this.m_options.getRenderer("cell"),o=this.m_options.getColumnBandingInterval();this._updateCellsInRow(i,i.getStart("row"),s,this.m_startCol,o)}else-1!==this.m_endRowHeader&&this.fetchHeaders("row",e.row,this.m_rowHeader,this.m_rowEndHeader,1,{success:this._handleHeaderUpdatesFetchSuccess,error:this.handleHeadersFetchError}),this.fetchCells(this.m_databody,e.row,this.m_startCol,1,this.m_endCol-this.m_startCol+1,{success:this._handleCellUpdatesFetchSuccess,error:this.handleCellsFetchError})},l.prototype._handleHeaderUpdatesFetchSuccess=function(e,t,i){var s=t.axis;this.m_fetching[s]=!1;var o=t.start;this._replaceHeaders(this.buildRowHeaders.bind(this),e,this.m_rowHeader,o,this.m_startRowHeader),this._replaceHeaders(this.buildRowEndHeaders.bind(this),i,this.m_rowEndHeader,o,this.m_startRowEndHeader);var n=this.m_rowHeader.firstChild.childNodes[o-this.m_startRowHeader];null==this.m_active||"header"!==this.m_active.type||"row"!==this.m_active.axis&&"rowEnd"!==this.m_active.axis||this._getKey(n,"row")!==this.m_active.key||this._highlightActive(),this._signalTaskEnd()},l.prototype._replaceHeaders=function(e,t,i,s,o){if(null!=t){var n=e(i,t,s,1,!0,!0),r=i.firstChild,l=r.childNodes[s-o];r.replaceChild(n,l)}},l.prototype._handleCellUpdatesFetchSuccess=function(e,t){this.m_fetching.cells=!1;var i=t[0].start,s=this.m_options.getRenderer("cell"),o=this.m_options.getColumnBandingInterval();this._updateCellsInRow(e,i,s,this.m_startCol,o),this._signalTaskEnd()},l.prototype._getUpdateAnimation=function(){return l.UPDATE_ANIMATION_SLIDE_INOUT},l.prototype._getUpdateAnimationDuration=function(){return l.UPDATE_ANIMATION_DURATION},l.prototype._updateCellsInRow=function(e,t,i,s,o){var n,r=this._getUpdateAnimationDuration(),l=this._getAxisCellsByIndex(t,"row"),a=this.getElementDir(l[0],"top");if(0!==r&&this.m_utils.supportsTransitions()){var h=this;h._signalTaskStart(),this._removeFromArray(l),n=document.createDocumentFragment(),this._addCellsToFragment(n,e,t,a,s,this.m_startColPixel),l=n.childNodes;for(var d=this.getElementWidth(this.m_databody),m=0;m<l.length;m++)this.addTransformMoveStyle(l[m],0,0,"linear",d,0,0);this._populateDatabody(this.m_databody.firstChild,n),l=this._getAxisCellsByIndex(t,"row"),this.hideStatusText();this._onTransitionEnd(l[l.length-1],function(){for(var e=0;e<l.length;e++)h.removeTransformMoveStyle(l[e]);h._isSelectionEnabled()&&h.applySelection(),h._highlightActive(),h._signalTaskEnd(),h._runModelEventQueue()},r),setTimeout(function(){for(var e=0;e<l.length;e++)h.addTransformMoveStyle(l[e],r+"ms",0,"linear",0,0,0)},0)}else this._removeFromArray(l),n=document.createDocumentFragment(),this._addCellsToFragment(n,e,t,a,s,this.m_startColPixel),this._populateDatabody(this.m_databody.firstChild,n),this._isSelectionEnabled()&&this.applySelection(),this._highlightActive(),this.hideStatusText()},l.prototype._handleModelDeleteEvent=function(e,t,i){var s,o,n,r;Array.isArray(t)||(t=new Array(t),e=new Array(e));for(var a=0,h=0,d=0,m=0,c=0,u=0;u<t.length;u++){var _=t[u],p=e[u];if(null!=_.row){var g=0,C=_.row,f=this._isInViewport(p);f===l.BEFORE?(this._modifyAxisCellContextIndex("row",this.m_startRow,this.m_endRow-this.m_startRow+1,-1),m+=1,a+=this.m_avgRowHeight,this.m_startRowPixel-=this.m_avgRowHeight,this.m_endRowPixel-=this.m_avgRowHeight,-1!==this.m_endRowHeader&&(this.m_startRowHeaderPixel-=this.m_avgRowHeight,this.m_endRowHeaderPixel-=this.m_avgRowHeight),null!=(r=this._getAxisCellsByKey(C,"row"))&&this.pushRowsUp(this.m_startRow,this.m_avgRowHeight),null!=(o=this.m_rowHeader.firstChild.firstChild)&&this.pushRowHeadersUp(o,this.m_avgRowHeight),null!=(n=this.m_rowEndHeader.firstChild.firstChild)&&this.pushRowHeadersUp(n,this.m_avgRowHeight)):f===l.INSIDE?(c+=1,null!=(r=this._getAxisCellsByKey(C,"row"))&&(g=this.calculateRowHeight(r[0]),p=r[0][this.getResources().getMappedAttribute("context")].indexes.row,this._modifyAxisCellContextIndex("row",p+1,this.m_endRow-p,-1),this._removeFromArray(r),this.pushRowsUp(p,g),this.m_endRowPixel-=g),null!=(o=this._findHeaderByKey(C,this.m_rowHeader,this.getMappedStyle("rowheadercell")))&&(g=this.calculateRowHeaderHeight(o),s=o.nextSibling,this._remove(o),this.pushRowHeadersUp(s,g),this.m_endRowHeaderPixel-=g),null!=(n=this._findHeaderByKey(C,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell")))&&(g=this.calculateRowHeaderHeight(n),s=n.nextSibling,this._remove(n),this.pushRowHeadersUp(s,g),this.m_endRowEndHeaderPixel-=g),h+=g):"scroll"===this.m_options.getScrollPolicy()&&(d+=this.m_avgRowHeight)}}this._refreshDatabodyMap(),this.m_startRow-=m,this.m_endRow=this.m_endRow-m-c,-1!==this.m_endRowHeader&&(this.m_startRowHeader-=m,this.m_endRowHeader=this.m_endRowHeader-m-c),-1!==this.m_endRowEndHeader&&(this.m_startRowEndHeader-=m,this.m_endRowEndHeader=this.m_endRowEndHeader-m-c);var v=a+h+d,y=this.m_databody.firstChild,E=this.getElementHeight(y)-v;this.setElementHeight(y,E),this.resizeGrid(),i||!0===this.m_moveActive||(this.m_resizeRequired=!0,this.m_stopRowFetch=!1,-1!==this.m_endRowHeader&&(this.m_stopRowHeaderFetch=!1),-1!==this.m_endRowEndHeader&&(this.m_stopRowEndHeaderFetch=!1),this.fillViewport()),this.updateRowBanding()},l.prototype._handleModelDeleteEventWithAnimation=function(e){this._collapseRowsWithAnimation(e)},l.prototype._collapseRowsWithAnimation=function(e){var t,i,s,o,n,r,a,h;if(0!==e.length){var d=this;d._signalTaskStart();var m=this.m_processingEventQueue?1:l.COLLAPSE_ANIMATION_DURATION,c=[],u=0,_=-1!==this.m_endRowHeader,p=-1!==this.m_endRowEndHeader,g=this.m_databody.firstChild,C=this._getIndex(this._getAxisCellsByKey(e[0].row,"row")[0],"row")-1;for(i=C;i>=this.m_startRow&&(t=this._getAxisCellsByIndex(i,"row"),!(this.getElementDir(t[0],"top")+this.getElementHeight(t[0])<this.m_currentScrollTop));i--)for(s=0;s<t.length;s++)this.changeStyleProperty(t[s],this.getCssSupport("z-index"),10);if(_)for(n=[],o=this._findHeaderByKey(e[0].row,this.m_rowHeader,this.getMappedStyle("rowheadercell")).previousSibling;o&&!(this.getElementDir(o,"top")+this.getElementHeight(o)<this.m_currentScrollTop);)this.changeStyleProperty(o,this.getCssSupport("z-index"),10),o=o.previousSibling;if(p)for(r=[],o=this._findHeaderByKey(e[0].row,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell")).previousSibling;o&&!(this.getElementDir(o,"top")+this.getElementHeight(o)<this.m_currentScrollTop);)this.changeStyleProperty(o,this.getCssSupport("z-index"),10),o=o.previousSibling;for(i=0;i<e.length;i++){var f=e[i].row;if(null!=(t=this._getAxisCellsByKey(f,"row")))for(c.push(t),u+=this.getElementHeight(t[0]),s=0;s<t.length;s++)this.setElementDir(t[s],this.getElementDir(t[s],"top")-u,"top"),this.addTransformMoveStyle(t[s],0,0,"linear",0,u,0);_&&null!=(a=this._findHeaderByKey(f,this.m_rowHeader,this.getMappedStyle("rowheadercell")))&&(n.push(a),this.setElementDir(a,this.getElementDir(a,"top")-u,"top"),this.addTransformMoveStyle(a,0,0,"linear",0,u,0)),p&&null!=(h=this._findHeaderByKey(f,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell")))&&(r.push(h),this.setElementDir(h,this.getElementDir(h,"top")-u,"top"),this.addTransformMoveStyle(h,0,0,"linear",0,u,0))}for(i=C+e.length+1;i<=this.m_endRow;i++){for(t=this._getAxisCellsByIndex(i,"row"),s=0;s<t.length;s++)this.setElementDir(t[s],this.getElementDir(t[s],"top")-u,"top"),this.addTransformMoveStyle(t[s],0,0,"linear",0,u,0);_&&(a=a.nextSibling,this.setElementDir(a,this.getElementDir(a,"top")-u,"top"),this.addTransformMoveStyle(a,0,0,"linear",0,u,0)),p&&(h=h.nextSibling,this.setElementDir(h,this.getElementDir(h,"top")-u,"top"),this.addTransformMoveStyle(h,0,0,"linear",0,u,0))}var v=this._getCellByIndex(this.createIndex(this.m_endRow,this.m_endCol));d._onTransitionEnd(v,function(){d._modifyAxisCellContextIndex("row",C+e.length+1,d.m_endRow-(C+e.length),-1*e.length);for(var t=0;t<c.length;t++){for(var i=0;i<c[t].length;i++)d._remove(c[t][i]);_&&d._remove(n[t]),p&&d._remove(r[t])}d._refreshDatabodyMap(),d.m_endRow-=c.length,d.m_endRowPixel-=u,d.m_stopRowFetch=!1,_&&(d.m_endRowHeader-=n.length,d.m_endRowHeaderPixel-=u,d.m_stopRowHeaderFetch=!1),p&&(d.m_endRowEndHeader-=n.length,d.m_endRowEndHeaderPixel-=u,d.m_stopRowEndHeaderFetch=!1),d.setElementHeight(g,d.m_endRowPixel-d.m_startRowPixel),d.resizeGrid(),d.updateRowBanding(),d.fillViewport(),d._handleAnimationEnd()},m),this.m_animating=!0,setTimeout(function(){for(i=C+1;i<=d.m_endRow;i++){for(t=d._getAxisCellsByIndex(i,"row"),s=0;s<t.length;s++)d.addTransformMoveStyle(t[s],m+"ms",0,"ease-out",0,0,0);_&&(a=d._getHeaderByIndex(i,0,d.m_rowHeader,d.m_rowHeaderLevelCount,d.m_startRowHeader),d.addTransformMoveStyle(a,m+"ms",0,"ease-out",0,0,0)),p&&(h=d._getHeaderByIndex(i,0,d.m_rowEndHeader,d.m_rowEndHeaderLevelCount,d.m_startRowEndHeader),d.addTransformMoveStyle(h,m+"ms",0,"ease-out",0,0,0))}},0)}},l.prototype._handleAnimationEnd=function(){var e,t=this.m_databody.firstChild,i=this.m_rowHeader.firstChild,s=this.m_rowEndHeader.firstChild;for(e=0;e<t.childNodes.length;e++)this.removeTransformMoveStyle(t.childNodes[e]),this.changeStyleProperty(t.childNodes[e],this.getCssSupport("z-index"),null,"remove");if(-1!==this.m_endRowHeader)for(e=0;e<i.childNodes.length;e++)this.removeTransformMoveStyle(i.childNodes[e]),this.changeStyleProperty(i.childNodes[e],this.getCssSupport("z-index"),null,"remove");if(-1!==this.m_endRowEndHeader)for(e=0;e<s.childNodes.length;e++)this.removeTransformMoveStyle(s.childNodes[e]),this.changeStyleProperty(s.childNodes[e],this.getCssSupport("z-index"),null,"remove");this.m_animating=!1,this._runModelEventQueue(),this._signalTaskEnd()},l.prototype._getCellOrHeaderByKey=function(e,t){var i=null,s=this._getAxisCellsByKey(e,t,!0);return null!=s&&s.length>0&&(i=s[0]),null==i&&("row"===t?null==(i=this._findHeaderByKey(e,this.m_rowHeader,this.getMappedStyle("rowheadercell")))&&(i=this._findHeaderByKey(e,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell"))):"column"===t&&null==(i=this._findHeaderByKey(e,this.m_colHeader,this.getMappedStyle("colheadercell")))&&(i=this._findHeaderByKey(e,this.m_colEndHeader,this.getMappedStyle("colendheadercell")))),i},l.prototype._findHeaderByKey=function(e,t,i){if(null==t)return null;var s;s=t.getElementsByClassName?t.getElementsByClassName(i):t.childNodes;for(var o=0;o<s.length;o++){var n=s[o],r=this._getKey(n);if(this._shallowThenDeepCompare(r,e))return n}return null},l.prototype._handleModelRefreshEvent=function(){var e=this.getVisibility();this.m_updateScrollPostionOnRefreshCallback(),e===l.VISIBILITY_STATE_VISIBLE?(this.empty(),null!=this.m_root.offsetParent?this.refresh(this.m_root):this.setVisibility(l.VISIBILITY_STATE_REFRESH)):e===l.VISIBILITY_STATE_HIDDEN&&(this.empty(),this.setVisibility(l.VISIBILITY_STATE_REFRESH))},l.prototype._handleModelSyncEvent=function(e){var t=e.pageSize;this.m_fetching={},this.m_startRow=0,this.m_endRow=-1,this.m_startRowHeader=0,this.m_endRowHeader=-1,this.m_startRowEndHeader=0,this.m_endRowEndHeader=-1,this.m_startRowPixel=0,this.m_endRowPixel=0,this.m_startRowHeaderPixel=0,this.m_endRowHeaderPixel=0,this.m_startRowEndHeaderPixel=0,this.m_endRowEndHeaderPixel=0,this.m_startCol=0,this.m_endCol=-1,this.m_startColHeader=0,this.m_endColHeader=-1,this.m_startColEndHeader=0,this.m_endColEndHeader=-1,this.m_startColPixel=0,this.m_endColPixel=0,this.m_startColHeaderPixel=0,this.m_endColHeaderPixel=0,this.m_startColEndHeaderPixel=0,this.m_endColEndHeaderPixel=0,this.m_rowHeaderLevelCount=void 0,this.m_columnHeaderLevelCount=void 0,this.m_rowEndHeaderLevelCount=void 0,this.m_columnEndHeaderLevelCount=void 0,this.m_avgRowHeight=void 0,this.m_avgColWidth=void 0,this.m_isEstimateRowCount=void 0,this.m_isEstimateColumnCount=void 0,this.m_stopRowFetch=!1,this.m_stopRowHeaderFetch=!1,this.m_stopRowEndHeaderFetch=!1,this.m_stopColumnFetch=!1,this.m_stopColumnHeaderFetch=!1,this.m_stopColumnEndHeaderFetch=!1,this._clearScrollPositionKeys(),this.m_selection=null,this.m_active=null,this.m_prevActive=null,this.m_trueIndex={},null!=this.m_empty&&(this.m_root.removeChild(this.m_empty),this.m_empty=null),this._showHeader(this.m_rowHeader),this._showHeader(this.m_colHeader),this._showHeader(this.m_rowEndHeader),this._showHeader(this.m_colEndHeader),this.m_initialized=!1,this.fetchHeaders("row",0,this.m_rowHeader,this.m_rowEndHeader,t,{success:function(e,t,i){this.handleRowHeadersFetchSuccessForLongScroll(e,t,i)}}),this.fetchHeaders("column",0,this.m_colHeader,this.m_colEndHeader,void 0,{success:function(e,t,i){this.handleColumnHeadersFetchSuccessForLongScroll(e,t,i)}}),this.fetchCells(this.m_databody,0,0,t,null,{success:function(e,t){this.handleCellsFetchSuccessForLongScroll(e,t)}})},l.prototype._setActiveByIndex=function(e,t,i,s,o){return this._setActive(this._getCellByIndex(e),{type:"cell",indexes:e},t,i,s,o)},l.prototype._updateActive=function(e,t,i){var s;if(null==e)this._setActive(null,null,null,!0,!1,i);else if(null!=e.keys)s=this._getCellByKeys(e.keys);else if(null!=e.indexes)s=this._getCellByIndex(e.indexes);else if(null!=e.axis){var o=null==e.level?0:e.level;"column"===e.axis?null!=e.key?s=this._findHeaderByKey(e.key,this.m_colHeader,this.getMappedStyle("colheadercell")):null!=e.index&&(s=this._getHeaderByIndex(e.index,o,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader)):"row"===e.axis?null!=e.key?s=this._findHeaderByKey(e.key,this.m_rowHeader,this.getMappedStyle("rowheadercell")):null!=e.index&&(s=this._getHeaderByIndex(e.index,o,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader)):"columnEnd"===e.axis?null!=e.key?s=this._findHeaderByKey(e.key,this.m_colEndHeader,this.getMappedStyle("colendheadercell")):null!=e.index&&(s=this._getHeaderByIndex(e.index,o,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader)):"rowEnd"===e.axis&&(null!=e.key?s=this._findHeaderByKey(e.key,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell")):null!=e.index&&(s=this._getHeaderByIndex(e.index,o,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader)))}null!=s&&(t||(this.m_shouldFocus=!1),this._setActive(s,e,null,!0,!1,i))},l.prototype._setActive=function(e,t,i,s,o,n){var r;if(null==t||n||this._scrollToActive(t),null!=e)if(r=this._createActiveObject(e),this._compareActive(r,this.m_active)){if(o||this._fireBeforeCurrentCellEvent(r,this.m_active,i))return this.m_prevActive=this.m_active,this.m_active=r,i&&"mousedown"===i.type&&(this.m_trueIndex=null),s&&this._isSelectionEnabled()&&this._clearSelection(i),this._unhighlightActiveObject(this.m_prevActive),this._highlightActiveObject(this.m_active,this.m_prevActive),this._manageMoveCursor(),this._isGridEditable()&&("cell"===r.type&&this._setEditableClone(e),this._updateEdgeCellBorders("")),o||this._fireCurrentCellEvent(r,i),!0}else this._highlightActive();else if(!this.m_scrollIndexAfterFetch&&!this.m_scrollHeaderAfterFetch)return(o||this._fireBeforeCurrentCellEvent(r,this.m_active,i))&&(this.m_prevActive=this.m_active,this.m_active=null,this._unhighlightActiveObject(this.m_prevActive),o||this._fireCurrentCellEvent(r,i)),!0;return!1},l.prototype._createActiveObject=function(e){var t=e[this.getResources().getMappedAttribute("context")];return this.m_utils.containsCSSClassName(e,this.getMappedStyle("headercell"))||this.m_utils.containsCSSClassName(e,this.getMappedStyle("endheadercell"))?{type:"header",axis:t.axis,index:this.getHeaderCellIndex(e),key:t.key,level:t.level}:this.m_utils.containsCSSClassName(e,this.getMappedStyle("headerlabel"))?{type:"label",axis:t.axis,level:t.level}:{type:"cell",indexes:{row:t.indexes.row,column:t.indexes.column},keys:{row:t.keys.row,column:t.keys.column},extents:{row:t.extents.row,column:t.extents.column}}},l.prototype._getActiveElement=function(){return this._getElementFromActiveObject(this.m_active)},l.prototype._getElementFromActiveObject=function(e){if(null!=e){if("header"!==e.type)return"label"===e.type?this._getLabel(e.axis,e.level):this._getCellByIndex(e.indexes);if("row"===e.axis)return this._findHeaderByKey(e.key,this.m_rowHeader,this.getMappedStyle("rowheadercell"));if("column"===e.axis)return this._findHeaderByKey(e.key,this.m_colHeader,this.getMappedStyle("colheadercell"));if("rowEnd"===e.axis)return this._findHeaderByKey(e.key,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell"));if("columnEnd"===e.axis)return this._findHeaderByKey(e.key,this.m_colEndHeader,this.getMappedStyle("colendheadercell"))}return null},l.prototype._compareActive=function(e,t){if(null==e&&null==t)return!1;if(null==e&&null!=t||null!=e&&null==t)return!0;if(e.type!==t.type)return!0;if("header"===e.type){if(e.index!==t.index||e.key!==t.key||e.axis!==t.axis||e.level!==t.level)return!0}else if("label"===e.type){if(e.axis!==t.axis||e.level!==t.level)return!0}else if(e.indexes.row!==t.indexes.row||e.indexes.column!==t.indexes.column||e.keys.row!==t.keys.row||e.keys.column!==t.keys.column)return!0;return!1},l.prototype._fireBeforeCurrentCellEvent=function(e,t,i){var s={event:i,ui:{currentCell:e,previousCurrentCell:t}};return this.fireEvent("beforeCurrentCell",s)},l.prototype._fireCurrentCellEvent=function(e,t){var i={event:t,ui:e};return this.fireEvent("currentCell",i)},l.prototype._isDatabodyCellActive=function(){return null!=this.m_active&&"cell"===this.m_active.type},l.prototype._updateActiveContext=function(e,t){var i;if("header"===e.type){var s=e.axis,o=e.index,n=e.level,r={};"row"===e.axis?(this.m_rowHeaderLevelCount>1&&(null!=t&&n===t.level&&s===t.axis||(r.level=n)),null!=t&&o===t.index&&s===t.axis||(r.rowHeader=o)):"column"===s?(this.m_columnHeaderLevelCount>1&&(null!=t&&n===t.level&&s===t.axis||(r.level=n)),null!=t&&o===t.index&&s===t.axis||(r.columnHeader=o)):"rowEnd"===e.axis?(this.m_rowEndHeaderLevelCount>1&&(null!=t&&n===t.level&&s===t.axis||(r.level=n)),null!=t&&o===t.index&&s===t.axis||(r.rowEndHeader=o)):"columnEnd"===s&&(this.m_columnEndHeaderLevelCount>1&&(null!=t&&n===t.level&&s===t.axis||(r.level=n)),null!=t&&o===t.index&&s===t.axis||(r.columnEndHeader=o)),this._updateContextInfo(r,i)}else"cell"===e.type&&(null==t||"cell"!==t.type||null==e||this.m_externalFocus||(e.indexes.row===t.indexes.row?i="row":e.indexes.column===t.indexes.column&&(i="column")),this._updateContextInfo(e,i))},l.prototype.handleDatabodyClickActive=function(e){var t=e.target,i=this.findCell(t);null!=i&&this._setActive(i,this._createActiveObject(i),e)},l.prototype.handleHeaderClickActive=function(e){var t=e.target,i=this.findHeader(t);null!=i&&(this._clearSelection(e),this._setActive(i,this._createActiveObject(i),e))},l.prototype._scrollToActive=function(e){"header"===e.type?this.scrollToHeader(e):"cell"===e.type&&this.scrollToIndex(e.indexes)},l.prototype._getCellByKeys=function(e){if(null==e||null==e.row||null==e.column||null==this.m_databody||null==this.m_databody.firstChild)return null;for(var t=this.m_databody.firstChild.getElementsByClassName(this.getMappedStyle("cell")),i=0;i<t.length;i++){var s=t[i],o=this._getKey(s,"row");if(this._shallowThenDeepCompare(o,e.row)){var n=this._getKey(s,"column");if(this._shallowThenDeepCompare(n,e.column))return s}}return null},l.prototype._shallowThenDeepCompare=function(e,t){return e===t||this._compareValuesCallback(e,t)},l.prototype.getCellIndexes=function(e){var t=e[this.getResources().getMappedAttribute("context")];return this.createIndex(t.indexes.row,t.indexes.column)},l.prototype.getCellExtents=function(e){var t=e[this.getResources().getMappedAttribute("context")];return this.createIndex(t.extents.row,t.extents.column)},l.prototype.getCellEndIndexes=function(e){var t=this.getCellIndexes(e),i=this.getCellExtents(e);return this.createIndex(t.row+(i.row-1),t.column+(i.column-1))},l.prototype._getIndex=function(e,t){if(null!=e){if(null==t||!this.m_utils.containsCSSClassName(e,this.getMappedStyle("cell")))return this.getHeaderCellIndex(e);var i=e[this.getResources().getMappedAttribute("context")];if("row"===t)return i.indexes.row;if("column"===t)return i.indexes.column}return null},l.prototype._getExtent=function(e,t){if(null!=e){if(null==t||!this.m_utils.containsCSSClassName(e,this.getMappedStyle("cell")))return parseInt(this._getAttribute(e,"extent",!0),10);var i=e[this.getResources().getMappedAttribute("context")];if("row"===t)return i.extents.row;if("column"===t)return i.extents.column}return null},l.prototype.getHeaderCellIndex=function(e){var t,i,s;switch(this.getHeaderCellAxis(e)){case"column":t=this.m_columnHeaderLevelCount,i=this.m_startColHeader;break;case"row":t=this.m_rowHeaderLevelCount,i=this.m_startRowHeader;break;case"columnEnd":t=this.m_columnEndHeaderLevelCount,i=this.m_startColEndHeader;break;case"rowEnd":t=this.m_rowEndHeaderLevelCount,i=this.m_startRowEndHeader;break;default:return-1}if(t>1){if(s=this._getAttribute(e.parentNode,"start",!0),e===e.parentNode.firstChild)return s;s-=1}else s=i;for(;e.previousSibling;)s+=1,e=e.previousSibling;return s},l.prototype.getHeaderCellAxis=function(e){return this.m_utils.containsCSSClassName(e,this.getMappedStyle("colheadercell"))?"column":this.m_utils.containsCSSClassName(e,this.getMappedStyle("rowheadercell"))?"row":this.m_utils.containsCSSClassName(e,this.getMappedStyle("rowendheadercell"))?"rowEnd":this.m_utils.containsCSSClassName(e,this.getMappedStyle("colendheadercell"))?"columnEnd":null},l.prototype.getHeaderCellLevel=function(e){if(this.m_utils.containsCSSClassName(e,this.getMappedStyle("colheadercell"))){if(1===this.m_columnHeaderLevelCount)return 0}else if(this.m_utils.containsCSSClassName(e,this.getMappedStyle("rowheadercell"))){if(1===this.m_rowHeaderLevelCount)return 0}else if(this.m_utils.containsCSSClassName(e,this.getMappedStyle("colendheadercell"))){if(1===this.m_columnEndHeaderLevelCount)return 0}else if(this.m_utils.containsCSSClassName(e,this.getMappedStyle("rowendheadercell"))&&1===this.m_rowEndHeaderLevelCount)return 0;var t=this._getAttribute(e.parentNode,"level",!0);return e===e.parentNode.firstChild?t:t+this.getHeaderCellDepth(e.parentNode.firstChild)},l.prototype.getHeaderCellDepth=function(e){return this._getAttribute(e,"depth",!0)},l.prototype.findCellOrHeader=function(e){var t=this.findCell(e);return null==t&&(t=this.findHeader(e)),t},l.prototype.findCell=function(e){return this.find(e,"cell")},l.prototype.findLabel=function(e){return this.find(e,"headerlabel")},l.prototype.find=function(e,t,i){return null==e||e===this.getRootElement()?null:(null==i&&(i=this.getMappedStyle(t)),null==i?null:this.m_utils.containsCSSClassName(e,i)?e:this.find(e.parentNode,t,i))},l.prototype._highlightActive=function(e){this._highlightActiveObject(this.m_active,this.m_prevActive,e)},l.prototype._unhighlightActive=function(e){this._unhighlightActiveObject(this.m_active,e)},l.prototype._highlightActiveObject=function(e,t,i){if(null==i&&this.m_utils.shouldOffsetOutline()&&(i=["offsetOutline"]),null!=e){var s=this._getElementFromActiveObject(e);null!=s&&(this.m_focusInHandler(s),null!=i&&this._highlightElement(s,i),this._setAriaProperties(e,t,s))}},l.prototype._unhighlightActiveObject=function(e,t){if(null==t&&this.m_utils.shouldOffsetOutline()&&(t=["offsetOutline"]),null!=e){var i=this._getElementFromActiveObject(e);null!=i&&(this.m_focusOutHandler(i),null!=t&&this._unhighlightElement(i,t),this._unsetAriaProperties(i))}},l.prototype._highlightCellsAlongAxis=function(e,t,i,s,o){for(var n="key"===i?this._getAxisCellsByKey(e,t):this._getAxisCellsByIndex(e,t),r=0;r<n.length;r++)"add"===s?this._highlightElement(n[r],o):this._unhighlightElement(n[r],o)},l.prototype._highlightElement=function(e,t){for(var i=0;i<t.length;i++){var s=this.getMappedStyle(t[i]);this.m_utils.addCSSClassName(e,s)}},l.prototype._unhighlightElement=function(e,t){for(var i=0;i<t.length;i++){var s=this.getMappedStyle(t[i]);this.m_utils.removeCSSClassName(e,s)}},l.prototype._setAriaProperties=function(e,t,i){var s=this.getLabelledBy(e,t,i);this._updateActiveContext(e,t),i.setAttribute("tabIndex",0),i.setAttribute("aria-labelledby",s),null!=this.m_cellToFocus&&this.m_cellToFocus===i||!1===this.m_shouldFocus||i.focus(),this.m_shouldFocus=null},l.prototype._unsetAriaProperties=function(e){null!=e&&(e.setAttribute("tabIndex",-1),e.removeAttribute("aria-labelledby"))},l.prototype.getLabelledBy=function(e,t,i){var s,o,n,r,l="";if("header"===e.type){null==t||"header"!==t.type||this.m_externalFocus||("row"===t.axis?s=this._getHeaderByIndex(t.index,t.level,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader):"column"===t.axis?s=this._getHeaderByIndex(t.index,t.level,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader):"rowEnd"===t.axis?s=this._getHeaderByIndex(t.index,t.level,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader):"columnEnd"===t.axis&&(s=this._getHeaderByIndex(t.index,t.level,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader))),l=[this.createSubId("context"),this._getHeaderAndParentIds(i,s)].join(" ");var a=i.getAttribute(this.getResources().getMappedAttribute("sortDir"));"ascending"===a?(o="accessibleSortAscending",l=l+" "+this.createSubId("state")):"descending"===a&&(o="accessibleSortDescending",l=l+" "+this.createSubId("state")),!0===this.m_externalFocus&&(l=[this.createSubId("summary"),l].join(" "),this.m_externalFocus=!1),null!=o&&this._updateStateInfo([{key:o,args:{id:""}}]),i.setAttribute("tabIndex",0)}else if("label"===e.type)l=[this.createSubId("context"),this._getActiveElement().id].join(" ");else{null!=t&&("header"===t.type?(n="row"===t.axis?t.index:null,r="column"===t.axis?t.index:null):"cell"===t.type&&(n=t.indexes.row,r=t.indexes.column));var h=this._getHeaderLabelledBy("row",this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader,this.m_endRowHeader,e.indexes.row,n,i),d=this._getHeaderLabelledBy("rowEnd",this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader,this.m_endRowEndHeader,e.indexes.row,n,i),m=this._getHeaderLabelledBy("column",this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader,this.m_endColHeader,e.indexes.column,r,i),c=this._getHeaderLabelledBy("columnEnd",this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader,this.m_endColEndHeader,e.indexes.column,r,i),u=e.extents.row,_=e.extents.column,p=[];u>1&&p.push({key:"accessibleRowSpanContext",args:{extent:u}}),_>1&&p.push({key:"accessibleColumnSpanContext",args:{extent:_}}),this._updateStateInfo(p),l=(l=[this.createSubId("context"),h,d,m,c,i.id,this.createSubId("state")].join(" ")).replace(/ +(?= )/g,""),this.m_externalFocus&&(l=[this.createSubId("summary"),l].join(" "),this.m_externalFocus=!1)}return l},l.prototype.getHeaderFromCell=function(e,t,i){var s,o,n,r,l,a;return"row"===t?null!=this.m_rowHeader&&(s=this._getIndex(e,"row"),o=this._getExtent(e,"row"),n=this.m_rowHeaderLevelCount-1,r=this.m_rowHeader,l=this.m_rowHeaderLevelCount,a=this.m_startRowHeader):"column"===t?null!=this.m_colHeader&&(s=this._getIndex(e,"column"),o=this._getExtent(e,"column"),n=this.m_columnHeaderLevelCount-1,r=this.m_colHeader,l=this.m_columnHeaderLevelCount,a=this.m_startColHeader):"rowEnd"===t?null!=this.m_rowEndHeader&&(s=this._getIndex(e,"row"),o=this._getExtent(e,"row"),n=this.m_rowEndHeaderLevelCount-1,r=this.m_rowEndHeader,l=this.m_rowEndHeaderLevelCount,a=this.m_startRowEndHeader):"columnEnd"===t&&null!=this.m_colEndHeader&&(s=this._getIndex(e,"column"),o=this._getExtent(e,"column"),n=this.m_columnEndHeaderLevelCount-1,r=this.m_colEndHeader,l=this.m_columnEndHeaderLevelCount,a=this.m_startColEndHeader),null!=s&&null!=n&&s>-1?(i&&(s+=o-1),this._getHeaderByIndex(s,n,r,l,a)):null},l.prototype.createRange=function(e,t,i,s){var o,n,r,l,a,h,d,m;return t&&(e.row<t.row||-1===t.row?(o=e.row,n=t.row,i&&(a=i.row,h=s.row)):(o=t.row,n=e.row,i&&(a=s.row,h=i.row)),isNaN(e.column)||isNaN(t.column)?(e={row:o},t={row:n},i&&(i={row:a,column:d},s={row:h,column:m})):(e.column<t.column||-1===t.column?(r=e.column,l=t.column,i&&(d=i.column,m=s.column)):(r=t.column,l=e.column,i&&(d=s.column,m=i.column)),e={row:o,column:r},t={row:n,column:l},i&&(i={row:a,column:d},s={row:h,column:m}))),i?{startIndex:e,endIndex:t,startKey:i,endKey:s}:{startIndex:e,endIndex:t}},l.prototype._createRangeWithKeys=function(e,t,i){this._keys(e,this._createRangeStartKeyCallback.bind(this,t,i))},l.prototype._createRangeStartKeyCallback=function(e,t,i,s){e===s?this._createRangeEndKeyCallback(i,s,t,i,s):e?this._keys(e,this._createRangeEndKeyCallback.bind(this,i,s,t)):t.call(this,{startIndex:s,endIndex:s,startKey:i,endKey:i})},l.prototype._createRangeEndKeyCallback=function(e,t,i,s,o){i.call(this,this.createRange(t,o,e,s))},l.prototype.getEndIndex=function(e){return null==e.endIndex?e.startIndex:e.endIndex},l.prototype.getElementsInRange=function(e,t,i,s,o){var n,r,l,a,h;null==t&&(t=this.m_startRow),null==i&&(i=this.m_endRow+1);var d=e.startIndex,m=this.getEndIndex(e),c=d.row,u=m.row;if(-1===u&&(u=Number.MAX_VALUE),i<c||u<t)return null;if(!isNaN(d.column)&&!isNaN(m.column)&&(n=d.column,-1===(r=m.column)&&(r=Number.MAX_VALUE),this.m_endCol+1<n||r<this.m_startCol))return null;var _=[];if(null==this.m_databody.firstChild)return null;if(c=Math.max(0,c),u=Math.min(this.m_endRow,u),isNaN(n)||isNaN(r))for(n=Math.max(0,this.m_startCol),r=Math.max(n,this.m_endCol),l=c;l<=u;l+=1)for(a=n;a<=r;a+=1)null!=(h=this._getCellByIndex(this.createIndex(l,a)))&&-1===_.indexOf(h)&&_.push(h);else for(n=Math.max(0,n),r=Math.min(this.m_endCol,r),l=c;l<=u;l+=1)for(a=n;a<=r;a+=1)null!=(h=this._getCellByIndex(this.createIndex(l,a)))&&-1===_.indexOf(h)&&_.push(h);return _},l.prototype.readCurrentContent=function(){var e,t;if(null==this.m_active)return!1;if("header"===this.m_active.type)e={},"row"===this.m_active.axis?(this.m_rowHeaderLevelCount>1&&(e.level=this.m_active.level),e.rowHeader=this.m_active.index):(this.m_columnHeaderLevelCount>1&&(e.level=this.m_active.level),e.columnHeader=this.m_active.index),t=this._getActiveElement();else if("cell"===this.m_active.type){if(e=this.m_active.indexes,this._isSelectionEnabled()&&this.isMultipleSelection()&&null!=this.m_selectionFrontier&&(e=this.m_selectionFrontier),null==e)return!1;var i=this.createRange(e),s=this.getElementsInRange(i);if(null==s||0===s.length)return!1;t=s[0]}else t=this._getActiveElement();this._updateActiveContext(this.m_active,this.m_prevActive),this.m_placeHolder.tabIndex=-1;var o=t.getAttribute("aria-labelledby");return this.m_placeHolder.setAttribute("aria-labelledby",o+" "+t.id),this.m_placeHolder===document.activeElement?t.focus():this.m_placeHolder.focus(),!0},l.prototype._enterActionableMode=function(e){return this._enableAllFocusableElements(e),this._setFocusToFirstFocusableElement(e)&&(this.m_focusOutHandler(e),this.setActionableMode(!0)),!1},l.prototype._exitActionableMode=function(){if(this.isActionableMode()){var e=this._getActiveElement();this.setActionableMode(!1),this._disableAllFocusableElements(e),this.m_focusInHandler(e)}},l.prototype._reRenderCell=function(e,t,i,s){var o=this.m_options.getRenderer("cell"),n=e[this.getResources().getMappedAttribute("context")];if(n.mode=t,this.m_utils.empty(e),this.m_utils.containsCSSClassName(e,i)?this.m_utils.removeCSSClassName(e,i):this.m_utils.addCSSClassName(e,i),s){for(;s.hasChildNodes();)e.appendChild(s.firstChild);delete this.m_editableClone}else this._renderContent(o,n,e,n.data)},l.prototype._setEditableClone=function(e){if(delete this.m_editableClone,null!=e){var t=e.cloneNode(!1);this._createUniqueId(t),t[this.getResources().getMappedAttribute("context")]=e[this.getResources().getMappedAttribute("context")],t[this.getResources().getMappedAttribute("context")].parentElement=t,this.m_root.appendChild(t),this._reRenderCell(t,"edit",this.getMappedStyle("cellEdit"),null),this.m_root.removeChild(t),t[this.getResources().getMappedAttribute("context")].parentElement=e,this.m_editableClone=t}},l.prototype.isNavigationKey=function(e){return this.isArrowKey(e)||e===l.keyCodes.HOME_KEY||e===l.keyCodes.END_KEY||e===l.keyCodes.PAGEUP_KEY||e===l.keyCodes.PAGEDOWN_KEY},l.prototype.isArrowKey=function(e){return e===l.keyCodes.UP_KEY||e===l.keyCodes.DOWN_KEY||e===l.keyCodes.LEFT_KEY||e===l.keyCodes.RIGHT_KEY},l.prototype.createIndex=function(e,t){if(null==e&&null==t)return null;var i={};return null!=e&&(i.row=e),null!=t&&(i.column=t),i},l.prototype.checkCorners=function(e,t,i){return"column"===this.m_selectionFrontier.axis&&this.m_columnHeaderLevelCount!==this.m_selectionFrontier.level||"row"===this.m_selectionFrontier.axis&&this.m_rowHeaderLevelCount!==this.m_selectionFrontier.level||"rowEnd"===this.m_selectionFrontier.axis&&this.m_rowEndHeaderLevelCount!==this.m_selectionFrontier.level||"columnEnd"===this.m_selectionFrontier.axis&&this.m_columnEndHeaderLevelCount!==this.m_selectionFrontier.level||(-1!==e.indexOf("row")?t===i.startIndex.row&&this.m_selectionFrontier.end===i.endIndex.row||t===i.endIndex.row&&this.m_selectionFrontier.end===i.startIndex.row:-1!==e.indexOf("column")&&(t===i.startIndex.column&&this.m_selectionFrontier.end===i.endIndex.column||t===i.endIndex.column&&this.m_selectionFrontier.end===i.startIndex.column))},l.prototype.handleLabelFocusChange=function(e,t,i,s){var o,n,r,a,h;if(!this.isFetchComplete())return!0;this.getResources().isRTLMode()&&(e===l.keyCodes.LEFT_KEY?e=l.keyCodes.RIGHT_KEY:e===l.keyCodes.RIGHT_KEY&&(e=l.keyCodes.LEFT_KEY));var d=this.m_active.axis,m=this.m_active.level;switch("column"===d?(r=this.m_colHeader,a=this.m_startColHeader,h=this.m_columnHeaderLevelCount):"row"===d&&(r=this.m_rowHeader,a=this.m_startRowHeader,h=this.m_rowHeaderLevelCount),"columnEnd"===d&&(e===l.keyCodes.DOWN_KEY?e=l.keyCodes.UP_KEY:e===l.keyCodes.UP_KEY&&(e=l.keyCodes.DOWN_KEY),r=this.m_colEndHeader,a=this.m_startColEndHeader,h=this.m_columnEndHeaderLevelCount),"rowEnd"===d&&(e===l.keyCodes.LEFT_KEY?e=l.keyCodes.RIGHT_KEY:e===l.keyCodes.RIGHT_KEY&&(e=l.keyCodes.LEFT_KEY),r=this.m_rowEndHeader,a=this.m_startRowEndHeader,h=this.m_rowEndHeaderLevelCount),e){case l.keyCodes.DOWN_KEY:"row"!==d&&"rowEnd"!==d||(o=this._getHeaderByIndex(a,m,r,h,a),this._setActive(o,{type:"header",index:a,level:m,axis:d},t)),"column"!==d&&"columnEnd"!==d||((o=this.m_headerLabels[d][m+1])?this._setActive(o,{type:"label",level:m+1,axis:d},t):"column"===d&&m===h-1&&this.m_headerLabels.row.length?(o=this.m_headerLabels.row[this.m_headerLabels.row.length-1],this._setActive(o,{type:"label",level:this.m_headerLabels.row.length-1,axis:"row"},t)):m===h-1&&(n="column"===d?this.m_startRowHeader:this.m_endRowHeader,(o=this._getHeaderByIndex(n,this.m_rowHeaderLevelCount-1,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader))&&this._setActive(o,{type:"header",index:n,level:m,axis:"row"},t)));break;case l.keyCodes.UP_KEY:"row"===d&&m===h-1&&this.m_headerLabels.column.length&&(o=this.m_headerLabels.column[this.m_headerLabels.column.length-1],this._setActive(o,{type:"label",level:this.m_headerLabels.column.length-1,axis:"column"},t)),"column"!==d&&"columnEnd"!==d||(o=this.m_headerLabels[d][m-1])&&this._setActive(o,{type:"label",level:m-1,axis:d},t);break;case l.keyCodes.RIGHT_KEY:"row"!==d&&"rowEnd"!==d||((o=this.m_headerLabels[d][m+1])?this._setActive(o,{type:"label",level:m+1,axis:d},t):m===h-1&&(n="row"===d?this.m_startColHeader:this.m_endColHeader,(o=this._getHeaderByIndex(n,this.m_columnHeaderLevelCount,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader))&&this._setActive(o,{type:"header",index:n,level:m,axis:"column"},t))),"column"!==d&&"columnEnd"!==d||(o=this._getHeaderByIndex(a,m,r,h,a),this._setActive(o,{type:"header",index:a,level:m,axis:d},t));break;case l.keyCodes.LEFT_KEY:"row"!==d&&"rowEnd"!==d||(o=this.m_headerLabels[d][m-1])&&this._setActive(o,{type:"label",level:m-1,axis:d},t)}return!0},l.prototype.handleHeaderFocusChange=function(e,t,i,s){var o,n,r,a,h,d,m,c,u;if(!this.isFetchComplete())return!0;this.getResources().isRTLMode()&&(e===l.keyCodes.LEFT_KEY?e=l.keyCodes.RIGHT_KEY:e===l.keyCodes.RIGHT_KEY&&(e=l.keyCodes.LEFT_KEY));var _=this.m_active.axis,p=this.m_active.index,g=this.m_active.level,C=this._getActiveElement(),f=null!=C?this._getAttribute(C,"depth",!0):1;if(_||p||!this.m_active||(_=this.m_selectionFrontier.axis,p=this.m_active.indexes[_]),t.shiftKey&&!i&&this.m_selectionFrontier&&this.isMultipleSelection()&&(i=this.checkHeaderToDatabody(_,e)),!(i&&this.isArrowKey(e)&&this.isHeaderSelectionType(this.m_selectionFrontier)&&this.checkCorners(_,p,this.m_selection[this.m_selection.length-1]))||(_=this.m_selectionFrontier.axis,p=this.m_selectionFrontier.index,g=this.m_selectionFrontier.level,-1===p&&(p=this.m_active.indexes[_]),"cell"!==this.m_active.type||(e!==l.keyCodes.LEFT_KEY&&e!==l.keyCodes.RIGHT_KEY||-1===_.indexOf("row"))&&(e!==l.keyCodes.UP_KEY&&e!==l.keyCodes.DOWN_KEY||-1===_.indexOf("column")))){switch("column"===_?(h=this.m_colHeader,d=this.m_startColHeader,m=this.m_endColHeader,c=this.m_columnHeaderLevelCount,u=this.m_stopColumnHeaderFetch):"row"===_&&(h=this.m_rowHeader,d=this.m_startRowHeader,m=this.m_endRowHeader,c=this.m_rowHeaderLevelCount,u=this.m_stopRowHeaderFetch),"columnEnd"===_&&(e===l.keyCodes.DOWN_KEY?e=l.keyCodes.UP_KEY:e===l.keyCodes.UP_KEY&&(e=l.keyCodes.DOWN_KEY),h=this.m_colEndHeader,d=this.m_startColEndHeader,m=this.m_endColEndHeader,c=this.m_columnEndHeaderLevelCount,u=this.m_stopColumnEndHeaderFetch),"rowEnd"===_&&(e===l.keyCodes.LEFT_KEY?e=l.keyCodes.RIGHT_KEY:e===l.keyCodes.RIGHT_KEY&&(e=l.keyCodes.LEFT_KEY),h=this.m_rowEndHeader,d=this.m_startRowEndHeader,m=this.m_endRowEndHeader,c=this.m_rowEndHeaderLevelCount,u=this.m_stopRowEndHeaderFetch),i&&this.isArrowKey(e)&&this.isHeaderSelectionType(this.m_selectionFrontier)&&(f=null!=(C=this._getHeaderByIndex(p,g,h,c,d))?this._getAttribute(C,"depth",!0):1),e){case l.keyCodes.LEFT_KEY:if("column"===_||"columnEnd"===_)if(p>0){if(s&&this.m_headerLabels[_][g]){this._setActive(this.m_headerLabels[_][g],{type:"label",level:g,axis:_},t);break}if("column"===_&&s&&this.m_headerLabels.row[this.m_rowHeaderLevelCount-1]){this._setActive(this.m_headerLabels.row[this.m_rowHeaderLevelCount-1],{type:"label",level:this.m_rowHeaderLevelCount-1,axis:"row"},t);break}if(1===c)r=p-1,n=null!=C?C.previousSibling:null,a=g;else if(r=null!=(n=this._getHeaderByIndex(p-1,g,h,c,d))?this._getAttribute(n.parentNode,"start",!0):p-1,a=null!=n?this.getHeaderCellLevel(n):g,r<0)break;i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive())}else this.m_headerLabels[_][g]?this._setActive(this.m_headerLabels[_][g],{type:"label",level:g,axis:_},t):"column"===_&&this.m_headerLabels.row[this.m_rowHeaderLevelCount-1]&&this._setActive(this.m_headerLabels.row[this.m_rowHeaderLevelCount-1],{type:"label",level:this.m_rowHeaderLevelCount-1,axis:"row"},t);else("row"===_||"rowEnd"===_)&&g>0&&(n=this._getHeaderByIndex(p,g-1,h,c,d),r=this._getAttribute(n.parentNode,"start",!0),a=this.getHeaderCellLevel(n),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive()));break;case l.keyCodes.RIGHT_KEY:"rowEnd"===_&&s&&-1!==this.m_endRowHeader?(n=this._getHeaderByIndex(p,this.m_rowHeaderLevelCount,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:p,level:this.m_rowHeaderLevelCount,axis:_},t),this._highlightActive())):"row"===_&&s&&-1!==this.m_endRowEndHeader?(n=this._getHeaderByIndex(p,this.m_rowEndHeaderLevelCount,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:p,level:this.m_rowEndHeaderLevelCount,axis:_},t),this._highlightActive())):"row"===_||"rowEnd"===_?g+f>=c&&!i?(o="row"===_?this.createIndex(p,0):this._isHighWatermarkScrolling()?this.createIndex(p,this.m_endCol):this.createIndex(p,this.getDataSource().getCount("column")-1),this.m_trueIndex={row:p},this._isSelectionEnabled()?this.selectAndFocus(o,t):(this._setActiveByIndex(o,t),this._highlightActive())):(n=this._getHeaderByIndex(p,g+f,h,c,d),r=this._getAttribute(n.parentNode,"start",!0),a=this.getHeaderCellLevel(n),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive())):"column"===_&&s&&this.m_headerLabels.rowEnd[this.m_rowEndHeaderLevelCount-1]?this._setActive(this.m_headerLabels.rowEnd[this.m_rowEndHeaderLevelCount-1],{type:"label",level:this.m_rowEndHeaderLevelCount-1,axis:"rowEnd"},t):(1===c?(r=p+1,n=null!=C?C.nextSibling:null,a=g):(g===c-1?(r=p+1,n=this._getHeaderByIndex(r,g,h,c,d)):(r=null!=C?this._getAttribute(C.parentNode,"start",!0)+this._getAttribute(C.parentNode,"extent",!0):p+1,n=this._getHeaderByIndex(r,g,h,c,d)),a=null!=n?this.getHeaderCellLevel(n):g),r>m&&u||!(this._isCountUnknown("column")||r<this.getDataSource().getCount("column"))?"column"===_&&this.m_headerLabels.rowEnd[this.m_rowEndHeaderLevelCount-1]&&this._setActive(this.m_headerLabels.rowEnd[this.m_rowEndHeaderLevelCount-1],{type:"label",level:this.m_rowEndHeaderLevelCount-1,axis:"rowEnd"},t):i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive()));break;case l.keyCodes.UP_KEY:if("row"===_||"rowEnd"===_){if(s&&this.m_headerLabels[_][g]){this._setActive(this.m_headerLabels[_][g],{type:"label",level:g,axis:_},t);break}if("row"===_&&s&&this.m_headerLabels.column[this.m_columnHeaderLevelCount-1]){this._setActive(this.m_headerLabels.column[this.m_columnHeaderLevelCount-1],{type:"label",level:this.m_columnHeaderLevelCount-1,axis:"column"},t);break}if(p>0){if(1===c)r=p-1,n=null!=C?C.previousSibling:null,a=g;else if(g===c-1?(r=p-1,n=this._getHeaderByIndex(r,g,h,c,d)):r=null!=(n=this._getHeaderByIndex(this._getAttribute(C.parentNode,"start",!0)-1,g,h,c,d))?this._getAttribute(n.parentNode,"start",!0):p-1,a=null!=n?this.getHeaderCellLevel(n):g,r<0)break;i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this.m_selectionFrontier={},this._clearSelection(t)),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive())}else this.m_headerLabels[_][g]?this._setActive(this.m_headerLabels[_][g],{type:"label",level:g,axis:_},t):"row"===_&&this.m_headerLabels.column[this.m_columnHeaderLevelCount-1]&&this._setActive(this.m_headerLabels.column[this.m_columnHeaderLevelCount-1],{type:"label",level:this.m_columnHeaderLevelCount-1,axis:"column"},t)}else("column"===_||"columnEnd"===_)&&g>0&&(n=this._getHeaderByIndex(p,g-1,h,c,d),r=this._getAttribute(n.parentNode,"start",!0),a=this.getHeaderCellLevel(n),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this.m_selectionFrontier={},this._clearSelection(t)),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive()));break;case l.keyCodes.DOWN_KEY:"columnEnd"===_&&s&&-1!==this.m_endColHeader?(n=this._getHeaderByIndex(p,this.m_columnHeaderLevelCount,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this.m_selectionFrontier={},this._clearSelection(t)),this._setActive(n,{type:"header",index:p,level:this.m_columnHeaderLevelCount,axis:_},t),this._highlightActive())):"column"===_&&s&&-1!==this.m_endColEndHeader?(n=this._getHeaderByIndex(p,this.m_columnEndHeaderLevelCount,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:p,level:this.m_columnEndHeaderLevelCount,axis:_},t),this._highlightActive())):"column"===_||"columnEnd"===_?g+f>=c&&!i?(o="column"===_?this.createIndex(0,p):this._isHighWatermarkScrolling()?this.createIndex(this.m_endRow,p):this.createIndex(this.getDataSource().getCount("row")-1,p),this.m_trueIndex={column:p},this._isSelectionEnabled()?this.selectAndFocus(o,t):(this._setActiveByIndex(o,t),this._highlightActive())):(n=this._getHeaderByIndex(p,g+f,h,c,d),r=this._getAttribute(n.parentNode,"start",!0),a=this.getHeaderCellLevel(n),i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive())):"row"===_&&s&&this.m_headerLabels.columnEnd[this.m_columnEndHeaderLevelCount-1]?this._setActive(this.m_headerLabels.columnEnd[this.m_columnEndHeaderLevelCount-1],{type:"label",level:this.m_columnEndHeaderLevelCount-1,axis:"columnEnd"},t):(1===c?(r=p+1,n=null!=C?C.nextSibling:null,a=g):(g===c-1?(r=p+1,n=this._getHeaderByIndex(r,g,h,c,d)):(r=null!=C?this._getAttribute(C.parentNode,"start",!0)+this._getAttribute(C.parentNode,"extent",!0):p+1,n=this._getHeaderByIndex(r,g,h,c,d)),a=null!=n?this.getHeaderCellLevel(n):g),r>m&&u||!(this._isCountUnknown("row")||r<this.getDataSource().getCount("row"))?"row"===_&&this.m_headerLabels.columnEnd[this.m_columnEndHeaderLevelCount-1]&&this._setActive(this.m_headerLabels.columnEnd[this.m_rowEndHeaderLevelCount-1],{type:"label",level:this.m_columnEndHeaderLevelCount-1,axis:"columnEnd"},t):i?this.extendSelectionHeader(n,t,!0):(this._isSelectionEnabled()&&!this.m_discontiguousSelection&&(this._clearSelection(t),this.m_selectionFrontier={}),this._setActive(n,{type:"header",index:r,level:a,axis:_},t),this._highlightActive()));break;case l.keyCodes.PAGEUP_KEY:"row"!==_&&"rowEnd"!==_||(C=this._getHeaderByIndex(0,g,h,c,d),this._setActive(C,{type:"header",index:0,level:g,axis:_},t));break;case l.keyCodes.PAGEDOWN_KEY:"row"!==_&&"rowEnd"!==_||(p=this._isCountUnknown("row")||this._isHighWatermarkScrolling()?Math.max(0,m):Math.max(0,this.getDataSource().getCount("row")-1),C=this._getHeaderByIndex(p,g,h,c,d),this._setActive(C,{type:"header",index:p,level:g,axis:_},t));break;case l.keyCodes.HOME_KEY:"column"!==_&&"columnEnd"!==_||(C=this._getHeaderByIndex(0,g,h,c,d),this._setActive(C,{type:"header",index:0,level:g,axis:_},t));break;case l.keyCodes.END_KEY:"column"!==_&&"columnEnd"!==_||(p=this._isCountUnknown("column")||this._isHighWatermarkScrolling()?Math.max(0,m):Math.max(0,this.getDataSource().getCount("column")-1),C=this._getHeaderByIndex(p,g,h,c,d),this._setActive(C,{type:"header",index:p,level:g,axis:_},t))}return!0}},l.prototype.checkHeaderToDatabody=function(e,t){return!("row"===e&&this.m_rowHeaderLevelCount===this.m_selectionFrontier.level&&t===l.keyCodes.RIGHT_KEY||"rowEnd"===e&&this.m_rowEndHeaderLevelCount===this.m_selectionFrontier.level&&t===l.keyCodes.LEFT_KEY||"column"===e&&this.m_columnHeaderLevelCount===this.m_selectionFrontier.level&&t===l.keyCodes.DOWN_KEY||"columnEnd"===e&&this.m_columnEndHeaderLevelCount===this.m_selectionFrontier.level&&t===l.keyCodes.UP_KEY)},l.prototype._getHeaderLabelledBy=function(e,t,i,s,o,n,r,l){var a;if(-1!==o&&(n!==r||this.m_externalFocus)){var h=this.getHeaderFromCell(l,e);return null!=r&&(a=this._getHeaderByIndex(r,i-1,t,i,s)),this._getHeaderAndParentIds(h,a)}return""},l.prototype._getHeaderAndParentIds=function(e,t){var i="",s=[];if(null==e)return"";var o=this._getHeaderAndParents(e);null!=t&&(s=this._getHeaderAndParents(t));for(var n=0;n<o.length;n++)s[n]===o[n]&&n!==o.length-1||(i+=(""===i?"":" ")+o[n].id);return i},l.prototype._getHeaderAndParents=function(e){var t,i=[e],s=this.getHeaderCellAxis(e),o=this.getHeaderCellLevel(e),n=this._getLabel(s,o);if("row"===s?t=this.m_rowHeaderLevelCount:"column"===s?t=this.m_columnHeaderLevelCount:"rowEnd"===s?t=this.m_rowEndHeaderLevelCount:"columnEnd"===s&&(t=this.m_columnEndHeaderLevelCount),n&&i.unshift(n),1===t)return i;for(o===t-1&&(e=e.parentNode.firstChild,i.unshift(e),o-=1,(n=this._getLabel(s,o))&&i.unshift(n));o>0;)e=e.parentNode.parentNode.firstChild,i.unshift(e),o-=1,(n=this._getLabel(s,o))&&i.unshift(n);return i},l.prototype.isHeaderSelectionType=function(e){return!(!e||!e.axis)},l.prototype.handleFocusChange=function(e,t,i,s,o){var n,r,a,h=1,d=1;if(!this.isFetchComplete())return!0;if(t){if(n=this.m_selectionFrontier,this.isHeaderSelectionType(this.m_selectionFrontier))return void this.handleHeaderFocusChange(e,i,t,o)}else n=this.m_active.indexes;if(null!=n){null==this.m_trueIndex&&(this.m_trueIndex={}),this.getResources().isRTLMode()&&(e===l.keyCodes.LEFT_KEY?e=l.keyCodes.RIGHT_KEY:e===l.keyCodes.RIGHT_KEY&&(e=l.keyCodes.LEFT_KEY));var m=this._isSelectionEnabled()?this.selectAndFocus.bind(this):this._setActiveByIndex.bind(this),c=n.row,u=n.column,_=this._getCellByIndex(n);if(_){var p=_[this.getResources().getMappedAttribute("context")];h=p.extents.row,d=p.extents.column}switch(e){case l.keyCodes.LEFT_KEY:this.m_trueIndex.row||t||(this.m_trueIndex={row:c}),u>0&&(!o||-1===this.m_endRowHeader)?"row"===this.m_options.getSelectionMode()?(r=this.createIndex(this.m_trueIndex.row,u-1),this._setActiveByIndex(r,i)):(t?(r=this.createIndex(c,u-1),this.extendSelection(r,i,e)):m(r=this.createIndex(this.m_trueIndex.row,u-1),i),u-1==0&&this._setAccInfoText("accessibleFirstColumn")):!t&&s&&(a=this._getHeaderByIndex(this.m_trueIndex.row,this.m_rowHeaderLevelCount-1,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader),this.m_discontiguousSelection?this.discontiguousHeaderSetActiveFromDatabody(i,"row",a,this.m_rowHeaderLevelCount):this._setActive(a,{type:"header",index:this.m_trueIndex.row,level:this.m_rowHeaderLevelCount-1,axis:"row"},i,!0));break;case l.keyCodes.RIGHT_KEY:this.m_trueIndex.row||t||(this.m_trueIndex={row:c}),this._isLastColumn(u+(d-1))||o&&-1!==this.m_endRowEndHeader?-1!==this.m_endRowEndHeader&&s?(a=this._getHeaderByIndex(this.m_trueIndex.row,this.m_rowEndHeaderLevelCount-1,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader),this.m_discontiguousSelection?this.discontiguousHeaderSetActiveFromDatabody(i,"rowEnd",a,this.m_rowEndHeaderLevelCount):this._setActive(a,{type:"header",index:this.m_trueIndex.row,level:this.m_rowEndHeaderLevelCount-1,axis:"rowEnd"},i,!0)):t||m(n,i):"row"===this.m_options.getSelectionMode()?(r=this.createIndex(this.m_trueIndex.row,u+d),this._setActiveByIndex(r,i)):(t?(r=this.createIndex(c,u+1),this.extendSelection(r,i,e)):m(r=this.createIndex(this.m_trueIndex.row,u+d),i),this._isLastColumn(u+d)&&this._setAccInfoText("accessibleLastColumn"));break;case l.keyCodes.UP_KEY:this.m_trueIndex.column||t||(this.m_trueIndex={column:u}),c>0&&(!o||-1===this.m_endColHeader)?(t?(r=this.createIndex(c-1,u),this.extendSelection(r,i,e)):m(r=this.createIndex(c-1,this.m_trueIndex.column),i),c-1==0&&this._setAccInfoText("accessibleFirstRow")):!t&&s&&(a=this._getHeaderByIndex(this.m_trueIndex.column,this.m_columnHeaderLevelCount-1,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader),this.m_discontiguousSelection?this.discontiguousHeaderSetActiveFromDatabody(i,"column",a,this.m_columnHeaderLevelCount):this._setActive(a,{type:"header",index:this.m_trueIndex.column,level:this.m_columnHeaderLevelCount-1,axis:"column"},i,!0));break;case l.keyCodes.DOWN_KEY:this.m_trueIndex.column||t||(this.m_trueIndex={column:u}),this._isLastRow(c+(h-1))||o&&-1!==this.m_endColEndHeader?-1!==this.m_endColEndHeader&&s?(a=this._getHeaderByIndex(this.m_trueIndex.column,this.m_columnEndHeaderLevelCount-1,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader),this.m_discontiguousSelection?this.discontiguousHeaderSetActiveFromDatabody(i,"columnEnd",a,this.m_columnEndHeaderLevelCount):this._setActive(a,{type:"header",index:this.m_trueIndex.column,level:this.m_columnEndHeaderLevelCount-1,axis:"columnEnd"},i,!0)):t||m(n,i):(t?(r=this.createIndex(c+1,u),this.extendSelection(r,i,e)):m(r=this.createIndex(c+h,this.m_trueIndex.column),i),this._isLastRow(c+h)&&this._setAccInfoText("accessibleLastRow"));break;case l.keyCodes.HOME_KEY:this.m_trueIndex.row||(this.m_trueIndex={row:c}),m(r=this.createIndex(this.m_trueIndex.row,0),i);break;case l.keyCodes.END_KEY:this.m_trueIndex.row||(this.m_trueIndex={row:c}),m(r=this._isCountUnknown("column")||this._isHighWatermarkScrolling()?this.createIndex(this.m_trueIndex.row,Math.max(0,this.m_endCol)):this.createIndex(this.m_trueIndex.row,Math.max(0,this.getDataSource().getCount("column")-1)),i);break;case l.keyCodes.PAGEUP_KEY:this.m_trueIndex.column||(this.m_trueIndex={column:u}),m(r=this.createIndex(0,u),i);break;case l.keyCodes.PAGEDOWN_KEY:this.m_trueIndex.column||(this.m_trueIndex={column:u}),m(r=this._isCountUnknown("column")||this._isHighWatermarkScrolling()?this.createIndex(Math.max(0,this.m_endRow),this.m_trueIndex.column):this.createIndex(Math.max(0,this.getDataSource().getCount("row")-1),this.m_trueIndex.column),i)}return!0}},l.prototype.scrollToIndex=function(e,t,i){var s,o,n=e.row,r=e.column;t&&(this.m_shouldFocus=!1),i&&(e.scrollToOrigin=!0);var l=this.getResources().isRTLMode()?"right":"left",a=0,h=0,d=this._getViewportTop(),m=this._getViewportBottom(),c=this._getViewportLeft(),u=this._getViewportRight();if(n<this.m_startRow||n>this.m_endRow){var _;_=n<this.m_startRow?this.m_avgRowHeight*n:this.m_avgRowHeight*(n+1)-m+d,h=this.m_currentScrollTop-_,this.m_scrollIndexAfterFetch=e,s=!0}else{o=this._getCellByIndex({row:n,column:this.m_startCol});var p=this.getElementDir(o,"top"),g=this.getElementHeight(o);i||e.scrollToOrigin?h=d-p:p+g>m?h=m-(p+g):p<d&&(h=d-p)}if(!isNaN(r)&&!0!==s)if(r<this.m_startCol||r>this.m_endCol){var C;C=r<this.m_startCol?this.m_avgColWidth*r:this.m_avgColWidth*(r+1)-u+c,a=this.m_currentScrollLeft-C,this.m_scrollIndexAfterFetch=e}else{o=this._getCellByIndex({row:this.m_startRow,column:r});var f=this.getElementDir(o,l),v=this.getElementWidth(o);i||e.scrollToOrigin?a=c-f:f<c?a=c-f:f+v>u&&(a=u-(f+v))}0!==a||0!==h?(null!=(o=this._getCellByIndex(e))&&!0!==t&&!1!==this.m_shouldFocus&&(this.m_cellToFocus=o),this.scrollDelta(a,h)):null!=this.m_scrollIndexAfterFetch&&(t||!1===this.m_shouldFocus?this.m_scrollIndexAfterFetch=null:this._setActiveByIndex(this.m_scrollIndexAfterFetch,null,!1,!1,!0)&&(this.m_scrollIndexAfterFetch=null))},l.prototype.scrollToHeader=function(e){var t,i,s,o,n,r,l,a,h,d=e.axis,m=e.index,c=e.level,u=0;"row"===d?(t=this.m_startRowHeader,i=this.m_endRowHeader,s=this.m_avgRowHeight,o=this.m_currentScrollTop,a=this._getViewportTop(),h=this._getViewportBottom()):"column"===d?(t=this.m_startColHeader,i=this.m_endColHeader,s=this.m_avgColWidth,o=this.m_currentScrollLeft,a=this._getViewportLeft(),h=this._getViewportRight()):"rowEnd"===d?(t=this.m_startRowEndHeader,i=this.m_endRowEndHeader,s=this.m_avgRowHeight,o=this.m_currentScrollTop,a=this._getViewportTop(),h=this._getViewportBottom()):"columnEnd"===d&&(t=this.m_startColEndHeader,i=this.m_endColEndHeader,s=this.m_avgColWidth,o=this.m_currentScrollLeft,a=this._getViewportLeft(),h=this._getViewportRight());var _=h-a;m<t||m>i?(u=o-(m<t?s*m:s*(m+1)-_),this.m_scrollHeaderAfterFetch=e):("row"===d||"rowEnd"===d?(l="row"===d?this._getHeaderByIndex(m,c,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader):this._getHeaderByIndex(m,c,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader),n=this.getElementDir(l,"top"),r=this.getElementHeight(l)):"column"!==d&&"columnEnd"!==d||(l="column"===d?this._getHeaderByIndex(m,c,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader):this._getHeaderByIndex(m,c,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader),n=this.getElementDir(l,this.getResources().isRTLMode()?"right":"left"),r=this.getElementWidth(l)),_>r?n+r>h?u=h-(n+r):n<a&&(u=a-n):u=a-n),0!==u?(null!=l&&!1!==this.m_shouldFocus&&(this.m_cellToFocus=l),"row"===d||"rowEnd"===d?this.scrollDelta(0,u):this.scrollDelta(u,0)):null!=this.m_scrollHeaderAfterFetch&&(this._updateActive(e,!0,!0),this.m_scrollHeaderAfterFetch=null)},l.prototype.findHeader=function(e,t,i){if(null==t&&(t=this.getMappedStyle("headercell")),null==i&&(i=this.getMappedStyle("endheadercell")),null!=t){if(this.m_utils.containsCSSClassName(e,t)||this.m_utils.containsCSSClassName(e,i))return e;if(e.parentNode)return this.findHeader(e.parentNode,t,i);if(e===this.m_root)return null}return null},l.prototype.updateRowBanding=function(){var e=this.m_options.getRowBandingInterval();if(e>0)for(var t=this.m_databody.firstChild.childNodes,i=this.getMappedStyle("banded"),s=0;s<t.length;s++){var o=t[s],n=this._getIndex(o,"row");Math.floor(n/e)%2==1?this.m_utils.containsCSSClassName(o,i)||this.m_utils.addCSSClassName(o,i):this.m_utils.containsCSSClassName(o,i)&&this.m_utils.removeCSSClassName(o,i)}},l.prototype.updateColumnBanding=function(){var e=this.m_options.getColumnBandingInterval();if(e>0)for(var t=this.m_databody.firstChild.childNodes,i=this.getMappedStyle("banded"),s=0;s<t.length;s+=1){var o=t[s],n=this._getIndex(o,"column");Math.floor(n/e)%2==1?this.m_utils.containsCSSClassName(o,i)||this.m_utils.addCSSClassName(o,i):this.m_utils.containsCSSClassName(o,i)&&this.m_utils.removeCSSClassName(o,i)}},l.prototype._removeBanding=function(){for(var e=this.m_databody.firstChild.childNodes,t=this.getMappedStyle("banded"),i=0;i<e.length;i++)this.m_utils.containsCSSClassName(e[i],t)&&this.m_utils.removeCSSClassName(e[i],t)},l.prototype._setAccInfoText=function(e,t){var i=this.getResources().getTranslatedText(e,t);null!=i&&(this.m_accInfo.textContent=i)},l.prototype.handleExpandEvent=function(e,t){void 0===t&&this.queueModelEvent(e)?e.operation="expand":(this._setAccInfoText("accessibleRowExpanded"),this.populateAccInfo(),t&&this._runModelEventQueue())},l.prototype.handleCollapseEvent=function(e,t){void 0===t&&this.queueModelEvent(e)?e.operation="collapse":(this._setAccInfoText("accessibleRowCollapsed"),this.populateAccInfo(),t&&this._runModelEventQueue())},l.prototype._getKey=function(e,t){return null!=e&&e[this.getResources().getMappedAttribute("context")]?null!=t&&this.m_utils.containsCSSClassName(e,this.getMappedStyle("cell"))?e[this.getResources().getMappedAttribute("context")].keys[t]:e[this.getResources().getMappedAttribute("context")].key:null},l.prototype._getActiveKey=function(e,t){if(t&&null!=this.m_prevActive){if("header"===this.m_prevActive.type&&(this.m_prevActive.axis===e||this.m_prevActive.axis===e+"End"))return this.m_prevActive.key;if("cell"===this.m_prevActive.type)return this.m_prevActive.keys[e]}else if(null!=this.m_active){if("header"===this.m_active.type&&(this.m_active.axis===e||this.m_active.axis===e+"End"))return this.m_active.key;if("cell"===this.m_active.type)return this.m_active.keys[e]}return null},l.prototype._handleCut=function(e,t){null==t&&(t=e.target);var i=this.findCellOrHeader(t);if(this._isMoveOnElementEnabled(i)){if(null!=this.m_cutCells)for(var s=0;s<this.m_cutCells.length;s++)this.m_utils.removeCSSClassName(this.m_cutCells[s],this.getMappedStyle("cut"));var o=this._getKey(i,"row");return this.m_cutCells=this._getAxisCellsByKey(o,"row"),this.m_cutRowHeader=this._findHeaderByKey(o,this.m_rowHeader,this.getMappedStyle("rowheadercell")),this.m_cutRowEndHeader=this._findHeaderByKey(o,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell")),this._highlightCellsAlongAxis(o,"row","key","add",["cut"]),null!==this.m_cutRowHeader&&this.m_utils.addCSSClassName(this.m_cutRowHeader,this.getMappedStyle("cut")),null!==this.m_cutRowEndHeader&&this.m_utils.addCSSClassName(this.m_cutRowEndHeader,this.getMappedStyle("cut")),!0}return!1},l.prototype._handlePaste=function(e,t){if(null==t&&(t=e.target),null!=this.m_cutCells){for(var i=0;i<this.m_cutCells.length;i++)this.m_utils.removeCSSClassName(this.m_cutCells[i],this.getMappedStyle("cut"));null!==this.m_cutRowHeader&&(this.m_utils.removeCSSClassName(this.m_cutRowHeader,this.getMappedStyle("cut")),this.m_cutRowHeader=null),null!==this.m_cutRowEndHeader&&(this.m_utils.removeCSSClassName(this.m_cutRowEndHeader,this.getMappedStyle("cut")),this.m_cutRowEndHeader=null);var s=this._getKey(this.findCellOrHeader(t),"row"),o=this._getKey(this.m_cutCells[0],"row");return o!==s&&(this._isSelectionEnabled()&&this._clearSelection(e),this._isDatabodyCellActive()&&this._unhighlightActive(),this.m_moveActive=!0,this.getDataSource().move(o,s)),this.m_cutCells=null,!0}return!1},l.prototype._handleCancelReorder=function(e,t){if(null!=this.m_cutCells){for(var i=0;i<this.m_cutCells.length;i++)this.m_utils.removeCSSClassName(this.m_cutCells[i],this.getMappedStyle("cut"));return this.m_cutCells=null,null!==this.m_cutRowHeader&&(this.m_utils.removeCSSClassName(this.m_cutRowHeader,this.getMappedStyle("cut")),this.m_cutRowHeader=null),null!==this.m_cutRowEndHeader&&(this.m_utils.removeCSSClassName(this.m_cutRowEndHeader,this.getMappedStyle("cut")),this.m_cutRowEndHeader=null),!0}},l.prototype._handleMove=function(e){if(null==this.m_moveCells){var t=e.target,i=this.findCellOrHeader(t),s=this._getKey(i,"row");this.m_originalMoveIndex=this._getIndex(i,"row"),this.m_moveIndex=this.m_originalMoveIndex,this.m_moveCells=this._getAxisCellsByIndex(this.m_moveIndex,"row"),this.m_moveRowHeader=this._findHeaderByKey(s,this.m_rowHeader,this.getMappedStyle("rowheadercell")),this.m_moveRowEndHeader=this._findHeaderByKey(s,this.m_rowEndHeader,this.getMappedStyle("rowendheadercell")),this._highlightCellsAlongAxis(this.m_moveIndex,"row","index","add",["drag"]),this.m_originalTop=this.getElementDir(this.m_moveCells[0],"top"),this.m_dropTarget=document.createElement("div"),this.m_utils.addCSSClassName(this.m_dropTarget,this.getMappedStyle("drop")),this.setElementHeight(this.m_dropTarget,this.calculateRowHeight(this.m_moveCells[0])),this.setElementDir(this.m_dropTarget,this.m_originalTop,"top"),this.m_databody.firstChild.appendChild(this.m_dropTarget),this._addHeaderDropTarget(this.m_moveRowHeader,this.m_rowHeader,!1),this._addHeaderDropTarget(this.m_moveRowEndHeader,this.m_rowEndHeader,!0)}this.m_utils.isTouchDevice()||(this.m_prevY=this.m_currentY,this.m_currentY=e.pageY);for(var o=this.m_currentY-this.m_prevY,n=this.calculateRowHeight(this.m_moveCells[0]),r=0;r<this.m_moveCells.length;r++)this.setElementDir(this.m_moveCells[r],this.getElementDir(this.m_moveCells[r],"top")+o,"top");null!==this.m_moveRowHeader&&this.setElementDir(this.m_moveRowHeader,this.getElementDir(this.m_moveRowHeader,"top")+o,"top"),null!==this.m_moveRowEndHeader&&this.setElementDir(this.m_moveRowEndHeader,this.getElementDir(this.m_moveRowEndHeader,"top")+o,"top");var l=this.m_moveIndex+1,a=this.m_moveIndex-1,h=this._getCellByIndex(this.createIndex(l,this.m_startCol)),d=this._getCellByIndex(this.createIndex(a,this.m_startCol));null!=h&&this.getElementDir(h,"top")<this.getElementDir(this.m_moveCells[0],"top")+n/2?this._moveDropRows("nextSibling",l):null!=d&&this.getElementDir(d,"top")>this.getElementDir(this.m_moveCells[0],"top")-n/2&&this._moveDropRows("previousSibling",a)},l.prototype._addHeaderDropTarget=function(e,t,i){var s;null!==e&&(null==e.style.height&&this.setElementHeight(e,this.calculateRowHeight(e)),this.m_utils.addCSSClassName(e,this.getMappedStyle("drag")),s=document.createElement("div"),this.m_utils.addCSSClassName(s,this.getMappedStyle("drop")),this.setElementHeight(s,this.calculateRowHeight(e)),this.setElementDir(s,this.m_originalTop,"top"),t.firstChild.appendChild(s),i?this.m_dropTargetEndHeader=s:this.m_dropTargetHeader=s)},l.prototype._moveDropRows=function(e,t){var i,s,o,n,r;"nextSibling"===e?(r=this._getAxisCellsByIndex(t,"row"),i=this.m_originalTop+this.calculateRowHeight(r[0]),s=this.m_originalTop):(r=this._getAxisCellsByIndex(t,"row"),s=(i=this.getElementDir(r[0],"top"))+this.calculateRowHeight(r[0])),this.setElementDir(this.m_dropTarget,i,"top");for(var l=0;l<r.length;l++)this.setElementDir(r[l],s,"top");null!==this.m_moveRowHeader&&(o=this.m_moveRowHeader.parentNode,this.setElementDir(this.m_dropTargetHeader,i,"top"),this.setElementDir(this.m_moveRowHeader[e],s,"top")),null!==this.m_moveRowEndHeader&&(n=this.m_moveRowEndHeader.parentNode,this.setElementDir(this.m_dropTargetEndHeader,i,"top"),this.setElementDir(this.m_moveRowEndHeader[e],s,"top")),this.m_originalTop=i,this._highlightCellsAlongAxis(this.m_moveIndex+1,"row","index","remove",["activedrop"]),"nextSibling"===e?(this._modifyAxisCellContextIndex("row",this.m_moveIndex,1,1),this._modifyAxisCellContextIndex("row",this.m_moveIndex+1,1,-1),this.m_moveIndex+=1,null!==this.m_moveRowHeader&&o.insertBefore(this.m_moveRowHeader,this.m_moveRowHeader[e][e]),null!==this.m_moveRowEndHeader&&n.insertBefore(this.m_moveRowEndHeader,this.m_moveRowEndHeader[e][e])):(this._modifyAxisCellContextIndex("row",this.m_moveIndex,1,-1),this._modifyAxisCellContextIndex("row",this.m_moveIndex-1,1,1),this.m_moveIndex-=1,null!==this.m_moveRowHeader&&o.insertBefore(this.m_moveRowHeader,this.m_moveRowHeader[e]),null!==this.m_moveRowEndHeader&&n.insertBefore(this.m_moveRowEndHeader,this.m_moveRowEndHeader[e])),this._refreshDatabodyMap(),this._highlightCellsAlongAxis(this.m_moveIndex+1,"row","index","add",["activedrop"])},l.prototype._isMoveEnabled=function(e){var t=this.getDataSource().getCapability("move");return"enable"===this.m_options.isMoveable("row")&&("full"===t||t===e)},l.prototype._handleMoveMouseUp=function(e,t){if(null!=this.m_moveCells){this._remove(this.m_dropTarget),null!==this.m_moveRowHeader&&this._remove(this.m_dropTargetHeader),null!==this.m_moveRowEndHeader&&this._remove(this.m_dropTargetEndHeader),null!=this.m_active&&"column"!==this.m_active.axis&&(this.m_moveActive=!0),this._isSelectionEnabled()&&this._clearSelection(e);var i=this.m_moveCells[0],s=this._getKey(i,"row");if(!0===t){var o=this.m_moveIndex+1,n=this._getKey(this._getCellByIndex(this.createIndex(o,this.m_startCol)),"row");this.getDataSource().move(s,n)}else this.getDataSource().move(s,s);this.m_moveCells=null,this.m_originalMoveIndex=null,this.m_moveIndex=null}this.m_databodyMove=!1},l.prototype._isMoveOnElementEnabled=function(e){return!(null==e||!this._isMoveEnabled("row")||this._getActiveKey("row")!==this._getKey(e,"row"))},l.prototype._manageMoveCursor=function(){var e=this._getActiveKey("row"),t=this._getActiveKey("row",!0),i=this.getMappedStyle("draggable"),s=this.getMappedStyle("rowheadercell"),o=this.getMappedStyle("rowendheadercell");if(null!=t){this._highlightCellsAlongAxis(t,"row","key","remove",["draggable"]);var n=this._findHeaderByKey(t,this.m_rowHeader,s);this.m_utils.containsCSSClassName(n,i)&&this.m_utils.removeCSSClassName(n,i),n=this._findHeaderByKey(t,this.m_rowEndHeader,o),this.m_utils.containsCSSClassName(n,i)&&this.m_utils.removeCSSClassName(n,i)}if(null!=e){var r=this._getAxisCellsByKey(e,"row");if(this._isMoveOnElementEnabled(r[0])){this._highlightCellsAlongAxis(e,"row","key","add",["draggable"]);var l=this._findHeaderByKey(e,this.m_rowHeader,s);this.m_utils.addCSSClassName(l,i);var a=this._findHeaderByKey(e,this.m_rowEndHeader,o);this.m_utils.addCSSClassName(a,i)}}},l.prototype.handleRootFocus=function(e){if(this.m_utils.addCSSClassName(this.m_root,this.getMappedStyle("focus")),!this.m_root.contains(document.activeElement)||document.activeElement===this.m_root&&0===this.m_root.tabIndex||document.activeElement===this.m_databody&&this.m_scrollbarFocus&&0===this.m_root.tabIndex){this.m_externalFocus=!0,this._isCellEditable()?this._setAccInfoText("accessibleEditableMode"):this._isGridEditable()&&this._setAccInfoText("accessibleNavigationMode");var t=!1;if(!0===this.m_scrollbarFocus&&(this.m_shouldFocus=!1,this.m_scrollbarFocus=!1,t=!0),null!=this.m_active||this._databodyEmpty())null!=this.m_active&&this._highlightActive();else{var i=this.createIndex(0,0);t||this.scrollToIndex(i),this._setActiveByIndex(i,e,null,null,t)}}this.m_root.tabIndex=-1},l.prototype.handleRootBlur=function(e){setTimeout(function(){if(!this.m_root.contains(document.activeElement)){this.m_root.tabIndex=0;var e=this._getActiveElement();null!=e&&this._unsetAriaProperties(e)}}.bind(this),100),null==this.m_moveRow&&this.m_utils.removeCSSClassName(this.m_root,this.getMappedStyle("focus"))},l.prototype.calculateRowHeight=function(e){return""!==e.style.height?this.getElementHeight(e):null!=e.nextSibling?this.getElementDir(e.nextSibling,"top")-this.getElementDir(e,"top"):this.m_endRowPixel-this.getElementDir(e,"top")},l.prototype.calculateRowHeaderHeight=function(e){return""!==e.style.height?this.getElementHeight(e):null!=e.nextSibling?this.getElementDir(e.nextSibling,"top")-this.getElementDir(e,"top"):this.m_endRowHeaderPixel-this.getElementDir(e,"top")},l.prototype.calculateColumnWidth=function(e){if(""!==e.style.width)return this.getElementWidth(e);var t=this.getResources().isRTLMode()?"right":"left";return null!=e.nextSibling?this.getElementDir(e.nextSibling,t)-this.getElementDir(e,t):this.m_endColPixel-this.getElementDir(e,t)},l.prototype.calculateColumnHeaderWidth=function(e){if(""!==e.style.width)return this.getElementWidth(e);var t=this.getResources().isRTLMode()?"right":"left";return null!=e.nextSibling?this.getElementDir(e.nextSibling,t)-this.getElementDir(e,t):this.m_endColHeaderPixel-this.getElementDir(e,t)},l.prototype._databodyEmpty=function(){return null==this.m_databody.firstChild||null==this.m_databody.firstChild.firstChild},l.prototype.changeStyleProperty=function(e,t,i,s){void 0!==t&&(e.style[t]="remove"===s?"":i)},l.prototype.addTransformMoveStyle=function(e,t,i,s,o,n,r){this.changeStyleProperty(e,this.getCssSupport("transition-delay"),i),this.changeStyleProperty(e,this.getCssSupport("transition-timing-function"),s),this.changeStyleProperty(e,this.getCssSupport("transition-duration"),t),this.changeStyleProperty(e,this.getCssSupport("transform"),"translate3d("+o+"px,"+n+"px,"+r+"px)")},l.prototype.removeTransformMoveStyle=function(e){this.changeStyleProperty(e,this.getCssSupport("transition-delay"),null,"remove"),this.changeStyleProperty(e,this.getCssSupport("transition-timing-function"),null,"remove"),this.changeStyleProperty(e,this.getCssSupport("transition-duration"),null,"remove"),this.changeStyleProperty(e,this.getCssSupport("transform"),null,"remove")},l.prototype.getCssSupport=function(e){var t=["","-moz-","-webkit-","-o-","-ms-","-khtml-"],i=document.documentElement;for(var s=0;s<t.length;s++){var o=(t[s]+e).replace(/-([a-z])/gi,function(e,t){return t.toUpperCase()});if("Ms"===o.substr(0,2)&&(o="m"+o.substr(1)),o in i.style)return o}},l.prototype._refreshDatabodyMap=function(){this._clearDatabodyMap(),this._addNodesToDatabodyMap(this.m_databody.firstChild.childNodes)},l.prototype._populateDatabody=function(e,t){this._addNodesToDatabodyMap(t.childNodes),e.appendChild(t)},l.prototype._emptyDatabody=function(e){this._clearDatabodyMap(),this.m_utils.empty(e)},l.prototype._addNodesToDatabodyMap=function(e){for(var t=0;t<e.length;t++){var i=e[t];if(this.m_utils.containsCSSClassName(i,this.getMappedStyle("cell"))){var s=this.getCellIndexes(i),o=this.getCellExtents(i),n=i.id;this._addToDatabodyMap(s,n,o)}}},l.prototype._removeNodesFromDatabodyMap=function(e){for(var t=0;t<e.length;t++){var i=this.getCellIndexes(e[t]);this._removeIndexFromDatabodyMap(i)}},l.prototype._addToDatabodyMap=function(e,t,i){for(var s=i.row,o=i.column,n=0;n<s;n++)for(var r=0;r<o;r++)this._addIndexToDatabodyMap(this.createIndex(e.row+n,e.column+r),t)},l.prototype._addIndexToDatabodyMap=function(e,t){var i="r"+e.row+"c"+e.column;this.m_databodyMap.set(i,t)},l.prototype._removeIndexFromDatabodyMap=function(e){var t="r"+e.row+"c"+e.column;return this.m_databodyMap.delete(t)},l.prototype._getFromDatabodyMap=function(e){var t="r"+e.row+"c"+e.column;return this.m_databodyMap.get(t)},l.prototype._clearDatabodyMap=function(){return this.m_databodyMap.clear()},l.prototype._modifyAxisCellContextIndex=function(e,t,i,s){for(var o=t;o<t+i;o++)for(var n=this._getAxisCellsByIndex(o,e),r=0;r<n.length;r++){n[r][this.getResources().getMappedAttribute("context")].indexes[e]+=s}},l.prototype._getCellOrHeaderByIndex=function(e,t){var i=null,s=this._getAxisCellsByIndex(e,t,!0);return null!=s&&s.length>0&&(i=s[0]),null==i&&("row"===t&&null==(i=this._getHeaderByIndex(e,0,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader))&&(i=this._getHeaderByIndex(e,0,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader)),"column"===t&&null==(i=this._getHeaderByIndex(e,0,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader))&&(i=this._getHeaderByIndex(e,0,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader))),i},l.prototype._getLabel=function(e,t){return this.m_headerLabels[e][t]},l.prototype._getCellByIndex=function(e){var t=this._getFromDatabodyMap(e);return null!=t?this.m_databody.querySelector("#"+t):null},l.prototype._getAxisCellsByIndex=function(e,t,i){for(var s,o="row"===t?this.m_startCol:this.m_startRow,n="row"===t?this.m_endCol:this.m_endRow,r=[],l=o;l<=n;l+=s){var a=this._getCellByIndex(this.createIndex("row"===t?e:l,"row"===t?l:e));if(null!=a){if(s=this.getCellExtents(a)["row"===t?"column":"row"],r.push(a),i)break}else s=1}return r},l.prototype._getAxisCellsByKey=function(e,t,i){if(null==e||null==this.m_databody||null==this.m_databody.firstChild)return null;for(var s=[],o=this.m_databody.firstChild.childNodes,n=0;n<o.length;n++){var r=o[n];if(this.m_utils.containsCSSClassName(r,this.getMappedStyle("cell")))if(this._getKey(r,t)===e&&(s.push(r),i))break}return s},l.prototype._isContainFocusableElement=function(e){return this.getFocusableElementsInNode(e).length>0},l.prototype.unhighlightSelection=function(){for(var e=this.GetSelection(),t=0;t<e.length;t+=1)this.unhighlightRange(e[t])},l.prototype.unhighlightRange=function(e){var t=this.getElementsInRange(e);this.unhighlightElems(t)},l.prototype.highlightRange=function(e,t){var i,s=this.getElementsInRange(e);(this.highlightElems(s),t)&&(i=1===this.GetSelection().length?s.length:this._getCurrentSelectionCellCount(),this._setAccInfoText("accessibleMultiCellSelected",{num:i}))},l.prototype._getCurrentSelectionCellCount=function(){for(var e=0,t=this.GetSelection(),i=0;i<t.length;i++){var s=this.getElementsInRange(t[i]);null!=s&&(e+=s.length)}return e},l.prototype.unhighlightElems=function(e){if(null!=e&&0!==e.length)for(var t=0;t<e.length;t+=1){var i=e[t];this._unhighlightElement(i,["selected","topSelected","bottomSelected"])}},l.prototype.highlightElems=function(e){if(null!=e&&0!==e.length){var t=e[0],i=this._getIndex(t,"row");t=e[e.length-1];for(var s=this._getIndex(t,"row"),o=0;o<e.length;o+=1){var n=["selected"];t=e[o];var r=this._getIndex(t,"row");r===i&&n.push("topSelected"),r===s&&n.push("bottomSelected"),this._highlightElement(t,n)}}},l.prototype.applySelection=function(e,t,i,s){for(var o=this.GetSelection(),n=0;n<o.length;n+=1){var r=this.getElementsInRange(o[n],e,t,i,s);this.highlightElems(r)}},l.prototype.handleDatabodySelectionDrag=function(e){var t,i;if(this.m_utils.isTouchDevice()?t=this.findCell(document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY)):(i=e.target,t=this.findCell(i)),null!=t)if(this.isHeaderSelectionType(this.m_selectionFrontier))this.extendSelectionHeader(t,e);else{var s=this.getCellIndexes(t);this.extendSelection(s,e)}},l.prototype._isSelected=function(e){var t=this.getMappedStyle("selected");return null!=t&&this.m_utils.containsCSSClassName(e,t)},l.prototype._deselect=function(e){"row"===this.m_options.getSelectionMode()&&(e=this.createIndex(e.row));for(var t=e.row,i=e.column,s=-1,o=this.GetSelection(),n=0;n<o.length;n+=1){var r=o[n],l=r.startIndex,a=this.getEndIndex(r),h=l.row,d=a.row;if(h===t&&d===t){var m=l.column,c=a.column;if(isNaN(m)||isNaN(c)){if(isNaN(i)){s=n;break}}else if(m===i&&c===i){s=n;break}}}-1!==s&&(this.unhighlightRange(o[s]),o.splice(s,1))},l.prototype.handleHeaderClickSelection=function(e){var t,i,s,o=e.target,n=this.findHeader(o),r=e.shiftKey;if(!r&&n&&this._setActive(n,this._createActiveObject(n),e),null==this.m_active||"header"!==this.m_active.type&&!e.shiftKey)return!1;if("header"===this.m_active.type&&(t=this.m_active.axis,i=this.m_active.index,s=this.m_active.level),this.m_utils.isTouchDevice())this._removeTouchSelectionAffordance(),this._selectHeader(t,i,s,e);else if(r){if(r){var l=n[this.getResources().getMappedAttribute("context")];null==t&&(t=l.axis),(-1!==t.indexOf("row")&&-1!==l.axis.indexOf("row")||-1!==t.indexOf("column")&&-1!==l.axis.indexOf("column"))&&this.extendSelectionHeader(n,e)}}else this._selectHeader(t,i,s,e)},l.prototype.discontiguousHeaderSetActiveFromDatabody=function(e,t,i,s){var o=t.replace("End",""),n=this.m_selection[this.m_selection.length-1];this.unhighlightSelection(),n.startIndex.row===this.m_active.indexes.row&&n.endIndex.row===this.m_active.indexes.row&&n.startIndex.column===this.m_active.indexes.column&&n.endIndex.column===this.m_active.indexes.column&&this.m_selection.pop(),this._setActive(i,{type:"header",index:this.m_trueIndex[o],level:s-1,axis:t},e,!1),this.rehighlightSelection()},l.prototype.handleDragAnchorChange=function(e){if(this.m_headerDragState){var t,i,s=e.target,o=this.findHeader(s),n=o[this.getResources().getMappedAttribute("context")],r=this._getActiveElement(),l=r[this.getResources().getMappedAttribute("context")],a=this._getAttribute(r.parentNode,"start",!0),h=this._getAttribute(r.parentNode,"extent",!0);if(!n.extent)return;1===n.extent?(t=n.index,i=n.index):i=(t=this._getAttribute(o.parentNode,"start",!0))+(this._getAttribute(o.parentNode,"extent",!0)-1),h=(a=this._getAttribute(r.parentNode,"start",!0))+(this._getAttribute(r.parentNode,"extent",!0)-1),1!==l.extent?(t<=a&&i>=h||t>=a&&i<=h)&&this._setActive(o,this._createActiveObject(o),e):t!==i&&t<=a&&a<=i&&this._setActive(o,this._createActiveObject(o),e)}},l.prototype.handleDatabodyClickSelection=function(e){var t,i=e.target,s=this.findCell(i);if(null!=s&&(t=this.getCellIndexes(s)),null!=t){if(this.isMultipleSelection()&&2===e.button&&this._isContainSelection(t))return;var o=this.m_utils.ctrlEquivalent(e),n=e.shiftKey;this.isMultipleSelection()?this.m_utils.isTouchDevice()?(this._removeTouchSelectionAffordance(),null!=this.m_active&&this._unhighlightActive(),this.selectAndFocus(t,e,!1)):o||n?!o&&n?this.extendSelection(t,e):this.selectAndFocus(t,e,!0):this.selectAndFocus(t,e,!1):this.selectAndFocus(t,e,!1)}},l.prototype._handleSelectAll=function(e){return!(!this._isSelectionEnabled()||!this.isMultipleSelection())&&("row"===this.m_options.getSelectionMode()?this._selectRange(this.createIndex(0),this.createIndex(-1),e):this._selectRange(this.createIndex(0,0),this.createIndex(-1,-1),e),this.m_utils.isTouchDevice()&&this.m_topSelectIconContainer&&this.m_bottomSelectIconContainer&&(this.m_topSelectIconContainer.parentNode.removeChild(this.m_topSelectIconContainer),this.m_bottomSelectIconContainer.parentNode.removeChild(this.m_bottomSelectIconContainer)),!0)},l.prototype._isContainSelection=function(e,t){null==t&&(t=this.GetSelection());for(var i=0;i<t.length;i+=1){var s=t[i],o=s.startIndex,n=this.getEndIndex(s),r=o.row,l=n.row;if(e.row>=r&&(-1===l||e.row<=l)){var a=o.column,h=n.column;if(isNaN(a)||isNaN(h))return!0;if(e.column>=a&&(-1===h||e.column<=h))return!0}}return!1},l.prototype._compareSelections=function(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i+=1){for(var s=!1,o=0;o<t.length;o+=1)this._compareIndividualSelectionObjects(e[i],t[o])&&(s=!0);if(!1===s)return!1}return!0},l.prototype._compareIndividualSelectionObjects=function(e,t){return e.startIndex.row===t.startIndex.row&&e.startIndex.column===t.startIndex.column&&e.endIndex.row===t.endIndex.row&&e.endIndex.column===t.endIndex.column},l.prototype._clearSelection=function(e){this.unhighlightSelection(),this._removeTouchSelectionAffordance();var t=this.GetSelection();this.m_selection=[],this._compareSelectionAndFire(e,t)},l.prototype.setDiscontiguousSelectionMode=function(e){this.m_discontiguousSelection=e,this._setAccInfoText(e?"accessibleRangeSelectModeOn":"accessibleRangeSelectModeOff")},l.prototype._selectEntireRow=function(e,t,i){var s=this.createIndex(e,0),o=this.createIndex(t,-1),n=this._getSelectionStartAndEnd(s,o,0);"row"===this.m_options.getSelectionMode()?this._selectRange(this.createIndex(n.min.row),this.createIndex(n.max.row),i):this._selectRange(this.createIndex(n.min.row,0),this.createIndex(n.max.row,-1),i)},l.prototype._selectEntireColumn=function(e,t,i){var s=this.createIndex(0,e),o=this.createIndex(-1,t),n=this._getSelectionStartAndEnd(s,o,0);this._selectRange(this.createIndex(0,n.min.column),this.createIndex(-1,n.max.column),i)},l.prototype._selectRange=function(e,t,i){this.unhighlightSelection(),this._createRangeWithKeys(e,t,this._selectRangeCallback.bind(this,i))},l.prototype._selectRangeCallback=function(e,t){var i,s=this.GetSelection();(i=this.m_discontiguousSelection||!e||this.m_utils.ctrlEquivalent(e)&&0===e.button?s.slice(0):[]).push(t),this.m_selection=i,this.rehighlightSelection(),this._isDatabodyCellActive()&&e.target[this.getResources().getMappedAttribute("context")]&&!e.target[this.getResources().getMappedAttribute("context")].axis&&!this.m_selectionFrontier.axis&&(this.m_selectionFrontier=this.m_active.indexes,this._highlightActive()),this._compareSelectionAndFire(e,s)},l.prototype.rehighlightSelection=function(){for(var e=0;e<this.m_selection.length;e++)this.highlightRange(this.m_selection[e])},l.prototype.GetSelection=function(){return null==this.m_selection&&(this.m_selection=[]),this.m_selection},l.prototype.SetSelection=function(e){void 0!==e&&(null===e&&(e=[]),this.unhighlightSelection(),this.m_selection=e,null!=this.m_databody&&this.applySelection(this.m_startRow,this.m_endRow,this.m_startCol,this.m_endCol))},l.prototype.fireSelectionEvent=function(e,t){var i={event:e,ui:{selection:this.GetSelection(),previousSelection:t}};this.fireEvent("select",i)},l.prototype.extendSelection=function(e,t,i){if("header"!==this.m_active.type){var s;if(this.m_utils.isTouchDevice())s=this.m_touchSelectAnchor;else s={row:this.m_active.indexes.row,column:this.m_active.indexes.column};if(null!=s){this._resetSelectionFrontierFocus();var o=this._updateSelectionFrontier(s,e,i),n=o.min,r=o.max;"row"===this.m_options.getSelectionMode()&&(n=this.createIndex(n.row),r=this.createIndex(r.row)),this._createRangeWithKeys(n,r,this._extendSelectionCallback.bind(this,t,s))}}},l.prototype.extendSelectionHeader=function(e,t,i){if(null!==e){var s,o,n,r,l,a=this.findCellOrHeader(e),h=a[this.getResources().getMappedAttribute("context")];if(null==i&&(i=this.m_discontiguousSelection),h){if(h.cell)r=n=-1!==this.m_selectionFrontier.axis.indexOf("column")?h.indexes.column:h.indexes.row,l=n;else{if(this.m_selectionFrontier&&h.index===this.m_selectionFrontier.index&&h.level===this.m_selectionFrontier.level)return;1===h.extent?(n=h.index,r=h.index,l=h.index):r=(n=this._getAttribute(e.parentNode,"start",!0))+(this._getAttribute(e.parentNode,"extent",!0)-1)}var d,m,c,u=this._getActiveElement(),_=u[this.getResources().getMappedAttribute("context")];if(this.m_utils.isTouchDevice()?(-1===(s=-1!==this.m_selectionFrontier.axis.indexOf("column")?this.m_touchSelectAnchor.column:this.m_touchSelectAnchor.row)&&(s=0),d=s,m=s,o=this.m_selectionFrontier.axis):(m=(d=this._getAttribute(u.parentNode,"start",!0))+(this._getAttribute(u.parentNode,"extent",!0)-1),"header"===this.m_active.type&&(o=this.m_active.axis,s=this.m_active.index)),"cell"===this.m_active.type?(c=1,s=-1!==(o=h.axis).indexOf("row")?this.m_active.indexes.row:this.m_active.indexes.column):c=_.extent,i){var p=this.m_selection[this.m_selection.length-1];this.unhighlightSelection(),p&&this.checkCorners(o,s,p)&&this.m_selection.pop()}1!==c?n<=d&&r>=m||n>=d&&r<=m?(this.m_headerDragState||this._setActive(a,this._createActiveObject(a),t),s=n,l=r):n>d&&r>m?(s=d,l=r):n<d&&r<m&&(s=n,l=m):1===c&&n!==r&&(n<=s&&s<=r?(this.m_headerDragState||"cell"===this.m_active.type||this._setActive(a,this._createActiveObject(a),t),s=n,l=r):n<=s&&r<=s?(l=s,s=n):n>=s&&r>=s&&(l=r)),h.cell?this.setHeaderSelectionFrontier(o,l,l,this.m_selectionFrontier.level,e,!0):this.setHeaderSelectionFrontier(o,l,h.index,h.level,e,!0),-1!==o.indexOf("column")?t?this._selectEntireColumn(s,l,t):this._selectEntireColumn(s,l,null):-1!==o.indexOf("row")&&(t?this._selectEntireRow(s,l,t):this._selectEntireRow(s,l,null))}}},l.prototype._updateSelectionFrontier=function(e,t,i){var s,o,n;if("row"===this.m_options.getSelectionMode()?(s=this.createIndex(e.row,this.m_startCol),o=this.createIndex(t.row,this.m_endCol)):(s=e,o=t),null!=i){var r=this.GetSelection(),a=(n=r[this._getLastAnchoredSelectionIndex(r,s)]).startIndex,h=n.endIndex;a.row===this.m_selectionFrontier.row&&s.row!==a.row?s.row=h.row:h.row===this.m_selectionFrontier.row&&s.row!==h.row&&(s.row=a.row),a.column===this.m_selectionFrontier.column&&s.column!==a.column?s.column=h.column:h.column===this.m_selectionFrontier.column&&s.column!==h.column&&(s.column=a.column)}var d=this._getSelectionStartAndEnd(s,o,0),m=o;if(null!=i){var c=d.min,u=d.max;for("row"===this.m_options.getSelectionMode()&&(c=this.createIndex(c.row),u=this.createIndex(u.row));this._compareIndividualSelectionObjects(n,this.createRange(c,u));){if(i===l.keyCodes.LEFT_KEY){if(0===o.column)break;o.column-=1}else if(i===l.keyCodes.RIGHT_KEY){if(o.column===this.m_endCol)break;o.column+=1}else if(i===l.keyCodes.UP_KEY){if(0===o.row)break;o.row-=1}else{if(i!==l.keyCodes.DOWN_KEY)break;if(o.row===this.m_endRow)break;o.row+=1}c=(d=this._getSelectionStartAndEnd(s,o,0)).min,u=d.max,"row"===this.m_options.getSelectionMode()&&(c=this.createIndex(c.row),u=this.createIndex(u.row))}i===l.keyCodes.LEFT_KEY?(m.column=c.column<s.column?c.column:u.column,m.row=c.row<s.row?c.row:u.row):i===l.keyCodes.RIGHT_KEY?(m.column=u.column>s.column?u.column:c.column,m.row=c.row<s.row?c.row:u.row):i===l.keyCodes.UP_KEY?(m.row=c.row<s.row?c.row:u.row,m.column=c.column<s.column?c.column:u.column):i===l.keyCodes.DOWN_KEY&&(m.row=u.row>s.row?u.row:c.row,m.column=c.column<s.column?c.column:u.column)}else m=this.getCellIndexes(this._getCellByIndex(m));return"row"===this.m_options.getSelectionMode()&&(m=this.createIndex(m.row,this.m_active.indexes.column)),this.m_selectionFrontier=m,d},l.prototype._getMinOrMax=function(e,t,i){return isNaN(e)?isNaN(t)?null:t:isNaN(t)?e:i(e,t)},l.prototype._getSelectionStartAndEnd=function(e,t,i){var s=this.getElementsInRange(this.createRange(e,t));if(null==s||s.length===i)return{min:e,max:t};for(var o={row:this._getMinOrMax(e.row,t.row,Math.min),column:this._getMinOrMax(e.column,t.column,Math.min)},n={row:this._getMinOrMax(e.row,t.row,Math.max),column:this._getMinOrMax(e.column,t.column,Math.max)},r=0;r<s.length;r++){var l=this.getCellIndexes(s[r]),a=this.getCellEndIndexes(s[r]);(l.row<o.row||null==o.row)&&(o.row=l.row),(l.column<o.column||null==o.column)&&(o.column=l.column),(a.row>n.row||null==n.row)&&(n.row=a.row),(a.column>n.column||null==n.column)&&(n.column=a.column)}return this._getSelectionStartAndEnd(o,n,s.length)},l.prototype._getLastAnchoredSelectionIndex=function(e,t){var i;for(i=e.length-1;i>-1;i--)if(this._isContainSelection(t,[e[i]]))return i;return i-1},l.prototype._extendSelectionCallback=function(e,t,i){var s=this.GetSelection(),o=this._getLastAnchoredSelectionIndex(s,t),n=s[o];if(null!=n){var r=n.startIndex.row===i.startIndex.row;null!=n.startIndex.column&&null!=i.startIndex.column&&(r=r&&n.startIndex.column===i.startIndex.column);var l=n.endIndex.row===i.endIndex.row;if(null!=n.endIndex.column&&null!=i.endIndex.column&&(l=l&&n.endIndex.column===i.endIndex.column),!r||!l){var a;if(this.m_discontiguousSelection||e&&this.m_utils.ctrlEquivalent(e)&&0===e.button?(a=s.slice(0),this.unhighlightRange(n),a.splice(o,1)):(a=[],this.unhighlightSelection()),a.push(i),this.m_selection=a,this.m_discontiguousSelection||e&&this.m_utils.ctrlEquivalent(e)&&0===e.button)for(var h=0;h<this.m_selection.length;h++)this.highlightRange(this.m_selection[h]);else this.highlightRange(i,!0);this._makeSelectionFrontierFocus(),this._compareSelectionAndFire(e,s)}}},l.prototype._resetSelectionFrontierFocus=function(){if(!(null==this.m_selectionFrontier||this._isDatabodyCellActive()&&this.m_selectionFrontier.row===this.m_active.indexes.row&&this.m_selectionFrontier.column===this.m_active.indexes.column)){var e=this.createRange(this.m_selectionFrontier),t=this.getElementsInRange(e);null!=t&&t.length>0&&this._unsetAriaProperties(t[0])}},l.prototype._makeSelectionFrontierFocus=function(){if(!(null==this.m_selectionFrontier||this._isDatabodyCellActive()&&this.m_selectionFrontier.row===this.m_active.indexes.row&&this.m_selectionFrontier.column===this.m_active.indexes.column)){if(this._isDatabodyCellActive()){var e=this.createRange(this.m_active.indexes),t=this.getElementsInRange(e);null!=t&&t.length>0&&this._unsetAriaProperties(t[0])}var i=this.createRange(this.m_selectionFrontier),s=this.getElementsInRange(i);if(null!=s&&0!==s.length){this._updateContextInfo(this.m_selectionFrontier);var o=this.m_utils.containsCSSClassName(s[0],this.getMappedStyle("row"))?s[0].firstChild:s[0];this._setAriaProperties(this._createActiveObject(o),null,o)}}},l.prototype._selectHeader=function(e,t,i,s){var o,n;if(-1!==e.indexOf("row")&&this.m_rowHeaderLevelCount-1===i||-1!==e.indexOf("column")&&this.m_columnHeaderLevelCount-1===i)o=t,n=t;else{var r=this._getActiveElement();n=(o=this._getAttribute(r.parentNode,"start",!0))+(this._getAttribute(r.parentNode,"extent",!0)-1)}-1!==e.indexOf("row")?((o===n&&!this.isMultipleSelection()||this.isMultipleSelection())&&(this.setHeaderSelectionFrontier(e,n,t,i,s.target,!0),this._selectEntireRow(o,n,s)),this._setAccInfoText("accessibleRowSelected",{row:t+1})):-1!==e.indexOf("column")&&(this.setHeaderSelectionFrontier(e,n,t,i,s.target,!0),this._selectEntireColumn(o,n,s),this._setAccInfoText("accessibleColumnSelected",{column:t+1})),this.isMultipleSelection()&&(this.m_headerDragState=!0)},l.prototype.setHeaderSelectionFrontier=function(e,t,i,s,o,n){n&&(this.m_selectionFrontier={}),this.m_selectionFrontier.axis=e,this.m_selectionFrontier.end=t,this.m_selectionFrontier.index=i,this.m_selectionFrontier.level=s,this.m_selectionFrontier.target=o},l.prototype.updateSelectionHeader=function(){this.m_selectionFrontier&&this.m_selectionFrontier.target&&(this.m_utils.isTouchDevice()&&(this.m_touchSelectAnchor=this.m_selection[this.m_selection.length-1].startIndex),this.extendSelectionHeader(this.m_selectionFrontier.target,null))},l.prototype.selectAndFocus=function(e,t,i){null==i&&(i=!1),this._resetSelectionFrontierFocus(),this._setActiveByIndex(e,t),"row"===this.m_options.getSelectionMode()&&(e=this.createIndex(e.row));var s=this._getSelectionStartAndEnd(e,e,0),o=s.min,n=s.max;"row"===this.m_options.getSelectionMode()&&(o=this.createIndex(o.row),n=this.createIndex(n.row)),this._createRangeWithKeys(o,n,this._selectAndFocusRangeCallback.bind(this,o,t,i))},l.prototype._selectAndFocusRangeCallback=function(e,t,i,s){var o=this.GetSelection(),n=o.slice(0);i||(this.m_discontiguousSelection||!t||this.isMultipleSelection()&&this.m_utils.ctrlEquivalent(t)&&0===t.button?!this._isDatabodyCellActive()||null==this.m_prevActive||"cell"!==this.m_prevActive.type||this.m_selectionFrontier.row!==this.m_prevActive.indexes.row||this.m_selectionFrontier.column!==this.m_prevActive.indexes.column||this.m_utils.isTouchDevice()||!t.keyCode&&this.isMultipleSelection()||(n.pop(),this._isContainSelection(this.m_prevActive.indexes,n)||this._unhighlightElement(this._getCellByIndex(this.m_prevActive.indexes),["selected","topSelected","bottomSelected"])):(this.unhighlightSelection(),n=[])),this.m_selectionFrontier=e,n.push(s),this.m_selection=n,this.highlightRange(s),this._compareSelectionAndFire(t,o)},l.prototype._compareSelectionAndFire=function(e,t){var i=this.GetSelection();this.m_utils.isTouchDevice()&&this.isMultipleSelection()&&i.length>0&&(this._addTouchSelectionAffordance(e),this._moveTouchSelectionAffordance()),this._compareSelections(i,t)||this.fireSelectionEvent(e,t)},l.prototype._addTouchSelectionAffordance=function(e){if(null==this.m_topSelectIconContainer&&null==this.m_bottomSelectIconContainer){var t=this.getResources().isRTLMode()?"right":"left",i=this._getTouchSelectionAffordanceSize(),s=e.target,o=this.findCell(s);if(o||(o=this.findHeader(s)),!o)return;var n=o[this.getResources().getMappedAttribute("context")],r=this.getElementDir(o,"top"),l=r+this.getElementHeight(o);this.m_topSelectIconContainer=document.createElement("div"),this.m_topSelectIconContainer.className=this.getMappedStyle("toucharea"),this.setElementDir(this.m_topSelectIconContainer,r-i/2,"top");var a=document.createElement("div");a.className=this.getMappedStyle("selectaffordancetop"),a.setAttribute("role","button"),a.setAttribute("aria-label",this.getResources().getTranslatedText("accessibleSelectionAffordanceTop")),this.m_topSelectIconContainer.appendChild(a),this.m_bottomSelectIconContainer=document.createElement("div"),this.m_bottomSelectIconContainer.className=this.getMappedStyle("toucharea"),this.setElementDir(this.m_bottomSelectIconContainer,l-i/2,"top");var h,d=document.createElement("div");d.className=this.getMappedStyle("selectaffordancebottom"),d.setAttribute("role","button"),d.setAttribute("aria-label",this.getResources().getTranslatedText("accessibleSelectionAffordanceBottom")),this.m_bottomSelectIconContainer.appendChild(d),"row"===this.m_options.getSelectionMode()?(h=this.getElementWidth(this.m_databody)/2+this.m_currentScrollLeft-i/2,this.setElementDir(this.m_topSelectIconContainer,h,t),this.setElementDir(this.m_bottomSelectIconContainer,h,t)):n.axis&&-1!==n.axis.indexOf("row")?(h=this.getElementWidth(this.m_databody)/2+this.m_currentScrollLeft-i/2,this.setElementDir(this.m_topSelectIconContainer,h,t),this.setElementDir(this.m_bottomSelectIconContainer,h,t)):n.axis&&-1!==n.axis.indexOf("column")?(r=this.getElementHeight(this.m_databody)/2+this.m_currentScrollTop-i/2,this.setElementDir(this.m_topSelectIconContainer,r,"top"),this.setElementDir(this.m_bottomSelectIconContainer,r,"top"),h=this.getElementDir(o,t)-i/2,this.setElementDir(this.m_topSelectIconContainer,h,t),this.setElementDir(this.m_bottomSelectIconContainer,h+this.calculateColumnWidth(o),t)):(h=this.getElementDir(o,t)-i/2,this.setElementDir(this.m_topSelectIconContainer,h,t),this.setElementDir(this.m_bottomSelectIconContainer,h+this.calculateColumnWidth(o),t)),this.m_databody.firstChild.appendChild(this.m_topSelectIconContainer),this.m_databody.firstChild.appendChild(this.m_bottomSelectIconContainer)}},l.prototype._removeTouchSelectionAffordance=function(){this._isDatabodyCellActive()&&this.m_topSelectIconContainer&&this.m_topSelectIconContainer.parentNode&&(this.m_topSelectIconContainer.parentNode.removeChild(this.m_topSelectIconContainer),this.m_bottomSelectIconContainer.parentNode.removeChild(this.m_bottomSelectIconContainer))},l.prototype._moveTouchSelectionAffordance=function(){var e,t,i=this.getResources().isRTLMode()?"right":"left",s=this.GetSelection();if(s.length>0){var o=this.m_options.getSelectionMode(),n=this._getTouchSelectionAffordanceSize();if(null!=this.m_topSelectIconContainer&&null!=this.m_bottomSelectIconContainer){if("row"===o)e=this._getAxisCellsByKey(s[s.length-1].startKey.row,"row"),t=this._getAxisCellsByKey(s[s.length-1].endKey.row,"row"),this.setElementDir(this.m_topSelectIconContainer,this.getElementDir(e[0],"top")-n/2,"top"),this.setElementDir(this.m_bottomSelectIconContainer,this.getElementDir(t[0],"top")+this.getElementHeight(t[0])-n/2,"top");else if(-1!==s[s.length-1].endIndex.row&&-1===s[s.length-1].endIndex.column){e=this._getAxisCellsByKey(s[s.length-1].startKey.row,"row"),t=this._getAxisCellsByKey(s[s.length-1].endKey.row,"row"),this.setElementDir(this.m_topSelectIconContainer,this.getElementDir(e[0],"top")-n/2,"top"),this.setElementDir(this.m_bottomSelectIconContainer,this.getElementDir(t[0],"top")+this.getElementHeight(t[0])-n/2,"top");var r=this.getElementWidth(this.m_databody)/2+this.m_currentScrollLeft-n/2;this.setElementDir(this.m_topSelectIconContainer,r,i),this.setElementDir(this.m_bottomSelectIconContainer,r,i)}else if(-1!==s[s.length-1].endIndex.column&&-1===s[s.length-1].endIndex.row){e=this._getAxisCellsByKey(s[s.length-1].startKey.column,"column"),t=this._getAxisCellsByKey(s[s.length-1].endKey.column,"column");var l=this.getElementHeight(this.m_databody)/2+this.m_currentScrollTop-n/2;this.setElementDir(this.m_topSelectIconContainer,l,"top"),this.setElementDir(this.m_bottomSelectIconContainer,l,"top"),this.setElementDir(this.m_topSelectIconContainer,this.getElementDir(e[0],"left")-n/2,"left"),this.setElementDir(this.m_bottomSelectIconContainer,this.getElementDir(t[0],"left")+this.getElementWidth(t[0])-n/2,"left")}else{var a=this._getCellByIndex(s[s.length-1].startIndex),h=this._getCellByIndex(s[s.length-1].endIndex);this.setElementDir(this.m_topSelectIconContainer,this.getElementDir(a,"top")-n/2,"top"),this.setElementDir(this.m_bottomSelectIconContainer,this.getElementDir(h,"top")+this.getElementHeight(h)-n/2,"top"),this.setElementDir(this.m_topSelectIconContainer,this.getElementDir(a,i)-n/2,i),this.setElementDir(this.m_bottomSelectIconContainer,this.getElementDir(h,i)+this.getElementWidth(h)-n/2,i)}null==this.m_topSelectIconContainer.parentNode&&(this.m_databody.firstChild.appendChild(this.m_topSelectIconContainer),this.m_databody.firstChild.appendChild(this.m_bottomSelectIconContainer))}}},l.prototype._scrollTouchSelectionAffordance=function(){var e,t,i=this.m_options.getSelectionMode();if("row"===i)null!=this.m_topSelectIconContainer&&(t=this.getResources().isRTLMode()?"right":"left",e=this.getElementWidth(this.m_databody)/2+this.m_currentScrollLeft,this.setElementDir(this.m_topSelectIconContainer,e,t),this.setElementDir(this.m_bottomSelectIconContainer,e,t));else if("cell"===i&&this.isHeaderSelectionType(this.m_selectionFrontier)&&null!=this.m_topSelectIconContainer)if(-1!==this.m_selectionFrontier.axis.indexOf("row"))t=this.getResources().isRTLMode()?"right":"left",e=this.getElementWidth(this.m_databody)/2+this.m_currentScrollLeft,this.setElementDir(this.m_topSelectIconContainer,e,t),this.setElementDir(this.m_bottomSelectIconContainer,e,t);else{var s=this.getElementHeight(this.m_databody)/2+this.m_currentScrollTop;this.setElementDir(this.m_topSelectIconContainer,s,"top"),this.setElementDir(this.m_bottomSelectIconContainer,s,"top")}},l.prototype._getTouchSelectionAffordanceSize=function(){if(null==this.m_touchSelectionAffordanceSize){var e=document.createElement("div");e.className=this.getMappedStyle("toucharea"),e.style.visibilty="hidden",e.style.top="0px",e.style.visibilty="0px",this.m_root.appendChild(e);var t=e.offsetWidth;this.m_root.removeChild(e),this.m_touchSelectionAffordanceSize=t}return this.m_touchSelectionAffordanceSize},l.SORT_ANIMATION_DURATION=800,l.prototype._handleSortMouseOver=function(e){if(!this._databodyEmpty()){var t=e.target,i=this.findHeader(t);i&&this._showOrHideSortIcon(i,!1),(this.m_utils.containsCSSClassName(t,this.getMappedStyle("sortascending"))||this.m_utils.containsCSSClassName(t,this.getMappedStyle("sortdescending")))&&this.m_utils.addCSSClassName(t,this.getMappedStyle("hover"))}},l.prototype._handleSortMouseOut=function(e){if(!this._databodyEmpty()){var t=e.target,i=e.relatedTarget,s=this.findHeader(t);null!=s&&null!=i&&s===this.findHeader(i)||this._showOrHideSortIcon(s,!0),(this.m_utils.containsCSSClassName(t,this.getMappedStyle("sortascending"))||this.m_utils.containsCSSClassName(t,this.getMappedStyle("sortdescending")))&&(this.m_utils.removeCSSClassName(t,this.getMappedStyle("hover")),this.m_utils.removeCSSClassName(t,this.getMappedStyle("selected")))}},l.prototype._handleSortIconMouseDown=function(e){this._databodyEmpty()||this.m_utils.addCSSClassName(e,this.getMappedStyle("selected"))},l.prototype._toggleSortIconDirection=function(e,t){if(null!=e){var i=this._getSortIcon(e);"descending"===t&&this.m_utils.containsCSSClassName(i,this.getMappedStyle("sortascending"))?(this.m_utils.removeCSSClassName(i,this.getMappedStyle("sortascending")),this.m_utils.addCSSClassName(i,this.getMappedStyle("sortdescending"))):"ascending"===t&&this.m_utils.containsCSSClassName(i,this.getMappedStyle("sortdescending"))&&(this.m_utils.removeCSSClassName(i,this.getMappedStyle("sortdescending")),this.m_utils.addCSSClassName(i,this.getMappedStyle("sortascending")))}},l.prototype._showOrHideSortIcon=function(e,t){var i=!1;if(null!=e){var s=this._getSortIcon(e);null!=this.m_sortInfo&&(i=this.m_sortInfo.key===this._getKey(e)),!1!==t||i?!0!==t||i||(this.m_utils.removeCSSClassName(s,this.getMappedStyle("default")),this.m_utils.addCSSClassName(s,this.getMappedStyle("disabled"))):(this.m_utils.removeCSSClassName(s,this.getMappedStyle("disabled")),this.m_utils.addCSSClassName(s,this.getMappedStyle("default")))}},l.prototype._buildSortIcon=function(e){var t=document.createElement("div");t.className=this.getMappedStyle("sortcontainer");var i=document.createElement("div"),s=this.getMappedStyle("icon")+" "+this.getMappedStyle("clickableicon"),o=null!=this.m_sortInfo?this.m_sortInfo.key:null;if(e.key===o){var n=null!=this.m_sortInfo?this.m_sortInfo.direction:null;"ascending"===n?i.className=this.getMappedStyle("sortascending")+" "+s+" "+this.getMappedStyle("default"):"descending"===n&&(i.className=this.getMappedStyle("sortdescending")+" "+s+" "+this.getMappedStyle("default"))}else s+=" "+this.getMappedStyle("disabled"),i.className=this.getMappedStyle("sortascending")+" "+s;return t.appendChild(i),t},l.prototype._handleKeyboardSort=function(e,t){if(!this._databodyEmpty()){var i=e.getAttribute(this.getResources().getMappedAttribute("sortDir"));i=null==i||"descending"===i?"ascending":"descending",this._doHeaderSort(t,e,i)}},l.prototype._handleHeaderSort=function(e,t){if(!this._databodyEmpty()){var i=e.target,s=this.findHeader(i);null!=s&&(null==t&&(t=null!=this.m_sortInfo&&this.m_sortInfo.key===this._getKey(s)&&"ascending"===this.m_sortInfo.direction?"descending":"ascending"),this._doHeaderSort(e,s,t))}},l.prototype._handleCellSort=function(e,t,i){null==i||this._databodyEmpty()||(this._removeTouchSelectionAffordance(),this._doHeaderSort(e,i,t))},l.prototype._doHeaderSort=function(e,t,i){if(!0!==this.m_isSorting){this.m_delayedSort=null;var s=this._getKey(t),o=this._getAxis(t);if(this._removeSortSelection(),t.setAttribute(this.getResources().getMappedAttribute("sortDir"),i),this.m_sortInfo={event:e,key:s,axis:o,direction:i},this._toggleSortIconDirection(t,i),this._addSortSelection(),null!=i&&null!=s&&null!=o){this.m_isSorting=!0,this.showStatusText();var n={axis:o,key:s,direction:i};this.getDataSource().sort(n,{success:this._handleSortSuccess.bind(this),error:this._handleSortError.bind(this)})}this._setAccInfoText("ascending"===i?"accessibleSortAscending":"accessibleSortDescending",{id:s})}else this.m_delayedSort={event:e,header:t,direction:i}},l.prototype._handleSortError=function(){this.hideStatusText()},l.prototype._removeSortSelection=function(){if(null!=this.m_sortInfo){var e=this._findHeaderByKey(this.m_sortInfo.key,this.m_colHeader,this.getMappedStyle("colheadercell"));e.removeAttribute(this.getResources().getMappedAttribute("sortDir"));var t=this._getSortIcon(e);this._toggleSortIconDirection(e,"ascending"),"descending"===this.m_sortInfo.direction&&(this.m_utils.removeCSSClassName(t,this.getMappedStyle("sortdescending")),this.m_utils.addCSSClassName(t,this.getMappedStyle("sortascending"))),this.m_utils.addCSSClassName(t,this.getMappedStyle("disabled")),this.m_utils.removeCSSClassName(t,this.getMappedStyle("default")),this.m_utils.removeCSSClassName(this._getSortContainer(e),this.getMappedStyle("enabled"))}},l.prototype._addSortSelection=function(){if(null!=this.m_sortInfo){var e=this._findHeaderByKey(this.m_sortInfo.key,this.m_colHeader,this.getMappedStyle("colheadercell")),t=this._getSortIcon(e);this.m_utils.addCSSClassName(t,this.getMappedStyle("default")),this.m_utils.removeCSSClassName(t,this.getMappedStyle("disabled")),this.m_utils.removeCSSClassName(t,this.getMappedStyle("selected")),this.m_utils.addCSSClassName(this._getSortContainer(e),this.getMappedStyle("enabled"))}},l.prototype._getAxis=function(e){var t=this.getMappedStyle("colheadercell"),i=this.getMappedStyle("rowheadercell");return this.m_utils.containsCSSClassName(e,t)?"column":this.m_utils.containsCSSClassName(e,i)?"row":null},l.prototype._handleSortSuccess=function(){this.hideStatusText(),this._isDatabodyCellActive()?this._indexes({row:this.m_active.keys.row,column:this.m_active.keys.column},this._handlePreSortScrolling):this._fetchForSort(this.m_startRow,this.m_endRow-this.m_startRow+1,!1)},l.prototype._handlePreSortScrolling=function(e){var t=(-1===e.row?0:e.row)*this.m_avgRowHeight,i=t+this.m_avgRowHeight,s=this._isHighWatermarkScrolling();if(this.m_currentScrollTop<=t&&i<=this.m_currentScrollTop+this.getElementHeight(this.m_databody)||s)this._fetchForSort(this.m_startRow,this.m_endRow-this.m_startRow+1,!1);else{this.m_currentScrollTop=Math.min(t,this._getMaxScrollHeight());var o=Math.floor(this.m_currentScrollTop/this.m_avgRowHeight),n=o*this.m_avgRowHeight;this.m_startRow=o,this.m_endRow=-1,this.m_startRowHeader=o,this.m_endRowHeader=-1,this.m_startRowPixel=n,this.m_endRowPixel=n,this.m_startRowHeaderPixel=n,this.m_endRowHeaderPixel=n,this._fetchForSort(o,null,!0)}},l.prototype._fetchForSort=function(e,t,i){var s=document.createDocumentFragment(),o=document.createDocumentFragment();this.fetchHeaders("row",e,s,o,t,{success:this.handleHeadersFetchSuccessForSort.bind(this),error:this.handleCellsFetchError}),this.fetchCells(this.m_databody,e,this.m_startCol,t,this.m_endCol-this.m_startCol+1,{success:this.handleCellsFetchSuccessForSort.bind(this,s,o,i),error:this.handleCellsFetchError})},l.prototype.handleHeadersFetchSuccessForSort=function(e,t,i,s){var o,n,r,l,a,h,d,m=t.axis,c=t.start,u=t.header,_=t.endHeader;if(this.m_fetching[m]=!1,null!=e){for(o=e.getCount(),l=0,n=0,h=this.getMappedStyle("headercell")+" "+this.getMappedStyle("rowheadercell"),d=this.m_options.getRenderer("row");o-n>0;)r=c+n,n+=(a=this.buildLevelHeaders(u,r,0,0,this.m_startRowPixel+l,!0,s,d,e,"row",h,this.m_rowHeaderLevelCount)).count,l+=a.totalHeaderDimension;this.m_endRowHeader=this.m_startRowHeader+(o-1),this.m_endRowHeaderPixel=this.m_startRowHeaderPixel+l}if(null!=i){for(o=i.getCount(),l=0,n=0,h=this.getMappedStyle("endheadercell")+" "+this.getMappedStyle("rowendheadercell"),d=this.m_options.getRenderer("rowEnd");o-n>0;)r=c+n,n+=(a=this.buildLevelHeaders(_,r,0,0,this.m_startRowPixel+l,!0,s,d,i,"rowEnd",h,this.m_rowEndHeaderLevelCount)).count,l+=a.totalHeaderDimension;this.m_endRowEndHeader=this.m_startRowEndHeader+(o-1),this.m_endRowEndHeaderPixel=this.m_startRowEndHeaderPixel+l}this._signalTaskEnd()},l.prototype.handleCellsFetchSuccessForSort=function(e,t,i,s,o){var n;this.m_fetching.cells=!1;var r=l.SORT_ANIMATION_DURATION;this.isFetchComplete()&&this.hideStatusText();var a=o[0].start,h=s.getCount("row"),d=o[1].start,m=document.createDocumentFragment(),c=this._addCellsToFragment(m,s,a,this.m_startRowPixel,d,this.m_startColPixel);this.m_endRow=this.m_startRow+(h-1),this.m_endRowPixel=this.m_startRowPixel+c.totalRowHeight;var u=this.m_databody.firstChild,_=this.m_rowHeader.firstChild,p=this.m_rowEndHeader.firstChild;!0===i&&(n=this._isHighWatermarkScrolling(),this.m_utils.isTouchDevice()?(this._disableTouchScrollAnimation(),this.scrollTo(this.m_currentScrollLeft,this.m_currentScrollTop)):(this.m_silentScroll=!0,this.m_databody.scrollTop=this.m_currentScrollTop,this._syncScroller())),!r||0===r||!this.m_utils.supportsTransitions()||1===h||this.m_rowHeaderLevelCount>1&&null!=this.m_rowHeaderLevelCount||!1===n?(this._signalTaskStart(),this._handleSortEnd(m,e,t)):this.processSortAnimationToPosition(r,0,"ease-in",_,e,u,m,p,t),this._signalTaskEnd()},l.prototype._handleSortEnd=function(e,t,i){var s;t.childNodes.length>1&&(s=this.m_rowHeader.firstChild,this.m_utils.empty(s),s.appendChild(t)),i.childNodes.length>1&&(s=this.m_rowEndHeader.firstChild,this.m_utils.empty(s),s.appendChild(i));var o=this.m_databody.firstChild;this._emptyDatabody(o),this._populateDatabody(o,e),this._fireSortEvent(),this._restoreActive(),this.m_isSorting=!1,this._doDelayedSort(),this.m_animating=!1,this._signalTaskEnd(),this._runModelEventQueue()},l.prototype.processSortAnimationToPosition=function(e,t,i,s,o,n,r,l,a){var h,d,m,c,u,_,p,g,C,f,v,y=this;this._signalTaskStart();var E=o.childNodes.length>1,S=a.childNodes.length>1,w=this.getResources().isRTLMode()?"right":"left",H=this._getViewportBottom(),b=this._getViewportLeft(),x=this._getViewportRight(),R={},M={};for(c=0;c<n.childNodes.length;c++)u=n.childNodes[c],h=this._getKey(u,"row"),v=(f=this.getElementDir(u,w))+this.getElementWidth(u),_=(d=this.getElementDir(u,"top"))+this.getElementHeight(u),this._isCellBoundryInViewport(f,v,d,_)&&(R[h]?R[h].cell.push(u):(m=H,R[h]={cell:[u],oldTop:d,newTop:m}),m-d!=0&&(g=u));for(c=0;c<s.childNodes.length;c++)E&&(u=s.childNodes[c],h=this._getKey(u,"row"),_=(d=this.getElementDir(u,"top"))+this.getElementHeight(u),this._isCellBoundryInViewport(b,x,d,_)&&(m=H,R[h]||(R[h]={oldTop:d,newTop:m}),R[h].rowHeader=u));for(c=0;c<l.childNodes.length;c++)E&&(u=l.childNodes[c],h=this._getKey(u,"row"),_=(d=this.getElementDir(u,"top"))+this.getElementHeight(u),this._isCellBoundryInViewport(b,x,d,_)&&(m=H,R[h]||(R[h]={oldTop:d,newTop:m}),R[h].rowEndHeader=u));for(c=0;c<r.childNodes.length;c++)if(u=r.childNodes[c],h=this._getKey(u,"row"),m=this.getElementDir(u,"top"),R[h])R[h].newTop=m;else if(d=H,p=m+this.getElementHeight(u),v=(f=this.getElementDir(u,w))+this.getElementWidth(u),this._isCellBoundryInViewport(f,v,m,p)){var I=u.cloneNode(!0);I[this.getResources().getMappedAttribute("context")]=u[this.getResources().getMappedAttribute("context")],this.setElementDir(I,d,"top"),n.appendChild(I),M[h]?M[h].cell.push(I):M[h]={cell:[I],oldTop:d,newTop:m,add:!0},m-d!=0&&(g=I)}for(c=0;c<o.childNodes.length;c++)if(E){var A=o.childNodes[c];h=this._getKey(A,"row"),R[h]||(p=(m=this.getElementDir(A,"top"))+this.getElementHeight(A),d=H,this._isCellBoundryInViewport(b,x,m,p)&&((C=A.cloneNode(!0))[this.getResources().getMappedAttribute("context")]=A[this.getResources().getMappedAttribute("context")],this.setElementDir(C,d,"top"),s.appendChild(C),M[h]||(M[h]={oldTop:d,newTop:m,add:!0}),M[h].rowHeader=C))}for(c=0;c<a.childNodes.length;c++)if(S){var T=a.childNodes[c];h=this._getKey(T,"row"),R[h]||(p=(m=this.getElementDir(T,"top"))+this.getElementHeight(T),d=H,this._isCellBoundryInViewport(b,-1,m,p)&&((C=T.cloneNode(!0))[this.getResources().getMappedAttribute("context")]=T[this.getResources().getMappedAttribute("context")],this.setElementDir(C,d,"top"),l.appendChild(C),M[h].rowEndHeader=C,M[h]||(M[h]={oldTop:d,newTop:m,add:!0})))}if(null!=g){var D=this._handleSortEnd.bind(this,r,o,a);y._onTransitionEnd(g,D,e),this.m_animating=!0,setTimeout(function(){var s,o,n,r,l,a=Object.keys(R);for(l=0;l<a.length;l++){if(h=a[l],n=R[a[l]],o=t+"ms",s=n.newTop-n.oldTop,n.cell)for(r=0;r<n.cell.length;r++)y.addTransformMoveStyle(n.cell[r],e/2+"ms",o,i,0,s,0);E&&n.rowHeader&&y.addTransformMoveStyle(n.rowHeader,e/2+"ms",o,i,0,s,0),S&&n.rowEndHeader&&y.addTransformMoveStyle(n.rowEndHeader,e/2+"ms",o,i,0,s,0)}for(a=Object.keys(M),l=0;l<a.length;l++){if(h=a[l],n=M[a[l]],o=t*r+"ms",s=n.newTop-n.oldTop,n.cell)for(var d=0;d<n.cell.length;d++)y.addTransformMoveStyle(n.cell[d],e/2+"ms",o,i,0,s,0);E&&n.rowHeader&&y.addTransformMoveStyle(n.rowHeader,e/2+"ms",o,i,0,s,0),S&&n.rowEndHeader&&y.addTransformMoveStyle(n.rowEndHeader,e/2+"ms",o,i,0,s,0)}},0)}else this._handleSortEnd(r,o,a)},l.prototype._restoreActive=function(){if(null!=this.m_active){var e=this.m_active.axis,t=this.m_sortInfo.originalEvent;if("cell"===this.m_active.type){var i=this._getCellByKeys(this.m_active.keys);if(null!=i){var s=this.getCellIndexes(i);this._isSelectionEnabled()?this.selectAndFocus(s,t):this._setActiveByIndex(s,t)}else this._setActive(null,null,t,!0),this._isSelectionEnabled()&&this._clearSelection(t)}else if("row"===e||"rowEnd"===e){var o="row"===e?this.m_rowHeader:this.m_rowEndHeader,n="row"===e?this.getMappedStyle("rowheadercell"):this.getMappedStyle("rowendheadercell"),r=this._findHeaderByKey(this.m_active.key,o,n);if(null!=r){var l=r[this.getResources().getMappedAttribute("context")];this._setActive(r,{type:"header",axis:e,index:l.index,key:l.key,level:l.level},t)}else this._setActive(null,null,t)}}},l.prototype._getSortIcon=function(e){return e.lastChild.firstChild},l.prototype._getSortContainer=function(e){return e.lastChild},l.prototype._fireSortEvent=function(){var e={event:this.m_sortInfo.event,ui:{header:this.m_sortInfo.key,direction:this.m_sortInfo.direction}};this.fireEvent("sort",e)},l.prototype._doDelayedSort=function(){null!=this.m_delayedSort?this._doHeaderSort(this.m_delayedSort.event,this.m_delayedSort.header,this.m_delayedSort.direction):this.fillViewport()},l.RESIZE_OFFSET=5,l.RESIZE_TOUCH_OFFSET=8,l.prototype.handleResize=function(e){if(!1===this.m_isResizing){var t=this.find(e.target,"header");null==t&&(t=this.find(e.target,"endheader")),null==t||t!==this.m_rowHeader&&t!==this.m_colHeader&&t!==this.m_rowEndHeader&&t!==this.m_colEndHeader||(this.m_cursor=this.manageHeaderCursor(e),null!=this.m_resizingElement&&("default"===this.m_cursor?(this.m_resizingElement.style.cursor="",null!=this.m_resizingElementSibling&&(this.m_resizingElementSibling.style.cursor="")):(this.m_resizingElement.style.cursor=this.m_cursor,null!=this.m_resizingElementSibling&&(this.m_resizingElementSibling.style.cursor=this.m_cursor))))}else this.handleResizeMouseMove(e)},l.prototype.handleResizeMouseDown=function(e){return("col-resize"===this.m_cursor||"row-resize"===this.m_cursor)&&(this.m_isResizing=!0,this.m_utils.isTouchDevice()?(this.m_lastMouseX=e.touches[0].pageX,this.m_lastMouseY=e.touches[0].pageY):(document.addEventListener("mousemove",this.m_docMouseMoveListener,!1),document.addEventListener("mouseup",this.m_docMouseUpListener,!1),this.m_lastMouseX=e.pageX,this.m_lastMouseY=e.pageY),this.m_overResizeLeft=0,this.m_overResizeMinLeft=0,this.m_overResizeTop=0,this.m_overResizeMinTop=0,this.m_overResizeRight=0,this.m_overResizeBottom=0,this.m_orginalResizeDimensions={width:this.getElementWidth(this.m_resizingElement),height:this.getElementHeight(this.m_resizingElement)},!0)},l.prototype.handleResizeMouseUp=function(e){if(!0===this.m_isResizing){var t=this.getElementWidth(this.m_resizingElement),i=this.getElementHeight(this.m_resizingElement);if(t!==this.m_orginalResizeDimensions.width||i!==this.m_orginalResizeDimensions.height){var s="col-resize"===this.m_cursor?this.m_resizingElement.style.width:this.m_resizingElement.style.height,o={event:e,ui:{header:this._getKey(this.m_resizingElement),oldDimensions:{width:this.m_orginalResizeDimensions.width,height:this.m_orginalResizeDimensions.height},newDimensions:{width:this.getElementWidth(this.m_resizingElement),height:this.getElementHeight(this.m_resizingElement)},size:s}};this.fireEvent("resize",o)}this.m_isResizing=!1,this.m_cursor="default",this.m_resizingElement.style.cursor="",null!=this.m_resizingElementSibling&&(this.m_resizingElementSibling.style.cursor=""),this.m_resizingElement=null,this.m_resizingElementMin=null,this.m_resizingElementSibling=null,this.m_orginalResizeDimensions=null,document.removeEventListener("mousemove",this.m_docMouseMoveListener,!1),document.removeEventListener("mouseup",this.m_docMouseUpListener,!1)}},l.prototype._isDOMElementResizable=function(e){return null!=e&&"true"===e.getAttribute(this.getResources().getMappedAttribute("resizable"))},l.prototype.manageHeaderCursor=function(e){var t,i,s,o,n,r,a,h,d=this.find(e.target,"headercell");if(d||(d=this.find(e.target,"endheadercell")),!d)return"default";var m=this.getHeaderCellAxis(d),c=this.getHeaderCellIndex(d),u=this.getHeaderCellLevel(d);"column"===m?(n="enable"===this.m_options.isResizable(m,"height"),o=this._isDOMElementResizable(d),a=this._getHeaderByIndex(c-1,u,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader),r=this._isDOMElementResizable(a),h=this._getHeaderByIndex(c,u-1,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader)):"row"===m?(o="enable"===this.m_options.isResizable(m,"width"),n=this._isDOMElementResizable(d),a=this._getHeaderByIndex(c-1,u,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader),r=this._isDOMElementResizable(a),h=this._getHeaderByIndex(c,u-1,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader)):"columnEnd"===m?(n="enable"===this.m_options.isResizable(m).height,o=this._isDOMElementResizable(d),a=this._getHeaderByIndex(c-1,u,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader),r=this._isDOMElementResizable(a),h=this._getHeaderByIndex(c,u-1,this.m_colEndHeader,this.m_columnEndHeaderLevelCount,this.m_startColEndHeader)):"rowEnd"===m&&(o="enable"===this.m_options.isResizable(m).width,n=this._isDOMElementResizable(d),a=this._getHeaderByIndex(c-1,u,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader),r=this._isDOMElementResizable(a),h=this._getHeaderByIndex(c,u-1,this.m_rowEndHeader,this.m_rowEndHeaderLevelCount,this.m_startRowEndHeader)),this.m_utils.isTouchDevice()?(t=e.touches[0].pageX,i=e.touches[0].pageY,s=l.RESIZE_TOUCH_OFFSET):(t=e.pageX,i=e.pageY,s=l.RESIZE_OFFSET);var _=this.getHeaderEdgePixels(d),p=this.getResources().isRTLMode(),g="columnEnd"===m||"rowEnd"===m,C=t<_[0]+s,f=i<_[1]+s,v=t>_[2]-s,y=i>_[3]-s;if("column"===m||"columnEnd"===m){if(o&&(p?C:v))return this.m_resizingElement=d,"col-resize";if(r&&(p?v:C)){if(this.m_resizingElement=a,this.m_resizingElementSibling=d,null!==this.m_resizingElement)return"col-resize"}else if(n){if(!g&&y||g&&f)return this.m_resizingElement=d,"row-resize";if(!g&&f||g&&y)return this.m_resizingElement=h,this.m_resizingElementSibling=d,"row-resize"}}else if("row"===m||"rowEnd"===m){if(n&&y)return this.m_resizingElement=d,"row-resize";if(r&&f&&(this.m_resizingElement=a,this.m_resizingElementSibling=d,null!==this.m_resizingElement))return"row-resize";if(o){if(!g&&(p?C:v)||g&&(p?v:C))return this.m_resizingElement=d,"col-resize";if((!g&&(p?v:C)||g&&(p?C:v))&&(this.m_resizingElement=h,this.m_resizingElementSibling=d,null!==this.m_resizingElement))return"col-resize"}}return"default"},l.prototype.handleResizeMouseMove=function(e){var t,i,s,o,n;this.m_currentMouseX=e.pageX,this.m_currentMouseY=e.pageY,this.m_utils.isTouchDevice()?(this.m_currentMouseX=e.touches[0].pageX,this.m_currentMouseY=e.touches[0].pageY):(this.m_currentMouseX=e.pageX,this.m_currentMouseY=e.pageY),t=this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("colheadercell"))||this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("colendheadercell"))?"column":"row";var r=this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("endheadercell"));"col-resize"===this.m_cursor?"column"===t?(i=this.calculateColumnHeaderWidth(this.m_resizingElement),s=this.getNewElementWidth("column",i,r),this.resizeColWidth(i,s)):"row"===t&&(i=this.getElementWidth(this.m_resizingElement),s=this.getNewElementWidth("row",i,r),this.resizeRowWidth(s,s-i,r)):"row-resize"===this.m_cursor&&("row"===t?(o=this.calculateRowHeaderHeight(this.m_resizingElement),n=this.getNewElementHeight("row",o,r),this.resizeRowHeight(o,n)):"column"===t&&(o=this.getElementHeight(this.m_resizingElement),n=this.getNewElementHeight("column",o,r),this.resizeColHeight(n,n-o,r))),this.buildCorners(),this.m_utils.isTouchDevice()&&this._moveTouchSelectionAffordance(),this.m_lastMouseX=this.m_currentMouseX,this.m_lastMouseY=this.m_currentMouseY},l.prototype.resizeColWidth=function(e,t){var i,s=t-e;if(0!==s){if(null!=this.m_databody.firstChild)i=this.getElementWidth(this.m_databody.firstChild)+s,this.setElementWidth(this.m_databody.firstChild,i);this.resizeColumnWidthAndShift(s),this.m_endColPixel+=s,this.m_endColHeaderPixel+=s,this.m_endColEndHeaderPixel+=s,null!=i&&(this.m_avgColWidth=i/this.getDataSource().getCount("column")),this.manageResizeScrollbars()}},l.prototype.resizeRowHeight=function(e,t){var i,s=t-e;if(0!==s){if(null!=this.m_databody.firstChild)i=this.getElementHeight(this.m_databody.firstChild)+s,this.setElementHeight(this.m_databody.firstChild,i);this.resizeRowHeightAndShift(s),this.m_endRowPixel+=s,this.m_endRowHeaderPixel+=s,this.m_endRowEndHeaderPixel+=s,null!=i&&(this.m_avgRowHeight=i/this.getDataSource().getCount("row")),this.manageResizeScrollbars()}},l.prototype.resizeColHeight=function(e,t,i){if(0!==t){var s=this.getHeaderCellLevel(this.m_resizingElement)+(this.getHeaderCellDepth(this.m_resizingElement)-1);if(i?this.m_columnEndHeaderLevelHeights[s]+=t:this.m_columnHeaderLevelHeights[s]+=t,this.resizeColumnHeightsAndShift(t,s,i,!0),i)this.m_colEndHeaderHeight+=t,this.setElementHeight(this.m_colEndHeader,this.m_colEndHeaderHeight);else if(this.m_colHeaderHeight+=t,this.setElementHeight(this.m_colHeader,this.m_colHeaderHeight),0===this.m_headerLabels.column.length)this._resizeHeaderLabelDirs(s,t,["row"],"height");else if(s===this.m_columnHeaderLevelCount-1&&this.m_headerLabels.row.length){var o=e/2,n=this._getLabel("row",this.m_rowHeaderLevelCount-1),r=this._getLabel("column",this.m_columnHeaderLevelCount-1);this.setElementHeight(r,Math.ceil(o)),this._resizeHeaderLabelDirs(this.m_rowHeaderLevelCount-1,Math.floor(o)-this.getElementHeight(n),["row"],"height")}this.manageResizeScrollbars()}},l.prototype.resizeRowWidth=function(e,t,i){if(0!==t){var s=this.getHeaderCellLevel(this.m_resizingElement)+(this.getHeaderCellDepth(this.m_resizingElement)-1);i?this.m_rowEndHeaderLevelWidths[s]+=t:this.m_rowHeaderLevelWidths[s]+=t,this.resizeRowWidthsAndShift(t,s,i),i?(this.m_rowEndHeaderWidth+=t,this.setElementWidth(this.m_rowEndHeader,this.m_rowEndHeaderWidth)):(this.m_rowHeaderWidth+=t,this.setElementWidth(this.m_rowHeader,this.m_rowHeaderWidth),s!==this.m_rowHeaderLevelCount-1&&0!==this.m_headerLabels.row.length||this._resizeHeaderLabelDirs(s,t,["column"],"width")),this.manageResizeScrollbars()}},l.prototype._resizeHeaderLabelDirs=function(e,t,i,s){for(var o=0;o<i.length;o++)for(var n=i[o],r=0;r<this.m_headerLabels[n].length;r++){var l=this.m_headerLabels[n][r],a=this.getElementDir(l,s)+t;this.setElementDir(l,a,s)}},l.prototype.getNewElementWidth=function(e,t,i,s){var o=this._getMinValue("width",e);null==s&&(s=this.getResources().isRTLMode()?this.m_lastMouseX-this.m_currentMouseX:this.m_currentMouseX-this.m_lastMouseX),i&&"row"===e&&(s*=-1);var n=t+s+this.m_overResizeLeft+this.m_overResizeMinLeft+this.m_overResizeRight,r=Math.round(this.getWidth()/2);return n<o?(this.m_overResizeMinLeft+=s-o+t,n=o):(this.m_overResizeMinLeft=0,this.m_overResizeLeft=0),"row"===e&&(n>r?(this.m_overResizeRight+=s-r+t,n=r):this.m_overResizeRight=0),n},l.prototype.getNewElementHeight=function(e,t,i,s){var o=this._getMinValue("height",e);"column"===e&&!i&&this.getHeaderCellLevel(this.m_resizingElement)+this.getHeaderCellDepth(this.m_resizingElement)===this.m_columnHeaderLevelCount&&this.m_headerLabels.row.length&&this.m_headerLabels.column.length&&(o+=this.getElementHeight(this.m_headerLabels.row[this.m_headerLabels.row.length-1])),null==s&&(s=this.m_currentMouseY-this.m_lastMouseY),i&&"column"===e&&(s*=-1);var n=t+s+this.m_overResizeTop+this.m_overResizeMinTop+this.m_overResizeBottom,r=Math.round(this.getHeight()/2);return n<o?(this.m_overResizeMinTop+=s-o+t,n=o):(this.m_overResizeMinTop=0,this.m_overResizeTop=0),"column"===e&&(n>r?(this.m_overResizeBottom+=s-r+t,n=r):this.m_overResizeBottom=0),n},l.prototype._getMinValue=function(e,t){var i,s,o=this.m_resizingElement,n=this.getHeaderCellLevel(o),r=this.getHeaderCellDepth(o),a=this._getCellPaddingBorder(e,o),h=Math.max(this.m_utils.isTouchDevice()?2*l.RESIZE_TOUCH_OFFSET:2*l.RESIZE_OFFSET,a);if("column"===t&&(1===this.m_columnHeaderLevelCount||"width"===e&&this.m_columnHeaderLevelCount===n+1||"height"===e&&1===r)||"row"===t&&(1===this.m_rowHeaderLevelCount||"height"===e&&this.m_rowHeaderLevelCount===n+1||"width"===e&&1===r))return h;var d=this.getHeaderCellIndex(o),m=this._getAttribute(this.m_resizingElement.parentNode,"extent",!0),c=this.getElementDir(o,e);return"column"===t?"width"===e?(i=this._getHeaderByIndex(d+(m-1),this.m_columnHeaderLevelCount-1,this.m_colHeader,this.m_columnHeaderLevelCount,this.m_startColHeader),s=this.getElementDir(i,e)):s=this._getHeaderLevelDimension(n+(r-1),o,this.m_columnHeaderLevelWidths,"height",1):"row"===t&&("height"===e?(i=this._getHeaderByIndex(d+(m-1),this.m_rowHeaderLevelCount-1,this.m_rowHeader,this.m_rowHeaderLevelCount,this.m_startRowHeader),s=this.getElementDir(i,e)):s=this._getHeaderLevelDimension(n+(r-1),o,this.m_rowHeaderLevelWidths,"width",1)),c-(s-h)},l.prototype._getCellPaddingBorder=function(e,t){if(null==this.m_resizingElementMin){for(var i=["top","right","bottom","left"],s="width"===e?1:0,o=0,n=window.getComputedStyle(t);s<4;s+=2)o+=parseFloat(n.getPropertyValue("padding-"+i[s])),o+=parseFloat(n.getPropertyValue("border-"+i[s]+"-width"));this.m_resizingElementMin=Math.round(o)}return this.m_resizingElementMin},l.prototype.manageResizeScrollbars=function(){var e=this.getWidth(),t=this.getHeight(),i=this.m_colHeader,s=this.m_colEndHeader,o=this.m_rowHeader,n=this.m_rowEndHeader,r=this.m_databody,l=r.firstChild,a=this.getColumnHeaderHeight(),h=this.getColumnEndHeaderHeight(),d=this.getRowHeaderWidth(),m=t-a-h,c=e-d-this.getRowEndHeaderWidth(),u=this.m_utils.getScrollbarSize(),_=this.getResources().isRTLMode()?"right":"left";if(this._databodyEmpty()){var p;null==this.m_empty?(p=this._buildEmptyText(),this.m_root.appendChild(p)):p=this.m_empty;var g=this.getElementHeight(p),C=this.getElementWidth(p);g>this.getElementHeight(l)&&this.setElementHeight(l,g),C>this.getElementWidth(l)&&this.setElementWidth(l,C)}var f,v,y,E,S,w=this.getElementWidth(r.firstChild),H=this.getElementHeight(r.firstChild),b=this.isDatabodyHorizontalScrollbarRequired(c);b?(f=this.isDatabodyVerticalScrollbarRequired(m-u),r.style.overflow="auto"):(f=this.isDatabodyVerticalScrollbarRequired(m))?(b=this.isDatabodyHorizontalScrollbarRequired(c-u),r.style.overflow="auto"):r.style.overflow="hidden",this.m_hasHorizontalScroller=b,this.m_hasVerticalScroller=f,-1!==this.m_endColEndHeader?(v=Math.min(H+(b?u:0),m),y=b?v-u:v):(v=m,y=Math.min(H,b?v-u:v)),-1!==this.m_endRowEndHeader?(E=Math.min(w+(f?u:0),c),S=f?E-u:E):(E=c,S=Math.min(w,f?E-u:E));var x=d+S+(f?u:0),R=a+y+(b?u:0);if(this.setElementDir(o,0,_),this.setElementDir(o,a,"top"),this.setElementHeight(o,y),this.setElementDir(n,x,_),this.setElementDir(n,a,"top"),this.setElementHeight(n,y),this.setElementDir(i,d,_),this.setElementWidth(i,S),this.setElementDir(s,d,_),this.setElementDir(s,R,"top"),this.setElementWidth(s,S),this.setElementDir(r,a,"top"),this.setElementDir(r,d,_),this.setElementWidth(r,E),this.setElementHeight(r,v),this.m_scrollWidth=w-S,this.m_scrollHeight=H-y,this.buildCorners(),this._adjustHeaderBorders(),this._updateGridlines(),this.m_utils.isTouchDevice()){var M=0,I=0;if(this.m_currentScrollLeft>this.m_scrollWidth&&(M=this.m_scrollWidth-this.m_currentScrollLeft),this.m_currentScrollTop>this.m_scrollHeight&&(I=this.m_scrollHeight-this.m_currentScrollTop),0!==M||0!==I){this._disableTouchScrollAnimation();var A=this.adjustTouchScroll(M,I);M=A[0],I=A[1],this.scrollDelta(M,I)}}},l.prototype.resizeColumnWidthAndShift=function(e){var t=this.getResources().isRTLMode()?"right":"left",i=this.m_colHeader.style.display,s=this.m_colEndHeader.style.display;this.m_databody.style.display="none",this.m_colHeader.style.display="none",this.m_colEndHeader.style.display="none";var o=this.getHeaderCellIndex(this.m_resizingElement);this.m_columnHeaderLevelCount>1&&this.m_resizingElement===this.m_resizingElement.parentNode.firstChild&&null!=this.m_resizingElement.nextSibling&&(o+=this._getAttribute(this.m_resizingElement.parentNode,"extent",!0)-1),this._shiftHeadersAlongAxisInContainer(this.m_colHeader.firstChild,o,e,t,this.getMappedStyle("colheadercell"),"column"),this._shiftHeadersAlongAxisInContainer(this.m_colEndHeader.firstChild,o,e,t,this.getMappedStyle("colendheadercell"),"column"),this._shiftCellsAlongAxis("column",e,o),this.m_databody.style.display="",this.m_colHeader.style.display=i,this.m_colEndHeader.style.display=s},l.prototype._shiftCellsAlongAxis=function(e,t,i,s){var o,n,r,l,a,h=[];if(null==s&&(s=!1),"row"===e?(o="height",n="top",r=this.m_endRow,l=this.m_startCol,a=this.m_endCol):(o="width",n=this.getResources().isRTLMode()?"right":"left",r=this.m_endCol,l=this.m_startRow,a=this.m_endRow),null!=this.m_databody.firstChild)for(var d=l;d<=a;d++){var m="row"===e?this.createIndex(i,d):this.createIndex(d,i),c=this._getCellByIndex(m),u=c[this.getResources().getMappedAttribute("context")],_=u.indexes[e],p=u.extents[e],g=i-_,C=p-g;h[d]&&h[d][i]||!0===s||(this.setElementDir(c,this.getElementDir(c,o)+t,o),"row"===e?this._updateTempArray(h,!0,d,i,u.extents.column,p-g):this._updateTempArray(h,!0,d,i,u.extents.row,p-g));var f=i;!0!==s&&(f=i+C);for(var v=f;v<=r;v++)if(!h[d]||!h[d][v]){m="row"===e?this.createIndex(v,d):this.createIndex(d,v),p=(u=(c=this._getCellByIndex(m))[this.getResources().getMappedAttribute("context")]).extents[e];var y=this.getElementDir(c,n)+t;this.setElementDir(c,y,n),"row"===e?this._updateTempArray(h,!0,d,v,u.extents.column,p):this._updateTempArray(h,!0,d,v,u.extents.row,p)}}},l.prototype.resizeRowHeightAndShift=function(e){var t=this.m_rowHeader.style.display,i=this.m_rowEndHeader.style.display;this.m_databody.style.display="none",this.m_rowHeader.style.display="none",this.m_rowEndHeader.style.display="none";var s=this.getHeaderCellIndex(this.m_resizingElement);this.m_rowHeaderLevelCount>1&&this.m_resizingElement===this.m_resizingElement.parentNode.firstChild&&null!=this.m_resizingElement.nextSibling&&(s+=this._getAttribute(this.m_resizingElement.parentNode,"extent",!0)-1),this._shiftHeadersAlongAxisInContainer(this.m_rowHeader.firstChild,s,e,"top",this.getMappedStyle("rowheadercell"),"row"),this._shiftHeadersAlongAxisInContainer(this.m_rowEndHeader.firstChild,s,e,"top",this.getMappedStyle("rowendheadercell"),"row"),this._shiftCellsAlongAxis("row",e,s),this.m_databody.style.display="",this.m_rowHeader.style.display=t,this.m_rowEndHeader.style.display=i},l.prototype._shiftHeadersAlongAxisInContainer=function(e,t,i,s,o,n){var r,l,a,h,d=0,m=e.lastChild;if(null!=m){var c=this.m_utils.containsCSSClassName(m,o);for(c?(l=m.parentNode,r=m,a=this.getHeaderCellIndex(r)):(l=m,r=m.firstChild,a=this._getAttribute(l,"start",!0));t<a;)if(c)h=this.getElementDir(r,s)+i,this.setElementDir(r,h,s),m=m.previousSibling,c=this.m_utils.containsCSSClassName(m,o),l=m.parentNode,r=m,a=this.getHeaderCellIndex(r);else{for(var u=l.getElementsByClassName(o),_=0;_<u.length;_++)h=this.getElementDir(u[_],s)+i,this.setElementDir(u[_],h,s);m=m.previousSibling,c=this.m_utils.containsCSSClassName(m,o),l=m,r=m.firstChild,a=this._getAttribute(l,"start",!0)}"column"===n?(d=this.getElementWidth(r)+i,this.setElementWidth(r,d)):"row"===n?(d=this.getElementHeight(r)+i,this.setElementHeight(r,d)):null==n&&(h=this.getElementDir(r,s)+i,this.setElementDir(r,h,s)),c||null==r.nextSibling?null!=n&&this.m_sizingManager.setSize(n,this._getKey(r),d):this._shiftHeadersAlongAxisInContainer(m,t,i,s,o,n)}},l.prototype.resizeColumnHeightsAndShift=function(e,t,i,s){var o,n,r,l;i?(o=this.m_colEndHeader,n=this.getMappedStyle("colendheadercell"),r="columnEnd",l="bottom"):(o=this.m_colHeader,n=this.getMappedStyle("colheadercell"),r="column",l="top"),o.style.display="none",this.m_databody.style.display="none",s&&this._shiftLabelsDir(this.m_headerLabels[r],e,t,l,r),this._shiftHeadersDirInContainer(o.firstChild,e,t,l,n,r),o.style.display="",this.m_databody.style.display=""},l.prototype.resizeRowWidthsAndShift=function(e,t,i){var s,o,n,r;i?(s=this.m_rowEndHeader,o=this.getMappedStyle("rowendheadercell"),n="rowEnd",r=this.getResources().isRTLMode()?"left":"right"):(s=this.m_rowHeader,o=this.getMappedStyle("rowheadercell"),n="row",r=this.getResources().isRTLMode()?"right":"left"),s.style.display="none",this.m_databody.style.display="none",this._shiftLabelsDir(this.m_headerLabels[n],e,t,r,n),this._shiftHeadersDirInContainer(s.firstChild,e,t,r,o,n),s.style.display="",this.m_databody.style.display=""},l.prototype._shiftLabelsDir=function(e,t,i,s,o){for(var n=0;n<e.length;n++){var r,l=e[n];n===i&&("column"===o||"columnEnd"===o?(r=this.getElementHeight(l)+t,this.setElementHeight(l,r)):(r=this.getElementWidth(l)+t,this.setElementWidth(l,r))),n>i&&(r=this.getElementDir(l,s)+t,this.setElementDir(l,r,s))}},l.prototype._shiftHeadersDirInContainer=function(e,t,i,s,o,n){for(var r=e.childNodes,l=0;l<r.length;l++){var a,h,d=r[l];if(this.m_utils.containsCSSClassName(d,o)){a=this.getHeaderCellLevel(d);var m=this.getHeaderCellDepth(d);a<=i&&i<a+m?"column"===n||"columnEnd"===n?(h=this.getElementHeight(d)+t,this.setElementHeight(d,h)):(h=this.getElementWidth(d)+t,this.setElementWidth(d,h)):a>i&&(h=this.getElementDir(d,s)+t,this.setElementDir(d,h,s))}else if((a=this._getAttribute(d,"level",!0))<=i)this._shiftHeadersDirInContainer(d,t,i,s,o,n);else for(var c=d.getElementsByClassName(o),u=0;u<c.length;u++)h=this.getElementDir(c[u],s)+t,this.setElementDir(c[u],h,s)}},l.prototype.handleContextMenuResize=function(e,t,i,s){this.m_overResizeLeft=0,this.m_overResizeMinLeft=0,this.m_overResizeTop=0,this.m_overResizeMinTop=0,this.m_overResizeRight=0,this.m_overResizeBottom=0;var o=parseInt(i,10),n=o-this.getElementWidth(s),r=o-this.getElementHeight(s);this.m_utils.containsCSSClassName(s,this.getMappedStyle("cell"))&&(s=t===this.m_resources.getMappedCommand("resizeHeight")?this.getHeaderFromCell(s,"row",!0):this.getHeaderFromCell(s,"column",!0)),this.m_resizingElement=s;var l=this.getElementWidth(s),a=this.getElementHeight(s),h=this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("endheadercell"));t===this.m_resources.getMappedCommand("resizeWidth")?l!==o&&(this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("colheadercell"))||this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("colendheadercell"))?this._isDOMElementResizable(this.m_resizingElement)&&this.resizeColWidth(l,this.getNewElementWidth("column",l,h,n)):this.resizeRowWidth(o,o-l,h)):t===this.m_resources.getMappedCommand("resizeHeight")&&a!==o&&(this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("colheadercell"))||this.m_utils.containsCSSClassName(this.m_resizingElement,this.getMappedStyle("colendheadercell"))?this.resizeColHeight(o,o-a,h):this._isDOMElementResizable(this.m_resizingElement)&&this.resizeRowHeight(a,this.getNewElementHeight("row",a,h,r)));var d=this.getElementWidth(s),m=this.getElementHeight(s);if(d!==l||m!==a){var c={event:e,ui:{header:this._getKey(this.m_resizingElement),oldDimensions:{width:l,height:a},newDimensions:{width:d,height:m},size:o}};this.fireEvent("resize",c),this.buildCorners(),this.m_utils.isTouchDevice()&&this._moveTouchSelectionAffordance()}this.m_resizingElement=null,this.m_resizingElementMin=null},l.prototype.getHeaderEdgePixels=function(e){var t,i,s=this.findPos(e),o=s[0],n=s[1];return this.m_utils.containsCSSClassName(e,this.getMappedStyle("colheadercell"))?(t=this.calculateColumnHeaderWidth(e),i=this.getElementHeight(e)):(t=this.getElementWidth(e),i=this.calculateRowHeaderHeight(e)),[o,n,o+t,n+i]};var a=function(){this.sizes={column:new Map,row:new Map}};a.prototype.setSize=function(e,t,i){this.sizes[e].set(t,i)},a.prototype.getSize=function(t,i){var s=this.sizes[t].get(i);return null!=s?s:(this.sizes[t].forEach(function(t,o){null==s&&e.Object.compareValues(o,i)&&(s=t)}),s)},a.prototype.clear=function(){this.sizes.column.clear(),this.sizes.row.clear()};var h=function(e){this.scrollbarSize=-1,this.dataGrid=e;var t=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():null;this.os=this._determineOS(t),this.platform=this._determinePlatform(t)};h.IE_PLATFORM="ie",h.GECKO_PLATFORM="gecko",h.WEBKIT_PLATFORM="webkit",h.UNKNOWN_PLATFORM="unknown",h.EDGE_PLATFORM="edge",h.WINDOWS_OS="Windows",h.SOLARIS_OS="Solaris",h.MAC_OS="Mac",h.UNKNOWN_OS="Unknown",h.prototype._getMaxDivHeightForScrolling=function(){return null==this.m_maxDivHeightForScrolling&&this._setMaxValuesForScrolling(),this.m_maxDivHeightForScrolling},h.prototype._getMaxDivWidthForScrolling=function(){return null==this.m_maxDivWidthForScrolling&&this._setMaxValuesForScrolling(),this.m_maxDivWidthForScrolling},h.prototype._setMaxValuesForScrolling=function(){if(this.platform===h.IE_PLATFORM||this.platform===h.EDGE_PLATFORM)return this.m_maxDivHeightForScrolling=1e6,void(this.m_maxDivWidthForScrolling=1e6);var e=document.createElement("div");e.style.cssText="width:1000000000px;height:1000000000px;display:none;",document.body.appendChild(e),this.m_maxDivHeightForScrolling=parseInt(parseFloat(window.getComputedStyle(e).height)/2,10),this.m_maxDivWidthForScrolling=parseInt(parseFloat(window.getComputedStyle(e).width)/2,10),document.body.removeChild(e)},h.prototype.calculateScrollbarSize=function(){var e=document.createElement("div");e.style.cssText="width:100px;height:100px;overflow:scroll;position:absolute;top:-9999px;",document.body.appendChild(e),this.scrollbarSize=e.offsetWidth-e.clientWidth,document.body.removeChild(e)},h.prototype.getScrollbarSize=function(){return-1===this.scrollbarSize&&this.calculateScrollbarSize(),this.scrollbarSize},h.prototype.isTouchDevice=function(){if(null==this.isTouch){var e=navigator.userAgent.toLowerCase();-1!==e.indexOf("mobile")||-1!==e.indexOf("android")?this.isTouch=!0:this.isTouch=!1}return this.isTouch},h.prototype.addCSSClassName=function(e,t){var i=!1;if(null!=t&&null!=e){var s=e.className;if(-1===h._getCSSClassNameIndex(s,t)){var o=s?t+" "+s:t;e.className=o,i=!0}}return i},h.prototype.removeCSSClassName=function(e,t){var i=!1;if(null!=t&&null!=e){var s=e.className,o=h._getCSSClassNameIndex(s,t);if(-1!==o){var n,r=o+t.length,l=0===o?null:s.substring(0,o),a=r===s.length?null:s.substring(r+1);n=null==l?null==a?"":a:null==a?l:l+a,e.className=n,i=!0}}return i},h.prototype.containsCSSClassName=function(e,t){return null!=t&&null!=e&&-1!==h._getCSSClassNameIndex(e.className,t)},h._getCSSClassNameIndex=function(e,t){if(!e||!e.indexOf)return-1;if(t===e)return 0;var i=t.length,s=e.length,o=e.indexOf(t);if(o>=0){var n=0===o||" "===e.charAt(o-1),r=o+i,l=r===s||" "===e.charAt(r);if(n&&l)return o;var a=e.lastIndexOf(t);if(a!==o)return n=e.charAt(a-1),l=(r=a+i)===s||" "===e.charAt(r),n&&l?a:e.indexOf(" "+t+" ")}return-1},h.prototype.ctrlEquivalent=function(e){return this.os===h.MAC_OS?e.metaKey:e.ctrlKey},h.prototype.getElementScrollLeft=function(e){if(this.dataGrid.getResources().isRTLMode()){if(this.platform===h.GECKO_PLATFORM||this.platform===h.IE_PLATFORM||this.platform===h.EDGE_PLATFORM)return Math.abs(e.scrollLeft);var t=this.dataGrid.getScrollableWidth(),i=e.clientWidth;return Math.max(0,t-i-e.scrollLeft)}return e.scrollLeft},h.prototype.setElementScrollLeft=function(e,t){if(this.dataGrid.getResources().isRTLMode())if(this.platform===h.GECKO_PLATFORM)e.scrollLeft=-t;else if(this.platform===h.IE_PLATFORM||this.platform===h.EDGE_PLATFORM)e.scrollLeft=t;else{var i=this.dataGrid.getScrollableWidth()-e.clientWidth-t;e.scrollLeft=i}else e.scrollLeft=t},h.prototype._determineOS=function(e){if(e){if(-1!==e.indexOf("win"))return h.WINDOWS_OS;if(-1!==e.indexOf("mac"))return h.MAC_OS;if(-1!==e.indexOf("sunos"))return h.SOLARIS_OS}return h.UNKNOWN_OS},h.prototype._determinePlatform=function(e){if(e){if(-1!==e.indexOf("opera"))return h.UNKNOWN_PLATFORM;if(-1!==e.indexOf("trident")||-1!==e.indexOf("msie"))return h.IE_PLATFORM;if(-1!==e.indexOf("edge"))return h.EDGE_PLATFORM;if(-1!==e.indexOf("applewebkit")||-1!==e.indexOf("safari"))return h.WEBKIT_PLATFORM;if(-1!==e.indexOf("gecko/"))return h.GECKO_PLATFORM}return h.UNKNOWN_PLATFORM},h.prototype.getMousewheelEvent=function(){return"wheel"},h.prototype.getMousewheelScrollDelta=function(e){var t,i=e.deltaMode;return i===e.DOM_DELTA_PIXEL?t=-1:i!==e.DOM_DELTA_LINE&&i!==e.DOM_DELTA_PAGE||(t=-40),{deltaX:e.deltaX*t,deltaY:e.deltaY*t}},h.prototype.empty=function(e){for(;e.firstChild;)this.dataGrid._remove(e.firstChild)},h.prototype.supportsTransitions=function(){var e=(document.body||document.documentElement).style,t="transition";if(/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<11))return!1;if("string"==typeof e[t])return!0;var i=["Moz","webkit","Webkit","Khtml","O","ms"];t=t.charAt(0).toUpperCase()+t.substr(1);for(var s=0;s<i.length;s++)if("string"==typeof e[i[s]+t])return!0;return!1},h.prototype._isNodeEditableOrClickable=function(e,t){for(;null!=e&&e!==t;){var i=e.nodeName;if(3===e.nodeType)e=e.parentNode;else{var s=parseInt(e.getAttribute("tabIndex"),10),o=parseInt(e.getAttribute(this.dataGrid.getResources().getMappedAttribute("tabindex")),10);if(null!=s&&s>=0)return!(this.containsCSSClassName(e,this.dataGrid.getResources().getMappedStyle("cell"))||this.containsCSSClassName(e,this.dataGrid.getResources().getMappedStyle("headerlabel"))||this.containsCSSClassName(e,this.dataGrid.getResources().getMappedStyle("headercell"))||this.containsCSSClassName(e,this.dataGrid.getResources().getMappedStyle("endheadercell")));if(i.match(/^INPUT|SELECT|OPTION|BUTTON|^A\b|TEXTAREA/)&&(-1!==s||-1!==o))return!0;e=e.parentNode}}return!1},h.prototype.shouldOffsetOutline=function(){return this.os===h.MAC_OS&&this.platform===h.WEBKIT_PLATFORM};var d=function(e,t){this.options=e,this.rendererWrapperFunction=t};function m(e){this.dataprovider=e,this.pendingHeaderCallback={},e.options&&e.options.implicitSort&&(this.currentSortCriteria=e.options.implicitSort),this.sortUpdated=!1;var t=this.dataprovider.getCapability("fetchByOffset");this.fetchByOffset=null!=t&&"randomAccess"===t.implementation,this._registerEventListeners(),m.superclass.constructor.call(this)}function c(e,t,i,s){this.index=e,this.data=i,this.key=t,this.columns=s}function u(e,t,i){this.response=e,this.results=e.results,this.cellRanges=t,this.columns=i,this._setBounds(e,t,i)}function _(e,t,i,s){this.start=e,this.end=t,this.headers=i,this.sortCriteria=s}d.prototype.extract=function(e,t,i,s){if(null!=e){var o=this.options[e];if(null!=t&&null!=o){var n=o[t];if(null!=i&&null!=n){var r=n[i];return null!=s&&null!=r?r[s]:r}return n}return o}return null},d.prototype.evaluate=function(e,t){return"function"==typeof e?e.call(this,t):e},d.prototype.getRawProperty=function(e,t,i){var s,o,n,r;return"row"===t||"column"===t||"rowEnd"===t||"columnEnd"===t?(s="header",o=t,i?(n="label",r=e):n=e):"cell"===t&&(s="cell",o=e),this.extract(s,o,n,r)},d.prototype.getProperty=function(e,t,i,s){return void 0===i?this.extract(e,t,s):this.evaluate(this.getRawProperty(e,t,s),i)},d.prototype.getRowBandingInterval=function(){var e=this.getProperty("bandingInterval","row");return null!=e?e:0},d.prototype.getColumnBandingInterval=function(){var e=this.getProperty("bandingInterval","column");return null!=e?e:0},d.prototype.getEmptyText=function(){return this.getProperty("emptyText")},d.prototype.getHorizontalGridlines=function(){var e=this.extract("gridlines","horizontal");return null!=e?e:"visible"},d.prototype.getVerticalGridlines=function(){var e=this.extract("gridlines","vertical");return null!=e?e:"visible"},d.prototype.getScrollPosition=function(){var e=this.getProperty("scrollPosition");return null!=e?e:null},d.prototype.getSelectionCardinality=function(){var e=this.getProperty("selectionMode");if(null==e)return"none";var t=e[this.getSelectionMode()];return null!=t?t:"none"},d.prototype.getSelectionMode=function(){var e=this.getProperty("selectionMode");if(null==e)return"cell";var t=e.row;return null!=t&&"none"!==t?"row":"cell"},d.prototype.getSelection=function(){return this.getProperty("selection")},d.prototype.getCurrentCell=function(){return this.getProperty("currentCell")},d.prototype.getEditMode=function(){return this.getProperty("editMode")},d.prototype.isSortable=function(e,t){return this.getProperty("sortable",e,t)},d.prototype.isResizable=function(e,t,i){var s=this.extract("header",e,"resizable",t);return null!=i?this.evaluate(s,i):s},d.prototype.isMoveable=function(e){return this.extract("dnd","reorder",e)},d.prototype.getInlineStyle=function(e,t,i){return this.getProperty("style",e,t,i)},d.prototype.getStyleClass=function(e,t,i){return this.getProperty("className",e,t,i)},d.prototype.getRenderer=function(e,t){return this.rendererWrapperFunction?this.rendererWrapperFunction(this.getRawProperty("renderer",e,t)):this.getRawProperty("renderer",e,t)},d.prototype.getScrollPolicy=function(){var e=this.getProperty("scrollPolicy");return null==e&&(e="auto"),e},d.prototype.getScrollPolicyOptions=function(){return this.getProperty("scrollPolicyOptions")},e.__registerWidget("oj.ojDataGrid",t.oj.baseComponent,{widgetEventPrefix:"oj",options:{bandingInterval:{row:0,column:0},data:null,gridlines:{horizontal:"visible",vertical:"visible"},scrollPosition:{x:0,y:0},selectionMode:{cell:"none",row:"none"},dnd:{reorder:{row:"disable"}},scrollPolicy:"auto",scrollPolicyOptions:{maxRowCount:500,maxColumnCount:500},selection:[],currentCell:null,editMode:"none",header:{row:{className:null,label:{renderer:null,className:null,style:null},renderer:null,resizable:{width:"disable",height:"disable"},sortable:"auto",style:null},column:{className:null,label:{renderer:null,className:null,style:null},renderer:null,resizable:{width:"disable",height:"disable"},sortable:"auto",style:null},columnEnd:{className:null,label:{renderer:null,className:null,style:null},renderer:null,resizable:{width:"disable",height:"disable"},style:null},rowEnd:{className:null,label:{renderer:null,className:null,style:null},renderer:null,resizable:{width:"disable",height:"disable"},style:null}},cell:{className:null,renderer:null,style:null},resize:null,sort:null,ready:null,scroll:null,beforeCurrentCell:null,beforeEdit:null,beforeEditEnd:null},_ComponentCreate:function(){this._super(),this.root=this.element[0],this.rootId=this.root.getAttribute("id"),this.grid=new l(this.root),this.grid.setVisibility(l.VISIBILITY_STATE_RENDER),t(this.root).addClass("oj-datagrid oj-component"),t(this.root).attr(i._OJ_CONTAINER_ATTR,this.widgetName),this.root.setAttribute("x-ms-format-detection","none"),this.redrawSet={data:"all",header:["className","renderer","style","template"]}},_AfterCreate:function(){var s=this;this._unregisterResizeListener(this.root),this._removeAllChildren(),this._super(),this.resources=new e.DataGridResources(this._GetReadingDirection(),this._getTranslation.bind(s),n.parseJSONFromFontFamily("oj-datagrid-option-defaults"),this.widgetName),this._setDataSource(),this._setSelection(),null!=this.datasource&&(this.grid.SetDataSource(this.datasource),this._addContextMenu(),this._isCreate=!0,this.grid._addDataSourceEventListeners()),this._checkSelectionMode(this.options),this.grid.SetOptions(this.options,this._WrapCustomElementRenderer.bind(s)),this.grid.SetResources(this.resources),this.grid.SetCreateContextCallback(this._modifyContext.bind(s)),this.grid.SetFixContextCallback(this._FixRendererContext.bind(s)),this.grid.SetRemoveCallback(this._remove.bind(s)),this.grid.SetUniqueIdCallback(this._uniqueId.bind(s)),this.grid.SetCompareValuesCallback(this._compareValues.bind(s)),this.grid.SetNotReadyCallback(this._NotReady.bind(s)),this.grid.SetMakeReadyCallback(this._MakeReady.bind(s)),this.grid.SetOptionCallback(this.option.bind(s)),this.grid.SetSubtreeAttachedCallback(i.subtreeAttached),this.grid.SetContextCallback(o.getContext),this.grid.SetUpdateScrollPostionOnRefreshCallback(this._updateScrollPositionOnRefresh.bind(s)),this._focusable({applyHighlight:!0,setupHandlers:function(e,i){s.grid.SetFocusableCallback.call(s.grid,function(i){return e(t(i))},function(e){return i(t(e))})}}),this._registerEventListeners(),this._possiblyRenderOrRefresh()},_SetupResources:function(){this._super(),null!=this.datasource&&(this._isCreate||this.grid._addDataSourceEventListeners(),this.grid._addDomEventListeners(),this._registerResizeListener(this.root)),this._isCreate=!1},_ReleaseResources:function(){this._super(),this.grid._removeDataSourceEventListeners(),this.grid._removeDomEventListeners(),this._unregisterResizeListener(this.root)},_registerEventListeners:function(){var e=this;this.grid.addListener("resize",function(t){e._trigger("resize",t.event,t.ui)}),this.grid.addListener("select",function(t){e.option("selection",t.ui.selection,{_context:{originalEvent:t.event,internalSet:!0},changed:!0})}),this.grid.addListener("currentCell",function(t){e.option("currentCell",t.ui,{_context:{originalEvent:t.event,internalSet:!0},changed:!0})}),this.grid.addListener("beforeCurrentCell",function(t){return e._trigger("beforeCurrentCell",t.event,t.ui)}),this.grid.addListener("sort",function(t){var i=e._trigger2("sort",t.event,t.ui);e.grid.SetSortOriginalEvent(i.event)}),this.grid.addListener("keydown",function(t){return e._trigger("keydown",t.event,t.ui)}),this.grid.addListener("ready",function(){e._trigger("ready",null,{})}),this.grid.addListener("scroll",function(t){e._trigger("scroll",t.event,t.ui)}),this.grid.addListener("beforeEdit",function(t){return e._trigger("beforeEdit",t.event,t.ui)}),this.grid.addListener("beforeEditEnd",function(t){return e._trigger("beforeEditEnd",t.event,t.ui)})},refresh:function(){this._super(),this._ReleaseResources(),this._removeAllChildren(),this._defaultContextMenu&&(this.options.contextMenu=null,this._defaultContextMenu=null),this._setDataSource(),null!=this.datasource&&(e.FlattenedTreeDataGridDataSource&&this.datasource instanceof e.FlattenedTreeDataGridDataSource&&(this.datasource.Destroy(),this.datasource.Init()),this.grid.SetDataSource(this.datasource),this._addContextMenu()),this.grid.SetOptions(this.options,this._WrapCustomElementRenderer.bind(this)),this.grid.SetResources(this.resources),this._SetupResources(),this.grid.getVisibility()!==l.VISIBILITY_STATE_RENDER&&this.grid.setVisibility(l.VISIBILITY_STATE_REFRESH),this._possiblyRenderOrRefresh()},_updateScrollPositionOnRefresh:function(){var e,t=this.options.selection;if(null==t||0===t.length)e={x:0,y:0};else{e={};var i=t[t.length-1];i.startKey?(e.rowKey=i.startKey.row,e.columnKey=i.startKey.column):i.startIndex&&(e.rowIndex=0,e.columnIndex=0)}this.option("scrollPosition",e,{_context:{internalSet:!0},changed:!1})},_destroy:function(){t(this.root).removeAttr(i._OJ_CONTAINER_ATTR),null!=this.datasource&&this.datasource.Destroy&&this.datasource.Destroy(),this.grid.destroy(),this._unregisterResizeListener(this.root),t(this.root).empty(),this._MakeReady()},_setOptions:function(e,t){if(this.datasource){var i=this._handleOptionUpdate(e,t);this._super(e,t),"refresh"===i?this.refresh():"pass"===i&&this.grid.UpdateOptions(e,t)}else this._super(e,t),null!=e.data&&this.refresh()},_checkSelectionMode:function(e){var t=e.selectionMode;if(t&&t.row&&t.cell&&"none"!==t.row&&"none"!==t.cell)throw new Error("JET DataGrid does not support selectionMode on cell and row simultaneously.")},_NotifyShown:function(){this._super(),this._possiblyRenderOrRefresh()},_NotifyHidden:function(){this._super(),this.grid.getVisibility()===l.VISIBILITY_STATE_VISIBLE&&this.grid.setVisibility(l.VISIBILITY_STATE_HIDDEN)},_NotifyAttached:function(){this._super(),this._possiblyRenderOrRefresh()},_NotifyDetached:function(){this._super(),this.grid.getVisibility()===l.VISIBILITY_STATE_VISIBLE&&this.grid.setVisibility(l.VISIBILITY_STATE_HIDDEN)},_handleOptionUpdate:function(e,t){for(var i="ignore",s=Object.keys(e),o=0;o<s.length;o++){switch(s[o]){case"bandingInterval":case"currentCell":case"editMode":case"gridlines":case"scrollPosition":case"selection":i="pass";break;case"beforeCurrentCell":case"beforeEdit":case"beforeEditEnd":case"create":case"disabled":case"dnd":case"optionChange":case"ready":case"resize":case"rootAttributes":case"scroll":case"sort":break;case"selectionMode":this._checkSelectionMode(e),i="pass";break;case"cell":case"header":var n=t.subkey;if(null!=n){var r=n.split(".");if("resizable"===r[1]||"sortable"===r[1]){i="pass";break}}return"refresh";case"data":return this._updateScrollPositionOnRefresh(),"refresh";case"contextMenu":case"scrollPolicy":default:return"refresh"}}return i},_isResizeEnabled:function(e,t){return!(!this.options.header[e]||!this.options.header[e].resizable)&&"disable"!==this.options.header[e].resizable[t]},_isSortEnabled:function(e){return!!this.options.header[e]&&"disable"!==this.options.header[e].sortable},_removeAllChildren:function(){t(this.root).children("[slot!='contextMenu']").remove()},_GetDefaultContextMenu:function(){return this._defaultContextMenu},_addContextMenu:function(){var e=this,i=e._IsCustomElement(),s=this._GetContextMenu();if(s){null==this._menuItemsSetByGrid&&(this._menuItemsSetByGrid=[]);var o=(s=t(s)).find("[data-oj-command]"),n=[];o.each(function(){var s=e._shouldUpdateListItem(this,i);if(s.shouldUpdate){var o=t(this).attr("data-oj-command").split("-");if(i){var r=e._buildContextMenuLabel(o[o.length-1],i)[0];s.itemToUpdate?(s.itemToUpdate.textContent=r.textContent,n.push(s.itemToUpdate)):s.toFirstChild?(this.firstChild.appendChild(r),n.push(r)):(this.appendChild(r),n.push(r))}else{var l=e._buildContextMenuItem(o[o.length-1],i);t(this).replaceWith(l),n.push(l.children("a").get(0))}}}),this._menuItemsSetByGrid=n,s.data("oj-ojMenu")&&(i?s[0].refresh():s.ojMenu("refresh"))}else null!=this.datasource&&(s=this._createDefaultContextMenu())&&(this._defaultContextMenu=s[0]);s&&this._addMenuSelectListener(s)},_shouldUpdateListItem:function(i,s){var o,n=!1;if(s){if(null!=i.firstElementChild&&"opt"===i.firstElementChild.getAttribute("ojmenu")?(o=e.BaseCustomElementBridge.getSlotMap(i.firstElementChild),n=!0):o=e.BaseCustomElementBridge.getSlotMap(i),!o[""]||0===o[""].length)return{shouldUpdate:!0,toFirstChild:n};if(o[""]){var r=this._menuItemsSetByGrid.indexOf(o[""][0]);if(-1!==r)return{shouldUpdate:!0,itemToUpdate:this._menuItemsSetByGrid[r]}}return{shouldUpdate:!1}}var l=t(i).children("a");return{shouldUpdate:0===l.length||-1!==this._menuItemsSetByGrid.indexOf(l.get(0))}},_addMenuSelectListener:function(e){var t=this._handleContextMenuSelect.bind(this);this._IsCustomElement()&&!this._defaultContextMenu?e[0].addEventListener("ojAction",t):e.on("ojselect",t)},_createDefaultContextMenu:function(){var i=null,s=null,o=null,n=null,r=t("<ul>");r.css("display","none").attr("id",this.rootId+"contextmenu"),t(this.root).append(r),(this._isResizeEnabled("column","width")||this._isResizeEnabled("column","height")||this._isResizeEnabled("row","width")||this._isResizeEnabled("row","height"))&&(i=this._buildContextMenuItem("resize"));var l=this.datasource.getCapability("sort");if(this._isSortEnabled("column")&&("column"!==l&&"full"!==l||(s=this._buildContextMenuItem("sortCol"))),this._isSortEnabled("row")&&("row"!==l&&"full"!==l||(s=null!=s?s.add(this._buildContextMenuItem("sortRow")):this._buildContextMenuItem("sortRow"))),"enable"===this.options.dnd.reorder.row)switch(this.datasource.getCapability("move")){case"none":break;default:n=this._buildContextMenuListItem("cut").add(this._buildContextMenuListItem("paste"))}return this._isMultipleSelection()&&e.DomUtils.isTouchSupported()&&(this._discontiguousSelection=!1,o=this._buildContextMenuListItem("discontiguousSelection")),null!=i||null!=s||null!=n||null!=o?(r.append(i).append(s).append(n).append(o),r.ojMenu(),this.option("contextMenu",r.get(0),{_context:{internalSet:!0}}),r):null},_buildContextMenuItem:function(e,i){return"resize"===e?this._buildContextMenuListItem("resize",i).append(t("<ul></ul>").append(this._buildContextMenuListItem("resizeWidth",i)).append(this._buildContextMenuListItem("resizeHeight",i))):"sortCol"===e?this._buildContextMenuListItem("sortCol",i).append(t("<ul></ul>").append(this._buildContextMenuListItem("sortColAsc",i)).append(this._buildContextMenuListItem("sortColDsc",i))):"sortRow"===e?this._buildContextMenuListItem("sortRow",i).append(t("<ul></ul>").append(this._buildContextMenuListItem("sortRowAsc",i)).append(this._buildContextMenuListItem("sortRowDsc",i))):-1!==Object.keys(this.resources.commands).indexOf(e)?t(this._buildContextMenuListItem(e,i)):void 0},_buildContextMenuListItem:function(e,i){var s=t(i?"<oj-option></oj-option>":"<li></li>");return s.attr("data-oj-command",this._getMappedCommand(e)),s.append(this._buildContextMenuLabel(e,i)),s},_buildContextMenuLabel:function(e,i){var s="label"+e.charAt(0).toUpperCase()+e.slice(1);"discontiguousSelection"===e&&(s="labelEnableNonContiguous");var o=this._getTranslation(s);return i?t("<span>").text(o):t('<a href="#"></a>').text(o)},_getDataGridContextMenu:function(){return this._GetContextMenu()||this._GetDefaultContextMenu()},_getTranslation:function(e,t){return this.getTranslatedString(e,t)},_handleResizeDialog:function(e){var i=t("#"+this.rootId+"spinner").ojInputNumber("option","value");t("#"+this.rootId+"dialog").ojPopup("close"),this.grid.handleContextMenuReturn(this.contextMenuEvent,this.menuItemFunction,i),this.contextMenuEvent.target.focus()},_buildResizeDialog:function(e,i){var s=t("#"+this.rootId+"dialog"),o=t("#"+this.rootId+"spinner");if(0===s.length||0===o.length){(s=document.createElement("div")).id=this.rootId+"dialog";var n=document.createElement("div"),r=document.createElement("div"),l=document.createElement("div");n.className=this._getMappedStyle("popupHeader"),r.className=this._getMappedStyle("popupContent"),l.className=this._getMappedStyle("popupFooter"),s.appendChild(n),s.appendChild(r),s.appendChild(l);var a=document.createElement("h5");a.textContent=e,n.appendChild(a),(o=document.createElement("input")).id=this.rootId+"spinner";var h=document.createElement("button");h.id=this.rootId+"dialogsubmit",r.appendChild(o),l.appendChild(h),this.root.appendChild(s),t(h).ojButton({component:"ojButton",label:this._getTranslation("labelResizeDialogSubmit")}),h.addEventListener("click",this._handleResizeDialog.bind(this)),t(o).ojInputNumber({component:"ojInputNumber",max:1e3,min:20,step:1,value:i}),t(s).ojPopup({initialFocus:"firstFocusable",position:{my:"center center",at:"center center",collision:"none",of:t(this.root)}}),t(s).ojPopup("open")}else o.ojInputNumber("option","value",i),s.find("."+this._getMappedStyle("popupHeader"))[0].firstChild.textContent=e,s.ojPopup("open")},_handleContextMenuSelect:function(e,i){var s;if(s=i?i.item:t(e.target),this.menuItemFunction=s.attr("data-oj-command"),this.menuItemFunction===this._getMappedCommand("sortColAsc")||this.menuItemFunction===this._getMappedCommand("sortColDsc")||this.menuItemFunction===this._getMappedCommand("cut")||this.menuItemFunction===this._getMappedCommand("paste"))this.grid.handleContextMenuReturn(this.contextMenuEvent,this.menuItemFunction,null);else if(this.menuItemFunction===this._getMappedCommand("resizeWidth")||this.menuItemFunction===this._getMappedCommand("resizeHeight")){var o=t(this.contextMenuEvent.target).closest("."+this._getMappedStyle("cell"));if(0===o.length&&(o=t(this.contextMenuEvent.target).closest("."+this._getMappedStyle("headercell"))),0===o.length&&(o=t(this.contextMenuEvent.target).closest("."+this._getMappedStyle("endheadercell"))),o.length>0){var n=this.menuItemFunction===this._getMappedCommand("resizeWidth")?o.outerWidth():o.outerHeight();this._buildResizeDialog(s.text(),n)}}else if(this.menuItemFunction===this._getMappedCommand("discontiguousSelection")){this._discontiguousSelection=!this._discontiguousSelection,this.grid.handleContextMenuReturn(this.contextMenuEvent,this.menuItemFunction,this._discontiguousSelection);var r=this._discontiguousSelection?"labelDisableNonContiguous":"labelEnableNonContiguous";s.children().first().text(this._getTranslation(r))}},_NotifyContextMenuGesture:function(e,t,i){this.grid.handleContextMenuGesture(t,i,this._contextMenuGestureCallback.bind(this))},_contextMenuGestureCallback:function(e,i,s){if(null!=e){this.contextMenuEvent=i.originalEvent;var o=e.launcher,n=e.capabilities;this._manageContextMenu(n);var r="keyboard"===s?{position:{of:o},launcher:t(o)}:{launcher:t(o)};this._OpenContextMenu(i,s,r)}},_addContextMenuCapability:function(e){var i=t(this._getDataGridContextMenu());i.find("[data-oj-command="+e+"]").hasClass("oj-disabled")||i.find("[data-oj-command="+e+"]").addClass("oj-disabled")},_removeContextMenuCapability:function(e){t(this._getDataGridContextMenu()).find("[data-oj-command="+e+"]").removeClass("oj-disabled")},_manageContextMenu:function(e){for(var t=Object.keys(e),i=0;i<t.length;i++){var s=t[i],o=this.resources.getMappedCommand(s);"disable"===e[s]?this._addContextMenuCapability(o):this._removeContextMenuCapability(o)}},_findCellIndex:function(e){return e[this._getMappedAttribute("context")].indexes},_setDataSource:function(){null!=this.options.data?e.DataProviderFeatureChecker.isDataProvider(this.options.data)?(this.datasource=new m(this.options.data),"randomAccess"!==this.options.data.getCapability("fetchByOffset").implementation&&"scroll"===this.options.scrollPolicy&&(s.error("oj.DataProvider does not support fetchByOffset and scrollPolicy is set to scroll. scrollPolicy will fall back to auto."),this.options.scrollPolicy="auto")):this.datasource=this.options.data:this.datasource=null},_setSelection:function(){var e=this.options.selection;null!=e&&this.grid.SetSelection(e)},_modifyContext:function(e){e.component=i.__GetWidgetConstructor(this.element,"ojDataGrid")},_setAccessibleContext:function(e){this.grid.SetAccessibleContext(e)},_unregisterResizeListener:function(t){t&&this._resizeHandler&&e.DomUtils.removeResizeListener(t,this._resizeHandler)},_registerResizeListener:function(t){t&&(null==this._resizeHandler&&(this._resizeHandler=this._handleResize.bind(this)),e.DomUtils.addResizeListener(t,this._resizeHandler))},_handleResize:function(e,t){e>0&&t>0&&(this._possiblyRenderOrRefresh(),this.grid.HandleResize(e,t))},getNodeBySubId:function(e){var i;if(null==e)return this.element?this.element[0]:null;var s=e.subId;if("oj-datagrid-cell"===s){var o=e.rowIndex,n=e.columnIndex;i=t(this.grid._getCellByIndex({row:o,column:n}))}else if("oj-datagrid-sort-icon"===s||"oj-datagrid-sort-ascending"===s||"oj-datagrid-sort-descending"===s||"oj-datagrid-header"===s){var r,l=e.axis,a=e.index,h=null==e.level?0:e.level;if("column"===l?r=this._getHeaderByIndex(a,h,t("#"+this.rootId+"\\:columnHeader"),this.grid.getStartColumnHeader()):"row"===l?r=this._getHeaderByIndex(a,h,t("#"+this.rootId+"\\:rowHeader"),this.grid.getStartRowHeader()):"columnEnd"===l?r=this._getHeaderByIndex(a,h,t("#"+this.rootId+"\\:columnEndHeader"),this.grid.getStartColumnEndHeader()):"rowEnd"===l&&(r=this._getHeaderByIndex(a,h,t("#"+this.rootId+"\\:rowEndHeader"),this.grid.getStartRowEndHeader())),null==r)return null;if("oj-datagrid-sort-icon"===s)return r.children("."+this._getMappedStyle("sortcontainer")).children().get(0);i="oj-datagrid-sort-ascending"===s?r.find("."+this._getMappedStyle("sortascending")):"oj-datagrid-sort-descending"===s?r.find("."+this._getMappedStyle("sortdescending")):r}else"oj-datagrid-header-label"===s&&(i=t(this.grid._getLabel(e.axis,e.level)));return null!=i&&i.length>0?i[0]:null},getSubIdByNode:function(e){var i,s=t(e).closest("."+this._getMappedStyle("cell"));if(s.length>0){var o=this._findCellIndex(s[0]);return{subId:"oj-datagrid-cell",rowIndex:o.row,columnIndex:o.column}}var n=t(e).closest("."+this._getMappedStyle("headercell"));if(0===n.length&&(n=t(e).closest("."+this._getMappedStyle("endheadercell"))),n.length>0)return i=n[0][this._getMappedAttribute("context")],{subId:t(e).hasClass(this._getMappedStyle("sortascending"))?"oj-datagrid-sort-ascending":t(e).hasClass(this._getMappedStyle("sortdescending"))?"oj-datagrid-sort-descending":"oj-datagrid-header",axis:i.axis,index:this._getHeaderIndex(n),level:i.level};var r=t(e).closest("."+this._getMappedStyle("headerlabel"));return r.length>0?{subId:"oj-datagrid-header-label",axis:(i=r[0][this._getMappedAttribute("context")]).axis,level:i.level}:null},getContextByNode:function(i){var s,o,n=t(i).closest("."+this._getMappedStyle("cell"));if(n.length>0)return s=n[0][this._getMappedAttribute("context")],(o=e.CollectionUtils.copyInto({},s,void 0,!0)).subId="oj-datagrid-cell",o;var r=t(i).closest("."+this._getMappedStyle("headercell"));if(0===r.length&&(r=t(i).closest("."+this._getMappedStyle("endheadercell"))),r.length>0)return s=r[0][this._getMappedAttribute("context")],(o=e.CollectionUtils.copyInto({},s,void 0,!0)).subId="oj-datagrid-header",o.index=this._getHeaderIndex(r),o;var l=t(i).closest("."+this._getMappedStyle("headerlabel"));return l.length>0?(s=l[0][this._getMappedAttribute("context")],(o=e.CollectionUtils.copyInto({},s,void 0,!0)).subId="oj-datagrid-header-label",o):null},_getMappedStyle:function(e){return this.resources.getMappedStyle(e)},_getMappedAttribute:function(e){return this.resources.getMappedAttribute(e)},_getMappedCommand:function(e){return this.resources.getMappedCommand(e)},_isDataGridSizingAvailable:function(){return null!=this.root.offsetParent},_possiblyRenderOrRefresh:function(){var e=this.grid.getVisibility();this._isDataGridSizingAvailable()?(e===l.VISIBILITY_STATE_RENDER?this.grid.render(this.root):e===l.VISIBILITY_STATE_REFRESH&&this.grid.refresh(this.root),this.grid.setVisibility(l.VISIBILITY_STATE_VISIBLE)):e===l.VISIBILITY_STATE_VISIBLE&&this.grid.setVisibility(l.VISIBILITY_STATE_HIDDEN)},_getHeaderByIndex:function(e,t,i,s){if(t<0)return null;var o=i.children().first().children().last();if(o.hasClass(this._getMappedStyle("headercell")))return i.children().first().children("."+this._getMappedStyle("headercell")).eq(e-s);if(o.hasClass(this._getMappedStyle("endheadercell")))return i.children().first().children("."+this._getMappedStyle("endheadercell")).eq(e-s);var n=this._getGroupingContainer(e,t,0,i.children().first().children());if(null==n)return null;if(t<=parseInt(n.attr(this._getMappedAttribute("level")),10)+parseInt(n.children().eq(0).attr(this._getMappedAttribute("depth")),10)-1)return n.children().eq(0);var r=e-(s=parseInt(n.attr(this._getMappedAttribute("start")),10))+1;return n.children().eq(r)},_getGroupingContainer:function(e,t,i,s){if(null==s.eq(1)||s.eq(1).hasClass(this._getMappedStyle("headercell"))||s.eq(1).hasClass(this._getMappedStyle("endheadercell")))return t===i?s.eq(0).parent():null;var o,n=s.parent().parent();for(o=n.hasClass(this._getMappedStyle("header"))||n.hasClass(this._getMappedStyle("endheader"))?0:1;o<s.length;o++){var r=parseInt(s.eq(o).attr(this._getMappedAttribute("start")),10),l=parseInt(s.eq(o).attr(this._getMappedAttribute("extent")),10),a=parseInt(s.eq(o).children().eq(0).attr(this._getMappedAttribute("depth")),10);if(e>=r&&e<r+l)return t<i+a?s.eq(o):this._getGroupingContainer(e,t,i+a,s.eq(o).children())}return null},_getHeaderIndex:function(e){var t;if(e.parent().hasClass(this._getMappedStyle("groupingcontainer"))){if(t=parseInt(e.parent().attr(this._getMappedAttribute("start")),10),e.get(0)===e.parent().children(":first").get(0))return t;t-=1}else t=e.hasClass(this._getMappedStyle("rowheadercell"))?this.grid.getStartRowHeader():e.hasClass(this._getMappedStyle("colheadercell"))?this.grid.getStartColumnHeader():e.hasClass(this._getMappedStyle("colendheadercell"))?this.grid.getStartColumnEndHeader():this.grid.getStartRowEndHeader();return t+=e.index()},_isMultipleSelection:function(){return null!=this.options.selectionMode&&("multiple"===this.options.selectionMode.row||"multiple"===this.options.selectionMode.cell)},_remove:function(e){t(e).remove()},_uniqueId:function(e,i){i?t(e).removeUniqueId():t(e).uniqueId()},_compareValues:function(t,i){return e.Object.compareValues(t,i)},scrollTo:function(e){this.grid.scroll(e)},whenReady:function(){if(this._ready)return Promise.resolve(!0);if(!this._readyPromise){var e=this;this._readyPromise=new Promise(function(t){e._readyPromiseResolve=t})}return this._readyPromise},_NotReady:function(){if(this._ready=!1,!this._readyResolveFunc){var e=o.getContext(this.element[0]).getBusyContext(),t={description:"The component identified by '"+this.element.attr("id")+"' is being loaded."};this._readyResolveFunc=e.addBusyState(t)}},_MakeReady:function(){this._readyPromiseResolve&&(this._readyPromiseResolve(!0),this._readyPromiseResolve=null),this._ready=!0,this._promise=null,this._readyResolveFunc&&(this._readyResolveFunc(),this._readyResolveFunc=null)},_CompareOptionValues:function(t,i,s){switch(t){case"currentCell":case"selection":return e.Object.compareValues(i,s);default:return this._super(t,i,s)}}}),e.Object.createSubclass(m,e.DataGridDataSource,"DataProviderDataGridDataSource"),m.prototype._registerEventListeners=function(){this._mutationListener=this._handlDataProviderMutationEvent.bind(this),this._refreshListener=this._handlDataProviderRefreshEvent.bind(this),this.dataprovider.addEventListener("mutate",this._mutationListener),this.dataprovider.addEventListener("refresh",this._refreshListener)},m.prototype._handlDataProviderMutationEvent=function(e){var t,i=e.detail.add;if(null!=i)for(t=0;t<i.data.length;t++){var s={};s.source=this,s.operation="insert",s.keys={row:i.metadata[t].key,column:null},s.indexes={row:i.indexes[t],column:-1},s.result=new c(i.indexes[t],i.metadata[t].key,i.data[t],this.columns),this.handleEvent("change",s)}var o=e.detail.remove;if(null!=o)for(t=0;t<o.data.length;t++){var n={};n.source=this,n.operation="delete",n.keys={row:o.metadata[t].key,column:null},n.indexes={row:o.indexes[t],column:-1},this.handleEvent("change",n)}var r=e.detail.update;if(null!=r)for(t=0;t<r.data.length;t++){var l={};l.source=this,l.operation="update",l.keys={row:r.metadata[t].key,column:null},l.indexes={row:r.indexes[t],column:-1},l.result=new c(r.indexes[t],r.metadata[t].key,r.data[t],this.columns),this.handleEvent("change",l)}},c.prototype.getData=function(e){var t=this,i={};return Object.defineProperty(i,"data",{enumerable:!0,get:function(){return t.data[t.columns[e.column]]},set:function(i){t.data[t.columns[e.column]]=i}}),i},c.prototype.getMetadata=function(e){return{keys:{row:this.key,column:this.columns[e.column]}}},c.prototype.getStart=function(e){return"row"===e?this.index:0},c.prototype.getCount=function(e){return"row"===e?1:"column"===e?this.columns.length:0},c.prototype.getExtent=function(){return{row:{extent:1,more:{before:!1,after:!1}},column:{extent:1,more:{before:!1,after:!1}}}},m.prototype._handlDataProviderRefreshEvent=function(){this.handleEvent("change",{operation:"refresh"})},m.prototype.fetchHeaders=function(e,t,i){if(null!=t){var s=e.axis,o={};o.headerRange=e,o.callbacks=t,o.callbackObjects=i,this.pendingHeaderCallback[s]=o}},m.prototype._processPendingHeaderCallbacks=function(e){var t=this.pendingHeaderCallback[e];if(null!=t){var i=t.headerRange,s=t.callbacks,o=t.callbackObjects;this._handleHeaderFetchSuccess(i,s,o),this.pendingHeaderCallback[e]=null}},m.prototype._handleHeaderFetchSuccess=function(e,t,i){var s,o=e.axis,n=e.start,r=e.count;"column"===o&&null!=this.columns?s=new _(n,Math.min(this.columns.length,n+r),this.columns,this.currentSortCriteria):s=null;null!=t&&t.success&&t.success.call(i.success,s,e,null)},u.prototype._setBounds=function(e,t,i){for(var s=0;s<t.length;s+=1){var o=t[s];"row"===o.axis?(this.rowStart=e.fetchParameters.offset?e.fetchParameters.offset:o.start,this.rowEnd=this.rowStart+e.results.length-1):"column"===o.axis&&(this.colStart=o.start,this.colEnd=this.colStart+i.length-1)}},u.prototype.getData=function(e){var t=this,i={};return Object.defineProperty(i,"data",{enumerable:!0,get:function(){return t.results[e.row-t.rowStart].data[t.columns[e.column]]},set:function(i){t.results[e.row-t.rowStart].data[t.columns[e.column]]=i}}),i},u.prototype.getMetadata=function(e){return{keys:{row:this.results[e.row-this.rowStart].metadata.key,column:this.columns[e.column]}}},u.prototype.getCount=function(e){return"row"===e?this.rowEnd-this.rowStart+1:"column"===e?this.colEnd-this.colStart+1:0},u.prototype.getExtent=function(){return{row:{extent:1,more:{before:!1,after:!1}},column:{extent:1,more:{before:!1,after:!1}}}},m.prototype.setUpColumns=function(e){if(null==this.columns||0===this.columns.length){var t=[];if(e.results.length)for(var i=Object.keys(e.results[0].data),s=0;s<i.length;s++)t.push(i[s]);this.columns=t}},m.prototype.getRangeInfo=function(e){for(var t={},i=0;i<e.length;i+=1){var s=e[i];"row"===s.axis?(t.rowStart=s.start,t.rowEnd=t.rowStart+s.count-1):"column"===s.axis&&(t.colStart=s.start,t.colEnd=t.colStart+s.count-1)}return t},m.prototype._createResults=function(e){e.results=[];for(var t=0;t<e.value.data.length;t++){var i={};i.data=e.value.data[t],i.metadata=e.value.metadata[t],e.results.push(i)}},m.prototype.handleFetchResult=function(e,t,i,s){var o=s[0];o.results||(this._createResults(o),o.fetchParameters=o.value.fetchParameters),this.setUpColumns(o),this._processPendingHeaderCallbacks("column"),this._processPendingHeaderCallbacks("row");var n=new u(o,e,this.columns);if(null!=t&&null!=t.success){var r=i?i.success:null;t.success.call(r,n,e)}},m.prototype.fetchCells=function(e,t,i){this.getCount("row");var s=this.getRangeInfo(e),o=s.rowEnd-s.rowStart+1;if(this.fetchByOffset){var n=s.rowStart;this._fetchPromise=this.dataprovider.fetchByOffset({size:o,offset:n,sortCriteria:this.currentSortCriteria})}else(null==this._asyncIterator||this.sortUpdated)&&(this._asyncIterator=this.dataprovider.fetchFirst({size:o,sortCriteria:this.currentSortCriteria})[Symbol.asyncIterator]()),this._fetchPromise=this._asyncIterator.next();this.sortUpdated=!1,Promise.all([this._fetchPromise,this._getCountPromise]).then(this.handleFetchResult.bind(this,e,t,i))},m.prototype.getCapability=function(e){if("sort"===e){var t=this.dataprovider.getCapability(e).attributes;return"multiple"===t||"single"===t?"column":t}return"none"},m.prototype.getCount=function(e){var t=this;if("row"===e){if(void 0!==t.totalRowCount)return t.totalRowCount;t._getCountPromise=this.dataprovider.getTotalSize(),t._getCountPromise.then(function(e){t.totalRowCount=e})}else if("column"===e&&null!=this.columns)return this.columns.length;return-1},m.prototype.getCountPrecision=function(){return"estimate"},m.prototype.indexes=function(){return{row:-1,column:-1}},m.prototype.keys=function(){return{row:null,column:null}},m.prototype.move=function(){return!1},m.prototype.moveOK=function(){return"invalid"},m.prototype.sort=function(e,t,i){this.sortUpdated=!0,this.currentSortCriteria=[{attribute:e.key,direction:e.direction}],null==i&&(i={}),null!=t&&null!=t.success&&t.success.call(i.success)},_.prototype.getData=function(e){return this.headers[e]},_.prototype.getMetadata=function(e){var t=this.getData(e),i={key:t};if(null!=this.sortCriteria)for(var s=0;s<this.sortCriteria.length;s++)this.sortCriteria[s].attribute===t&&(i.sortDirection=this.sortCriteria[s].direction);return i},_.prototype.getLevelCount=function(){return 1},_.prototype.getExtent=function(){return{extent:1,more:{before:!1,after:!1}}},_.prototype.getLabel=function(){return null},_.prototype.getDepth=function(){return 1},_.prototype.getCount=function(){return Math.max(0,this.end-this.start)},l.prototype._setupActions=function(){this.actions={ACTIONABLE:this._handleActionable,EXIT_ACTIONABLE:this._handleExitActionable,TAB_NEXT_IN_CELL:this._handleActionableTab,TAB_PREV_IN_CELL:this._handleActionablePrevTab,EDITABLE:this._handleEditable,EXIT_EDITABLE:this._handleExitEditable,DATA_ENTRY:this._handleDataEntry,EXIT_DATA_ENTRY:this._handleExitDataEntry,EDIT:this._handleEdit,EXIT_EDIT:this._handleExitEdit,CANCEL_EDIT:this._handleCancelEdit,NO_OP:this._handleNoOp,EAT:this._handleEat,FOCUS_LEFT:this._handleFocusLeft,FOCUS_RIGHT:this._handleFocusRight,FOCUS_UP:this._handleFocusUp,FOCUS_DOWN:this._handleFocusDown,FOCUS_ROW_FIRST:this._handleFocusRowFirst,FOCUS_ROW_LAST:this._handleFocusRowLast,FOCUS_COLUMN_FIRST:this._handleFocusColumnFirst,FOCUS_COLUMN_LAST:this._handleFocusColumnLast,FOCUS_COLUMN_HEADER:this._handleFocusColumnHeader,FOCUS_COLUMN_END_HEADER:this._handleFocusColumnEndHeader,FOCUS_ROW_HEADER:this._handleFocusRowHeader,FOCUS_ROW_END_HEADER:this._handleFocusRowEndHeader,READ_CELL:this.readCurrentContent,SORT:this._handleSortKey,SELECT_DISCONTIGUOUS:this._handleSelectDiscontiguous,SELECT_EXTEND_LEFT:this._handleExtendSelectionLeft,SELECT_EXTEND_RIGHT:this._handleExtendSelectionRight,SELECT_EXTEND_UP:this._handleExtendSelectionUp,SELECT_EXTEND_DOWN:this._handleExtendSelectionDown,SELECT_ROW:this._handleSelectRow,SELECT_COLUMN:this._handleSelectColumn,SELECT_ALL:this._handleSelectAll,CUT:this._handleCut,CANCEL_REORDER:this._handleCancelReorder,PASTE:this._handlePaste}},l.prototype._getActionFromKeyDown=function(e,t,i){var s={cellOrHeader:t,isLabel:i,readOnly:!this._isCellEditable(),currentMode:this._getCurrentMode(),activeMove:null!=this.m_cutCells,rowMove:this._isMoveEnabled("row"),columnSort:"column"===t&&this._isDOMElementSortable(this._getActiveElement()),selection:this._isSelectionEnabled(),selectionMode:this.m_options.getSelectionMode(),multipleSelection:this.isMultipleSelection()};return this.actions[this.m_keyboardHandler.getAction(e,s)]},l.prototype.isActionableMode=function(){return"actionable"===this.m_currentMode},l.prototype.setActionableMode=function(e){this.m_currentMode=e?"actionable":"navigation",this._setAccInfoText(this.isActionableMode()?"accessibleActionableMode":"accessibleNavigationMode")},l.prototype._handleActionable=function(e,t){return this._enterActionableMode(t),!1},l.prototype._handleExitActionable=function(e,t){return this._exitActionableMode(),this._highlightActive(),!1},l.prototype._handleActionableTab=function(e,t){var i=this.getFocusableElementsInNode(t);return i.length>0&&e.target===i[i.length-1]&&(i[0].focus(),!0)},l.prototype._handleActionablePrevTab=function(e,t){var i=this.getFocusableElementsInNode(t);return i.length>0&&e.target===i[0]&&(i[i.length-1].focus(),!0)},l.prototype._getEditMode=function(){return null==this.m_editMode&&(this.m_editMode=this.m_options.getEditMode()),this.m_editMode},l.prototype._getCurrentMode=function(){return null==this.m_currentMode&&(this.m_currentMode="navigation"),this.m_currentMode},l.prototype._isEditOrEnter=function(){return"edit"===this._getCurrentMode()},l.prototype._isGridEditable=function(){var e=this._getEditMode();return"cellNavigation"===e||"cellEdit"===e},l.prototype._isCellEditable=function(){return"cellEdit"===this._getEditMode()},l.prototype._handleEditable=function(e,t){return this._isGridEditable()?(this.m_editMode=null,this.m_setOptionCallback("editMode","cellEdit",{_context:{writeback:!0,internalSet:!0}}),this.m_utils.removeCSSClassName(this.m_root,this.getMappedStyle("readOnly")),this.m_utils.addCSSClassName(this.m_root,this.getMappedStyle("editable")),this._updateEdgeCellBorders(""),this._setAccInfoText("accessibleEditableMode"),this._setEditableClone(t)):this._handleActionable(e,t),!1},l.prototype._handleExitEditable=function(e,t){this.m_editMode=null,this.m_setOptionCallback("editMode","cellNavigation",{_context:{writeback:!0,internalSet:!0}}),this.m_utils.addCSSClassName(this.m_root,this.getMappedStyle("readOnly")),this.m_utils.removeCSSClassName(this.m_root,this.getMappedStyle("editable")),this._updateEdgeCellBorders("none"),this._setAccInfoText("accessibleNavigationMode"),delete this.m_editableClone},l.prototype._handleDataEntry=function(e,t){var i={event:e,ui:{cell:t,cellContext:t[this.getResources().getMappedAttribute("context")]}};return this.fireEvent("beforeEdit",i)&&(this._reRenderCell(t,"edit",this.getMappedStyle("cellEdit"),this.m_editableClone),this._enableAllFocusableElements(t),this._overwriteFlag=!0,this._setFocusToFirstFocusableElement(t)?this.m_currentMode="edit":this.m_utils.removeCSSClassName(t,this.getMappedStyle("cellEdit")),this._overwriteFlag=!1),!1},l.prototype._handleExitDataEntry=function(e,t){return this._leaveEditing(e,t,!1)},l.prototype._handleEdit=function(e,t){var i={event:e,ui:{cell:t,cellContext:t[this.getResources().getMappedAttribute("context")]}},s=this.fireEvent("beforeEdit",i);if(s){this._reRenderCell(t,"edit",this.getMappedStyle("cellEdit"),this.m_editableClone);var n=this;o.getContext(t).getBusyContext().whenReady().then(function(){n._enableAllFocusableElements(t),n._setFocusToFirstFocusableElement(t)?n.m_currentMode="edit":n.m_utils.removeCSSClassName(t,n.getMappedStyle("cellEdit"))})}else s=!1,this._enterActionableMode(t);return s},l.prototype._handleExitEdit=function(e,t){return this._leaveEditing(e,t,!1)},l.prototype._handleCancelEdit=function(e,t){return!!this._leaveEditing(e,t,!0)&&(this._setEditableClone(t),!0)},l.prototype._leaveEditing=function(e,t,i){var s={event:e,ui:{cell:t,cellContext:t[this.getResources().getMappedAttribute("context")],cancelEdit:i}};i||(this._disableAllFocusableElements(t),this._highlightActive());var o=this.fireEvent("beforeEditEnd",s);return o?(this.m_currentMode="navigation",this._disableAllFocusableElements(t),this._highlightActive(),this._reRenderCell(t,"navigation",this.getMappedStyle("cellEdit"),this.m_editableClone)):(o=!1,this._scrollToActive(this.m_active),this._enableAllFocusableElements(t),this._setFocusToFirstFocusableElement(t)),o},l.prototype._handleFocusKey=function(e,t,i,s,o){var n,r=!0,l=!0;if(null!=this.m_active){if("cell"===this.m_active.type){if(this._isEditOrEnter()?(n=!0,r=this._leaveEditing(e,t,!1),l=!1):this.isActionableMode()&&this._exitActionableMode(),r){var a=this.m_active,h=this.handleFocusChange(i,s,e,l,o);return this._isGridEditable()&&a!==this.m_active&&n&&this.m_utils.isTouchDevice()?this._handleDataEntry(e,this._getActiveElement()):h}return!0}if("header"===this.m_active.type)return this.handleHeaderFocusChange(i,e,s,o);if("label"===this.m_active.type)return this.handleLabelFocusChange(i,e,s,o)}return!1},l.prototype._handleFocusLeft=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.LEFT_KEY,!1,!1)},l.prototype._handleFocusRight=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.RIGHT_KEY,!1,!1)},l.prototype._handleFocusUp=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.UP_KEY,!1,!1)},l.prototype._handleFocusDown=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.DOWN_KEY,!1,!1)},l.prototype._handleFocusRowFirst=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.PAGEUP_KEY,!1,!1)},l.prototype._handleFocusRowLast=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.PAGEDOWN_KEY,!1,!1)},l.prototype._handleFocusColumnFirst=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.HOME_KEY,!1,!1)},l.prototype._handleFocusColumnLast=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.END_KEY,!1,!1)},l.prototype._handleFocusRowHeader=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.LEFT_KEY,!1,!0)},l.prototype._handleFocusRowEndHeader=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.RIGHT_KEY,!1,!0)},l.prototype._handleFocusColumnHeader=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.UP_KEY,!1,!0)},l.prototype._handleFocusColumnEndHeader=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.DOWN_KEY,!1,!0)},l.prototype._handleSelectRow=function(e,t){var i,s,o,n;if(!this._isSelectionEnabled()||!this.isMultipleSelection()&&"row"!==this.m_options.getSelectionMode())return!1;if(this.m_utils.containsCSSClassName(t,this.getMappedStyle("cell")))i=n=this.m_active.indexes.row,s=n,o=this.m_rowHeaderLevelCount-1;else{if(null==this.m_active||"header"!==this.m_active.type||-1===this.m_active.axis.indexOf("row"))return!1;if(n=this.m_active.index,o=this.m_active.level,this.m_rowHeaderLevelCount-1===o)i=n,s=n;else{var r=this._getActiveElement();s=(i=this._getAttribute(r.parentNode,"start",!0))+this._getAttribute(r.parentNode,"extent",!0)-1}}return this.m_selectionFrontier&&this.m_selectionFrontier.axis&&-1!==this.m_selectionFrontier.axis.indexOf("column")?(this._handleSelectAll(e),!0):(this.setHeaderSelectionFrontier("row",s,n,o,t,!0),this._selectEntireRow(i,s,e),this._setAccInfoText("accessibleRowSelected",{row:n+1}),!0)},l.prototype._handleSelectColumn=function(e,t){var i,s,o,n;if(!this._isSelectionEnabled()||!this.isMultipleSelection()||"cell"!==this.m_options.getSelectionMode())return!1;if(this.m_utils.containsCSSClassName(t,this.getMappedStyle("cell")))i=n=this.m_active.indexes.column,s=n,o=this.m_columnHeaderLevelCount-1;else{if(null==this.m_active||"header"!==this.m_active.type||-1===this.m_active.axis.indexOf("column"))return!1;if(n=this.m_active.index,o=this.m_active.level,this.m_columnHeaderLevelCount-1===o)i=n,s=n;else{var r=this._getActiveElement();s=(i=this._getAttribute(r.parentNode,"start",!0))+this._getAttribute(r.parentNode,"extent",!0)-1}}return this.m_selectionFrontier&&this.m_selectionFrontier.axis&&-1!==this.m_selectionFrontier.axis.indexOf("row")?(this._handleSelectAll(e),!0):(this.setHeaderSelectionFrontier("column",s,n,o,t,!0),this._selectEntireColumn(i,s,e),this._setAccInfoText("accessibleColumnSelected",{column:n+1}),!0)},l.prototype._handleSelectDiscontiguous=function(e,t){return this.setDiscontiguousSelectionMode(!this.m_discontiguousSelection),!0},l.prototype._handleExtendSelectionLeft=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.LEFT_KEY,!0,!1)},l.prototype._handleExtendSelectionRight=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.RIGHT_KEY,!0,!1)},l.prototype._handleExtendSelectionUp=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.UP_KEY,!0,!1)},l.prototype._handleExtendSelectionDown=function(e,t){return this._handleFocusKey(e,t,l.keyCodes.DOWN_KEY,!0,!1)},l.prototype._handleSortKey=function(e,t){return"true"===t.getAttribute(this.getResources().getMappedAttribute("sortable"))?(this._handleKeyboardSort(t,e),!0):this._handleActionable(e,t)},l.prototype._handleNoOp=function(e,t){return!1},l.prototype._handleEat=function(e,t){return!0};var p=function(e){this.grid=e};p.prototype.getAction=function(e,t){var i=e.keyCode,s=this.grid.m_utils.ctrlEquivalent(e),o=e.shiftKey,n=e.altKey,r=l.keyCodes,a=t.cellOrHeader,h=t.readOnly,d=t.currentMode,m=t.activeMove,c=t.rowMove,u=t.columnSort,_=t.selection,p=t.selectionMode,g=t.multipleSelection;switch(i){case r.TAB_KEY:if("actionable"===d)return o?"TAB_PREV_IN_CELL":"TAB_NEXT_IN_CELL";if(!h)return o?"FOCUS_LEFT":"FOCUS_RIGHT";break;case r.ENTER_KEY:if("column"===a&&u)return"SORT";if(!n&&h&&"navigation"===d||"cell"!==a)return"ACTIONABLE";if(!h&&!n)return o?"FOCUS_UP":"FOCUS_DOWN";if(n&&h&&"navigation"===d)return"EDITABLE";if(!h&&("navigation"===d||"edit"===d))return"EDIT";break;case r.ESC_KEY:if("actionable"===d)return"EXIT_ACTIONABLE";if(m)return"CANCEL_REORDER";if(h){if(this.grid.m_discontiguousSelection)return"SELECT_DISCONTIGUOUS"}else{if("navigation"===d)return"EXIT_EDITABLE";if("edit"===d)return"CANCEL_EDIT"}break;case r.SPACE_KEY:if(-1!==a.indexOf("row")&&_&&("cell"===p&&g||"row"===p))return"SELECT_ROW";if(-1!==a.indexOf("column")&&_&&"cell"===p&&g)return"SELECT_COLUMN";if("cell"===a)if(h&&"navigation"===d){if(s&&_&&"cell"===p&&g)return"SELECT_COLUMN";if(o&&_&&("cell"===p&&g||"row"===p))return"SELECT_ROW"}else if("navigation"===d)return"DATA_ENTRY";break;case r.PAGEUP_KEY:if("edit"!==d)return"FOCUS_ROW_FIRST";break;case r.PAGEDOWN_KEY:if("edit"!==d)return"FOCUS_ROW_LAST";break;case r.END_KEY:if("edit"!==d)return"FOCUS_COLUMN_LAST";break;case r.HOME_KEY:if("edit"!==d)return"FOCUS_COLUMN_FIRST";break;case r.LEFT_KEY:if("actionable"===d)return"NO_OP";if("edit"!==d)return o&&_&&"cell"===p&&g?"SELECT_EXTEND_LEFT":s?"FOCUS_ROW_HEADER":"FOCUS_LEFT";break;case r.UP_KEY:if("actionable"===d)return"NO_OP";if("edit"!==d)return o&&_&&g?"SELECT_EXTEND_UP":s?"FOCUS_COLUMN_HEADER":"FOCUS_UP";break;case r.RIGHT_KEY:if("actionable"===d)return"NO_OP";if("edit"!==d)return o&&_&&"cell"===p&&g?"SELECT_EXTEND_RIGHT":s?"FOCUS_ROW_END_HEADER":"FOCUS_RIGHT";break;case r.DOWN_KEY:if("actionable"===d)return"NO_OP";if("edit"!==d)return o&&_&&g?"SELECT_EXTEND_DOWN":s?"FOCUS_COLUMN_END_HEADER":"FOCUS_DOWN";break;case r.F2_KEY:if("cell"!==a)return"ACTIONABLE";if(h&&"navigation"===d)return"EDITABLE";if(!h&&"navigation"===d)return"EDIT";break;case r.F8_KEY:if(o&&_&&g)return"SELECT_DISCONTIGUOUS";break;case r.F10_KEY:if(o)return"NO_OP";break;case r.V_KEY:if("navigation"===d&&s&&c)return"PASTE";if(!h&&"navigation"===d)return"DATA_ENTRY";break;case r.X_KEY:if("navigation"===d&&s&&c)return"CUT";if(!h&&"navigation"===d)return"DATA_ENTRY";break;case r.SHIFT_KEY:case r.CTRL_KEY:case r.ALT_KEY:break;case r.A_KEY:if(s&&_&&g)return"SELECT_ALL";case r.NUM5_KEY:if(s&&n)return"READ_CELL";default:if((i<r.F1_KEY||i>r.F15_KEY)&&!h&&"navigation"===d&&"cell"===a)return"DATA_ENTRY"}return"NO_OP"},r.extension._WIDGET_NAME="ojDataGrid",e.CustomElementBridge.register("oj-data-grid",{metadata:r})});