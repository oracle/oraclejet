/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojdvt-base","ojs/internal-deps/dvt/DvtThematicMap"],function(a,f,b,d,c){a.ya("oj.ojThematicMap",f.oj.dvtBaseComponent,{widgetEventPrefix:"oj",options:{load:null,optionChange:null},NU:"",nx:[],zT:"resources/internal-deps/dvt/thematicMap/basemaps/",d1:{ar:"ar",cs:"cs",da:"da",de:"de",el:"el",es:"es",fi:"fi",fr:"fr","fr-ca":"fr_CA",he:"iw",hu:"hu",it:"it",ja:"ja",ko:"ko",nl:"nl",no:"no",pl:"pl",pt:"pt_BR","pt-pt":"pt",ro:"ro",ru:"ru",sk:"sk",sv:"sv",
th:"th",tr:"tr","zh-hans":"zh_CN","zh-hant":"zh_TW"},_ComponentCreate:function(){this._super();this.Xp=[];this.jY=!1;this.Xs=[]},sf:function(a,b,d){return c.ThematicMap.newInstance(a,b,d)},hi:function(a){var b=a.subId;"oj-thematicmap-area"==b?b=a.dataLayer+":area["+a.index+"]":"oj-thematicmap-marker"==b?b=a.dataLayer+":marker["+a.index+"]":"oj-thematicmap-tooltip"==b&&(b="tooltip");return b},jg:function(a){var b={};0<a.indexOf(":area")?(b.subId="oj-thematicmap-area",b.dataLayer=a.substring(0,a.indexOf(":")),
b.index=this.Vg(a)):0<a.indexOf(":marker")?(b.subId="oj-thematicmap-marker",b.dataLayer=a.substring(0,a.indexOf(":")),b.index=this.Vg(a)):"tooltip"==a&&(b.subId="oj-thematicmap-tooltip");return b},Ge:function(){var a=this._super();a.push("oj-thematicmap");return a},ii:function(){var a=this._super();a["oj-dvtbase oj-thematicmap"]={path:"animationDuration",property:"animation-duration"};a["oj-thematicmap-arealayer"]=[{path:"styleDefaults/areaStyle",property:"CSS_BACKGROUND_PROPERTIES"},{path:"styleDefaults/labelStyle",
property:"CSS_TEXT_PROPERTIES"}];a["oj-thematicmap-area"]={path:"styleDefaults/dataAreaDefaults/borderColor",property:"border-top-color"};a["oj-thematicmap-area oj-hover"]={path:"styleDefaults/dataAreaDefaults/hoverColor",property:"border-top-color"};a["oj-thematicmap-area oj-selected"]=[{path:"styleDefaults/dataAreaDefaults/selectedInnerColor",property:"border-top-color"},{path:"styleDefaults/dataAreaDefaults/selectedOuterColor",property:"border-bottom-color"}];a["oj-thematicmap-marker"]=[{path:"styleDefaults/dataMarkerDefaults/labelStyle",
property:"CSS_TEXT_PROPERTIES"},{path:"styleDefaults/dataMarkerDefaults/color",property:"background-color"},{path:"styleDefaults/dataMarkerDefaults/opacity",property:"opacity"},{path:"styleDefaults/dataMarkerDefaults/borderColor",property:"border-top-color"}];return a},ki:function(){return["load","optionChange"]},_setOptions:function(b,c){var d=Object.keys(b).length,f=b.areaLayers,l=this.options.areaLayers,m=b.pointDataLayers;if(1==d&&f&&l&&0<l.length)for(d=0;d<f.length;d++){var m=f[d],n=l[d],p=!0,
r;for(r in m)"areaDataLayer"!=r&&m[r]!=n[r]&&(p=p&&!1);p&&!a.b.mh(n.areaDataLayer,m.areaDataLayer)&&this.Xs.push({options:m.areaDataLayer,parentLayer:m.layer,isADL:!0})}else if(1==d&&m&&this.options.pointDataLayers&&0<this.options.pointDataLayers.length)for(d=0;d<m.length;d++)a.b.mh(this.options.pointDataLayers[d],m[d])||this.Xs.push({options:m[d],parentLayer:m[d].id,isADL:!1});this._super(b,c)},yf:function(){this.XR();var b=this.options.areaLayers;if(this.options.basemap&&b&&!(1>b.length)){this.$ha();
for(var c=0;c<this.Xp.length;c++)if(!this.nx[this.Xp[c]])return;this.Xp=[];this.Rma();var d=(c=this.options.tooltip)?c.renderer:null;d&&(this.options._tooltip=function(b){var c=b.tooltip;try{return d(b)||c}catch(e){return a.q.warn("Showing default tooltip. "+e),c}});if(b)for(c=0;c<b.length;c++){var f=b[c].areaDataLayer;if(f){var l=f._templateRenderer;l&&(f.renderer=this.bC(l,f.markers))}}if(b=this.options.pointDataLayers)for(c=0;c<b.length;c++)(f=b[c])&&(l=f._templateRenderer)&&(f.renderer=this.bC(l,
f.markers));this.options._contextHandler=this.UI();if(this.jY&&0<this.Xs.length){if(this.Ze.isReadyToRender()){for(c=0;c<this.Xs.length;c++)l=this.Xs[c],this.ka.updateLayer(l.options,l.parentLayer,l.isADL);this.Xs=[]}}else this._super(),this.jY=!0;this._trigger("load",null,null)}},bC:function(a){var b=this;return function(c){var d=document.createElement("div");d.style.display="none";d.Bw=b.Ze;b.element.append(d);a({parentElement:d,data:c.data});return(c=d.children[0])?"http://www.w3.org/2000/svg"===
c.namespaceURI?(d.removeChild(c),f(d).remove(),c):b.Hv(c):null}},UI:function(){var b=this;return function(c,d,f,l,m){return{component:a.Components.Tf(b.element),parentElement:c,rootElement:d,data:f,state:l,previousState:m,id:f.id,label:f.label,color:f.color,location:f.location,x:f.x,y:f.y}}},renderDefaultHover:function(a){a.previousState&&a.state.hovered==a.previousState.hovered||this.ka.processDefaultHoverEffect(a.id,a.state.hovered)},renderDefaultSelection:function(a){a.previousState&&a.state.selected==
a.previousState.selected||this.ka.processDefaultSelectionEffect(a.id,a.state.selected)},renderDefaultFocus:function(a){a.previousState&&a.state.focused==a.previousState.focused||this.ka.processDefaultFocusEffect(a.id,a.state.focused)},$ha:function(){var b=this.options.basemap;if(b){var c=a.ba.Bg();c!==this.NU&&(this.NU=c,this.nx=[]);var d=this.options.areaLayers;if(d)for(var f=0;f<d.length;f++){var l=d[f].layer;l&&this.ZY(b,l,c)}d=this.options.pointDataLayers;!this.options.mapProvider&&d&&0<d.length&&
this.ZY(b,"cities",c)}},bZ:function(b,c){if(!this.nx[b]){var d=this,k=f.getScript(a.ba.lb(b),function(){d.nx[b]=!0;d.yf()});c&&k.fail(function(){d.nx[b]=!0;d.yf()})}},ZY:function(b,d,f){var k=!0;try{k=0<Object.keys(c.DvtBaseMapManager.getLayerIds(b,d)).length}catch(l){k=!1}k||((k=this.options.mapProvider)?a.Ia.Aoa(b,d,k):(k=this.zT+"ojthematicmap-"+b+"-"+d+".js",-1==this.Xp.indexOf(k)&&(this.Xp.push(k),this.bZ(k,!1))));if(-1===f.indexOf("en"))for(k=f.toLowerCase().split("-"),f=[k[0]],1<k.length&&
f.unshift(k[0]+"-"+k[1]),2<k.length&&f.unshift(k[0]+"-"+k[2],k[0]+"-"+k[1]+"-"+k[2]),b=b.charAt(0).toUpperCase()+b.slice(1),d=d.charAt(0).toUpperCase()+d.slice(1),b=this.zT+"resourceBundles/"+b+d+"Bundle_",d=0;d<f.length;d++)if(this.d1[f[d]]){b=b+this.d1[f[d]]+".js";-1==this.Xp.indexOf(b)&&(this.Xp.push(b),this.bZ(b,!0));break}},hk:function(a){if("selection"===a.type){var b={},c=a.clientId;b[c]=a.selection;if(this.options.selection)for(var d in this.options.selection)c!==d&&(b[d]=this.options.selection[d]);
this.xd("selection",b)}else this._super(a)},li:function(){var a=this.options.translations,b=this._super();b["DvtUtilBundle.THEMATIC_MAP"]=a.componentName;return b},Rma:function(){var a=this.options.selection;if(a){var b=this.options.pointDataLayers;if(b)for(var c=0;c<b.length;c++)a[b[c].id]&&(b[c].selection=a[b[c].id]);if(b=this.options.areaLayers)for(c=0;c<b.length;c++){var d=b[c].areaDataLayer;d&&a[d.id]&&(d.selection=a[d.id])}}},getArea:function(a,b){var c=this.ka.getAutomation().getData(a,"area",
b);this.Ug(c);return c},getMarker:function(a,b){var c=this.ka.getAutomation().getData(a,"marker",b);this.Ug(c);return c},getContextByNode:function(a){return(a=this.getSubIdByNode(a))&&"oj-thematicmap-tooltip"!==a.subId?a:null},ji:function(){return{areaLayers:["areaDataLayer/areas","areaDataLayer/markers"],pointDataLayers:["markers"]}},sR:function(a){var b=this.options.basemap;a=a.layer?a.layer:"cities";return{basemap:b,layer:a,ids:c.DvtBaseMapManager.getLayerIds(b,a)}}});a.Ia={};a.Ia.aA="DvtBaseMapManager";
a.Ia.RS="_UNPROCESSED_MAPS";a.Ia.El="type";a.Ia.o8="geometry";a.Ia.K7="coordinates";a.Ia.l8="features";a.Ia.C9="properties";a.Ia.o$="FeatureCollection";a.Ia.Nra="GeometryCollection";a.Ia.n$="Feature";a.Ia.QS="Polygon";a.Ia.PS="MultiPolygon";a.Ia.ni="id";a.Ia.X9="shortLabel";a.Ia.P8="longLabel";a.Ia.Aoa=function(b,c,d){var f={},l={},m=d.geo,n=d.propertiesKeys||{};d=m[a.Ia.El];if(d===a.Ia.o$)m[a.Ia.l8].forEach(function(b){a.Ia.Y4(b,n,l,f)});else if(d===a.Ia.n$)a.Ia.Y4(m,n,l,f);else{a.q.error("GeoJSON type of "+
d+" is not supported. Only Feature and FeatureCollection types are supported.");return}0===Object.keys(l).length?a.q.error("No valid Features found in GeoJSON."):(window[a.Ia.aA]||(window[a.Ia.aA]={},window[a.Ia.aA][a.Ia.RS]=[[],[],[]]),window[a.Ia.aA][a.Ia.RS][0].push([b,c,f,l,null,null,0]))};a.Ia.Y4=function(b,c,d,f){var l=b[a.Ia.C9];b=b[a.Ia.o8];if(a.Ia.Jpa(b)){var m=l[c[a.Ia.ni]];if(m){var n=l[c[a.Ia.X9]];c=l[c[a.Ia.P8]];if(n||c)f[m]=[n,c];d[m]=a.Ia.Boa(b)}else a.q.warn("No 'id' value found in the mapProvider.propertiesKey object. A Feature's 'properties' object must have an id in the field specified by the mapProvider.propertiesKey.id value.")}else a.q.warn("A geometry of type "+
b[a.Ia.El]+" is not supported and will be skipped.")};a.Ia.Jpa=function(b){b=b[a.Ia.El];return b===a.Ia.QS||b===a.Ia.PS?!0:!1};a.Ia.Boa=function(b){var c="",d=b[a.Ia.El];b=b[a.Ia.K7];d===a.Ia.QS?c=a.Ia.e5(b):d===a.Ia.PS&&b.forEach(function(b){c+=a.Ia.e5(b)});return c};a.Ia.e5=function(b){var c="";b.forEach(function(b){c+=a.Ia.Opa(b)});return c};a.Ia.Opa=function(a){var b,c,d,f="M";a.forEach(function(a){var e=a[0];a=-a[1];if("M"===f)c=e,d=a,f="x",b="M"+e+" "+a;else{var p=e-c,r=a-d;if("l"==f){if(c==
e){f="v";d=a;b=b+f+r;return}if(d==a){f="h";c=e;b=b+f+p;return}b=b+" "+p+" "+r}else f="l",b=b+"l"+p+" "+r;c=e;d=a}});return b+"Z"}});