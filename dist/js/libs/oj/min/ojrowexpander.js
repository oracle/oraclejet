/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojdatasource-common"],function(e,t,n){e.EmptyNodeSet=function(e,t){this.m_parent=e,this.m_start=t},e.EmptyNodeSet.prototype.getParent=function(){return this.m_parent},e.EmptyNodeSet.prototype.getStart=function(){return this.m_start},e.EmptyNodeSet.prototype.getCount=function(){return 0},e.EmptyNodeSet.prototype.getData=function(e){return null},e.EmptyNodeSet.prototype.getMetadata=function(e){return null},e.FlattenedNodeSet=function(e,t){this.m_nodeSet=e,this.m_start=t},e.FlattenedNodeSet.prototype.getParent=function(){return this.m_nodeSet.getParent()},e.FlattenedNodeSet.prototype.getStart=function(){return null!=this.m_start?this.m_start:this.m_nodeSet.getStart()},e.FlattenedNodeSet.prototype.getCount=function(){return void 0===this.m_count&&(this.m_count=this._getCount(this.m_nodeSet,0),null!=this.m_start&&(this.m_count=this.m_count-this.m_start)),this.m_count},e.FlattenedNodeSet.prototype._getCount=function(e,t){var n,a,s,o;if(n=e.getStart(),t+=a=e.getCount(),e.getChildNodeSet)for(s=0;s<a;s++)null!=(o=e.getChildNodeSet(s+n))&&(t=this._getCount(o,t));return t},e.FlattenedNodeSet.prototype.getData=function(e){return this._getDataOrMetadata(this.m_nodeSet,e,{index:this.m_nodeSet.getStart()},this._getData)},e.FlattenedNodeSet.prototype.getMetadata=function(e){return this._getDataOrMetadata(this.m_nodeSet,e,{index:this.m_nodeSet.getStart()},this._getMetadata)},e.FlattenedNodeSet.prototype._getMetadata=function(e,t){return e.getMetadata(t)},e.FlattenedNodeSet.prototype._getData=function(e,t){return e.getData(t)},e.FlattenedNodeSet.prototype._getDataOrMetadata=function(e,t,n,a){var s,o,i,r,d,l;for(s=e.getStart(),o=e.getCount(),i=0;i<o;i++){if((r=n.index)===t)return a.call(this,e,i+s);if(n.index=r+1,e.getChildNodeSet&&null!=(d=e.getChildNodeSet(i+s))&&null!=(l=this._getDataOrMetadata(d,t,n,a)))return l}return null},e.MergedNodeSet=function(e,t,n){this.m_nodeSet1=e,this.m_nodeSet2=t,this.m_mergeAt=this._findIndex(n)},e.MergedNodeSet.prototype._findIndex=function(e){var t,n,a;for(n=(t=this.m_nodeSet1.getStart())+this.m_nodeSet1.getCount(),a=t;a<n;a++)if(e===this.m_nodeSet1.getMetadata(a).key)return a;return n-1},e.MergedNodeSet.prototype.getParent=function(){return this.m_nodeSet1.getParent()},e.MergedNodeSet.prototype.getStart=function(){return this.m_nodeSet1.getStart()},e.MergedNodeSet.prototype.getCount=function(){return this.m_nodeSet1.getCount()+this.m_nodeSet2.getCount()},e.MergedNodeSet.prototype.getData=function(e){var t,n,a;return n=(t=this._getRelativeIndex(e)).set,a=t.index,n.getData(a)},e.MergedNodeSet.prototype.getMetadata=function(e){var t,n,a;return n=(t=this._getRelativeIndex(e)).set,a=t.index,n.getMetadata(a)},e.MergedNodeSet.prototype._getRelativeIndex=function(e){if(e<=this.m_mergeAt)return{set:this.m_nodeSet1,index:e};var t=this.m_nodeSet2.getCount();return e>this.m_mergeAt+t?{set:this.m_nodeSet1,index:e-t}:{set:this.m_nodeSet2,index:e-this.m_mergeAt-1+this.m_nodeSet2.getStart()}},e.NodeSetWrapper=function(e,t,n,a){this.m_nodeSet=e,this.m_callback=t,this.m_range=n,this.m_collapsedKeys=a},e.NodeSetWrapper.prototype.getParent=function(){return this.m_nodeSet.getParent()},e.NodeSetWrapper.prototype.getStart=function(){return null!=this.m_range?this.m_range.start:this.m_nodeSet.getStart()},e.NodeSetWrapper.prototype.getCount=function(){var e,t;return e=this.m_nodeSet.getStart(),t=this.m_nodeSet.getCount(),null!=this.m_range&&(t=Math.min(this.m_range.count,t),this.m_range.start<e&&(t=0)),t},e.NodeSetWrapper.prototype.getData=function(e){return this.m_nodeSet.getData(this._getRelativeIndex(e))},e.NodeSetWrapper.prototype.getMetadata=function(e){var t,n;return(t=this.m_nodeSet.getMetadata(this._getRelativeIndex(e))).index=e,t.parentKey=this.getParent(),n=t.key,this.m_callback.call(null,n,t),t},e.NodeSetWrapper.prototype.getChildNodeSet=function(t){var n;return null!=this.m_collapsedKeys&&-1!=this.m_collapsedKeys.indexOf(this.m_nodeSet.getMetadata(t).key)||!this.m_nodeSet.getChildNodeSet||null==(n=this.m_nodeSet.getChildNodeSet(t))?null:new e.NodeSetWrapper(n,this.m_callback,null,this.m_collapsedKeys)},e.NodeSetWrapper.prototype._getRelativeIndex=function(e){return null==this.m_range?e:e-this.m_range.start+this.m_nodeSet.getStart()},e.FlattenedTreeDataSource=function(t,n){this.m_wrapped=t,this.m_options=n||{},e.FlattenedTreeDataSource.superclass.constructor.call(this)},e.Object.createSubclass(e.FlattenedTreeDataSource,e.DataSource,"oj.FlattenedTreeDataSource"),e.FlattenedTreeDataSource.prototype.Init=function(){var t;e.FlattenedTreeDataSource.superclass.Init.call(this),this.m_wrapped.on("change",this._handleModelEvent.bind(this)),this.m_busy=!1,this.m_fetchSize=parseInt(this.m_options.fetchSize,10),isNaN(this.m_fetchSize)&&(this.m_fetchSize=25),this.m_maxCount=parseInt(this.m_options.maxCount,10),isNaN(this.m_maxCount)&&(this.m_maxCount=500),t=this.m_options.expanded,Array.isArray(t)?this.m_expandedKeys=t:("all"===t&&(this.m_collapsedKeys=[]),this.m_expandedKeys=[]),this.m_cache=[]},e.FlattenedTreeDataSource.prototype.handleEvent=function(t,n){return e.FlattenedTreeDataSource.superclass.handleEvent.call(this,t,n)},e.FlattenedTreeDataSource.prototype.Destroy=function(){delete this.m_cache,delete this.m_expandedKeys,delete this.m_collapsedKeys,this.m_queue&&delete this.m_queue,this.m_wrapped.off("change"),this.m_wrapped.Destroy&&this.m_wrapped.Destroy()},e.FlattenedTreeDataSource.prototype.getFetchSize=function(){return this.m_fetchSize},e.FlattenedTreeDataSource.prototype.getMaxCount=function(){return this.m_maxCount},e.FlattenedTreeDataSource.prototype.getExpandedKeys=function(){return this.m_expandedKeys},e.FlattenedTreeDataSource.prototype.getOption=function(e){return null!=this.m_options?this.m_options[e]:null},e.FlattenedTreeDataSource.prototype.getWrappedDataSource=function(){return this.m_wrapped},e.FlattenedTreeDataSource.prototype._getFetchSizeToUse=function(e){var t,n;return t=this.getFetchSize(),n=this.getMaxCount(),-1===t?-1===e?n:e:-1===e?Math.min(t,n):t},e.FlattenedTreeDataSource.prototype.fetchRows=function(e,t){this.m_busy=!0,this._isExpandAll()?this._fetchRowsFromDescendants(e,t):this._fetchRowsFromChildren(e,t)},e.FlattenedTreeDataSource.prototype._fetchRowsFromChildren=function(t,n){var a,s,o,i,r,d,l,h,c,p,u;if(t.start>this._getLastIndex()){if(a=this._getMaxFetchSize(),this._getLastIndex()<0)return(c={}).start=t.start,c.count=Math.min(a,t.count),void this.m_wrapped.fetchChildren(null,c,{success:function(e){this._handleFetchSuccess(e,null,0,t,c,0,n)}.bind(this),error:function(e){this._handleFetchError(e,n)}.bind(this)});if(a>0)return s=this._getLastEntry(),o=s.parent,i=this.m_wrapped.getChildCount(o),r=s.index,d=s.depth,void(-1===i||r<i-1?(h=this._getFetchSizeToUse(i),(c={}).start=r+1,c.count=-1===i?Math.min(h,t.count):Math.min(a,Math.min(Math.min(h,t.count),i-c.start)),this.m_wrapped.fetchChildren(o,c,{success:function(e){this._handleFetchSuccess(e,o,d,t,c,i,n)}.bind(this),error:function(e){this._handleFetchError(e,n)}.bind(this)})):(p=s.key,u=this.m_wrapped.getChildCount(p),(this._isExpanded(p)&&(-1===u||u>0)?this._fetchFromAncestors(s,d+1,t,n,a):this._fetchFromAncestors(o,d,t,n,a))||(l=new e.EmptyNodeSet(null,t.start),null!=n&&null!=n.success&&n.success.call(null,l),this.m_busy=!1)))}this.handleMaxCountReached(t,n),this.m_busy=!1},e.FlattenedTreeDataSource.prototype.moveOK=function(e,t,n){return this.m_wrapped.moveOK(e,t,n)},e.FlattenedTreeDataSource.prototype.move=function(e,t,n,a){this.m_wrapped.move(e,t,n,a)},e.FlattenedTreeDataSource.prototype._getMaxFetchSize=function(){return this.getMaxCount()-(this._getLastIndex()+1)},e.FlattenedTreeDataSource.prototype._handleFetchError=function(e,t){null!=t&&null!=t.error&&t.error.call(null,e),this.m_busy=!1},e.FlattenedTreeDataSource.prototype._handleFetchSuccess=function(t,n,a,s,o,i,r,d){var l,h,c,p;l=[],this._processNodeSet(t,n,a,l),h={start:s.start,count:t.getCount()},t=new e.NodeSetWrapper(t,this.insertMetadata.bind(this),h),0!==l.length?((c=[]).push(l),(p={}).callbacks={success:function(e){this._verifyFetchResults(e,n,a,s,o,i,r,d)}.bind(this),error:function(e){this._handleFetchError(e,r)}.bind(this)},p.nodeSet=t,p.keys=[],this._syncExpandRows(c,p)):this._verifyFetchResults(t,n,a,s,o,i,r,d)},e.FlattenedTreeDataSource.prototype._verifyFetchResults=function(t,n,a,s,o,i,r,d){var l,h,c,p,u,_,g;if(null!=d&&null!=(l=d.prevNodeSet)&&(h=l.getStart()+l.getCount()-1,c=l.getMetadata(h).key,p=new e.MergedNodeSet(l,t,c)),t.getCount()<s.count&&null!=n&&a>0)(u={}).start=s.start+t.getCount(),u.count=s.count-t.getCount(),(_={}).prevNodeSet=null==p?t:p,g=this._fetchFromAncestors(n,a,u,r,void 0,_);else if(t.getCount()>s.count){var y=t.getCount()-s.count;null!=p?(p=new e.NodeSetWrapper(p,this.insertMetadata.bind(this),{start:p.getStart(),count:p.getCount()-y}),this._removeEntry(p.getStart()+p.getCount(),y)):(t=new e.NodeSetWrapper(t,this.insertMetadata.bind(this),{start:t.getStart(),count:t.getCount()-y}),this._removeEntry(t.getStart()+t.getCount(),y))}g||null!=r&&null!=r.success&&r.success.call(null,null==p?t:p),this.m_busy=!1},e.FlattenedTreeDataSource.prototype.getChildCount=function(e){return this.m_wrapped.getChildCount(e)},e.FlattenedTreeDataSource.prototype._fetchFromAncestors=function(e,t,n,a,s,o){var i,r,d,l,h,c,p,u,_,g;for(g=!1,void 0===s&&(s=this._getMaxFetchSize()),this._isBatchFetching()&&(u={queueOnly:!0}),p=this._getFetchSizeToUse(-1),i=this._getLastIndex();i>=0;i--)if(r=this._getEntry(i),(d=r.depth)<t){if(e=r.parent,l=this.m_wrapped.getChildCount(e),h=r.index,(c=-1===l)||h<l-1){if((_={}).start=h+1,c?(_.count=Math.min(s,Math.max(0,p)),u=void 0):_.count=Math.min(s,Math.min(p,l-_.start)),0==_.count)break;this.m_wrapped.fetchChildren(e,_,{success:function(t){this._handleFetchSuccess(t,e,d,n,_,l,a,o)}.bind(this),error:function(e){this._handleFetchError(e,a)}.bind(this)},u),g=!0;break}t-=1}return null!=u&&(this.m_wrapped.fetchChildren(e,{start:n.count,count:0},{success:function(t){this._handleFetchSuccess(t,e,d,n,_,l,a,o)}.bind(this),error:function(e){this._handleFetchError(e,a)}.bind(this)}),g=!0),g},e.FlattenedTreeDataSource.prototype._processNodeSet=function(e,t,n,a){var s,o,i,r;for(s=e.getStart(),o=e.getCount(),i=0;i<o;i++)r=e.getMetadata(s+i).key,this._addEntry(r,n,s+i,t),this._isExpanded(r)&&a.push(r)},e.FlattenedTreeDataSource.prototype.insertMetadata=function(e,t){this._isExpanded(e)&&!t.leaf?t.state="expanded":t.leaf?t.state="leaf":t.state="collapsed"},e.FlattenedTreeDataSource.prototype._fetchRowsFromDescendants=function(e,t){var n={maxCount:this.getMaxCount()};this._getLastIndex()>=0&&(n.start=this._getEntry(this._getLastIndex()).key),this.m_wrapped.fetchDescendants(null,{success:function(n){this._handleFetchDescendantsSuccess(n,e,t)}.bind(this),error:function(e){this._handleFetchError(e,t)}.bind(this)},n)},e.FlattenedTreeDataSource.prototype.getSortCriteria=function(){return this.m_wrapped.getSortCriteria()},e.FlattenedTreeDataSource.prototype._handleFetchDescendantsSuccess=function(t,n,a){var s,o,i,r,d;n.start>this._getLastIndex()?(s=this._getMaxFetchSize(),o=Math.min(s,n.count),t=new e.NodeSetWrapper(t,this.insertMetadata.bind(this),null,this.m_collapsedKeys),this._getLastIndex()>=0?(i=this._getLastEntry(),r={index:0,found:!1,count:0},this._processDescendantsNodeSet(t,null,0,i,o,r),d=r.index+1):(r={count:0},this._processDescendantsNodeSet(t,null,0,null,o,r),d=0),null!=a&&null!=a.success&&(t=null!=r?0===r.count?new e.EmptyNodeSet(null,n.start):new e.FlattenedNodeSet(t,d):new e.FlattenedNodeSet(t),a.success.call(null,t))):this.handleMaxCountReached(n,a),this.m_busy=!1,this._processQueue()},e.FlattenedTreeDataSource.prototype._processDescendantsNodeSet=function(e,t,n,a,s,o){var i,r,d,l,h,c;for(i=e.getStart(),r=e.getCount(),d=0;d<r;d++){if(o.count==s)return;h=(l=e.getMetadata(i+d)).key,o.checkDepth&&a.depth===n&&(o.found=!0,o.checkDepth=!1),(null==a||o.found)&&(this._addEntry(h,n,i+d,t),o.count=o.count+1,l.leaf?l.state="leaf":l.state="expanded"),null==a||o.found||(h===a.key?l.leaf||this._isExpanded(h)?o.found=!0:o.checkDepth=!0:o.index=o.index+1),e.getChildNodeSet&&this._isExpanded(h)&&null!=(c=e.getChildNodeSet(d))&&this._processDescendantsNodeSet(c,h,n+1,a,s,o)}},e.FlattenedTreeDataSource.prototype.expand=function(e){this._expand(e)},e.FlattenedTreeDataSource.prototype._expand=function(t,n){var a,s,o;this.m_busy=!0,a=this.m_wrapped.getChildCount(t),s=this._getFetchSizeToUse(a),o=this.getMaxCount(),(this._getLastIndex()+1!==o||this.getIndex(t)!=o-1)&&0!=s?this.m_wrapped.fetchChildren(t,{start:0,count:s},{success:function(e){this.handleExpandSuccess(t,e,a,n)}.bind(this),error:function(e){this.handleExpandError(t,e)}.bind(this)}):this.handleExpandSuccess(t,new e.EmptyNodeSet(t,0),0,n)},e.FlattenedTreeDataSource.prototype._processQueue=function(){var e,t;if(this.m_queue&&this.m_queue.length>0){for(e=this.m_queue.length-1;e>=0;e--)t=this.m_queue[e],this.collapse(t.key);this.m_queue.length=0}},e.FlattenedTreeDataSource.prototype._queueOp=function(e,t){null==this.m_queue&&(this.m_queue=[]),this.m_queue.push({op:e,key:t})},e.FlattenedTreeDataSource.prototype.collapse=function(e){var t,n,a,s,o,i,r,d;if(this.m_busy)this._queueOp("collapse",e);else if(t=this.getIndex(e)+1,null!=(n=this._getEntry(t-1))){for(a=0,s=n.depth,o=this._getLastIndex(),r=t;r<o+1;r++){var l=this._getEntry(r).depth;if(l>s)a+=1;else if(l==s)break}if(0!=a){for(this._isExpandAll()?this.m_collapsedKeys.push(e):this._removeExpanded(e),d=[],i=0;i<a;i++)d.push({key:this._getEntry(t+i).key,index:t+i});this._removeEntry(t,a),this.removeRows(d),this.handleEvent("collapse",{rowKey:e})}else this.handleEvent("collapse",{rowKey:e})}},e.FlattenedTreeDataSource.prototype._isExpanded=function(e){return this._isExpandAll()?!(this.m_collapsedKeys&&this.m_collapsedKeys.length>0)||-1===this._getCollapsedKeyIndex(e):!!(this.m_expandedKeys&&this.m_expandedKeys.length>0)&&this._getExpandedKeyIndex(e)>-1},e.FlattenedTreeDataSource.prototype._getCollapsedKeyIndex=function(e){return this._getKeyIndex(this.m_collapsedKeys,e)},e.FlattenedTreeDataSource.prototype._getExpandedKeyIndex=function(e){return this._getKeyIndex(this.m_expandedKeys,e)},e.FlattenedTreeDataSource.prototype._getKeyIndex=function(e,t){var n,a;for(a=-1,n=0;n<e.length;n++)e[n]===t&&(a=n);return a},e.FlattenedTreeDataSource.prototype._removeExpanded=function(e){var t=this._getExpandedKeyIndex(e);t>-1&&this.m_expandedKeys.splice(t,1)},e.FlattenedTreeDataSource.prototype._removeCollapsed=function(e){var t=this._getCollapsedKeyIndex(e);t>-1&&this.m_collapsedKeys.splice(t,1)},e.FlattenedTreeDataSource.prototype.handleExpandError=function(e,t){this.handleEvent("expand",{rowKey:e})},e.FlattenedTreeDataSource.prototype.handleExpandSuccess=function(t,n,a,s){var o,i,r,d,l,h,c,p,u,_,g,y,m,f,S;for(n=new e.NodeSetWrapper(n,this.insertMetadata.bind(this)),i=o=this.getIndex(t)+1,r=n.getStart(),d=n.getCount(),h=(l=this._getEntry(o-1)).depth+1,u=[],_=r;_<d;_++)p=(c=n.getMetadata(_)).key,this._isExpanded(p)&&u.push(p),this._insertRow(o,c,l.key,_,h),o++;if(this._isExpandAll()?this._removeCollapsed(t):-1===this.m_expandedKeys.indexOf(t)&&this.m_expandedKeys.push(t),null!=s&&(y=s.queue,m=s.prevNodeSetInfo),null!=m&&(n=new e.MergedNodeSet(m.nodeSet,n,t)),0==u.length&&(void 0===y||0==y.length)){if(null!=m){if(null!=(S=m.callbacks))return S.success.call(null,n),void(this.m_busy=!1);this.insertRows(m.firstIndex,m.firstKey,n)}else this.insertRows(i,t,n);if(f=this.getMaxCount(),-1===a&&d===this.getFetchSize()||a>d||o==f?this._deleteAllRowsBelow(o):this._getLastIndex()>=f&&this._deleteAllRowsBelow(f),null!=m)for(g=0;g<m.keys.length;g++)this.handleEvent("expand",{rowKey:m.keys[g]});this.m_busy=!1,this.handleEvent("expand",{rowKey:t})}else void 0===y&&(y=[]),u.length>0&&y.push(u),void 0===m&&((m={}).firstIndex=i,m.firstKey=t,m.keys=[]),m.nodeSet=n,m.keys.push(t),this._syncExpandRows(y,m);this.m_busy=!1,y&&0==y.length&&this._processQueue()},e.FlattenedTreeDataSource.prototype._syncExpandRows=function(e,t){var n,a;a=(n=e[e.length-1]).shift(),0===n.length&&e.pop(),this._expand(a,{prevNodeSetInfo:t,queue:e})},e.FlattenedTreeDataSource.prototype._expandRows=function(e){var t,n;for(this._isBatchFetching()&&(t={queueOnly:!0}),n=0;n<e.length;n++)n==e.length-1?this._expand(e[n]):this._expand(e[n],t)},e.FlattenedTreeDataSource.prototype._insertRow=function(e,t,n,a,s){var o;o=t.key,e<=this._getLastIndex()?this._addEntry(o,s,a,n,e):this._addEntry(o,s,a,n)},e.FlattenedTreeDataSource.prototype._deleteAllRowsBelow=function(e,t){var n;null==t&&(t=this._getLastIndex()+1-e),n=[];for(var a=0;a<t;a++)n.push({key:this._getEntry(e+a).key,index:e+a});this._removeEntry(e,t),this.removeRows(n)},e.FlattenedTreeDataSource.prototype._handleModelEvent=function(e){var t,n,a,s;t=e.operation,n=e.parent,a=Array.isArray(n)?n[n.length-1]:n,s=e.index,"insert"===t?this._handleInsertEvent(a,s,e.data):"delete"===t?this._handleDeleteEvent(a,s):"refresh"===t&&this._handleRefreshEvent(a)},e.FlattenedTreeDataSource.prototype._handleInsertEvent=function(e,t,n){var a,s,o,i;a=this.getIndex(e),s=this._getEntry(a).depth+1,o=a+t+1,i=n.getMetadata(n.getStart()),this._insertRow(o,i,e,t,s)},e.FlattenedTreeDataSource.prototype._handleDeleteEvent=function(t,n){var a,s,o,i,r,d;for(a=this.getIndex(t),s=this._getEntry(a),o=a+n,i=this._getEntry(o),e.Assert.assert(i.parent===s&&i.depth===s.depth+1),1,r=o+1,d=this._getLastIndex();r<=d&&this._getEntry(r).depth==i.depth;)r++;this._deleteAllRowsBelow(o,1)},e.FlattenedTreeDataSource.prototype._handleRefreshEvent=function(e){null==e&&this.refresh()},e.FlattenedTreeDataSource.prototype._isExpandAll=function(){var e=this.m_wrapped.getCapability("fetchDescendants");return null!=this.m_collapsedKeys&&null!=e&&"disable"!=e},e.FlattenedTreeDataSource.prototype._isBatchFetching=function(){return"enable"===this.m_wrapped.getCapability("batchFetch")},e.FlattenedTreeDataSource.prototype.refresh=function(){this._clearAll()},e.FlattenedTreeDataSource.prototype.getIndex=function(e){var t,n;for(t=this._getLastIndex(),n=0;n<=t;n++)if(this._getEntry(n).key==e)return n;return-1},e.FlattenedTreeDataSource.prototype.getKey=function(e){return e<0||e>this._getLastIndex()?null:this._getEntry(e).key},e.FlattenedTreeDataSource.prototype.getFetchedRange=function(){return{start:0,end:this._getLastIndex()+1}},e.FlattenedTreeDataSource.prototype.getAncestors=function(e){var t,n,a;for(t=[],n=this.getIndex(e),a=this._getParent(n);null!=a;)t.push(a),n=this.getIndex(a),a=this._getParent(n);return t.reverse()},e.FlattenedTreeDataSource.prototype.handleMaxCountReached=function(e,t){null!=t&&null!=t.error&&t.error.call(null)},e.FlattenedTreeDataSource.prototype.insertRows=function(t,n,a){e.Assert.failedInAbstractFunction()},e.FlattenedTreeDataSource.prototype.removeRows=function(t){e.Assert.failedInAbstractFunction()},e.FlattenedTreeDataSource.prototype._getLastIndex=function(){return this.m_cache.length-1},e.FlattenedTreeDataSource.prototype._getLastEntry=function(){return this.m_cache[this._getLastIndex()]},e.FlattenedTreeDataSource.prototype._getEntry=function(e){return this.m_cache[e]},e.FlattenedTreeDataSource.prototype._getParent=function(e){var t=this.m_cache[e];return null!=t?t.parent:null},e.FlattenedTreeDataSource.prototype._addEntry=function(e,t,n,a,s){var o=new Object;o.key=e,o.depth=t,o.index=n,o.parent=a,void 0===s?this.m_cache.push(o):this.m_cache.splice(s,0,o)},e.FlattenedTreeDataSource.prototype._removeEntry=function(e,t){this.m_cache.splice(e,t)},e.FlattenedTreeDataSource.prototype._clearAll=function(){this.m_cache.length=0},e.FlattenedTreeDataSource.prototype.getCapability=function(e){return this.m_wrapped.getCapability(e)},e.__registerWidget("oj.ojRowExpander",t.oj.baseComponent,{version:"1.0.0",widgetEventPrefix:"oj",options:{context:null,expanded:null,expand:null,collapse:null},classNames:{root:"oj-rowexpander",icon:"oj-component-icon",clickable:"oj-clickable-icon-nocontext",expand:"oj-rowexpander-expand-icon",collapse:"oj-rowexpander-collapse-icon",leaf:"oj-rowexpander-leaf-icon",lazyload:"oj-rowexpander-lazyload-icon",toucharea:"oj-rowexpander-touch-area",indent:"oj-rowexpander-indent",iconspacer:"oj-rowexpander-icon-spacer",depth0:"oj-rowexpander-depth-0",depth1:"oj-rowexpander-depth-1",depth2:"oj-rowexpander-depth-2",depth3:"oj-rowexpander-depth-3",depth4:"oj-rowexpander-depth-4",depth5:"oj-rowexpander-depth-5",depth6:"oj-rowexpander-depth-6",depth7:"oj-rowexpander-depth-7"},constants:{MAX_STYLE_DEPTH:7,NUM5_KEY:53},_ComponentCreate:function(){this._super(),this.element.addClass(this.classNames.root),this._initContent()},_initContent:function(){var n,a=this;if(null!=(n=this.options.context).component)this.component="function"==typeof n.component?n.component("instance"):n.component;else if(n.componentElement){var s=n.componentElement;s=t(s).hasClass("oj-component-initnode")?s:t(s).find(".oj-component-initnode")[0],this.component=e.Components.__GetWidgetConstructor(s)("instance")}this.datasource=n.datasource,this.depth=n.depth,this.iconState=n.state,this.rowKey=n.key,this.index=n.index,this.parentKey=n.parentKey,this._addIndentation(),this._addIcon(),this._setIconStateClass(),"expanded"===this.iconState||"collapsed"===this.iconState?(t(this.toucharea).on("touchend",function(e){e.preventDefault(),a._fireExpandCollapse()}),t(this.toucharea).on("click",function(e){e.preventDefault(),a._fireExpandCollapse()}),t(this.element).on("keypress",function(e){var n=e.keyCode||e.which;n!==t.ui.keyCode.ENTER&&n!==t.ui.keyCode.SPACE||(a._fireExpandCollapse(),e.preventDefault(),e.target.focus())}),this.handleKeyDownCallback=this._handleKeyDownEvent.bind(this),this.component.element.get(0).addEventListener("keydown",this.handleKeyDownCallback,!0),this.handleExpandCallback=this._handleExpandEvent.bind(this),this.handleCollapseCallback=this._handleCollapseEvent.bind(this),this.datasource.on("expand",this.handleExpandCallback,this),this.datasource.on("collapse",this.handleCollapseCallback,this),this._initExpanded()):"leaf"===this.iconState&&(this.handleKeyDownCallback=this._handleKeyDownEvent.bind(this),this.component.element.get(0).addEventListener("keydown",this.handleKeyDownCallback,!0),t(this.icon).attr("tabindex",-1)),this.handleActiveKeyChangeCallback=this._handleActiveKeyChangeEvent.bind(this),this.component._IsCustomElement()?t(this.component.element).on("ojBeforeCurrentCell",this.handleActiveKeyChangeCallback):t(this.component.element).on("ojbeforecurrentcell",this.handleActiveKeyChangeCallback)},_initExpanded:function(){var e=this.options.expanded;null!=e?e&&"collapsed"===this.iconState?this._expand():e||"expanded"!==this.iconState||this._collapse():this.options.expanded="collapsed"!==this.iconState},refresh:function(){this.element.empty(),this._initContent()},_destroy:function(){this.component.element.get(0).removeEventListener("ojkeydown",this.handleKeyDownCallback,!0),t(this.component.element).off("ojbeforecurrentcell",this.handleActiveKeyChangeCallback),this.datasource.off("expand",this.handleExpandCallback,this),this.datasource.off("collapse",this.handleCollapseCallback,this),this.element.removeClass(this.classNames.root),this.element.empty()},_expand:function(){return"collapsed"===this.iconState&&(this._loading(),this.datasource.expand(this.rowKey),!0)},_collapse:function(){return"expanded"===this.iconState&&(this._loading(),this.datasource.collapse(this.rowKey),!0)},_setOption:function(e,t,n){"expanded"!=e||null!=n._context&&1==n._context.internalSet?(this._super(e,t,n),"context"==e&&null!=n._context&&1!=n._context.internalSet&&this.refresh()):t?this._expand():this._collapse()},_addIndentation:function(){var e,t,n;if((n=this.depth-1)<this.constants.MAX_STYLE_DEPTH)this._appendSpacer(n);else{for(t=1;t<=n/this.constants.MAX_STYLE_DEPTH;t++)this._appendSpacer(this.constants.MAX_STYLE_DEPTH);(e=n%this.constants.MAX_STYLE_DEPTH)<this.constants.MAX_STYLE_DEPTH&&this._appendSpacer(e)}},_appendSpacer:function(e){var n=t(document.createElement("span")).addClass(this.classNames.indent).addClass(this.classNames["depth"+e]);this.element.append(n)},_addIcon:function(){var e;e=t(document.createElement("div")).addClass(this.classNames.iconspacer),this.toucharea=t(document.createElement("div")).addClass(this.classNames.toucharea),this.icon=t(document.createElement("a")).attr("href","#").attr("aria-labelledby",this._getLabelledBy()).addClass(this.classNames.icon).addClass(this.classNames.clickable).attr("aria-label",this.getTranslatedString("accessibleLevelDescription",{level:this.depth})),this.element.append(e.append(this.toucharea.append(this.icon))),this._focusable({element:this.icon,applyHighlight:!0})},_addIconClass:function(e){this.icon.addClass(this.classNames[e])},_removeIconClass:function(e){this.icon.removeClass(this.classNames[e])},_setIconStateClass:function(){switch(this.iconState){case"leaf":this._removeIconClass("icon"),this._removeIconClass("clickable"),this._addIconClass("leaf");break;case"collapsed":this._addIconClass("expand"),this._ariaExpanded(!1);break;case"expanded":this._addIconClass("collapse"),this._ariaExpanded(!0);break;case"loading":this._removeIconClass("clickable"),this._addIconClass("lazyload")}},_removeIconStateClass:function(){switch(this.iconState){case"leaf":this._removeIconClass("leaf"),this._addIconClass("icon"),this._addIconClass("clickable");break;case"collapsed":this._removeIconClass("expand");break;case"expanded":this._removeIconClass("collapse");break;case"loading":this._removeIconClass("lazyload"),this._addIconClass("clickable")}},_handleActiveKeyChangeEvent:function(e,t){var n,a,s,o;null==t&&(t=e.detail),null!=t.currentCell&&(n="cell"==t.currentCell.type?t.currentCell.keys.row:t.currentCell.key,null!=t.previousValue&&(a="cell"==t.previousCurrentCell.type?t.previousCurrentCell.keys.row:t.previousCurrentCell.key),this.rowKey===n&&a!=n&&this.component._setAccessibleContext&&(s=this.getTranslatedString("accessibleRowDescription",{level:this.depth,num:this.index+1,total:this.datasource.getWrappedDataSource().getChildCount(this.parentKey)}),o="collapsed"===this.iconState?this.getTranslatedString("accessibleStateCollapsed"):"expanded"===this.iconState?this.getTranslatedString("accessibleStateExpanded"):"",this.component._setAccessibleContext({context:s,state:o})))},_handleKeyDownEvent:function(n){var a,s,o,i,r,d,l=e.Components.__GetWidgetConstructor(this.component.element.get(0))("getContextByNode",n.target);if(null!=l&&(null==(a=l.key)&&(a=l.keys.row),this.rowKey===a&&(s=n.keyCode||n.which,e.DomUtils.isMetaKeyPressed(n))))if(s==t.ui.keyCode.RIGHT){if(this._expand())return void n.preventDefault()}else if(s==t.ui.keyCode.LEFT){if(this._collapse())return void n.preventDefault()}else if(n.altKey&&s==this.constants.NUM5_KEY&&this.component._setAccessibleContext){if(null!=(r=this.datasource.getAncestors(this.rowKey))&&r.length>0)for(i=[],d=0;d<r.length;d++)i.push({key:r[d],label:this.getTranslatedString("accessibleLevelDescription",{level:d+1})});o=this.getTranslatedString("accessibleRowDescription",{level:this.depth,num:this.index+1,total:this.datasource.getWrappedDataSource().getChildCount(this.parentKey)}),this.component._setAccessibleContext({context:o,state:"",ancestors:i})}},_loading:function(){this._removeIconStateClass(),this.iconState="loading",this._setIconStateClass()},_handleExpandEvent:function(e){var t=e.rowKey;if(t===this.rowKey){this._removeIconStateClass(),this.iconState="expanded",this._setIconStateClass(),this._ariaExpanded(!0),this._updateContextState("expanded");var n=this.options.expanded;(null==n||null!=n&&!n)&&(this._trigger("expand",null,{rowKey:t}),this._updateExpandedState(!0))}},_handleCollapseEvent:function(e){var t=e.rowKey;if(t===this.rowKey){this._removeIconStateClass(),this.iconState="collapsed",this._setIconStateClass(),this._ariaExpanded(!1),this._updateContextState("collapsed");var n=this.options.expanded;(null==n||null!=n&&n)&&(this._trigger("collapse",null,{rowKey:t}),this._updateExpandedState(!1))}},_updateExpandedState:function(e){this.option("expanded",e,{changed:!0,_context:{internalSet:!0,writeback:!0}})},_updateContextState:function(e){var t=this.options.context;t.state=e,this.option("context",t,{changed:!0,_context:{internalSet:!0}})},_fireExpandCollapse:function(){var e=this.iconState;this._loading(),"collapsed"===e?this.datasource.expand(this.rowKey):"expanded"===e&&this.datasource.collapse(this.rowKey)},_ariaExpanded:function(e){this.icon.attr("aria-expanded",e)},getNodeBySubId:function(e){var t;return null==e?this.element?this.element[0]:null:"oj-rowexpander-disclosure"!==(t=e.subId)&&"oj-rowexpander-icon"!==t||null==this.icon?null:this.icon.get(0)},getSubIdByNode:function(e){return e===this.icon.get(0)?{subId:"oj-rowexpander-disclosure"}:null},_NotifyAttached:function(){this._super(),this.icon.attr("aria-labelledby",this._getLabelledBy())},_getLabelledBy:function(){return this.element.parent().closest("[id]").attr("id")}}),e.CustomElementBridge.registerMetadata("oj-row-expander","baseComponent",{properties:{context:{type:"object"},expanded:{type:"boolean",writeback:!0},translations:{type:"Object",properties:{accessibleLevelDescription:{type:"string"},accessibleRowCollapsed:{type:"string"},accessibleRowDescription:{type:"string"},accessibleRowExpanded:{type:"string"},accessibleStateCollapsed:{type:"string"},accessibleStateExpanded:{type:"string"}}}},events:{collapse:{},expand:{}},extension:{_WIDGET_NAME:"ojRowExpander"}}),e.CustomElementBridge.register("oj-row-expander",{metadata:e.CustomElementBridge.getMetadata("oj-row-expander")})});