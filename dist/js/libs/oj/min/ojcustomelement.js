/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","require","promise","customElements"],function(e,t){e.BaseCustomElementBridge={},e.BaseCustomElementBridge.proto={getClass:function(t){var r=Object.create(HTMLElement.prototype);this.InitializePrototype(r);var n=this.GetMetadata(t);e.BaseCustomElementBridge._enumerateMetadataForKey(r,n,"properties",this.DefinePropertyCallback.bind(this)),e.BaseCustomElementBridge._enumerateMetadataForKey(r,n,"methods",this.DefineMethodCallback.bind(this)),this.AddComponentMethods(r),r.setProperties=function(t){e.BaseCustomElementBridge.getInstance(this)._setProperties(this,t)},Object.defineProperty(r,"set",{value:function(e,t){this.setProperty(e,t)}}),Object.defineProperty(r,"unset",{value:function(e){this.setProperty(e,void 0)}}),r.attributeChangedCallback=this._attributeChangedCallback,r.connectedCallback=this._connectedCallback,r.disconnectedCallback=this._detachedCallback,Object.defineProperty(r,"resolveBP",{value:function(t){e.BaseCustomElementBridge.getInstance(this)._resolveBindingProvider(t)}});var i=function(){var e=window.Reflect;return void 0!==e?e.construct(HTMLElement,[],this.constructor):HTMLElement.call(this)},o=this;return Object.defineProperty(i,"observedAttributes",{get:function(){return o.GetAttributes(n)}}),Object.defineProperty(r,"constructor",{value:i,writable:!0,configurable:!0}),i.prototype=r,Object.setPrototypeOf(i,HTMLElement),i},resolveDelayedReadyPromise:function(e){this.GetDelayedReadyPromise().resolvePromise()},AddComponentMethods:function(e){},CreateComponent:function(e){},DefineMethodCallback:function(e,t,r){},DefinePropertyCallback:function(e,t,r){},GetDelayedReadyPromise:function(){return this._delayedReady||(this._delayedReady=new e.BaseCustomElementBridge.__DelayedPromise),this._delayedReady},GetAttributes:function(t){return e.BaseCustomElementBridge.getAttributes(t.properties)},GetMetadata:function(t){return t[e.BaseCustomElementBridge.DESC_KEY_META]},GetAliasForProperty:function(e){return e},HandleAttributeChanged:function(e,t,r,n){},HandleBindingsApplied:function(e,t){},HandleDetached:function(e){this._bConnected=!1,this._complete||this._resolveBusyState(e)},HandleReattached:function(e){},InitializeElement:function(e){},InitializePrototype:function(e){},BatchedPropertySet:function(e,t){for(var r=Object.keys(t),n=0;n<r.length;n++){var i=r[n];e.setProperty(i,t[i])}},CanSkipTypeCheck:function(e){return!1},GetProperty:function(t,r,n){var i=e.__AttributeUtils.eventListenerPropertyToEventType(r),o=e.BaseCustomElementBridge.__GetPropertyMetadata(r,e.BaseCustomElementBridge.getProperties(this,t));return i||!o||-1===r.indexOf(".")?n[r]:e.BaseCustomElementBridge.__GetProperty(n,r)},InitializeBridge:function(t){var r=e.BaseCustomElementBridge.__GetDescriptor(t.tagName);this.METADATA=this.GetMetadata(r),this._eventListeners={}},PlaybackEarlyPropertySets:function(e){if(this._bCanSetProperty=!0,this._earlySets)for(;this._earlySets.length;){var t=this._earlySets.shift();e.setProperty(t.property,t.value)}},SaveEarlyPropertySet:function(e,t){return!this.__INITIALIZING_PROPS&&!this._bCanSetProperty&&(this._earlySets||(this._earlySets=[]),this._earlySets.push({property:e,value:t}),!0)},SetEventListenerProperty:function(t,r,n){var i=e.__AttributeUtils.eventListenerPropertyToEventType(r),o=this._eventListeners[i];o||(o=this._createEventListenerWrapper(),this._eventListeners[i]=o,t.addEventListener(i,o)),null==n||n instanceof Function?o.setListener(n):e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,"function")},SetProperty:function(t,r,n,i,o){var s=e.__AttributeUtils.eventListenerPropertyToEventType(r),a=e.BaseCustomElementBridge.__GetPropertyMetadata(r,e.BaseCustomElementBridge.getProperties(this,t));if(s||!a)t[r]=n;else{var l=t.getProperty(r),u=r.split(".")[0],d=i[u];if(e.CollectionUtils.isPlainObject(d)&&(d=e.CollectionUtils.copyInto({},d,void 0,!0)),!e.BaseCustomElementBridge.__CompareOptionValues(r,a,n,l)){o?this.ValidateAndSetProperty(this.GetAliasForProperty.bind(this),i,r,n,t):e.BaseCustomElementBridge.__SetProperty(this.GetAliasForProperty.bind(this),i,r,n);var m=-1!==r.indexOf(".");if(m){var p={};p.path=r,p.value=n,p.previousValue=l;var g=o?"external":"internal";e.BaseCustomElementBridge.__FirePropertyChangeEvent(t,u,i[u],d,g,p)}return{property:u,propertySet:!0,isSubproperty:m}}}return{property:null,propertySet:!1,isSubproperty:!1}},ValidateAndSetProperty:function(t,r,n,i,o){i=this.ValidatePropertySet(o,n,i),e.BaseCustomElementBridge.__SetProperty(t,r,n,i)},ValidatePropertySet:function(t,r,n){var i=e.BaseCustomElementBridge.getProperties(this,t),o=e.BaseCustomElementBridge.__GetPropertyMetadata(r,i),s=r.split("."),a=this.CanSkipTypeCheck(s);if(o||a)return i[s[0]].readOnly&&this._throwError(t,"Read-only property '"+r+"' cannot be set."),e.BaseCustomElementBridge.__CheckEnumValues(t,r,n,o),a||null==n?n:e.BaseCustomElementBridge.__CheckType(t,r,n,o);e.Logger.warn(e.BaseCustomElementBridge.getElementInfo(t)+": Ignoring property set for undefined property '"+r+"'.")},_attributeChangedCallback:function(t,r,n){var i=e.BaseCustomElementBridge.getInstance(this);if(i._bCreateCalled&&this.setProperty){var o=e.__AttributeUtils.attributeToPropertyName(t),s=e.BaseCustomElementBridge.__GetPropertyMetadata(o,e.BaseCustomElementBridge.getProperties(i,this));e.BaseCustomElementBridge.__CheckOverlappingAttribute(this,t),null===n&&(n=void 0);var a={detail:{attribute:t,value:n,previousValue:r}};this.dispatchEvent(new CustomEvent("attribute-changed",a)),e.__AttributeUtils.getExpressionInfo(n).expr||(s&&this.setProperty(o,e.BaseCustomElementBridge.__ParseAttrValue(this,t,o,n,s)),i.HandleAttributeChanged(this,t,r,n))}},_connected:function(e){if(this._bConnected=!0,this._bCreateCalled)this._complete||this._registerBusyState(e),this.HandleReattached(e);else{this._bCreateCalled=!0,this._registerBusyState(e),this._monitorReadyPromise(e),this.InitializeElement(e);var t=this;this._getBindingProvider(e).then(function(){t.CreateComponent(e)})}},_connectedCallback:function(){e.BaseCustomElementBridge.getInstance(this)._connected(this)},_detachedCallback:function(){e.BaseCustomElementBridge.getInstance(this).HandleDetached(this)},_createEventListenerWrapper:function(){var e,t=function(t){e&&e(t)};return t.setListener=function(t){e=t},t},_monitorReadyPromise:function(e){var t=this,r=function(){t._bConnected&&t._resolveBusyState(e),t._complete=!0};this.GetDelayedReadyPromise().getPromise().then(function(){e.classList.add("oj-complete"),r()},function(){e.classList.add("oj-incomplete"),r()})},_registerBusyState:function(t){var r=e.Context.getContext(t).getBusyContext();this._initCompleteCallback=r.addBusyState({description:e.BaseCustomElementBridge.getElementInfo(t)+" is being upgraded."})},_resolveBusyState:function(e){var t=this._initCompleteCallback;t||this._throwError(e,"Unexpected call to _resolveBusyState()."),this._initCompleteCallback=null,t()},_setProperties:function(e,t){for(var r=[],n={},i=!1,o=Object.keys(t),s=0;s<o.length;s++){var a=o[s];a.indexOf(".")>=0?r.push(a):(n[a]=t[a],i=!0)}i&&this.BatchedPropertySet(e,n);for(var l=0;l<r.length;l++){var u=r[l];e.setProperty(u,t[u])}},_throwError:function(t,r){throw this.GetDelayedReadyPromise().rejectPromise(),new Error(e.BaseCustomElementBridge.getElementInfo(t)+": "+r)},_resolveBindingProvider:function(e){this._bpResolve?this._bpResolve(e):this._bpInst=e},_setBpResolver:function(e){this._bpResolve=e},_getBindingProvider:function(t){var r=this._getBindingProviderName(t);return r===e.BaseCustomElementBridge._NO_BINDING_PROVIDER?(this.PlaybackEarlyPropertySets(t),Promise.resolve(null)):"knockout"==r?this._bpInst?Promise.resolve(this._bpInst):new Promise(this._setBpResolver.bind(this)):void this._throwError(t,"Unknown binding provider '"+r+"'.")},_getBindingProviderName:function(t){var r=t._ojBndgPrv;if(r)return r;if(!(r=t.getAttribute("data-oj-binding-provider")||e.BaseCustomElementBridge._getCompositeBindingProviderName(t))){var n=t.parentElement;null==n?t===document.documentElement?r="knockout":this._throwError(t,"Cannot determine binding provider for a disconnected subtree."):r=this._getBindingProviderName(n)}return Object.defineProperty(t,"_ojBndgPrv",{value:r}),r}},e.BaseCustomElementBridge.getAttributes=function(t){var r=[];return e.BaseCustomElementBridge._getAttributesFromProperties("",t,r),r},e.BaseCustomElementBridge._getAttributesFromProperties=function(t,r,n){if(r)for(var i in r){var o=r[i];if(!o.readOnly){var s=t+i;n.push(e.__AttributeUtils.propertyNameToAttribute(s)),o.properties&&e.BaseCustomElementBridge._getAttributesFromProperties(s+".",o.properties,n)}}},e.BaseCustomElementBridge.getElementInfo=function(e){return e?e.tagName.toLowerCase()+" with id '"+e.id+"'":""},e.BaseCustomElementBridge.getInstance=function(t){var r=t[e.BaseCustomElementBridge._INSTANCE_KEY];if(!r){var n=e.BaseCustomElementBridge._registry[t.tagName.toLowerCase()];if(!n)throw new Error(e.BaseCustomElementBridge.getElementInfo(t)+" Attempt to interact with the custom element before it has been registered.");(r=Object.create(n.bridgeProto)).InitializeBridge(t),Object.defineProperty(t,e.BaseCustomElementBridge._INSTANCE_KEY,{value:r})}return r},e.BaseCustomElementBridge.getProperties=function(e,t){return e.METADATA.properties},e.BaseCustomElementBridge.getRegistered=function(t){if(t){var r=e.BaseCustomElementBridge._registry[t.toLowerCase()];if(r)return{composite:r.composite}}return null},e.BaseCustomElementBridge.getSlotMap=function(t,r){for(var n={},i=t.childNodes,o=0;o<i.length;o++){var s=i[o];if(e.BaseCustomElementBridge.isSlotAssignable(s)&&(3!==s.nodeType||s.nodeValue.trim())){var a=r?s.__oj_slots:null,l=null!=a?a:s.getAttribute&&s.getAttribute("slot");l||(l=""),n[l]||(n[l]=[]),n[l].push(s)}}return n},e.BaseCustomElementBridge.isSlotAssignable=function(e){return 1===e.nodeType||3===e.nodeType},e.BaseCustomElementBridge._NO_BINDING_PROVIDER="none",e.BaseCustomElementBridge._enumerateMetadataForKey=function(e,t,r,n){if(t&&t[r]){var i=t[r];Object.keys(i).forEach(function(t){n(e,t,i[t])})}},e.BaseCustomElementBridge._getCompositeBindingProviderName=function(t){return e.Composite?e.Composite.getBindingProviderName(t.parentElement):null},e.BaseCustomElementBridge._verifyMetadata=function(t,r){if(r){var n=r.properties;if(n)for(var i=e.BaseCustomElementBridge._GLOBAL_PROPERTIES,o=0;o<i.length;o++)n[i[o]]&&e.Logger.error("Error registering composite %s. Redefined global HTML element attribute '%s' in metadata.",t,i[o])}},e.BaseCustomElementBridge.__CheckEnumValues=function(t,r,n,i){if("string"==typeof n&&i){var o=i.enumValues;if(o&&-1===o.indexOf(n))e.BaseCustomElementBridge.getInstance(t)._throwError(t,"Invalid value '"+n+"' found for property '"+r+"'. Expected one of the following '"+o.toString()+"'.")}},e.BaseCustomElementBridge.__CheckType=function(t,r,n,i){var o=i.type;if(o){var s=(o=o.toLowerCase()).split("|"),a=typeof n;if(1===s.length)("array"===o.substring(0,5)&&!Array.isArray(n)||"object"===o.substring(0,6)&&"object"!==a||"number"===o&&("number"!=typeof n||!isFinite(n))||"string"===o&&"string"!==a)&&e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,o),"boolean"===o&&(n=!!n);else if(2===s.length){var l=s.indexOf("string"),u=s.indexOf("promise");if(-1!==l&&"string"!==a)("function"===(d=0===l?s[1]:s[0])&&"function"!==a||"array"===d.substring(0,5)&&!Array.isArray(n)||"object"===d.substring(0,6)&&"object"!==a)&&e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,o);else if(-1!==u&&!(n instanceof Promise)){var d;"array"!==(d=0===u?s[1]:s[0]).substring(0,5)||Array.isArray(n)||e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,o)}}}return n},e.BaseCustomElementBridge.__CompareOptionValues=function(t,r,n,i){return r.writeback?e.Object.compareValues(n,i):n===i},e.BaseCustomElementBridge.__ThrowTypeError=function(t,r,n,i){e.BaseCustomElementBridge.getInstance(t)._throwError(t,"Invalid type '"+typeof n+"' found for property '"+r+"'. Expected value of type '"+i+"'.")},e.BaseCustomElementBridge.__GetDescriptor=function(t){return e.BaseCustomElementBridge._registry[t.toLowerCase()].descriptor},e.BaseCustomElementBridge.__GetCache=function(t){return t?e.BaseCustomElementBridge._registry[t.toLowerCase()].cache:null},e.BaseCustomElementBridge.__CheckOverlappingAttribute=function(t,r){var n=r.split(".");if(n.length>1)for(n.pop();n.length;){var i=n.join(".");if(t.hasAttribute(i))e.BaseCustomElementBridge.getInstance(t)._throwError(t,"Cannot set overlapping attributes '"+r+"' and '"+i+"'.");n.pop()}},e.BaseCustomElementBridge.__GetPropertyMetadata=function(e,t){for(var r=t,n=e.split("."),i=0;i<n.length&&(r=r[n[i]])&&(!(n.length>1&&i<n.length-1)||(r=r.properties));i++);return r},e.BaseCustomElementBridge.__InitProperties=function(t,r){var n=e.BaseCustomElementBridge.getInstance(t);n.__INITIALIZING_PROPS=!0;var i=e.BaseCustomElementBridge.getProperties(n,t);if(i)for(var o=t.attributes,s=0;s<o.length;s++){var a=o[s],l=e.__AttributeUtils.attributeToPropertyName(a.nodeName),u=e.BaseCustomElementBridge.__GetPropertyMetadata(l,i);if(u&&!u.readOnly)if(e.BaseCustomElementBridge.__CheckOverlappingAttribute(t,a.nodeName),!e.__AttributeUtils.getExpressionInfo(a.value).expr){var d=e.BaseCustomElementBridge.__ParseAttrValue(t,a.nodeName,l,a.value,u);n.ValidateAndSetProperty(n.GetAliasForProperty.bind(n),r,l,d,t)}}n.__INITIALIZING_PROPS=!1},e.BaseCustomElementBridge.__SetProperty=function(e,t,r,n){var i,o=t,s=r.split("."),a=e(s[0]);s.length>1&&!t[a]&&(o=i={});for(var l=0;l<s.length;l++){var u=e(s[l]);l===s.length-1?o[u]=n:o[u]||(o[u]={}),o=o[u]}i&&(t[a]=i[a])},e.BaseCustomElementBridge.__GetProperty=function(e,t){for(var r=e,n=t.split("."),i=0;i<n.length;i++){var o=n[i];if(i===n.length-1)return r[o];if(!r[o])return;r=r[o]}},e.BaseCustomElementBridge.__ParseAttrValue=function(t,r,n,i,o){if(null==i)return i;var s=o.type,a=e.BaseCustomElementBridge.getInstance(t);function l(n){var i;try{i=e.__AttributeUtils.coerceValue(t,r,n,s)}catch(e){a._throwError(t,e)}return i}var u=e.BaseCustomElementBridge.__GetDescriptor(t.tagName).parseFunction;return u?u(i,n,o,function(e){return l(e)}):l(i)},e.BaseCustomElementBridge.__ProcessEventListeners=function(t,r){return(t=e.CollectionUtils.copyInto({},t,void 0,!0,1)).properties=t.properties||{},e.BaseCustomElementBridge._enumerateMetadataForKey(null,t,"properties",function(r,n,i){var o=e.__AttributeUtils.propertyNameToChangeEventType(n),s=e.__AttributeUtils.eventTypeToEventListenerProperty(o);t.properties[s]={_derived:!0,_eventListener:!0}}),e.BaseCustomElementBridge._enumerateMetadataForKey(null,t,"events",function(n,i,o){var s=r?e.__AttributeUtils.eventTriggerToEventType(i):i,a=e.__AttributeUtils.eventTypeToEventListenerProperty(s);t.properties[a]={_derived:!0,_eventListener:!0}}),t},e.BaseCustomElementBridge.__Register=function(t,r,n,i){var o=t.toLowerCase();if(!e.BaseCustomElementBridge._registry[o]){if(!r)throw new Error("Cannot register "+t+". Missing a descriptor.");return e.BaseCustomElementBridge._verifyMetadata(t,r[e.BaseCustomElementBridge.DESC_KEY_META]),e.BaseCustomElementBridge._registry[o]={descriptor:r,bridgeProto:n,composite:i,cache:{}},!0}return!1},e.BaseCustomElementBridge.__FirePropertyChangeEvent=function(t,r,n,i,o,s){var a=e.BaseCustomElementBridge.getInstance(t);if("external"!==o||a.__READY_TO_FIRE){var l={};s&&(l.subproperty=s),l.value=n,l.previousValue=i,l.updatedFrom=o,a.beforePropertyChangedEvent&&a.beforePropertyChangedEvent(t,r,l),t.dispatchEvent(new CustomEvent(r+"Changed",{detail:l}))}},e.BaseCustomElementBridge.__DefineDynamicObjectProperty=function(e,t,r,n){Object.defineProperty(e,t,{enumerable:!0,get:r,set:n})},e.BaseCustomElementBridge.__GetUnique=function(){return n+r++};var r=0,n="_ojcustomelem";e.BaseCustomElementBridge._registry={},e.BaseCustomElementBridge.DESC_KEY_CSS="css",e.BaseCustomElementBridge.DESC_KEY_META="metadata",e.BaseCustomElementBridge.DESC_KEY_PARSE_FUN="parseFunction",e.BaseCustomElementBridge.DESC_KEY_VIEW="view",e.BaseCustomElementBridge.DESC_KEY_VIEW_MODEL="viewModel",e.BaseCustomElementBridge._GLOBAL_PROPERTIES=["accesskey","class","contenteditable","contextmenu","dir","draggable","hidden","id","is","lang","style","tabindex","title"],e.BaseCustomElementBridge._INSTANCE_KEY="_ojBridge",e.BaseCustomElementBridge.__DelayedPromise=function(){var e,t,r;this.getPromise=function(){return e||(e=new Promise(function(e,n){t=e,r=n})),e},this.rejectPromise=function(e){r&&r(e)},this.resolvePromise=function(e){t&&t(e)}}});