/**
 * @license
 * Copyright (c) 2014, 2024, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore-base","knockout","ojs/ojcustomelement","ojs/ojcustomelement-utils","ojs/ojkoshared","ojs/ojlogger","ojs/ojtemplateengine-ko","ojs/ojtemplateengine-preact-ko"],function(e,t,o,n,l,r,i,a){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;const s={};e._registerLegacyNamespaceProp("CompositeTemplateRenderer",s),s.renderTemplate=function(o,n,l){var r=s._storeNodes(n,l);t.virtualElements.setDomNodeChildren(n,l),s.invokeViewModelMethod(n,o.viewModel,"attached",[o.viewModelContext]),s.invokeViewModelMethod(n,o.viewModel,"connected",[o.viewModelContext]);var i=s._getKoBindingContext().createChildContext(o.viewModel,void 0,function(t){t[e.Composite.__COMPOSITE_PROP]=n,t.__oj_slots=o.slotMap,t.__oj_nodestorage=r,t.$slotNodeCounts=o.slotNodeCounts,t.$slotCounts=o.slotNodeCounts,t.$props=o.props,t.$properties=o.props,t.$unique=o.unique,t.$uniqueId=o.uniqueId,t.$parent=null,t.$parentContext=null,t.$parents=null,t.$provided=null});t.applyBindingsToDescendants(i,n),s.invokeViewModelMethod(n,o.viewModel,"bindingsApplied",[o.viewModelContext])},s.getEnclosingComposite=function(o){for(var n=null,l=t.contextFor(o);l&&!n;l=l.$parentContext)n=l[e.Composite.__COMPOSITE_PROP];return n},s.createTracker=function(){return t.observable()},s.invokeViewModelMethod=function(e,o,n,l){if(null!=o){var r=o[n];if("function"==typeof r)try{return t.ignoreDependencies(r,o,l)}catch(t){throw new Error("Error while invoking "+n+" callback for "+e.tagName.toLowerCase()+" with id '"+e.id+"'.")}}},s._storeNodes=function(t,o){var l,r=t.childNodes;if(r){(l=document.createElement("div")).setAttribute("data-bind","_ojNodeStorage_"),l.style.display="none",o.push(l);for(var i=[],a=0;a<r.length;a++){var s=r[a];n.CustomElementUtils.isSlotable(s)&&i.push(s)}i.forEach(function(e){l.appendChild(e)}),e.Components&&e.Components.subtreeHidden(l)}return l},s._getKoBindingContext=function(){if(!s._BINDING_CONTEXT){var e=document.createElement("div");t.applyBindings(null,e),s._BINDING_CONTEXT=t.contextFor(e),t.cleanNode(e)}return s._BINDING_CONTEXT},s._BINDING_CONTEXT=null,function(){function e(e,o){var n,l,r=["name","slot"];o?(r.push("data"),r.push("as"),l="ko _ojBindTemplateSlot_:{"):(r.push("index"),l="ko _ojBindSlot_:{");for(var i=[],a=0;a<r.length;a++){var s=r[a],d=t(e.getAttribute(s));d&&i.push(s+":"+d)}l+=i.join(","),l+="}";var u=document.createComment(l),p=document.createComment("/ko");n=[u];var c=e.parentNode;for(c.insertBefore(u,e);e.childNodes.length>0;){var m=e.childNodes[0];c.insertBefore(m,e),n.push(m)}return n.push(p),c.replaceChild(p,e),n}function t(e){if(null!=e){var t=n.AttributeUtils.getExpressionInfo(e).expr;return null==t&&(t="'"+e+"'"),t}return null}l.registerPreprocessor("oj-bind-slot",e),l.registerPreprocessor("oj-slot",e),l.registerPreprocessor("oj-bind-template-slot",function(t){return e(t,!0)})}(),t.bindingHandlers._ojNodeStorage_={init:function(){return{controlsDescendantBindings:!0}}};const d={};e._registerLegacyNamespaceProp("SlotUtils",d),d.cleanup=function(o,n){var l=n.__oj_nodestorage;if(l)for(var r=t.virtualElements.firstChild(o);r;){var i=t.virtualElements.nextSibling(r);null!=r.__oj_slots&&(l.appendChild(r),e.Components&&1===r.nodeType&&e.Components.subtreeHidden(r)),r=i}},d.preactTemplateCleanup=function(e,t,o){o.forEach(o=>{try{e.clean(o,t)}catch(e){r.warn("Error during template cleanup "+e)}})},t.bindingHandlers._ojBindSlot_={init:function(o,l,r,i,a){t.utils.domNodeDisposal.addDisposeCallback(o,d.cleanup.bind(null,o,a));var s=a.__oj_slots,u=l(),p=t.utils.unwrapObservable,c=p(u.name)||"",m=p(u.slot)||"",_=p(u.index),f=null!=_?[s[c][_]]:s[c];if(f){var C;for(C=0;C<f.length;C++){f[C].__oj_slots=m}n.CustomElementUtils.allowSlotRelocation(!0);try{t.virtualElements.setDomNodeChildren(o,f)}finally{n.CustomElementUtils.allowSlotRelocation(!1)}if(e.Components)for(C=0;C<f.length;C++){var v=f[C];1===v.nodeType&&e.Components.subtreeShown(v)}return{controlsDescendantBindings:!0}}t.virtualElements.childNodes(o).forEach(function(e){(function(e){return 1===e.nodeType||3===e.nodeType&&e.nodeValue.trim()})(e)&&(e.__oj_slots=m)})}},t.virtualElements.allowedBindings._ojBindSlot_=!0,t.bindingHandlers._ojBindTemplateSlot_={init:function(o,l,s,u,p){t.utils.domNodeDisposal.addDisposeCallback(o,d.cleanup.bind(null,o,p));var c=p.__oj_slots,m=l(),_=t.utils.unwrapObservable,f=_(m.name)||"",C=c[f],v=C&&C[C.length-1],g=!1;if(!v)for(var h=t.virtualElements.childNodes(o),j=0;j<h.length;j++)if("TEMPLATE"===h[j].tagName){g=!0,v=h[j];break}if(v){var N=p[e.Composite.__COMPOSITE_PROP];"TEMPLATE"!==v.tagName&&r.error("Slot content for slot '"+f+"' under "+N.tagName.toLowerCase()+" with id '"+N.id+"' should be wrapped inside a <template> node."),v.__oj_slots=_(m.slot)||"";const l=v.render?a:i,s=g?o:N;let u;if(t.computed(function(){v.render&&u&&d.preactTemplateCleanup(l,s,u);var e=_(m.data),n=_(m.as);u=l.execute(s,v,e,g?n:null),t.virtualElements.setDomNodeChildren(o,u)}),v.render){const e=n.CustomElementUtils.getElementState(N);e.addTemplateCleanCallback&&e.addTemplateCleanCallback(()=>{d.preactTemplateCleanup(l,s,u)}),t.utils.domNodeDisposal.addDisposeCallback(o,()=>{d.preactTemplateCleanup(l,s,u)})}}else t.virtualElements.setDomNodeChildren(o,[]);return{controlsDescendantBindings:!0}}},t.virtualElements.allowedBindings._ojBindTemplateSlot_=!0});
//# sourceMappingURL=ojcomposite-knockout.js.map