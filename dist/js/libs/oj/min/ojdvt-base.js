/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojvalidation-number","ojs/internal-deps/dvt/DvtToolkit","ojdnd","promise","ojs/ojkeyset"],function(e,t,n,r,i){e.AttributeGroupHandler=function(e){this.Init(e)},e.Object.createSubclass(e.AttributeGroupHandler,e.Object,"oj.AttributeGroupHandler"),e.AttributeGroupHandler.prototype.Init=function(e){for(var t in this._assignments={},this._valueIndex=0,this._matchRules={},e)this.addMatchRule(t,e[t])},e.AttributeGroupHandler.prototype.getValueRamp=function(){return[]},e.AttributeGroupHandler.prototype.getValue=function(e){return this._matchRules[e]?this._matchRules[e]:(this._assignments[e]||(this._values||(this._values=this.getValueRamp().slice()),this._assignments[e]=this._values[this._valueIndex],this._valueIndex++,this._valueIndex==this._values.length&&(this._valueIndex=0)),this._assignments[e])},e.AttributeGroupHandler.prototype.getCategoryAssignments=function(){var e=[];for(var t in this._assignments)e.push({category:t,value:this._assignments[t]});return e},e.AttributeGroupHandler.prototype.addMatchRule=function(e,t){this._matchRules[e]=t},e.ColorAttributeGroupHandler=function(n){if(this._attributeValues=[],t(document.body).hasClass("oj-hicontrast"))this._attributeValues=e.ColorAttributeGroupHandler._DEFAULT_COLORS.slice();else{var r=e.ColorAttributeGroupHandler.__createAttrDiv();r&&(e.ColorAttributeGroupHandler.__processAttrDiv(r),r.remove()),e.ColorAttributeGroupHandler._colors.length>0?this._attributeValues=e.ColorAttributeGroupHandler._colors.slice():this._attributeValues=e.ColorAttributeGroupHandler._DEFAULT_COLORS.slice()}this.Init(n)},e.Object.createSubclass(e.ColorAttributeGroupHandler,e.AttributeGroupHandler,"oj.ColorAttributeGroupHandler"),e.ColorAttributeGroupHandler._DEFAULT_COLORS=["#237bb1","#68c182","#fad55c","#ed6647","#8561c8","#6ddbdb","#ffb54d","#e371b2","#47bdef","#a2bf39","#a75dba","#f7f37b"],e.ColorAttributeGroupHandler._STYLE_CLASSES=["oj-dvt-category1","oj-dvt-category2","oj-dvt-category3","oj-dvt-category4","oj-dvt-category5","oj-dvt-category6","oj-dvt-category7","oj-dvt-category8","oj-dvt-category9","oj-dvt-category10","oj-dvt-category11","oj-dvt-category12"],e.ColorAttributeGroupHandler._colors=null,e.ColorAttributeGroupHandler.prototype.getValueRamp=function(){return this._attributeValues},e.ColorAttributeGroupHandler.createAttrDiv=function(){return e.ColorAttributeGroupHandler.__createAttrDiv()},e.ColorAttributeGroupHandler.processAttrDiv=function(t){e.ColorAttributeGroupHandler.__processAttrDiv(t)},e.ColorAttributeGroupHandler.__createAttrDiv=function(){if(e.ColorAttributeGroupHandler._colors)return null;var n=t(document.createElement("div"));n.attr("style","display:none;"),n.attr("id","attrGps"),t(document.body).append(n);for(var r=0;r<e.ColorAttributeGroupHandler._STYLE_CLASSES.length;r++){var i=t(document.createElement("div"));i.addClass(e.ColorAttributeGroupHandler._STYLE_CLASSES[r]),n.append(i)}return n},e.ColorAttributeGroupHandler.__processAttrDiv=function(n){e.ColorAttributeGroupHandler._colors=[];for(var r=n.children(),i=0;i<r.length;i++){var o=t(r[i]).css("color");o&&e.ColorAttributeGroupHandler._colors.push(o)}};var o={_SHAPE_REGEXP:/\d/,_SHAPE_ENUMS:{circle:!0,ellipse:!0,square:!0,rectangle:!0,diamond:!0,triangleUp:!0,triangleDown:!0,plus:!0,human:!0,star:!0},shapeParseFunction:function(e,t){var n=t||o._SHAPE_ENUMS;return function(r,i,s,a){if(e[i]){if(o._SHAPE_REGEXP.test(r))return r;if(n[r])return r;throw new Error("Found: '"+r+"'. Expected one of the following: "+Object.keys(t).toString())}return a(r)}}},s=function(e,t){this._path=t,this._root=e,this._delimiter="/"};s.prototype._resolveLeafObjectAndProperty=function(e,t,n,r){for(var i={};e&&t.indexOf(n)>-1;){var o=t.substring(0,t.indexOf(n));r&&void 0===e[o]&&(e[o]={}),e=e[o],t=t.substring(t.indexOf(n)+1,t.length)}return e&&(i.object=e,i.parameter=t),i},s.prototype._resolvePath=function(e){if(void 0===this._leaf){var t=this._resolveLeafObjectAndProperty(this._root,this._path,this._delimiter,e);this._leaf=t.object,this._param=t.parameter}},s.prototype.getValue=function(){return this._resolvePath(!1),void 0===this._leaf?void 0:this._leaf[this._param]},s.prototype.setValue=function(e,t){this._resolvePath(!0),!t&&this._leaf[this._param]||(this._leaf[this._param]=e)};var a,l={TEXT:function(e){var t={};return e&&(e.hasClass("oj-gauge-metric-label")?(t["font-size"]=!0,t.color=!0):e.hasClass("oj-treemap-node-header")&&(t["font-weight"]=!0)),l._buildTextCssPropertiesObject(e,t)},BACKGROUND:function(e,t,n,r){return l._buildCssBackgroundPropertiesObject(e)},ANIM_DUR:function(e){var t=e.css("animation-duration");if(t)return"ms"==t.slice(-2)?t=parseInt(t.slice(0,-2),10):"s"==t.slice(-1)&&(t=1e3*parseFloat(t.slice(0,-1))),t}};l._INHERITED_FONT_COLOR="rgb(254, 0, 254)",l._INHERITED_FONT_FAMILY="Times",l._INHERITED_FONT_SIZE="1px",l._INHERITED_FONT_WEIGHT="1",l._INHERITED_FONT_STYLE="normal",l._FONT_SIZE_BUFFER=4,l._styleCache={},l.defaultStyleProcessor=function(e,t){return e.css(t)},l._buildCssBackgroundPropertiesObject=function(e){var t={};return e.css("border-top-color")&&(t.borderColor=e.css("border-top-color")),e.css("border-width")&&e.css("border-style")&&"none"!=e.css("border-style")&&(t.borderWidth=e.css("border-width")),e.css("background-color")&&(t.backgroundColor=e.css("background-color")),t},l._buildTextCssPropertiesObject=function(e,t){var n={},r=e.css("font-family");return r&&r!==l._INHERITED_FONT_FAMILY&&(n.fontFamily=r.replace(/"/g,"'")),!(r=e.css("font-size"))||r.indexOf("px")>-1&&parseFloat(r)<l._FONT_SIZE_BUFFER||t["font-size"]||(n.fontSize=r),(r=e.css("font-weight"))&&r!==l._INHERITED_FONT_WEIGHT&&!t["font-weight"]&&(n.fontWeight=r),(r=e.css("color"))&&r!==l._INHERITED_FONT_COLOR&&!t.color&&(n.color=r),(r=e.css("font-style"))&&r!==l._INHERITED_FONT_STYLE&&(n.fontStyle=r),n},l.processStyles=function(n,r,i,o){for(var s=null,a=null,u="",d=0;d<i.length;d++)u=u+i[d]+" ";var h={},_={};for(var c in o){var p=o[c];p instanceof Array||(p=[p]);var f=l._hasUncachedProperty(c,p);a||s||!f||((s=t(document.createElement("div"))).attr("style","display:none;"),n.append(s),s.attr("class",u),t(document.body).append(s),(a=t(document.createElement("div"))).css("font-size",l._INHERITED_FONT_SIZE),a.css("color",l._INHERITED_FONT_COLOR),a.css("font-weight",l._INHERITED_FONT_WEIGHT),a.css("font-style",l._INHERITED_FONT_STYLE),s.append(a)),h[c]=p,f&&(_[c]=l._createStyleDivs(a,c,p))}var v=e.ColorAttributeGroupHandler.__createAttrDiv();for(var c in o)l._processStyle(_[c],r,c,h[c]);v&&(e.ColorAttributeGroupHandler.__processAttrDiv(v),v.remove()),s&&s.remove()},l._createStyleDivs=function(e,n,r){l._styleCache[n]||(l._styleCache[n]={});for(var i=null,o=0;o<r.length;o++){var s=r[o].property;if(s)void 0===l._styleCache[n][s]&&(i||((i=t(document.createElement("div"))).addClass(n),e.append(i)))}return i},l._processStyle=function(e,t,n,r){for(var i=0;i<r.length;i++){var o=r[i],a=o.property;if(a){var u=l._styleCache[n][a];if(void 0===u&&e&&(u=l._resolveStyle(e,a),l._styleCache[n][a]=u),null!=u){var d=new s(t,o.path),h=d.getValue(),_="object"==typeof h;if(_&&h){var c=Object.keys(u);for(i=0;i<c.length;i++){var p=c[i];void 0===h[p]&&(h[p]=u[p])}}else d.setValue(u,_)}}}},l._resolveStyle=function(e,t){var n=l[t],r=n?n(e):l.defaultStyleProcessor(e,t);return null==r||"string"==typeof r&&""==r.replace(/^\s+/g,"")?null:r},l._hasUncachedProperty=function(e,t){var n=l._styleCache[e];if(!n)return!0;for(var r=0;r<t.length;r++){var i=t[r].property;if(i)if(void 0===n[i])return!0}return!1},e.ShapeAttributeGroupHandler=function(e){this.Init(e)},e.Object.createSubclass(e.ShapeAttributeGroupHandler,e.AttributeGroupHandler,"oj.ShapeAttributeGroupHandler"),e.ShapeAttributeGroupHandler._attributeValues=["square","circle","diamond","plus","triangleDown","triangleUp","human"],e.ShapeAttributeGroupHandler.prototype.getValueRamp=function(){return e.ShapeAttributeGroupHandler._attributeValues},e.__registerWidget("oj.dvtBaseComponent",t.oj.baseComponent,{options:{trackResize:"on"},_ComponentCreate:function(){this._super(),this._renderCount=0,this._numDeferredObjs=0,this._optionsCopy=null,this._templateMap={};for(var n=this._GetComponentStyleClasses(),r=0;r<n.length;r++)this.element.addClass(n[r]);this._referenceDiv=t(document.createElement("div")),this._referenceDiv.attr("style","visibility:hidden;"),this.element.append(this._referenceDiv);var o=this.element[0].parentElement;o&&o._dvtcontext?this._context=o._dvtcontext:this._context=new i.Context(this.element[0],null,this._referenceDiv[0]),this._context.oj=e,this._context.setReadingDirection(this._GetReadingDirection()),this._context.setTooltipAttachedCallback(e.Components.subtreeAttached),this._context.setOverlayAttachedCallback(e.Components.subtreeAttached),this._context.setTooltipStyleClass("oj-dvt-tooltip"),this._context.setDatatipStyleClass("oj-dvt-datatip"),this._context.setFixContextCallback(this._FixRendererContext.bind(this)),this._context.setCustomElement(this._IsCustomElement()),t(document.body).hasClass("oj-hicontrast")&&i.Agent.setHighContrast(!0),this._component=this._CreateDvtComponent(this._context,this._HandleEvent,this),this._context.getStage().addChild(this._component),!1!==i.requireJS&&(this._setLocaleHelpers(),this._processTranslations()),this._LoadResources(),this._dataProviderEventListeners=[],this.options._environment="jet",this.options._widgetConstructor=e.Components.__GetWidgetConstructor(this.element)},_AfterCreate:function(){this._super(),"off"!=this.options.trackResize&&this._addResizeListener(),this._ProcessOptions(),this._Render()},refresh:function(){this._super(),this._context.setReadingDirection(this._GetReadingDirection()),this._processTranslations(),this._Render()},getNodeBySubId:function(e){var t=this._component&&this._component.getAutomation?this._component.getAutomation():null;if(t){var n=this._ConvertLocatorToSubId(e);return t.getDomElementForSubId(n)}return null},getSubIdByNode:function(e){var t=this._component&&this._component.getAutomation?this._component.getAutomation():null;if(t){var n=t.getSubIdForDomElement(e);return n?this._ConvertSubIdToLocator(n):null}return null},_ConvertLocatorToSubId:function(e){return null},_ConvertSubIdToLocator:function(e){return null},_ProcessStyles:function(){l.processStyles(this.element,this.options,this._GetComponentStyleClasses(),this._GetChildStyleClasses())},_GetComponentStyleClasses:function(){return["oj-dvtbase"]},_GetChildStyleClasses:function(){var e={"oj-dvt-no-data-message":{path:"_statusMessageStyle",property:"TEXT"}};return e},_GetEventTypes:function(){return[]},_GetTranslationMap:function(){var t=this.options.translations,n={"DvtUtilBundle.CLEAR_SELECTION":t.labelClearSelection,"DvtUtilBundle.COLON_SEP_LIST":t.labelAndValue,"DvtUtilBundle.INVALID_DATA":t.labelInvalidData,"DvtUtilBundle.NO_DATA":t.labelNoData,"DvtUtilBundle.DATA_VISUALIZATION":t.labelDataVisualization,"DvtUtilBundle.STATE_SELECTED":t.stateSelected,"DvtUtilBundle.STATE_UNSELECTED":t.stateUnselected,"DvtUtilBundle.STATE_MAXIMIZED":t.stateMaximized,"DvtUtilBundle.STATE_MINIMIZED":t.stateMinimized,"DvtUtilBundle.STATE_EXPANDED":t.stateExpanded,"DvtUtilBundle.STATE_COLLAPSED":t.stateCollapsed,"DvtUtilBundle.STATE_ISOLATED":t.stateIsolated,"DvtUtilBundle.STATE_HIDDEN":t.stateHidden,"DvtUtilBundle.STATE_VISIBLE":t.stateVisible,"DvtUtilBundle.SCALING_SUFFIX_THOUSAND":t.labelScalingSuffixThousand,"DvtUtilBundle.SCALING_SUFFIX_MILLION":t.labelScalingSuffixMillion,"DvtUtilBundle.SCALING_SUFFIX_BILLION":t.labelScalingSuffixBillion,"DvtUtilBundle.SCALING_SUFFIX_TRILLION":t.labelScalingSuffixTrillion,"DvtUtilBundle.SCALING_SUFFIX_QUADRILLION":t.labelScalingSuffixQuadrillion},r=e.LocaleData.getMonthNames("abbreviated");return n["DvtUtilBundle.MONTH_SHORT_JANUARY"]=r[0],n["DvtUtilBundle.MONTH_SHORT_FEBRUARY"]=r[1],n["DvtUtilBundle.MONTH_SHORT_MARCH"]=r[2],n["DvtUtilBundle.MONTH_SHORT_APRIL"]=r[3],n["DvtUtilBundle.MONTH_SHORT_MAY"]=r[4],n["DvtUtilBundle.MONTH_SHORT_JUNE"]=r[5],n["DvtUtilBundle.MONTH_SHORT_JULY"]=r[6],n["DvtUtilBundle.MONTH_SHORT_AUGUST"]=r[7],n["DvtUtilBundle.MONTH_SHORT_SEPTEMBER"]=r[8],n["DvtUtilBundle.MONTH_SHORT_OCTOBER"]=r[9],n["DvtUtilBundle.MONTH_SHORT_NOVEMBER"]=r[10],n["DvtUtilBundle.MONTH_SHORT_DECEMBER"]=r[11],n},_VerifyConnectedForSetup:function(){return!0},_SetupResources:function(){this._super(),this._addDataProviderEventListeners()},_ReleaseResources:function(){this._super(),this._removeDataProviderEventListeners()},_processTranslations:function(){var e=this._GetTranslationMap();i.Bundle.addLocalizedStrings(e)},_setLocaleHelpers:function(){var t={};t.numberConverterFactory=e.Validation.getDefaultConverterFactory("number"),t.isoToDateConverter=function(t){if("string"==typeof t){var n=e.IntlConverterUtils.isoToDate(t),r=n.toJSON()?e.IntlConverterUtils.dateToLocalIso(n):t;return e.IntlConverterUtils.isoToLocalDate(r)}return t},t.dateToIsoWithTimeZoneConverter=function(t){if(t instanceof Date){var n=-1*t.getTimezoneOffset(),r=n>=0?"+":"-",i=Math.floor(Math.abs(n)/60),o=Math.abs(n)%60,s=r+(2!==i.toString().length?"0"+i:i)+":"+(2!==o.toString().length?o+"0":o);return e.IntlConverterUtils.dateToLocalIso(t)+s}return t},this._context.setLocaleHelpers(t)},_destroy:function(){this._context.hideTooltips(),this._context.destroy(),this._context=null;var e=this.element[0].parentElement;e&&e._dvtcontext&&(e._dvtcontext=null),this._component.destroy&&this._component.destroy(),this._component=null,this._removeResizeListener(),this._CleanAllTemplates(),this.element.children().remove(),this.element.removeAttr("role").removeAttr("tabIndex").removeAttr("aria-activedescendant");for(var t=this._GetComponentStyleClasses(),n=0;n<t.length;n++)this.element.removeClass(t[n]);this._MakeReady(),this._super()},_setOptions:function(e,n){this._superApply(arguments);var r=this.options.trackResize;if("off"==r&&this._resizeListener?this._removeResizeListener():"off"==r||this._resizeListener||this._addResizeListener(),this._ProcessOptions(),!this._bUserDrivenChange){var i=!1,o=this._GetEventTypes(),s=["highlightedCategories","selection","dataCursorPosition"];t.each(e,function(e,t){if(o.indexOf(e)<0&&s.indexOf(e)<0)return i=!0,!1}),i?this._Render():(void 0!==e.highlightedCategories&&this._component.highlight(e.highlightedCategories),void 0!==e.selection&&this._component.select(e.selection),void 0!==e.dataCursorPosition&&this._component.positionDataCursor&&this._component.positionDataCursor(e.dataCursorPosition))}},_CreateDvtComponent:function(e,t,n){return null},_HandleEvent:function(e){var n=e.type;"selection"===n?this._UserOptionChange("selection",e.selection):"categoryHide"===n||"categoryShow"===n?this._UserOptionChange("hiddenCategories",e.hiddenCategories):"categoryHighlight"===n?this._UserOptionChange("highlightedCategories",e.categories):"optionChange"===n?this._UserOptionChange(e.key,e.value,e.optionMetadata):"touchHoldRelease"===n&&this._GetContextMenu()?this._OpenContextMenu(t.Event(e.nativeEvent),"touch"):"ready"===n&&0===this._numDeferredObjs&&this._MakeReady()},_addResizeListener:function(){this._resizeListener||(this._resizeListener=this._handleResize.bind(this),e.DomUtils.addResizeListener(this.element[0],this._resizeListener,250))},_removeResizeListener:function(){this._resizeListener&&(e.DomUtils.removeResizeListener(this.element[0],this._resizeListener),this._resizeListener=null)},_handleResize:function(e,t){var n=this.element.width(),r=this.element.height();(null==this._width||null==this._height||Math.abs(n-this._width)+Math.abs(r-this._height)>=5)&&this._Render(!0)},_LoadResources:function(){},_Render:function(t){this._context.hideTooltips(),this._NotReady(),this._context.isReadyToRender()?(this._width=this._IsFlowingLayoutSupported()?null:this.element.width(),this._height=this._IsFlowingLayoutSupported()?null:this.element.height(),this._context.setDefaultFontFamily(this._referenceDiv.css("font-family")),this.options._width=this._width,this.options._height=this._height,this.options._locale=e.Config.getLocale(),this._IsDraggable()&&this.element.attr("draggable",!0),this._ProcessStyles(),this._renderCount++,t?0===this._numDeferredObjs&&this._RenderComponent(this._optionsCopy,t):this._resolveDeferredDataItems()&&this._RenderComponent(this._optionsCopy),this._renderNeeded=!1):(this._renderNeeded=!0,this._MakeReady())},_IsDraggable:function(){return!!this.options.dnd},_NotifyShown:function(){this._super(),this._notifyShownAttached()},_NotifyAttached:function(){this._super(),this._notifyShownAttached()},_NotifyDetached:function(){this._super(),this._notifyHiddenDetached()},_NotifyHidden:function(){this._super(),this._notifyHiddenDetached()},_notifyShownAttached:function(){this._renderNeeded&&this._Render()},_notifyHiddenDetached:function(){this._context.hideTooltips(),this._MakeReady()},_UserOptionChange:function(e,t,n){this._bUserDrivenChange=!0,this.option(e,t,{_context:{writeback:!0,optionMetadata:n,internalSet:!0}}),this._bUserDrivenChange=!1},_NotifyContextMenuGesture:function(e,t,n){if("touch"!==n)if("keyboard"===n){var r=this.element[0].getBoundingClientRect(),i=this._component.getKeyboardFocus()?this._component.getKeyboardFocus().getBoundingClientRect():null,o=i?"left+"+(i.left+.5*i.width-r.left)+" top+"+(i.top+.5*i.height-r.top):"center";this._OpenContextMenu(t,n,{position:{at:o}})}else this._super(e,t,n)},_GetDvtComponent:function(t){var n=e.Components.__GetWidgetConstructor(t)("instance");return n?n._component:null},_GetStringFromIndexPath:function(e){for(var t="",n=0;n<e.length;n++)t+="["+e[n]+"]";return t},_GetIndexPath:function(e){for(var t=[],n=0;e.indexOf("[",n)>0;){var r=e.indexOf("[",n)+1,i=e.indexOf("]",n);t.push(Number(e.substring(r,i))),n=i+1}return t},_GetFirstIndex:function(e){return Number(this._GetFirstBracketedString(e))},_GetFirstBracketedString:function(e){var t=e.indexOf("[")+1,n=e.indexOf("]");return e.substring(t,n)},_GetComponentDeferredDataPaths:function(){return{}},_GetComponentNoClonePaths:function(){if(!this._noClonePaths){this._noClonePaths={};var e=this,t=this._GetComponentDeferredDataPaths().root;t&&t.forEach(function(t){e._noClonePaths[t]=!0})}return this._noClonePaths},_resolveDeferredDataItems:function(){this._optionsCopy=i.JsonUtils.clone(this.options,null,this._GetComponentNoClonePaths()),this._FixCustomRenderers(this._optionsCopy),this._numDeferredObjs=0;var e=this,t=this._GetComponentDeferredDataPaths();for(var n in t){t[n].forEach(function(t){if("root"===n)e._resolveDeferredDataItem.bind(e)(e.options,e._optionsCopy,t);else{var r=e.options[n];if(r&&r instanceof Array)for(var i=0;i<r.length;i++)e._resolveDeferredDataItem.bind(e)(r[i],e._optionsCopy[n][i],t)}})}return 0===this._numDeferredObjs},_resolveDeferredDataItem:function(t,n,r){var i=new s(t,r),o=i.getValue();if(o instanceof Function?o=Promise.resolve(o(this._GetDataContext(t))):this._IsCustomElement()&&Array.isArray(o)&&(o=Promise.resolve(o),i.setValue(o,!0)),o&&e.DataProviderFeatureChecker.isIteratingDataProvider(o)){var a=this;o=new Promise(function(e,t){var n=a._getTemplateEngine(),r=a._fetchAllData(o);Promise.all([n,r]).then(function(t){a._dataObjects=t[1];var n=a._ProcessTemplates(t[1],t[0]);e(n)})})}if(o instanceof Promise){var l=this._renderCount;a=this;o.then(function(e){e.paths?a._renderDeferredData(l,n,e.paths,e.values):a._renderDeferredData(l,n,[r],[e])},function(e){a._renderDeferredData(l,n,[r],[[]])}),this._numDeferredObjs++}},_renderDeferredData:function(e,t,n,r){if(e===this._renderCount){this._numDeferredObjs--;for(var i=0;i<n.length;i++)new s(t,n[i]).setValue(r[i],!0);0===this._numDeferredObjs&&(this._RenderComponent(this._optionsCopy),this._optionsCopy=null)}},_fetchAllData:function(e){var t={data:[],keys:[]},n=e.fetchFirst({size:-1})[Symbol.asyncIterator](),r=function(e){for(var i=0;i<e.value.data.length;i++)t.data.push(e.value.data[i]),t.keys.push(e.value.metadata[i].key);return e.done?Promise.resolve(t):n.next().then(r)};return n.next().then(r)},_getTemplateEngine:function(){return this._templateEnginePromise?this._templateEnginePromise:(this._templateEnginePromise=new Promise(function(t,n){e.Config.__getTemplateEngine().then(function(e){t(e)},function(e){throw"Error loading template engine: "+e})}),this._templateEnginePromise)},getTemplates:function(){return e.BaseCustomElementBridge.getSlotMap(this.element[0])},_ProcessTemplates:function(t,n){var r=this._GetSimpleDataProviderConfig(),i=r.templateName,o=r.templateElementName,s=r.resultPath;if(i&&o&&s){var a=this.options.as,l=this.getTemplates()[i],u=Object.keys(e.CustomElementBridge.getMetadata(o).properties),d=this.element[0],h=t.data,_=t.keys,c=[],p=document.createElement("div");p.setAttribute("data-oj-context","");for(var f=document.createDocumentFragment(),v=0;v<h.length;v++){var m,g={data:h[v],key:_[v],index:v,componentElement:d};try{for(var C=n.execute(d,l[0],g,a),y=0;y<C.length;y++)if(C[y].tagName&&C[y].tagName.toLowerCase()===o){m=C[y];break}}catch(t){e.Logger.error(t)}c.push(m),f.appendChild(m)}p.appendChild(f),document.body.appendChild(p);return e.Context.getContext(p).getBusyContext().whenReady().then(function(){for(var e=[],t=0;t<h.length;t++){for(var r=c[t],i={id:_[t],_itemData:h[t]},o=0;o<u.length;o++){var a=r.getProperty(u[o]);void 0!==a&&(i[u[o]]=a)}e.push(i)}return n.clean(p),document.body.removeChild(p),p=null,{paths:[s],values:[e]}})}return Promise.resolve({paths:[],values:[]})},_GetSimpleDataProviderConfig:function(){return{}},_RenderComponent:function(e,t){if(this._context.isReadyToRender()){this._CleanAllTemplates();var n=this._IsFlowingLayoutSupported()&&this._resizeListener;n&&this._removeResizeListener(),this._component.render(t?null:e,this._width,this._height),n&&this._addResizeListener(),this.element.attr("role")?this.element.attr("tabindex",0):this.element.attr("tabindex",null)}else this._renderNeeded=!0,this._MakeReady()},_GetDataProviderEventHandler:function(t,n){var r=this,i=function(t,n){if(!n)return[];for(var r=new e.KeySetImpl(n),i=new Map,o=0;o<t.keys.length;o++){var s=t.keys[o],a=r.get(s);null!=a&&i.set(a,o)}var l=[];return n.forEach(function(e){l.push(i.get(e))}),l},o=function(e){Promise.all([e,r._getTemplateEngine()]).then(function(e){r._dataObjects=e[0];var i=r._ProcessTemplates(e[0],e[1]),o="root"==n[0]?{}:t.options[n[0]];o[n[1]]=i,t._setOptions(o)})};return function(e){if("refresh"===e.type)o(r._fetchAllData(this));else if("mutate"===e.type){var t=e.detail.add,n=e.detail.remove,s=e.detail.update,a=r._dataObjects,l=function(e,t,n){var r=n?1:0,i=0;t.keys.forEach(function(n){a.data.splice(e[i],r,t.data[i]),a.keys.splice(e[i],r,n),i++}),o(Promise.resolve(a))};if(t)0==(h=t.indexes||i(a,t.afterKeys)).length&&h.push(a.data.length),Array.isArray(t.data)?l(h,t,!1):this.fetchByKeys({keys:t.keys}).then(function(e){if(e.results.size>0){var n=[];t.keys.forEach(function(t){n.push(e.results.get(t).data)}),t.data=n,l(h,t,!1)}});else if(n){for(var u=n.indexes||i(a,n.keys),d=0;d<u.length;d++)a.data.splice(u[d],1),a.keys.splice(u[d],1);o(Promise.resolve(a))}else if(s){var h=s.indexes||i(a,s.keys);Array.isArray(s.data)?l(h,s,!0):this.fetchByKeys({keys:s.keys}).then(function(e){if(e.results.size>0){var t=[];s.keys.forEach(function(n){t.push(e.results.get(n).data)}),s.data=t,l(h,s,!0)}})}}}},_addDataProviderEventListeners:function(){for(var t=this._GetComponentDeferredDataPaths(),n=Object.keys(t),r=0;r<n.length;r++)for(var i=n[r],o=t[i],s=0;s<o.length;s++){var a=o[s],l="root"===i?this.options[a]:this.options[i]?this.options[i][a]:null;if(l&&e.DataProviderFeatureChecker.isIteratingDataProvider(l)){var u=this._GetDataProviderEventHandler(this,[i,a]);l.addEventListener("mutate",u),l.addEventListener("refresh",u),this._dataProviderEventListeners.push({dataProvider:l,listener:u})}}},_removeDataProviderEventListeners:function(){for(var e=0;e<this._dataProviderEventListeners.length;e++){var t=this._dataProviderEventListeners[e],n=t.dataProvider,r=t.listener;n.removeEventListener("mutate",r),n.removeEventListener("refresh",r)}this._dataProviderEventListeners=[]},_GetDataContext:function(e){return{}},_IsFlowingLayoutSupported:function(){return!1},whenReady:function(){if(this._ready)return Promise.resolve(!0);if(!this._promise){var e=this;this._promise=new Promise(function(t){e._promiseResolve=t})}return this._promise},_NotReady:function(){if(this._ready=!1,0===this._numDeferredObjs&&!this._readyResolveFunc){var t=e.Context.getContext(this.element[0]).getBusyContext(),n={description:"The component identified by '"+this.element.attr("id")+"' is being loaded."};this._readyResolveFunc=t.addBusyState(n)}},_MakeReady:function(){this._promiseResolve&&(this._promiseResolve(!0),this._promiseResolve=null),this._ready=!0,this._promise=null,this._readyResolveFunc&&(this._readyResolveFunc(),this._readyResolveFunc=null)},_ProcessOptions:function(){var e=this.options.tooltip;e&&e._renderer&&(this.options.tooltip={renderer:this._GetTemplateRenderer(e._renderer,"tooltip")})},_WrapCustomElementRenderer:function(e){var t=this;return function(n){n._dvtcontext=t._context;var r=e(n);if(n._templateName&&n._templateCleanup&&t._AddTemplate(n._templateName,n._templateCleanup),r&&!0!==r.preventDefault&&r.insert){var i=r.insert;return i.classList&&i.classList.contains("oj-dvtbase")?t._GetDvtComponent(i):i}return null}},_FixCustomRenderers:function(e){if(this._IsCustomElement())for(var t=this._GetComponentRendererOptions(),n=0;n<t.length;n++){var r=t[n],i=new s(e,r),o=i.getValue();o&&i.setValue(this._WrapCustomElementRenderer(o),!0)}},_GetComponentRendererOptions:function(){return["tooltip/renderer"]},_GetTemplateRenderer:function(e,n){var r=this;return function(i){var o=document.createElement("div");o.style.display="none",e({parentElement:o,context:i});var s=o.children[0];return s?(r._AddTemplate(n,function(){t(o).remove()}),o.removeChild(s),t(o).remove(),s):null}},_GetTemplateDataRenderer:function(e,n){var r=this;return function(i){var o=document.createElement("div");o.style.display="none",o._dvtcontext=r._context,r.element.append(o),e({parentElement:o,data:i.data});var s=o.children[0];return s?(r._AddTemplate(n,function(){t(o).remove()}),"http://www.w3.org/2000/svg"===s.namespaceURI?(o.removeChild(s),t(o).remove(),s):r._GetDvtComponent(s)):null}},_CleanAllTemplates:function(){for(var e in this._templateMap)this._CleanTemplate(e);this._templateMap={}},_CleanTemplate:function(e){if(this._templateMap[e]){for(var t=this._templateMap[e].length,n=0;n<t;n++)this._templateMap[e][n]();this._templateMap[e]=[]}},_AddTemplate:function(e,t){this._templateMap[e]||(this._templateMap[e]=[]),this._templateMap[e].push(t)},_CompareOptionValues:function(t,n,r){switch(t){case"hiddenCategories":case"highlightedCategories":case"selection":return e.Object.compareValues(n,r);default:return this._super(t,n,r)}}},!0),a={properties:{trackResize:{type:"string",enumValues:["on","off"]},translations:{properties:{labelAndValue:{type:"string"},labelClearSelection:{type:"string"},labelCountWithTotal:{type:"string"},labelDataVisualization:{type:"string"},labelInvalidData:{type:"string"},labelNoData:{type:"string"},stateCollapsed:{type:"string"},stateDrillable:{type:"string"},stateExpanded:{type:"string"},stateHidden:{type:"string"},stateIsolated:{type:"string"},stateMaximized:{type:"string"},stateMinimized:{type:"string"},stateSelected:{type:"string"},stateUnselected:{type:"string"},stateVisible:{type:"string"}}}},methods:{},extension:{_WIDGET_NAME:"dvtBaseComponent",_DVT_PARSE_FUNC:o.shapeParseFunction}},e.CustomElementBridge.registerMetadata("dvtBaseComponent","baseComponent",a)});