/**
 * @license
 * Copyright (c) 2014, 2023, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcomponentcore","ojs/ojarraytabledatasource","ojs/ojlistview","ojs/ojeditablevalue","ojs/ojcore-base","ojs/ojcore","jquery","ojs/ojcolor","ojs/ojconverter-color","ojs/ojlogger","ojs/ojcontext","ojs/ojlabelledbyutils"],function(t,e,i,s,a,l,o,n,r,h,c,d){"use strict";var u,p;a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c,d=d&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d,(u={properties:{describedBy:{type:"string"},disabled:{type:"boolean",value:!1},displayOptions:{type:"object",properties:{converterHint:{type:"Array<string>|string"},helpInstruction:{type:"Array<string>|string",value:["notewindow"]},messages:{type:"Array<string>|string"},validatorHint:{type:"Array<string>|string"}}},help:{type:"object",properties:{instruction:{type:"string",value:""}}},helpHints:{type:"object",properties:{definition:{type:"string",value:""},source:{type:"string",value:""}}},labelDisplay:{type:"string",enumValues:["auto","off"],value:"off"},labelEdge:{type:"string",enumValues:["inside","none","provided"]},labelHint:{type:"string",value:""},labelledBy:{type:"string"},layout:{type:"string",enumValues:["grid","list"],value:"grid"},messagesCustom:{type:"Array<Object>",writeback:!0,value:[]},palette:{type:"Array<Object>"},swatchSize:{type:"string",enumValues:["xs","sm","lg"],value:"lg"},translations:{type:"object",value:{},properties:{labelNone:{type:"string"}}},userAssistanceDensity:{type:"string",enumValues:["compact","efficient","reflow"],value:"reflow"},valid:{type:"string",writeback:!0,enumValues:["invalidHidden","invalidShown","pending","valid"],readOnly:!0},value:{type:"object|string",writeback:!0}},methods:{getProperty:{},refresh:{},reset:{},setProperties:{},setProperty:{},showMessages:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojAnimateEnd:{},ojAnimateStart:{}},extension:{}}).extension._WIDGET_NAME="ojColorPalette",a.CustomElementBridge.register("oj-color-palette",{metadata:a.CollectionUtils.mergeDeep(u,{properties:{readonly:{binding:{consume:{name:"readonly"}}},userAssistanceDensity:{binding:{consume:{name:"userAssistanceDensity"}}},labelEdge:{binding:{consume:{name:"labelEdge"}}}}})}),p="oj-selected",l.__registerWidget("oj.ojColorPalette",o.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"<input>",options:{labelledBy:null,palette:null,swatchSize:"lg",labelDisplay:"off",layout:"grid",value:null},getNodeBySubId:function(t){if(null==t)return this.element?this.element[0]:null;var e,i=t.subId,s=t.index,a=this._super(t);return a||"oj-palette-entry"!==i||(e=this._$LV.find(".oj-listview-item")).length&&s<e.length&&(a=e[s]),a},getSubIdByNode:function(t){var e,i,s=o(t),a=null,l=-1,n=null;return s.is("li")&&s.hasClass("oj-listview-item-element")&&(a="oj-palette-entry",e=s.attr("id"),i=this._$LV.find(".oj-listview-item"),o.each(i,function(t,i){return o(i).attr("id")!==e||(l=t,!1)})),a&&(n={subId:a},l>=0&&(n.index=l)),null==n&&(n=this._super(t)),n},add:function(t){var e=null;t instanceof n?e={color:t}:"object"==typeof t&&t.color instanceof n&&(e=t),e&&(this._setPaletteBusyContext("The swatch add is being animated in the palette (id="+this.element.attr("id")+")."),e.id=this._getNewSwatchId(),this._opStack||(this._opStack=[]),this._opStack.push({op:"a",obj:e}),this._palDataSource.add(e),this._waitForLV())},remove:function(t){var e=null,i=typeof t;if("number"===i)t>=0&&t<this._palette.length?e=this._palette[t].id:h.error("JET Color Palette (id='"+this.element.attr("id")+"'): Invalid index for remove ("+t+")");else if("object"===i){var s=t instanceof n?t:t.color;e=this._findSwatchIdOfColorInPalette(s)}e&&(t={id:e},this._setPaletteBusyContext("The removed swatch is being animated in the palette (id="+this.element.attr("id")+")."),this._opStack||(this._opStack=[]),this._opStack.push({op:"r",obj:t}),this._palDataSource.remove(t),this._waitForLV())},whenReady:function(){var t=this;return new Promise(function(e){t._$LV.ojListView("whenReady").then(function(){e(!0)})})},_SetupResources:function(){this._super();var t=this,e=c.getContext(this._$LV[0]).getBusyContext();e.whenReady().then(function(){return t._$LV.ojListView({data:t._palDataSource,item:{renderer:t._renderer.bind(t)},optionChange:t._onLVOptionChange.bind(t),selectionMode:"single",selection:t._palInitSelected,rootAttributes:{class:"oj-colorpalette-listview-full"}}).attr("data-oj-internal",""),t._$LVWidget=t._$LV,e.whenReady()}).then(function(){if(t._$LVWidget&&(t._$LV.ojListView("option","translations.msgNoData",""),t._setOptDisabled(t._disabled),t._$LV[0].scrollWidth>t._$LV[0].clientWidth)){var e=t._getScrollbarWidth(),i="rtl"===t._GetReadingDirection();t._$LV.css(i?"padding-left":"padding-right",e+1)}t._$LV.ojListView("scrollToItem",{key:t._palInitSelected}),t._resolvePaletteBusyContext()})},_ReleaseResources:function(){this._super(),this._resolvePaletteBusyContext(),this._$LVWidget&&(this._$LVWidget.ojListView("destroy"),this._$LVWidget=null)},_VerifyConnectedForSetup:function(){return!0},_destroy:function(){this._palDataSource=null,this._$paletteContainer.remove(),this._$boundElem.removeClass("oj-colorpalette"),this._clear(),this._super()},_ComponentCreate:function(){this._super(),this._initPalette()},_AfterCreate:function(){var t;if(this._super(),this._labelledByUpdatedForSet(this.element[0].id,null,this.options.labelledBy,this._$LV),this._IsCustomElement()||(t=this._GetLabelElement()),t){var e=t.attr("id");e?this._$LV.attr("aria-labelledby",e):h.warn("JET Color Palette: The label for this component needs an id in order to be accessible")}else{var i=this.element.attr("aria-label");i&&this._$LV.attr("aria-label",i)}},_setOption:function(t,e,i){var s=this.options.labelledBy,a=!1;switch(t){case"value":a=this._setOptValue(e);break;case"palette":this._setOptPalette(e);break;case"swatchSize":this._setOptSwatchSize(e);break;case"layout":this._setOptLayout(e);break;case"labelDisplay":this._setOptLabelDisplay(e);break;case"disabled":this._setOptDisabled(e,!0);break;case"labelledBy":this._labelledByUpdatedForSet(this.element[0].id,s,e,this._$LV)}a||this._super(t,e,i)},_labelledByUpdatedForSet:d._labelledByUpdatedForSet,_onLVOptionChange:function(t,e){"selection"===e.option&&this._selected(t,e)},_waitForLV:function(){if(!this._LVResolve){var t=this;this._LVResolve=c.getContext(this._$LV[0]).getBusyContext(),this._LVResolve.whenReady().then(function(){var e,i,s,a,l,o;if(t._LVResolve=null,t._resolvePaletteBusyContext(),t._opStack){for(s=!1,l=0;l<t._opStack.length;l++)i=(e=t._opStack[l]).obj,"a"!==e.op&&"r"!==e.op||(s=!0,a||(a=t._palette.slice(0)),"a"===e.op?a.push(i):"r"===e.op&&(o=t._findIndexOfSwatchById(a,i.id),a.splice(o,1),e.index=o));if(s)for(t._fireOptionChangeEvent("palette",a,null);t._opStack.length;)i=(e=t._opStack.shift()).obj,"a"===e.op?t._palette.push(i):"r"===e.op&&t._palette.splice(e.index,1)}},function(){h.error("JET Color Palette (id='"+t.element.attr("id")+"'): ListView timed out."),t._opStack=[]})}},_compareColorValues:function(t,e){var i=!1;return t instanceof n&&e instanceof n&&(i=t.isEqual(e)),i},_fireOptionChangeEvent:function(t,e,i){"palette"===t&&this.option(t,e,{_context:{originalEvent:i,internalSet:!0},changed:!0})},_findColorInPalette:function(t){var e,i,s=-1,a=this._palette,l=a.length;for(e=0;e<l;e++)if(i=a[e],t.isEqual(i.color)){s=e;break}return s},_findSwatchIdOfColorInPalette:function(t){var e,i,s=null,a=this._palette,l=a.length;for(e=0;e<l;e++)if(i=a[e],t.isEqual(i.color)){s=i.id;break}return s},_findIndexOfSwatchById:function(t,e){var i,s=-1,a=t.length;for(i=0;i<a;i++)if(t[i].id===e){s=i;break}return s},_setPaletteBusyContext:function(t){if(!this._resolve){var e=c.getContext(this.element[0]).getBusyContext();this._resolve=e.addBusyState({description:t})}},_resolvePaletteBusyContext:function(){this._resolve&&(this._resolve(),this._resolve=null)},_renderer:function(t){var e,i,s,a,l,o;(e=t.data.color)instanceof n||(e=n.BLACK,h.warn("JET Color Palette (id='"+this.element.attr("id")+"'): Substituting Color.BLACK for an object that is not an instance of Color")),i=s=t.data.label,a="auto"===this._labelDisplay&&"list"===this._layout&&"sm"===this._swatchSize||"auto"===this._labelDisplay&&"grid"===this._layout&&"lg"===this._swatchSize,null!=e&&(o=i||this._convHex.format(e),a?(i=o||this._convHex.format(e),i=s?i:i.toUpperCase()):i=null,l=!!(this._isTransparent(e)||i&&"none"===i.toLowerCase()));var r,c="";return this._initSelection===t.data.id&&(c=p,this._initSelection=-1,this._selectedParent=t.parentElement),r="list"===this._layout?"oj-colorpalette-swatchsize-"+this._swatchSize+(l?" oj-colorpalette-swatch-none":""):this._swatchClass+(l?" oj-colorpalette-swatch-none":""),l?this._renderNone(a,i,o,r,c):this._renderStandard(e,a,i,o,r,c)},_renderStandard:function(t,e,i,s,a,l){var n=o("<div class='oj-colorpalette-swatch-entry'></div>").addClass(a+(e?" oj-colorpalette-swatch-showlabel":"")).append(o("<div class='oj-colorpalette-swatch-container'></div>").append(o("<div class='oj-colorpalette-swatch'></div>").attr("title",i?null:s).addClass(l).css("backgroundColor",t.toString())));return i&&n.append(o("<span class='oj-colorpalette-swatch-text'>"+i+"</span>")[0]),n[0]},_renderNone:function(t,e,i,s,a){var l;return l="<div class='oj-colorpalette-swatch-entry "+s+(t?" oj-colorpalette-swatch-showlabel":"")+"'><div class='oj-colorpalette-swatch-container'><div class='oj-colorpalette-swatch "+a+"'"+(e?"":" title='"+i+"'")+"><div class='oj-colorpalette-swatch-none-icon'></div></div></div>",e&&(l+="<span class='oj-colorpalette-swatch-text'>"+e+"</span>"),o(l+="</div>")[0]},_selected:function(t,e){var i,s,a=null;if((i=o(e.items[0]).find(".oj-colorpalette-swatch")).addClass(p),s=this._selectedSwatch,this._selectedSwatch=i,s||this._selectedParent&&(s=o(this._selectedParent).find(".oj-colorpalette-swatch"),this._selectedParent=null),s&&s.removeClass(p),1===e.value.length){for(var l=0;l<this._palette.length;l++)if(this._palette[l].id===e.value[0]){a=this._palette[l].color;break}this._SetValue(a,t),this._value=a}},_setOptDisabled:function(t,e){var i,s;(!e||e&&t!==this._disabled)&&(this._$LV&&this._$LV.ojListView("option","disabled",t),i=o(".oj-colorpalette-container .oj-colorpalette-swatch"),s=this,t?(this._disabledBG=[],o.each(i,function(t,e){s._disabledBG.push(e.style.backgroundColor),e.style.backgroundColor="#eee"})):(this._disabledBG&&this._disabledBG.length&&o.each(i,function(t,e){e.style.backgroundColor=s._disabledBG[t]}),this._disabledBG=null),this._disabled=t)},_setOptValue:function(t){var e=-1,i=[];if(this._palette.length>0&&t instanceof n&&!this._compareColorValues(this._value,t)){if((e=this._findColorInPalette(t))>=0&&null!=this._palette[e].id){var s=this._palette[e].id;i.push(s)}this._$LV.ojListView("option","selection",i),this._value=t}return i.length>0},_setOptPalette:function(t){o.isArray(t)&&(this._isPaletteEqual(t,this._palette)||(this._setPaletteBusyContext("The palette (id="+this.element.attr("id")+") option change in progress."),this._opStack=[],this._palette=t.slice(0),this._initSelection=this._findColorInPalette(this._value),this._setData(t,this._initSelection,!0),this._waitForLV()))},_setOptSwatchSize:function(t){if("string"==typeof t&&t!==this._swatchSize){this._swatchSize=t;var e="lg"===t||"sm"===t?t:"xs";this._swatchClass="oj-colorpalette-swatchsize-"+e,this._$LV.ojListView("refresh")}},_setOptLabelDisplay:function(t){"string"==typeof t&&t!==this._labelDisplay&&("auto"!==t&&"off"!==t||(this._labelDisplay=t,this._$LV.ojListView("refresh")))},_setOptLayout:function(t){"string"==typeof t&&t!==this._layout&&(this._layout=t,this._setDisplayFormat(),this._$LV.ojListView("refresh"))},_setDisplayFormat:function(){var t="grid"===this._layout,e=t?"oj-colorpalette-grid":"oj-colorpalette-list";this._$LV.removeClass("oj-colorpalette-grid oj-colorpalette-list oj-listview-card-layout"),this._$LV.addClass(e),t&&this._$LV.addClass("oj-listview-card-layout")},_setData:function(t,e,i){this._addIdsToPalette(t),this._palDataSource=new l.ArrayTableDataSource(t,{idAttribute:"id"}),e>=0&&(this._palette[e].id&&(e=this._palette[e].id),0===this._palInitSelected.length?this._palInitSelected.push(e):this._palInitSelected[0]=e),i&&(this._$LV.ojListView("option","selection",this._palInitSelected),this._$LV.ojListView("option","data",this._palDataSource))},_initPalette:function(){this._setPaletteBusyContext("Palette (id="+this.element.attr("id")+") is initializing."),this._initData(),this._setup()},_setup:function(){this._$boundElem.append(this._markup),this._$boundElem.addClass("oj-colorpalette"),this._$paletteContainer=this._$boundElem.find(".oj-colorpalette-container"),this._$LV=this._$paletteContainer.find(":first"),this._$LV.attr("data-oj-context",""),this._value&&this._value instanceof n&&(this._initSelection=this._findColorInPalette(this._value)),this._swatchId=0,this._setData(this._palette,this._initSelection,!1)},_initData:function(){var t;this._applyOptions(),this._convHex=new r({format:"hex"}),this._labelNone=this.getTranslatedString("labelNone"),t="grid"===this._layout?"oj-colorpalette-grid oj-listview-card-layout":"oj-colorpalette-list",this._markup=["<div class='oj-colorpalette-container oj-form-control-container'>","<ul class='"+t+"'>","</ul>","</div>"].join("")},_applyOptions:function(){var t,e=this.options;this._doc=this.element[0].ownerDocument,this._body=this._doc.body,this._$boundElem=o(this.element),this._disabled=!1,this._palInitSelected=[],this._palDataSource=null,"string"==typeof(t=e.swatchSize)&&"lg"!==(t=t.toLowerCase())&&"sm"!==t&&"xs"!==t&&(t="lg"),this._swatchSize=t,this._swatchClass="oj-colorpalette-swatchsize-"+t,"string"==typeof(t=e.labelDisplay)&&"auto"!==(t=t.toLowerCase())&&"off"!==t&&(t="auto"),this._labelDisplay=t,"string"==typeof(t=e.layout)&&("grid"!==(t=t.toLowerCase())&&"list"!==t&&(t="grid"),"grid"!==t&&"xs"===this._swatchSize&&(t="grid")),this._layout=t,(t=e.value)instanceof n||(t=n.BLACK),this._value=t,t=e.palette,o.isArray(t)||(t=[]),this._palette=t.slice(0),"boolean"==typeof(t=e.disabled)&&(this._disabled=t)},_isTransparent:function(t){var e=t.getRGBA();return 0===e.r&&0===e.g&&0===e.b&&0===e.a},_isPaletteEqual:function(t,e){var i,s,a,l=t.length,o=!1;if(l===e.length){for(a=0;a<l&&(i=t[a],s=e[a],!this._compareColorValues(i.color,s.color)||i.label===s.label);a++);o=a>=l}return o},_addIdsToPalette:function(t){for(var e=t.length,i=0;i<e;i++)t[i].id=this._getNewSwatchId()},_getNewSwatchId:function(){var t=this._swatchId.toString();return this._swatchId+=1,t},_clear:function(){this._convHex=null,this._markup=null,this._$LVElem=null,this._$LV=null,this._$LVWidget=null},_getScrollbarWidth:function(){var t=document.createElement("div");t.style.overflow="scroll",t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.visibility="hidden";var e=document.createElement("div");e.style.width="100%",e.style.height="100%",t.appendChild(e),this.element.append(t);var i=t.offsetWidth,s=e.offsetWidth;return o(t).remove(),i-s},_GetMessagingLauncherElement:function(){return this.element},_GetContentElement:function(){return this._$LV},_GetElementValue:function(){return this._value},_SetDisplayValue:function(t){t?this._value="string"==typeof t?new n(t):t:(this._value=n.BLACK,h.warn("JET Color Palette (id='"+this.element.attr("id")+"'): Substituting Color.BLACK since display value is not defined."))},_GetDisplayValue:function(){return this._value.toString()},_GetDefaultStyleClass:function(){return"oj-colorpalette"}})});
//# sourceMappingURL=ojcolorpalette.js.map