/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojmodel"],function(a){a.Mc=function(f,b,d,c,e){a.l.vy(d);this.$b=f;this.ve=b;this.zE=d;this.Gg=c;this.E4=e};o_("CollectionHeaderSet",a.Mc,a);a.Mc.prototype.C5=function(f){a.l.QD(f);null!=f&&f.length===this.R()&&(this.yr=f)};a.Mc.prototype.getData=function(f,b){var d;a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");if(null!=this.Gg){if(null==this.yr)return null;d=this.yr[f-this.$b];
return d.get(this.Gg)}return this.zE[f]};a.b.g("CollectionHeaderSet.prototype.getData",{getData:a.Mc.prototype.getData});a.Mc.prototype.getMetadata=function(f,b){var d;a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");if(null!=this.Gg){if(null==this.yr)return null;d=this.yr[f-this.$b];return{key:a.pp.rt(d)}}d=this.getData(f,b);return this.E4.key===d?{key:d,sortDirection:this.E4.direction}:{key:d}};a.b.g("CollectionHeaderSet.prototype.getMetadata",
{getMetadata:a.Mc.prototype.getMetadata});a.Mc.prototype.Ag=function(){return 0<this.R()?1:0};a.b.g("CollectionHeaderSet.prototype.getLevelCount",{Ag:a.Mc.prototype.Ag});a.Mc.prototype.Vb=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};a.b.g("CollectionHeaderSet.prototype.getExtent",{Vb:a.Mc.prototype.Vb});a.Mc.prototype.oe=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");
a.l.assert(null==b||0==b,"level out of bounds");return 1};a.b.g("CollectionHeaderSet.prototype.getDepth",{oe:a.Mc.prototype.oe});a.Mc.prototype.R=function(){return Math.max(0,this.ve-this.$b)};a.b.g("CollectionHeaderSet.prototype.getCount",{R:a.Mc.prototype.R});a.Mc.prototype.ta=function(){return this.$b};a.b.g("CollectionHeaderSet.prototype.getStart",{ta:a.Mc.prototype.ta});a.Mc.prototype.d3=function(){return this.ve};a.b.g("CollectionHeaderSet.prototype.getEnd",{d3:a.Mc.prototype.d3});a.Mc.prototype.m3=
function(){return this.zE};a.b.g("CollectionHeaderSet.prototype.getHeaders",{m3:a.Mc.prototype.m3});a.Mc.prototype.Ky=function(){return this.Gg};a.b.g("CollectionHeaderSet.prototype.getRowHeader",{Ky:a.Mc.prototype.Ky});a.Hd=function(f,b,d,c,e){a.l.vy(e);this.Qi=f;this.vr=b;this.hl=d;this.ur=c;this.Vd=e};o_("CollectionCellSet",a.Hd,a);a.Hd.prototype.C5=function(f){a.l.QD(f);null!=f&&f.length===this.R("row")&&(this.yr=f)};a.Hd.prototype.getData=function(a){var b;b=this.Pb(a);return null==b?null:b.get(this.Vd[a.column])};
a.b.g("CollectionCellSet.prototype.getData",{getData:a.Hd.prototype.getData});a.Hd.prototype.getMetadata=function(f){var b;b=this.Pb(f);return null==b?null:{keys:{row:a.pp.rt(b),column:this.Vd[f.column]}}};a.b.g("CollectionCellSet.prototype.getMetadata",{getMetadata:a.Hd.prototype.getMetadata});a.Hd.prototype.Pb=function(f){var b;if(null==this.yr)return null;a.l.Kf(f);b=f.row;f=f.column;a.l.assert(b>=this.Qi&&b<=this.vr&&f>=this.hl&&f<=this.ur);return this.yr[b-this.Qi]};a.Hd.prototype.R=function(a){return"row"===
a?Math.max(0,this.vr-this.Qi):"column"===a?Math.max(0,this.ur-this.hl):0};a.b.g("CollectionCellSet.prototype.getCount",{R:a.Hd.prototype.R});a.Hd.prototype.getStartRow=function(){return this.Qi};a.b.g("CollectionCellSet.prototype.getStartRow",{getStartRow:a.Hd.prototype.getStartRow});a.Hd.prototype.f3=function(){return this.vr};a.b.g("CollectionCellSet.prototype.getEndRow",{f3:a.Hd.prototype.f3});a.Hd.prototype.getStartColumn=function(){return this.hl};a.b.g("CollectionCellSet.prototype.getStartColumn",
{getStartColumn:a.Hd.prototype.getStartColumn});a.Hd.prototype.e3=function(){return this.ur};a.b.g("CollectionCellSet.prototype.getEndColumn",{e3:a.Hd.prototype.e3});a.Hd.prototype.Oo=function(){return this.Vd};a.b.g("CollectionCellSet.prototype.getColumns",{Oo:a.Hd.prototype.Oo});a.pp=function(){};a.pp.rt=function(a){var b;b=a.eg();null==b&&(b=a.tp());return b};a.xa=function(f,b){this.Fa=f;null!=b&&(this.mz=b.rowHeader,this.columns=b.columns);this.B0();a.xa.r.constructor.call(this)};o_("CollectionDataGridDataSource",
a.xa,a);a.b.ga(a.xa,a.bn,"oj.CollectionDataGridDataSource");a.xa.prototype.Init=function(){a.xa.r.Init.call(this);this.Pm={};this.Rx()};a.b.g("CollectionDataGridDataSource.prototype.Init",{Init:a.xa.prototype.Init});a.xa.prototype.Rx=function(){this.Fa.on("add",this.cga.bind(this));this.Fa.on("remove",this.ega.bind(this));this.Fa.on("change",this.dga.bind(this));this.Fa.on("refresh",this.vfa.bind(this));this.Fa.on("reset",this.wfa.bind(this))};a.xa.prototype.wha=function(){return null!=this.data};
a.xa.prototype.R=function(a){var b;void 0==this.precision&&(this.precision={});if("row"==a){b=this.Rd();if(-1===b||0===b&&(!this.wha()||0<this.yo()))return this.precision[a]="estimate",-1;this.precision[a]="exact";return this.yo()}if("column"==a){if(null!=this.columns)return this.precision[a]="exact",this.columns.length;this.precision[a]="estimate";return-1}return 0};a.b.g("CollectionDataGridDataSource.prototype.getCount",{R:a.xa.prototype.R});a.xa.prototype.yg=function(a){null!=this.precision&&null!=
this.precision[a]||this.R(a);return this.precision[a]};a.b.g("CollectionDataGridDataSource.prototype.getCountPrecision",{yg:a.xa.prototype.yg});a.xa.prototype.Of=function(a,b,d){var c,e;null!=b&&(c=a.axis,e={},e.W3=a,e.callbacks=b,e.wy=d,this.Pm[c]=e)};a.b.g("CollectionDataGridDataSource.prototype.fetchHeaders",{Of:a.xa.prototype.Of});a.xa.prototype.Rfa=function(f,b,d,c){var e,g,h,k;e=f.axis;g=f.start;h=f.count;if("column"===e)null!=this.columns?(c=Math.min(this.columns.length,g+h),k=new a.Mc(g,c,
this.columns,void 0,this.Gi)):k=new a.Gd(g,g,e,null);else if("row"===e){if(null!=this.mz){null!=c&&(h=c.count);c=Math.min(this.yo(),g+h);k=new a.Mc(g,c,this.columns,this.mz);this.Q_(g,c,k,f,b,d);return}k=new a.Gd(g,g,e,null)}null!=b&&b.success&&b.success.call(d.success,k,f)};a.xa.prototype.SW=function(a){var b,d,c,e,g,h;for(b=0;b<a.length;b+=1)d=a[b],"row"===d.axis?(c=d.start,e=d.count):"column"===d.axis&&(g=d.start,h=d.count);return{rowStart:c,rowCount:e,colStart:g,colCount:h}};a.xa.prototype.nfa=
function(f,b,d,c){var e,g,h;e=this.SW(f);g=e.rowStart;c=null!=c?Math.min(this.yo(),g+c.count):Math.min(this.yo(),g+e.rowCount);h=e.colStart;e=Math.min(null==this.columns?0:this.columns.length,h+e.colCount);e=new a.Hd(g,c,h,e,this.columns);this.Q_(g,c,e,f,b,d)};a.xa.prototype.Q_=function(a,b,d,c,e,g){var h;for(h=[];a<b;a++)h.push(this.Fa.at(a,{deferred:!0}));Promise.all(h).then(function(a){d.C5(a);e.success.call(g.success,d,c)})};a.xa.prototype.xg=function(a,b,d){null!=b&&(this.Ig={},this.Ig.d2=a,
this.Ig.callbacks=b,this.Ig.wy=d);this.ida(a)};a.b.g("CollectionDataGridDataSource.prototype.fetchCells",{xg:a.xa.prototype.xg});a.xa.prototype.PZ=function(a){var b,d,c,e,g;b=this.Pm[a];null!=b&&(d=b.W3,c=b.callbacks,e=b.wy,"row"===a&&(g=b.WM),this.Rfa(d,c,e,g),this.Pm[a]=null)};a.xa.prototype.tja=function(){this.nfa(this.Ig.d2,this.Ig.callbacks,this.Ig.wy,this.Ig.WM)};a.xa.prototype.ida=function(a){var b;a=this.SW(a);b=a.rowStart;this.Fa.nz(b,a.rowCount).then(function(a){this.data=!0;this.ala(a.start,
a.count);void 0===this.columns?this.Fa.at(b,{deferred:!0}).then(function(a){null!=a&&this.YL(a);this.CV()}.bind(this)):this.CV()}.bind(this),function(a){this.jda(a)}.bind(this))};a.xa.prototype.jda=function(f){a.q.error(f);null!=this.Pm&&(this.QZ("column",f),this.QZ("row",f));null!=this.Ig&&this.uja(f)};a.xa.prototype.QZ=function(a,b){var d,c,e;d=this.Pm[a];null!=d&&(c=d.callbacks,e=d.wy,d=d.W3,c.error&&c.error.call(e.error,b,d),this.Pm[a]=null)};a.xa.prototype.uja=function(a){var b,d,c;b=this.Ig.callbacks;
d=this.Ig.wy;c=this.Ig.d2;b.error&&b.error.call(d.error,a,c);this.Ig=null};a.xa.prototype.CV=function(){null!=this.Pm&&(this.PZ("column"),this.PZ("row"));null!=this.Ig&&this.tja()};a.xa.prototype.ala=function(a,b){var d={start:a,count:b};null!=this.Pm.row&&(this.Pm.row.WM=d);null!=this.Ig&&(this.Ig.WM=d)};a.xa.prototype.YL=function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.mz)&&this.columns.splice(this.columns.indexOf(this.mz),1)};a.xa.prototype.keys=function(f){var b,d,c,e,g;b=f.row;
d=f.column;g=this;return new Promise(function(f){g.Fa.at(b,{deferred:!0}).then(function(b){null==b?f({row:null,column:null}):(c=a.pp.rt(b),null==g.columns&&g.YL(b),e=g.columns[d],f({row:c,column:e}))}.bind(g))})};a.b.g("CollectionDataGridDataSource.prototype.keys",{keys:a.xa.prototype.keys});a.xa.prototype.Dg=function(a){var b,d,c,e;b=a.row;d=a.column;e=this;return new Promise(function(a){e.Fa.indexOf(b,{deferred:!0}).then(function(b){-1===b?a({row:-1,column:-1}):null==e.columns?e.Fa.at(b,{deferred:!0}).then(function(f){e.YL(f);
c=e.columns.indexOf(d);-1===c&&(b=-1);a({row:b,column:c})}.bind(e)):(c=e.columns.indexOf(d),-1===c&&(b=-1),a({row:b,column:c}))}.bind(e))})};a.b.g("CollectionDataGridDataSource.prototype.indexes",{Dg:a.xa.prototype.Dg});a.xa.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.b.g("CollectionDataGridDataSource.prototype.getCapability",{getCapability:a.xa.prototype.getCapability});a.xa.prototype.sort=function(a,b,d){var c,e,g;null==d&&(d={});null==a?this.EL(b,d):(e=
a.direction,g=a.key,a=a.axis,"column"===a?(this.Fa.Ya()?(this.Fa.comparator=g,this.Fa.sortDirection="ascending"===e?1:-1):("ascending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());
return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.Fa.comparator=c),this.Fa.sort(),this.B0(g),null!=b&&null!=b.success&&b.success.call(d.success)):null!=b&&null!=b.error&&b.error.call(d.error,"Axis value not supported"))};a.b.g("CollectionDataGridDataSource.prototype.sort",{sort:a.xa.prototype.sort});a.xa.prototype.EL=function(a,b){this.Fa.comparator=null;this.Fa.reset();null!=a&&null!=a.success&&a.success.call(b.success)};a.xa.prototype.B0=function(a){var b,d;b=this.Fa.comparator;d=-1===this.Fa.sortDirection?
"descending":"ascending";null==a&&"function"===typeof b?this.Gi={}:(this.Gi={},this.Gi.axis="column",this.Gi.direction=d,this.Gi.key=null==a?b:null)};a.xa.prototype.move=function(a,b,d,c,e){var g;this.Fa.get(a,{deferred:!0}).then(function(d){null==b?(this.Fa.remove(d),this.Fa.add(d),null!=c&&null!=c.success&&c.success.call(e.success)):(a===b?(g=this.Fa.indexOf(b,{deferred:!0}),this.Fa.remove(d)):(this.Fa.remove(d),g=this.Fa.indexOf(b,{deferred:!0})),g.then(function(a){this.Fa.add(d,{at:a,Hsa:!0});
null!=c&&null!=c.success&&c.success.call(e.success)}.bind(this)))}.bind(this))};a.b.g("CollectionDataGridDataSource.prototype.move",{move:a.xa.prototype.move});a.xa.prototype.rd=function(){return"valid"};a.b.g("CollectionDataGridDataSource.prototype.moveOK",{rd:a.xa.prototype.rd});a.xa.prototype.xk=function(a,b,d,c,e){var g={source:this};g.operation=a;g.keys={row:b,column:d};g.indexes={row:c,column:e};return g};a.xa.prototype.cga=function(f){this.handleEvent("change",this.xk("insert",a.pp.rt(f),null,
f.index,-1))};a.xa.prototype.ega=function(f,b,d){this.handleEvent("change",this.xk("delete",a.pp.rt(f),null,d.index,-1))};a.xa.prototype.dga=function(f){this.handleEvent("change",this.xk("update",a.pp.rt(f),null,f.index,-1))};a.xa.prototype.vfa=function(){this.data=null;this.handleEvent("change",this.xk("refresh",null,null))};a.xa.prototype.wfa=function(){this.data=null;this.handleEvent("change",this.xk("reset",null,null))};a.xa.prototype.yo=function(){return this.Fa.size()};a.xa.prototype.Rd=function(){return void 0===
this.Fa.totalResults?-1:this.Fa.totalResults};a.xa.prototype.Y2=function(){return this.Fa};a.b.g("CollectionDataGridDataSource.prototype.getCollection",{Y2:a.xa.prototype.Y2});a.xa.prototype.Oo=function(){return this.columns};a.b.g("CollectionDataGridDataSource.prototype.getColumns",{Oo:a.xa.prototype.Oo});a.xa.prototype.Ky=function(){return this.mz};a.b.g("CollectionDataGridDataSource.prototype.getRowHeader",{Ky:a.xa.prototype.Ky});a.xa.prototype.getData=function(){return this.data};a.b.g("CollectionDataGridDataSource.prototype.getData",
{getData:a.xa.prototype.getData})});