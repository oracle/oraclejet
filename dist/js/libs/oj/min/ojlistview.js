/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","require","ojs/ojcontext","ojs/ojconfig","ojs/ojthemeutils","ojs/ojkeysetimpl","ojs/ojmap","ojs/ojcomponentcore","ojs/ojanimation","ojs/ojlogger","ojs/ojdomscroller","promise","ojs/ojdataprovideradapter","ojs/ojkeyset"],function(t,e,i,n,s,l,o,r,a,h,c,d){var u={properties:{as:{type:"string",value:""},currentItem:{type:"any",writeback:!0},data:{type:"oj.TableDataSource|oj.TreeDataSource|oj.DataProvider"},dnd:{type:"object",properties:{drag:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"string|Array<string>"},drag:{type:"function"},dragEnd:{type:"function"},dragStart:{type:"function"}}}}},drop:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"string|Array<string>"},dragEnter:{type:"function"},dragLeave:{type:"function"},dragOver:{type:"function"},drop:{type:"function",properties:{item:{type:"Element"},position:{type:"'before'|'after'|'inside'"},reorder:{type:"boolean"}}}}}}},reorder:{type:"object",properties:{items:{type:"string",enumValues:["disabled","enabled"],value:"disabled"}}}}},drillMode:{type:"string",enumValues:["collapsible","none"],value:"collapsible"},expanded:{type:"KeySet",writeback:!0,value:"new ExpandedKeySet();"},firstSelectedItem:{type:"object",writeback:!0,readOnly:!0,value:{key:null,data:null},properties:{key:{type:"any"},data:{type:"any"}}},groupHeaderPosition:{type:"string",enumValues:["static","sticky"],value:"sticky"},item:{type:"object",properties:{focusable:{type:"boolean|function",value:!0,properties:{datasource:{type:"oj.DataProvider<K, D>"},index:{type:"number"},key:{type:"K"},data:{type:"D"},parentElement:{type:"Element"},depth:{type:"number"},parentKey:{type:"K"},leaf:{type:"boolean"}}},renderer:{type:"function",properties:{datasource:{type:"oj.DataProvider<K, D>"},index:{type:"number"},key:{type:"K"},data:{type:"D"},parentElement:{type:"Element"},depth:{type:"number"},parentKey:{type:"K"},leaf:{type:"boolean"}}},selectable:{type:"boolean|function",value:!0,properties:{datasource:{type:"oj.DataProvider<K, D>"},index:{type:"number"},key:{type:"K"},data:{type:"D"},parentElement:{type:"Element"},depth:{type:"number"},parentKey:{type:"K"},leaf:{type:"boolean"}}}}},scrollPolicy:{type:"string",enumValues:["auto","loadMoreOnScroll"],value:"auto"},scrollPolicyOptions:{type:"Object<string, number>",properties:{fetchSize:{type:"number",value:25},maxCount:{type:"number",value:500},scroller:{type:"Element"}}},scrollPosition:{type:"object",writeback:!0,value:{x:0,y:0},properties:{x:{type:"number"},y:{type:"number"},index:{type:"number"},parent:{type:"any"},key:{type:"any"},offsetX:{type:"number"},offsetY:{type:"number"}}},selection:{type:"Array<any>",writeback:!0,value:[]},selectionMode:{type:"string",enumValues:["multiple","none","single"],value:"none"},selectionRequired:{type:"boolean",value:!1},translations:{type:"object",value:{},properties:{accessibleNavigateSkipItems:{type:"string"},accessibleReorderAfterItem:{type:"string"},accessibleReorderBeforeItem:{type:"string"},accessibleReorderInsideItem:{type:"string"},accessibleReorderTouchInstructionText:{type:"string"},indexerCharacters:{type:"string"},labelCopy:{type:"string"},labelCut:{type:"string"},labelPaste:{type:"string"},labelPasteAfter:{type:"string"},labelPasteBefore:{type:"string"},msgFetchingData:{type:"string"},msgNoData:{type:"string"}}}},methods:{refresh:{},getContextByNode:{},getDataForVisibleItem:{},getIndexerModel:{},scrollToItem:{},setProperty:{},getProperty:{},setProperties:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojAnimateStart:{},ojAnimateEnd:{},ojBeforeCurrentItem:{},ojBeforeExpand:{},ojBeforeCollapse:{},ojCollapse:{},ojCopy:{},ojCut:{},ojExpand:{},ojPaste:{},ojReorder:{}},extension:{}};t.DataSourceContentHandler=function(t,e,i){this.m_root=e,this.m_widget=t,this.m_fetching=!1,this.setDataSource(i),this.Init()},t.Object.createSubclass(t.DataSourceContentHandler,t.Object,"oj.DataSourceContentHandler"),t.DataSourceContentHandler.prototype.Init=function(){t.DataSourceContentHandler.superclass.Init.call(this)},t.DataSourceContentHandler.prototype.notifyShown=function(){},t.DataSourceContentHandler.prototype.notifyAttached=function(){},t.DataSourceContentHandler.prototype.cleanItems=function(t){if(void 0===t&&(t=this.getTemplateEngine()),t&&this.m_root)for(var e=this.m_root.childNodes,i=0;i<e.length;i++)t.clean(e[i])},t.DataSourceContentHandler.prototype.Destroy=function(){null!=this.m_superRoot&&(this.m_root=this.m_superRoot),this.cleanItems(),e(this.m_root).empty(),this.m_widget=null,this.m_root=null,this.m_superRoot=null},t.DataSourceContentHandler.prototype.IsReady=function(){return!this.m_fetching},t.DataSourceContentHandler.prototype.setRootAriaProperties=function(){this.shouldUseGridRole()?this.m_root.setAttribute("role","grid"):this.IsHierarchical()?this.m_root.setAttribute("role","tree"):this.m_root.setAttribute("role","listbox")},t.DataSourceContentHandler.prototype.RenderContent=function(){if(this.signalTaskStart("rendering content"),this.setRootAriaProperties(),this.shouldUseGridRole()&&this.isCardLayout()&&!this.IsHierarchical()){var t=document.createElement("li"),i=document.createElement("ul");t.appendChild(i),e(t).attr("role","presentation").css("width","100%"),e(i).attr("role","row").addClass(this.m_widget.getGroupStyleClass()),this.m_root.appendChild(t),this.m_superRoot=this.m_root,this.m_root=i}this.fetchRows(!1),this.signalTaskEnd()},t.DataSourceContentHandler.prototype.GetKey=function(t){return t.key},t.DataSourceContentHandler.prototype.FindElementByKey=function(i){for(var n=e(this.m_root).find("."+this.m_widget.getItemElementStyleClass()),s=0;s<n.length;s++){var l=n[s];if(i==this.GetKey(l)||t.Object.compareValues(i,this.GetKey(l)))return l}return null},t.DataSourceContentHandler.prototype.getDataSource=function(){return this.m_dataSource},t.DataSourceContentHandler.prototype.setDataSource=function(t){this.m_dataSource=t},t.DataSourceContentHandler.prototype.loadTemplateEngine=function(){var t=this;return null!=this.m_widget.getItemTemplate()&&null==this.m_widget._getItemRenderer()?new Promise(function(e){s.__getTemplateEngine().then(function(i){t.m_engine=i,e(i)},function(t){throw new Error("Error loading template engine: "+t)})}):Promise.resolve(null)},t.DataSourceContentHandler.prototype.getTemplateEngine=function(){return this.m_engine},t.DataSourceContentHandler.prototype.fetchRows=function(t){this.m_widget.showStatusText()},t.DataSourceContentHandler.prototype.addItem=function(t,i,n,s,l,o){var r,a=document.createElement("li");if(e(a).uniqueId(),-1===i)r=null;else{var h=e(t).children("."+this.m_widget.getItemElementStyleClass()+", ."+this.m_widget.getEmptyTextStyleClass()+", .oj-listview-temp-item");r=i===h.length?null:h[i]}this.m_widget.BeforeInsertItem(),t.insertBefore(a,r);var c=e(t).children().index(a);return this._addOrReplaceItem(a,c,t,i,n,s,l,o)},t.DataSourceContentHandler.prototype.replaceItem=function(t,i,n,s,l,o){this.signalTaskStart("replace item");var r=t.parentNode,a=e(r).children().index(t),h=document.createElement("li");l&&l.clean(t),e(t).replaceWith(h),this._addOrReplaceItem(h,a,r,i,n,s,l,o)},t.DataSourceContentHandler.prototype._addOrReplaceItem=function(t,i,n,s,l,o,r,a){null==a&&(a=this.afterRenderItem.bind(this));var h,c=this.createContext(i,l,o,t),d=this.m_widget._getItemRenderer(),u=this.m_widget.getItemTemplate();if(null!=d){var m=d.call(this,c);null!=m&&(null===m.parentNode||m.parentNode instanceof DocumentFragment?t.appendChild(m):null!=m.parentNode||m.toString&&((h=document.createElement("span")).appendChild(document.createTextNode(m.toString())),t.appendChild(h)))}else if(null!=u&&null!=r)for(var p=this.m_widget.getRootElement()[0],g=this.GetBindingContext(c),f=r.execute(p,u,g,this.m_widget.GetOption("as")),_=0;_<f.length;_++){if("LI"===f[_].tagName){n.replaceChild(f[_],t);break}t.appendChild(f[_])}else(h=document.createElement("span")).appendChild(document.createTextNode(null==l?"":l.toString())),t.appendChild(h);var v=n.children?n.children[i]:this._getItemFromDocumentFragment(n,i);return c.parentElement=v,e.data(v,"data",l),a(v,c),{item:v,context:c}},t.DataSourceContentHandler.prototype._getItemFromDocumentFragment=function(t,e){for(var i=0,n=t.childNodes,s=0;s<n.length;s++){var l=n[s];if(!l)break;if(1===l.nodeType){if(i===e)return l;i+=1}}return null},t.DataSourceContentHandler.prototype.GetBindingContext=function(t){var e={};return e.data=t.data,e.index=t.index,e.key=t.key,e.componentElement=t.componentElement,e},t.DataSourceContentHandler.prototype.afterRenderItem=function(t,i){t.key=i.key;var n=e(t);n.uniqueId();var s=this.m_widget.getSingleFocusableElement(n);if(this.shouldUseGridRole())if(null==i.leaf||i.leaf)if(this.isCardLayout())s.attr("role","gridcell");else if(n.attr("role","row"),s!==n)s.attr("role","gridcell");else{var l="<div role='gridcell' class='oj-listview-cell-element'></div>";0===s.children().length?s.get(0).innerHTML=l:s.contents().wrapAll(l)}else n.attr("role","presentation");else s.attr("role",this.IsHierarchical()?"treeitem":"option"),s!==n&&n.attr("role","presentation");s.addClass(this.m_widget.getFocusedElementStyleClass()),this.isFocusable(i)||n.addClass("oj-skipfocus"),n.addClass(this.m_widget.getItemElementStyleClass())},t.DataSourceContentHandler.prototype.createContext=function(t,e,i,n){var s={};s.parentElement=n,s.index=t,s.data=e,s.component=this.m_widget.getWidgetConstructor(),s.datasource=this.getDataSource(),s=this.m_widget._FixRendererContext(s);for(var l=Object.keys(i),o=0;o<l.length;o++){var r=l[o];s[r]=i[r]}return s},t.DataSourceContentHandler.prototype.isFocusable=function(t){return this.m_widget.getItemFocusable(t)},t.DataSourceContentHandler.prototype.isSelectable=function(t){return this.m_widget.getItemSelectable(t)},t.DataSourceContentHandler.prototype.isCardLayout=function(){return this.m_widget.isCardLayout()},t.DataSourceContentHandler.prototype.shouldUseGridRole=function(){return this.m_widget.ShouldUseGridRole()},t.DataSourceContentHandler.prototype.isAsyncRendering=function(){return!1},t.DataSourceContentHandler.prototype.signalTaskStart=function(t){this.m_widget&&this.m_widget.signalTaskStart("DataSource ContentHandler "+t)},t.DataSourceContentHandler.prototype.signalTaskEnd=function(){this.m_widget&&this.m_widget.signalTaskEnd()},t.DataSourceContentHandler.prototype.createKeyMap=function(t){var e=new r;return t?(t.forEach(function(t,i){e.set(i,t)}),e):e},t.DataSourceContentHandler.prototype.createKeySet=function(t){return new d(t)},t.TreeDataSourceContentHandler=function(e,i,n){t.TreeDataSourceContentHandler.superclass.constructor.call(this,e,i,n)},t.Object.createSubclass(t.TreeDataSourceContentHandler,t.DataSourceContentHandler,"oj.TreeDataSourceContentHandler"),t.TreeDataSourceContentHandler.prototype.Init=function(){t.TreeDataSourceContentHandler.superclass.Init.call(this)},t.TreeDataSourceContentHandler.prototype.IsHierarchical=function(){return!0},t.TreeDataSourceContentHandler.prototype.fetchRows=function(e){this.signalTaskStart("fetching rows"),t.TreeDataSourceContentHandler.superclass.fetchRows.call(this,e),this.fetchChildren(0,null,this.m_root,null),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype.fetchChildren=function(t,i,n,s){var l=this;this.signalTaskStart("fetching children from index: "+t);var o=this.loadTemplateEngine();if(null!=i){var r=n.parentNode.firstElementChild.firstElementChild.firstElementChild;if(r){r=e(r);var a=this.m_widget.getCollapseIconStyleClass();if(r.hasClass(a)){var h=this.m_widget.getExpandingIconStyleClass();r.removeClass(a).addClass(h)}}}this.m_fetching=!0;var c={start:t,count:this.m_dataSource.getChildCount(i)};this.signalTaskStart("first fetch"),this.m_dataSource.fetchChildren(i,c,{success:function(t){o.then(function(e){l._handleFetchSuccess(t,i,n,s,e),l.signalTaskEnd()})},error:function(t){l._handleFetchError(t),l.signalTaskEnd()}}),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype._handleFetchSuccess=function(t,i,s,l,o){var r=this;if(null!=this.m_widget){this.signalTaskStart("handling successful fetch");for(var a=t.getStart(),h=t.getCount(),c=document.createDocumentFragment(),d=0;d<h;d++){var u=t.getData(a+d),m=t.getMetadata(a+d);this.addItem(c,-1,u,m,o)}if(s.appendChild(c),this.shouldUseGridRole()&&this.isCardLayout()&&null!=i&&h>1){var p=s.parentNode.firstElementChild.firstElementChild;e(p).attr("aria-colspan",h)}if(this.m_fetching=!1,this.isAsyncRendering())n.getContext(this.m_root).getBusyContext().whenReady().then(function(){g()});else g();this.m_initialized=!0,this.signalTaskEnd()}function g(){r.m_widget&&(null!=l&&l.call(null,s),r.m_widget.renderComplete())}},t.TreeDataSourceContentHandler.prototype.GetBindingContext=function(e){var i=t.TreeDataSourceContentHandler.superclass.GetBindingContext.call(this,e);return i.depth=e.depth,i.leaf=e.leaf,i.parentKey=e.parentKey,i},t.TreeDataSourceContentHandler.prototype.afterRenderItem=function(i,n){this.signalTaskStart("after rendering an item"),t.TreeDataSourceContentHandler.superclass.afterRenderItem.call(this,i,n);var s=this.m_widget.getGroupStyleClass(),l=this.m_widget.getItemStyleClass(),o=this.m_widget.getGroupItemStyleClass(!0),r=this.m_widget.getGroupCollapseStyleClass(),a=this.m_widget.getCollapseIconStyleClass(),h=this.m_widget.getFocusedElementStyleClass();if(i=e(i),!1===n.leaf){i.children().wrapAll("<div></div>"),i.hasClass(h)?i.removeClass(h).children().first().addClass(h).attr("aria-expanded","false"):i.children().first().attr("role","presentation").find("."+h).attr("aria-expanded","false");var c=i.children().first();if(c.uniqueId().addClass(o),this.m_widget.isExpandable()){i.addClass("oj-collapsed");var d=document.createElement("a");e(d).attr("href","#").attr("aria-labelledby",c.get(0).id).addClass("oj-component-icon oj-clickable-icon-nocontext").addClass(a),c.prepend(d)}this.shouldUseGridRole()&&(c.get(0).removeAttribute("aria-expanded"),c.removeClass(h),c.attr("role","row"),c.children().wrapAll("<div role='gridcell' aria-expanded='false' class='oj-listview-cell-element "+h+"'></div>"));var u,m=document.createElement("ul");u=this.shouldUseGridRole()?this.isCardLayout()?"row":"presentation":"group",e(m).addClass(s).addClass(r).attr("role",u),i.append(m)}else!0===n.leaf&&i.addClass(l);this.m_widget._isSelectionEnabled()&&this.isSelectable(n)&&this.m_widget.getFocusItem(i).attr("aria-selected",!1),this.m_widget.itemRenderComplete(i[0],n),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype._handleFetchError=function(t){null!=this.m_widget?(this.signalTaskStart("handling fetch error: "+t),c.error(t),this.m_widget.renderComplete(),this.signalTaskEnd()):c.info("handleFetchError: widget has already been destroyed")},t.TreeDataSourceContentHandler.prototype.Expand=function(t,e){this.signalTaskStart("expanding an item");var i=this.GetKey(t[0]),n=t.children("ul")[0];this.fetchChildren(0,i,n,e),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype.Collapse=function(t){var e=this.getTemplateEngine();e&&e.clean(t.get(0)),t.empty()},t.StaticContentHandler=function(t,e){this.m_widget=t,this.m_root=e},t.Object.createSubclass(t.StaticContentHandler,t.Object,"oj.StaticContentHandler"),t.StaticContentHandler.prototype.Init=function(){t.StaticContentHandler.superclass.Init.call(this)},t.StaticContentHandler.prototype.Destroy=function(){this.m_root.hasAttribute("role")&&(this.restoreContent(this.m_root,0),this.unsetRootAriaProperties(),this.shouldUseGridRole()&&this.isCardLayout()&&!this.IsHierarchical()&&e(this.m_root).children().first().children().unwrap().children().unwrap())},t.StaticContentHandler.prototype.IsReady=function(){return!0},t.StaticContentHandler.prototype.notifyShown=function(){},t.StaticContentHandler.prototype.notifyAttached=function(){},t.StaticContentHandler.prototype.RenderContent=function(){var t=this.m_root;this.shouldUseGridRole()&&this.isCardLayout()&&!this.IsHierarchical()&&e(t).children("li").length>0&&(e(this.m_root).children().wrapAll("<li role='presentation' style='width:100%'><ul role='row' class='"+this.m_widget.getGroupStyleClass()+"'></ul></li>"),t=e(this.m_root).children("li").first().children("ul").first().get(0)),this.modifyContent(t,0),this.setRootAriaProperties(),this.m_widget.renderComplete()},t.StaticContentHandler.prototype.Expand=function(t,i){var n="."+this.m_widget.getGroupStyleClass(),s=e(t).children(n)[0];e(s).css("display",""),i.call(null,s)},t.StaticContentHandler.prototype.Collapse=function(t){},t.StaticContentHandler.prototype.IsHierarchical=function(){return null==this.m_hier&&(this.m_hier=e(this.m_root).children("li").children("ul").length>0),this.m_hier},t.StaticContentHandler.prototype.restoreContent=function(t,i){for(var n=this.m_widget.getGroupStyleClass(),s=this.m_widget.getGroupCollapseStyleClass(),l=this.m_widget.getGroupExpandStyleClass(),o=this.m_widget.getGroupItemStyleClass(!0),r=this.m_widget.getItemStyleClass(),a=this.m_widget.getItemElementStyleClass(),h=t.children,c=0;c<h.length;c++){var d=e(h[c]);if(d.hasClass(a)){this.unsetAriaProperties(d.get(0)),d.removeClass(a).removeClass(r).removeClass(this.m_widget.getDepthStyleClass(i)).removeClass("oj-skipfocus").removeClass("oj-focus").removeClass("oj-hover").removeClass("oj-expanded").removeClass("oj-collapsed").removeClass("oj-selected");var u=d.children("ul");if(u.length>0){d.children("."+o).children().unwrap(),this.shouldUseGridRole()&&this.unsetGroupAriaProperties(d),d.children(".oj-component-icon").remove();var m=e(u[0]);m.removeClass(n).removeClass(l).removeClass(s).removeAttr("role"),this.restoreContent(m[0],i+1)}}}},t.StaticContentHandler.prototype.modifyContent=function(t,i){for(var n=this.m_widget.getItemStyleClass(),s=this.m_widget.getItemElementStyleClass(),l=this.m_widget.getGroupStyleClass(),o=this.m_widget.getGroupItemStyleClass(!0),r=this.m_widget.getGroupCollapseStyleClass(),a=this.m_widget.getCollapseIconStyleClass(),h=this.m_widget.getFocusedElementStyleClass(),c=t.children,d=this.m_widget.isExpandable(),u=0;u<c.length;u++){var m=e(c[u]),p=this.createContext(m);this.setAriaProperties(m,p),m.uniqueId().addClass(s),i>0&&m.addClass(this.m_widget.getDepthStyleClass(i)),this.isFocusable(p)||m.addClass("oj-skipfocus");var g=m.children("ul");if(g.length>0){this.m_hier=!0,m.children(":not(ul)").wrapAll("<div></div>");var f=m.children().first();f.addClass(o);var _=this.getItemsCount(g[0]);if(_>0){if(m.hasClass(h)?(m.removeClass(h),f.addClass(h).attr("aria-expanded","false")):(f.attr("role","presentation"),f.find("."+h).attr("aria-expanded","false")),d){m.addClass("oj-collapsed"),f.uniqueId();var v=document.createElement("a");e(v).attr("href","#").attr("role","button").attr("aria-labelledby",f.get(0).id).addClass("oj-component-icon oj-clickable-icon-nocontext").addClass(a),f.prepend(v)}}else f.addClass("oj-empty");this.shouldUseGridRole()&&this.setGroupAriaProperties(f,_);var y,S=e(g[0]);y=this.shouldUseGridRole()?this.isCardLayout()?"row":"presentation":"group",S.addClass(l).addClass(r).attr("role",y).css("display","none"),this.modifyContent(S[0],i+1)}else m.addClass(n);this.m_widget._isSelectionEnabled()&&this.isSelectable(p)&&this.m_widget.getFocusItem(m).attr("aria-selected",!1),this.m_widget.itemRenderComplete(m[0],p)}},t.StaticContentHandler.prototype.setRootAriaProperties=function(){this.shouldUseGridRole()?this.m_root.setAttribute("role","grid"):this.IsHierarchical()?this.m_root.setAttribute("role","tree"):this.m_root.setAttribute("role","listbox")},t.StaticContentHandler.prototype.unsetRootAriaProperties=function(){this.m_root.removeAttribute("role")},t.StaticContentHandler.prototype.getItemsCount=function(t){return e(t).children("li").length},t.StaticContentHandler.prototype.createContext=function(t){var e={};if(e.key=t.attr("id"),e.parentElement=t.children().first()[0],e.index=t.index(),e.data=t[0],e.component=this.m_widget.getWidgetConstructor(),e=this.m_widget._FixRendererContext(e),this.IsHierarchical()){e.leaf=0===t.children("ul").length;var i=t.parents("li."+this.m_widget.getItemElementStyleClass());e.depth=i.length,0===i.length?e.parentKey=null:e.parentKey=i.first().attr("id")}return e},t.StaticContentHandler.prototype.setAriaProperties=function(t,e){var i=this.m_widget.getSingleFocusableElement(t);this.shouldUseGridRole()?null==e.leaf||e.leaf?this.isCardLayout()?i.attr("role","gridcell"):(t.attr("role","row"),i!==t?i.attr("role","gridcell"):i.children().wrapAll("<div role='gridcell' class='oj-listview-cell-element'></div>")):(t.attr("role","presentation"),i!==t&&i.attr("role","gridcell")):(i.attr("role",this.IsHierarchical()?"treeitem":"option"),i!==t&&t.attr("role","presentation")),i.addClass(this.m_widget.getFocusedElementStyleClass())},t.StaticContentHandler.prototype.setGroupAriaProperties=function(t,e){var i=this.m_widget.getFocusedElementStyleClass();t.get(0).removeAttribute("aria-expanded"),t.removeClass(i),t.attr("role","row"),t.children().wrapAll("<div role='gridcell' aria-expanded='false' class='oj-listview-cell-element "+i+"'></div>"),this.isCardLayout()&&e>1&&t.children().first().attr("aria-colspan",e)},t.StaticContentHandler.prototype.unsetGroupAriaProperties=function(t){t.children("div").first().children().unwrap()},t.StaticContentHandler.prototype.unsetAriaProperties=function(t){this.m_widget.restoreTabIndex(t);var i,n=this.m_widget.getGroupItemStyleClass(!0),s=this.m_widget.getFocusedElementStyleClass(),l=t.firstElementChild;if(l&&e(l).hasClass(n)){if(0===(i=e(l).children("."+s).first()).length)return}else i=this.m_widget.getSingleFocusableElement(e(t));i.removeAttr("role"),i.removeAttr("aria-selected"),i.removeAttr("aria-expanded"),i.removeClass(this.m_widget.getFocusedElementStyleClass()),this.shouldUseGridRole()&&!this.isCardLayout()&&(i!==t?(e(t).removeAttr("role"),i.children().first().children().unwrap()):i.children().first().children().unwrap().children().unwrap())},t.StaticContentHandler.prototype.GetKey=function(t){return e(t).attr("id")},t.StaticContentHandler.prototype.FindElementByKey=function(t){return document.getElementById(t)},t.StaticContentHandler.prototype.isFocusable=function(t){return this.m_widget.getItemFocusable(t)},t.StaticContentHandler.prototype.isSelectable=function(t){return this.m_widget.getItemSelectable(t)},t.StaticContentHandler.prototype.isCardLayout=function(){return this.m_widget.isCardLayout()},t.StaticContentHandler.prototype.shouldUseGridRole=function(){return this.m_widget.ShouldUseGridRole()},t.StaticContentHandler.prototype.createKeyMap=function(t){var e=new r;return t?(t.forEach(function(t,i){e.set(i,t)}),e):e},t.StaticContentHandler.prototype.createKeySet=function(t){return new d(t)},t.KeyMap=function(){},t.KeyMap.prototype.set=function(t,e){void 0===this._mapKeys&&void 0===this._mapValues&&(this._mapKeys=[],this._mapValues=[]);var i=this._mapKeys.indexOf(t);i>-1?this._mapValues.splice(i,1,e):(this._mapKeys.push(t),this._mapValues.push(e))},t.KeyMap.prototype.get=function(t){if(this._mapKeys&&this._mapValues){var e=this._mapKeys.indexOf(t);if(e>-1&&this._mapValues.length>e)return this._mapValues[e]}return null},t.KeyMap.prototype.deleteValue=function(t){for(var e=this._mapValues.indexOf(t);e>-1;)this._mapValues.splice(e,1),this._mapKeys.splice(e,1),e=this._mapValues.indexOf(t,e)},t._ojListViewExpandedKeySet=function(){t._ojListViewExpandedKeySet.superclass.constructor.call(this)},t.Object.createSubclass(t._ojListViewExpandedKeySet,t.ExpandedKeySet,"ListViewExpandedKeySet");var m=function(i,n){var s=function(){};return t.Object.createSubclass(s,i,""),s.prototype=e.extend(s.prototype,n),s};t._ojListView=m(Object,{LEFT_KEY:37,RIGHT_KEY:39,DOWN_KEY:40,UP_KEY:38,TAB_KEY:9,ENTER_KEY:13,ESC_KEY:27,F2_KEY:113,SPACE_KEY:32,STATE_EXPANDED:0,STATE_COLLAPSED:1,STATE_NONE:2,MINIMUM_ITEM_HEIGHT:20,init:function(e){var i=this;this.readinessStack=[],this.element=e.element,this.ojContext=e.ojContext,this.OuterWrapper=e.OuterWrapper,this.options=e,this.element.uniqueId().addClass(this.GetStyleClass()+" oj-component-initnode"),this.OuterWrapper&&this.element[0].setAttribute("data-oj-context",""),this.signalTaskStart("Initializing"),this.SetRootElementTabIndex();var n=this.GetDnDContext();n&&(this.m_dndContext=n,this.ojContext._on(this.element,{dragstart:function(t){return n._handleDragStart(t)},dragenter:function(t){return n._handleDragEnter(t)},dragover:function(t){return n._handleDragOver(t)},dragleave:function(t){return n._handleDragLeave(t)},dragend:function(t){return i.m_preActive=!1,n._handleDragEnd(t)},drag:function(t){return n._handleDrag(t)},drop:function(t){return i.m_preActive=!1,n._handleDrop(t)}})),this.ojContext._on(this.element,{click:function(t){i.HandleMouseClick(t)},touchstart:function(t){i.HandleMouseDownOrTouchStart(t)},touchend:function(t){i.HandleTouchEndOrCancel(t)},touchcancel:function(t){i.HandleTouchEndOrCancel(t)},mousedown:function(t){0===t.button?i._recentTouch()||i.HandleMouseDownOrTouchStart(t):i.m_preActive=!0},mouseup:function(t){i._handleMouseUpOrPanMove(t),i.m_preActive=!1},mouseout:function(t){i._handleMouseOut(t)},mouseover:function(t){i._handleMouseOver(t)},keydown:function(t){i.HandleKeyDown(t)},keyup:function(t){i.HandleKeyUp(t)},ojpanmove:function(t){i._handleMouseUpOrPanMove(t)}}),this.ojContext._on(this.ojContext.element,{focus:function(t){i.HandleFocus(t)},blur:function(t){i.HandleBlur(t)}}),t.AgentUtils.getAgentInfo().browser===t.AgentUtils.BROWSER.FIREFOX&&this._getListContainer().attr("tabIndex",-1),this.ojContext._on(this.ojContext.element,{focusin:function(t){i.HandleFocus(t)},focusout:function(t){i.HandleFocusOut(t)}}),this.ojContext._focusable({applyHighlight:i.ShouldApplyHighlight(),recentPointer:i.RecentPointerCallback(),setupHandlers:function(t,e){i._focusInHandler=t,i._focusOutHandler=e}})},isAvailable:function(){return null!=this.m_contentHandler},setupResources:function(){this.ojContext.document.bind("touchend.ojlistview touchcancel.ojlistview",this.HandleTouchEndOrCancel.bind(this)),this.InitContentHandler(),this._registerResizeListener(this._getListContainer()[0]),this._registerScrollHandler()},releaseResources:function(){this.ojContext.document.off(".ojlistview"),this.DestroyContentHandler(),this._unregisterResizeListener(this._getListContainer()),this._unregisterScrollHandler()},afterCreate:function(){this._buildList(),this.signalTaskEnd()},refresh:function(){this._resetInternal(),this.signalTaskStart("Refresh"),this.SetAriaProperties(),this.InitContentHandler(),this._registerResizeListener(this._getListContainer()[0]),this._registerScrollHandler(),this.signalTaskEnd()},whenReady:function(){return this.readyPromise},destroy:function(){this.element.removeClass(this.GetStyleClass()+" oj-component-initnode"),this._unregisterResizeListener(this._getListContainer()),this._resetInternal(),t.DomUtils.unwrap(this.element,this._getListContainer())},adjustScrollPositionValueOnRefresh:function(){var t=null==this.GetOption("scrollPosition")?{}:this.GetOption("scrollPosition"),e=this.GetOption("selection");this._isSelectionEnabled()&&e.length>0?null!=this.m_selectionFrontier&&this.m_selectionFrontier.length>0?t.key=this.GetKey(this.m_selectionFrontier[0]):t.key=e[0]:(t.y=0,t.key=null,t.index=0),t.x=0,t.offsetX=0,t.offsetY=0,this.SetOption("scrollPosition",t,{_context:{internalSet:!0},changed:!1})},_clearBusyState:function(){if(this.readinessStack&&this.readinessStack.length>0)for(c.warn("ListView did not end with a clean state, this could happen if ListView is detached before fetch is complete.  State: "+this.readinessStack);this.readinessStack.length>0;)this.signalTaskEnd()},_resetInternal:function(){this.UnsetAriaProperties(),this._cleanupTabbableElementProperties(this.element),this.DestroyContentHandler(),this.m_active=null,this.m_isExpandAll=null,this.m_disclosing=null,this.m_itemHeight=null,this.m_keyElemMap=null,this.m_clientHeight=null,this.m_scrollHeight=null,this.ClearCache(),null!=this.m_dndContext&&this.m_dndContext.reset()},notifyAttached:function(){null!=this.m_contentHandler&&(this.syncScrollPosition(),this.m_contentHandler.notifyAttached())},notifyDetached:function(){this._getListContainer().removeClass("oj-focus-ancestor"),null!=this.m_active&&e(this.m_active.elem).removeClass("oj-focus oj-focus-highlight"),null!=this.m_hoverItem&&this._unhighlightElem(this.m_hoverItem,"oj-hover")},notifyShown:function(){null!=this.m_contentHandler&&(this.syncScrollPosition(),this.m_contentHandler.notifyShown())},getNodeBySubId:function(t){var i;if(null==t)return this.element[0];var n=t.subId;if("oj-listview-disclosure"===n||"oj-listview-icon"===n){if(null!=(i=t.key)){var s=this.FindElementByKey(i);if(null!=s){var l=e(s).find(".oj-clickable-icon-nocontext").first();if(this._isExpandCollapseIcon(l))return l.get(0)}}}else if("oj-listview-item"===n&&null!=(i=t.key))return this.FindElementByKey(i);return null},getSubIdByNode:function(t){if(null!=t&&this._isExpandCollapseIcon(t)){var e=this.FindItem(t);if(null!=e&&e.length>0){var i=this.GetKey(e[0]);if(null!=i)return{subId:"oj-listview-disclosure",key:i}}}return null},getContextByNode:function(t){var e=this.FindItem(t);if(null!=e&&e.length>0){var i=this.GetKey(e[0]);if(null!=i){var n=e.parent(),s={subId:"oj-listview-item",key:i,index:n.children("."+this.getItemElementStyleClass()).index(e)};return n.get(0)!==this.element.get(0)&&(s.parent=n.parent().get(0)),e.children().first().hasClass(this.getGroupItemStyleClass())?s.group=!0:s.group=!1,s}}return null},getDataForVisibleItem:function(t){var i,n=t.key;if(null!=n&&(i=this.FindElementByKey(n)),null==i){var s=t.index,l=t.parent;l=null==l?this.element.get(0):e(l).children("ul."+this.getGroupStyleClass()).first(),i=e(l).children("li").get(s)}return null!=i&&e(i).hasClass(this.getItemStyleClass())?this._getDataForItem(i):null},_getDataForItem:function(t){return null==this.GetOption("data")?t:e.data(t,"data")},ShouldRegisterResizeListener:function(t){return t&&this.m_contentHandler&&this.m_contentHandler.HandleResize&&this.m_contentHandler.shouldHandleResize&&this.m_contentHandler.shouldHandleResize()},_unregisterResizeListener:function(e){e&&this._resizeHandler&&t.DomUtils.removeResizeListener(e,this._resizeHandler)},_registerResizeListener:function(e){this._unregisterResizeListener(e),this.ShouldRegisterResizeListener(e)&&(null==this._resizeHandler&&(this._resizeHandler=this.HandleResize.bind(this)),t.DomUtils.addResizeListener(e,this._resizeHandler))},GetDnDContext:function(){if(void 0!==t.ListViewDndContext)return new t.ListViewDndContext(this)},HandleResize:function(t,e){t>0&&e>0&&null!=this.m_contentHandler&&this.m_contentHandler.HandleResize&&this.m_contentHandler.HandleResize(t,e),this.m_clientHeight=null,this.m_scrollHeight=null},ShouldApplyHighlight:function(){return!0},RecentPointerCallback:function(){return function(){return!1}},ShouldRefresh:function(t){return null!=t.data||null!=t.drillMode||null!=t.groupHeaderPosition||null!=t.item||null!=t.scrollPolicy||null!=t.scrollPolicyOptions},_isKeySet:function(t){return t.values&&t.isAddAll},setOptions:function(t,i){var n=this;if(this.ShouldRefresh(t))return!0;if(null!=t.expanded&&this.m_contentHandler.IsHierarchical()){this._collapsedKeys=void 0;var s=t.expanded;if(Array.isArray(s)||s.values){this.signalTaskStart("Set expanded option"),this._collapseAll(),this._ignoreExpanded=!0;try{(this._isKeySet(s)?s.values():s).forEach(function(t){n.expandKey(t,!0,!0,!0)})}finally{this._ignoreExpanded=void 0,this.signalTaskEnd()}}else if("all"===s||s.deletedValues)return!0}if(null!=t.currentItem){var l=this.FindElementByKey(t.currentItem);if(null!=l&&(l=e(l),!this.SkipFocus(l))){var o=document.activeElement;o&&this.element.get(0).contains(o)?this.ActiveAndFocus(l,null):this._setActive(l,null,!0)}}else null===t.currentItem&&(this.UnhighlightActive(),this.m_active=null,this.SetRootElementTabIndex());if(this.HandleSelectionOption(t),null!=t.selectionMode&&("none"!==t.selectionMode?this._clearSelection(!0):(this._clearSelection(!1),this._setSelectionOption([],null,null)),this.SetAriaProperties(),this.UpdateItemAriaProperties(t.selectionMode)),null!=t.scrollTop){var r=this._getScroller(),a=t.scrollTop;null==a||isNaN(a)||(r.scrollTop=a)}return null!=t.scrollPosition&&(this.syncScrollPosition(t.scrollPosition),delete t.scrollPosition),this._shouldDragSelectedItems()&&null!=this.m_active&&null!=t.dnd&&null!=t.dnd.reorder&&("enabled"===t.dnd.reorder.items?this.m_dndContext._setItemDraggable(this.m_active.elem):"disabled"===t.dnd.reorder.items&&this.m_dndContext._unsetItemDraggable(this.m_active.elem)),!1},HandleSelectionOption:function(t){if(null!=t.selection&&this._isSelectionEnabled()){t.selection=this._filterSelection(t.selection);var e=t.selection;this._clearSelection(!1);for(var i=0;i<e.length;i++){var n=this.FindElementByKey(e[i]);null!=n&&this._applySelection(n,e[i])}}},Trigger:function(t,e,i){return this.ojContext._trigger(t,e,i)},SetOption:function(t,e,i){this.ojContext.option(t,e,i)},GetOption:function(t){return this.ojContext.option(t)},_getBusyDescription:function(t){return"The component identified by '"+(this.ojContext._IsCustomElement()?this.getRootElement().attr("id"):this.element.attr("id"))+"', "+t},signalTaskStart:function(t){var e=this;if(this.readinessStack){if(0===this.readinessStack.length){this.readyPromise=new Promise(function(t){e.readyResolve=t});var i=n.getContext(this.element[0]).getBusyContext(),s=null!=t?{description:this._getBusyDescription(t)}:{};e.busyStateResolve=i.addBusyState(s)}this.readinessStack.push(null!=t?t:"unknown task")}},signalTaskEnd:function(){this.readinessStack&&this.readinessStack.length>0&&(this.readinessStack.pop(),0===this.readinessStack.length&&(this.readyResolve(null),this.busyStateResolve(null),this.busyStateResolve=null))},isReady:function(){return null==this.busyStateResolve},throwError:function(t){if(this.readinessStack)for(;this.readinessStack.length>0;)this.signalTaskEnd();throw t},getItems:function(t){var i=this,n=[];return e.each(t,function(t,e){var s=i.FindElementByKey(e);null!=s&&n.push(s)}),n},isCardLayout:function(){return(this.ojContext._IsCustomElement()?this.getRootElement():this.element).hasClass("oj-listview-card-layout")},ShouldUseGridRole:function(){return!0},ShouldUpdateScrollPosition:function(){return this.ShouldUseGridRole()&&this.ojContext._IsCustomElement()},DestroyContentHandler:function(){null!=this.m_contentHandler&&(this.m_contentHandler.Destroy(),delete this.m_contentHandler,this.m_contentHandler=null),this._clearBusyState()},InitContentHandler:function(){this.signalTaskStart("Initialize ContentHandler"),this.showStatusText();var e=this.GetOption("data");null!=e?void 0!==t.TableDataSource&&e instanceof t.TableDataSource?this.m_contentHandler=new t.IteratingDataProviderContentHandler(this,this.element[0],new t.TableDataSourceAdapter(e)):void 0!==t.TreeDataSource&&e instanceof t.TreeDataSource?this.m_contentHandler=new t.TreeDataSourceContentHandler(this,this.element[0],e):t.DataProviderFeatureChecker.isDataProvider(e)?this.m_contentHandler=new t.IteratingDataProviderContentHandler(this,this.element[0],e):this.throwError("Invalid data or missing module"):this.m_contentHandler=new t.StaticContentHandler(this,this.element[0]),this.m_contentHandler.RenderContent(),this.signalTaskEnd()},UpdateActiveDescendant:function(t){this.element.attr("aria-activedescendant",t.attr("id"))},SetAriaProperties:function(){this._isMultipleSelection()?this.element.attr("aria-multiselectable",!0):this._isSelectionEnabled()&&this.element.attr("aria-multiselectable",!1)},UnsetAriaProperties:function(){this.element.removeAttr("aria-activedescendant").removeAttr("aria-multiselectable")},UpdateItemAriaProperties:function(t){var i,n=this;"none"===t?(this.element.removeAttr("aria-multiselectable"),i=function(t){n.getFocusItem(t).removeAttr("aria-selected")}):("single"===t?this.element.attr("aria-multiselectable",!1):this.element.attr("aria-multiselectable",!0),i=function(t){n.getFocusItem(t).attr("aria-selected","false")});for(var s=this._getItemsCache(),l=0;l<s.length;l++)i(e(s[l]))},_buildList:function(t){var e=this._getListContainer();this.SetAriaProperties(),this.m_elementOffset=this.element.get(0).offsetTop;var i=this._buildStatus();e.append(i),this.m_status=i;var n=this._buildAccInfo();e.append(n),this.m_accInfo=n,this._isTouchSupport()&&null!=this.m_dndContext&&e.append(this._buildAccInstructionText())},_buildStatus:function(){var t=e(document.createElement("div"));t.addClass("oj-icon oj-listview-loading-icon");var i=e(document.createElement("div"));return i.addClass("oj-listview-status-message oj-listview-status").attr({id:this._createSubId("status"),role:"status"}),i.append(t),i},_buildAccInfo:function(){var t=e(document.createElement("div"));return t.addClass("oj-helper-hidden-accessible").attr({id:this._createSubId("info"),role:"status"}),t},_buildAccInstructionText:function(){var t=e(document.createElement("div"));return t.addClass("oj-helper-hidden-accessible").attr({id:this._createSubId("instr")}),t.text(this.ojContext.getTranslatedString("accessibleReorderTouchInstructionText")),t},_setAccInfoText:function(t){""!==t&&this.m_accInfo.text()!==t&&this.m_accInfo.text(t)},showStatusText:function(){var t=this;this.m_showStatusTimeout||(this.m_showStatusTimeout=setTimeout(function(){e(document.getElementById(t._createSubId("empty"))).remove();var i=t.ojContext.getTranslatedString("msgFetchingData"),n=t._getListContainer();if(t.m_status.attr("aria-label",i).css("left",Math.max(0,n.outerWidth()/2-t.m_status.outerWidth()/2)).css("top",Math.max(0,n.outerHeight()/2-t.m_status.outerHeight()/2)).show(),void 0===t.m_minHeightSet){var s=t.m_status.get(0).offsetHeight,l=n.get(0).offsetHeight;n.css("minHeight",Math.max(l,s+t._getListContainerBorderWidth())),t.m_minHeightSet=!0}t.m_showStatusTimeout=null},this._getShowStatusDelay()))},_getShowStatusDelay:function(){null==this.defaultOptions&&(this.defaultOptions=l.parseJSONFromFontFamily(this.getOptionDefaultsStyleClass()));var t=parseInt(this.defaultOptions.showIndicatorDelay,10);return isNaN(t)?0:t},hideStatusText:function(){this.m_showStatusTimeout&&(clearTimeout(this.m_showStatusTimeout),this.m_showStatusTimeout=null),this.m_status.hide()},getRootElement:function(){return this._getListContainer()},_getListContainer:function(){return null==this.m_container&&(this.m_container=this._createListContainer()),this.m_container},_createListContainer:function(){var t;return this.OuterWrapper?t=e(this.OuterWrapper):(t=e(document.createElement("div")),this.element.parent()[0].replaceChild(t[0],this.element[0])),t.addClass(this.GetContainerStyleClass()).addClass("oj-component"),t.prepend(this.element),t},_getEmptyText:function(){return this.ojContext.getTranslatedString("msgNoData")},_buildEmptyText:function(){var t=this._getEmptyText(),e=document.createElement("li");return e.id=this._createSubId("empty"),e.className=this.getEmptyTextStyleClass()+" "+this.getEmptyTextMarkerClass(),e.textContent=t,e},GetState:function(t){var e=this.getFocusItem(t).attr("aria-expanded");return"true"===e?this.STATE_EXPANDED:"false"===e?this.STATE_COLLAPSED:this.STATE_NONE},SetState:function(t,e){var i=this.isExpandable();e===this.STATE_EXPANDED?(this.getFocusItem(t).attr("aria-expanded","true"),i&&t.removeClass("oj-collapsed").addClass("oj-expanded")):e===this.STATE_COLLAPSED&&(this.getFocusItem(t).attr("aria-expanded","false"),i&&t.removeClass("oj-expanded").addClass("oj-collapsed"))},_getItemOption:function(t,e,i){var n=this.GetOption("item")[t];return"function"==typeof n&&i?n.call(this,e):n},getItemFocusable:function(t){return this._getItemOption("focusable",t,!0)},getItemSelectable:function(t){return this.getItemFocusable(t)&&this._getItemOption("selectable",t,!0)},_getItemRenderer:function(){var t=this._getItemOption("renderer",null,!1);return"function"!=typeof t?null:this._WrapCustomElementRenderer(t)},getItemTemplate:function(){if(void 0===this.m_template&&(this.m_template=null,this.ojContext._IsCustomElement())){var t=this.GetSlotMap().itemTemplate;t&&t.length>0&&"template"===t[0].tagName.toLowerCase()&&(this.m_template=t[0])}return this.m_template},GetSlotMap:function(){return t.BaseCustomElementBridge.getSlotMap(this.getRootElement()[0])},itemInsertComplete:function(t,e){},BeforeInsertItem:function(){},itemRemoveComplete:function(t){if(null!=this.m_active&&this.m_active.elem&&e(this.m_active.elem).get(0)===t){var i=t.nextElementSibling;null!=i&&e(i).hasClass(this.getItemElementStyleClass())||null!=(i=t.previousElementSibling)&&e(i).hasClass(this.getItemElementStyleClass())||this.SetOption("currentItem",null),null!=i&&e(i).hasClass(this.getItemElementStyleClass())&&this.SetOption("currentItem",this.GetKey(i))}null!=t&&t.id&&null!=this.m_keyElemMap&&this.m_keyElemMap.delete(t.id)},itemRenderComplete:function(t,i){null!=this.m_dndContext&&this.m_dndContext.itemRenderComplete(t);var s=i.key;if(this._isSelectionEnabled()){var l,r=this.GetOption("selection");if(this.IsSelectable(t)){new o(r).has(s)&&(this._applySelection(t,s),this._isMultipleSelection()||r.length>1&&(l=this.FindElementByKey(s),this._setSelectionOption([s],null,l,i.data))),0===r.length&&this._isSelectionRequired()&&(this._applySelection(t,s),this._setSelectionOption([s],null,[t],i.data))}else{var a=this.GetIndexOf(r,s);if(a>-1){var h=r.slice(0);h.splice(a,1),l=new Array(h.length);for(var c=0;c<h.length;c++)l[c]=this.FindElementByKey(h[c]);this._setSelectionOption(h,null,l)}}}var d=this;if(this.m_contentHandler.IsHierarchical()&&null==this._ignoreExpanded&&this.GetState(e(t))===this.STATE_COLLAPSED){var u=this.GetOption("expanded");this._isExpandAll()?(this.ojContext._IsCustomElement()||null==this._collapsedKeys)&&this.ExpandItem(e(t),null,!1,null,!1,!1,!1):!this.ojContext._IsCustomElement()&&Array.isArray(u)?e.each(u,function(i,n){n!==s||null!=d._collapsedKeys&&-1!==d._collapsedKeys.indexOf(n)||d.ExpandItem(e(t),null,!1,null,!1,!1,!1)}):u.has&&u.has(s)&&this.ExpandItem(e(t),null,!1,null,!1,!1,!1)}null!=this.m_active&&s===this.m_active.key&&null!=this.m_active.elem&&t!==this.m_active.elem.get(0)&&(this.m_active.elem=e(t)),t.setAttribute("data-oj-context",""),n.getContext(t).getBusyContext().whenReady().then(function(){t.removeAttribute("data-oj-context"),d._disableAllTabbableElements(t)})},renderComplete:function(){var t,i=this;if(this.hideStatusText(),e(document.getElementById(this._createSubId("empty"))).remove(),this.m_items=null,this.m_groupItems=null,this._isEmptyGrid()&&this.element[0].removeChild(this.element[0].children[0]),0===this.element[0].childElementCount){var n=this._buildEmptyText();return this.element.append(n),void this.Trigger("ready",null,{})}this.ShouldUpdateScrollPosition()&&null==this.m_itemHeight&&(this.m_contentHandler.IsHierarchical()?(t=this.element.children("li."+this.getItemElementStyleClass()).first()).length>0&&(this.m_itemHeight=t.get(0).firstElementChild.offsetHeight):(t=e(this._getRootNodeForItems()).children("li."+this.getItemStyleClass()).first()).length>0&&(this.m_itemHeight=t.get(0).offsetHeight));var s=this.GetOption("currentItem");if(null!=s){var l=this.FindElementByKey(s);null==l?this.SetOption("currentItem",null):null!=this.m_active||this.SkipFocus(e(l))||this.ActiveAndFocus(e(l),null)}if(this._getListContainer().hasClass("oj-focus-ancestor")&&null==this.m_active&&null==s&&!this._isTouchSupport()&&this._initFocus(),this.m_scrollAndFetch=void 0,this.m_ticking&&null==this.m_scrollPosition||this.syncScrollPosition(),null==this.m_keyElemMap&&this._isSelectionEnabled()&&this._isSelectionRequired()){this.signalTaskStart("validating selection entries");var o=this.GetOption("selection").slice(0);if(o.length>0)return void this._validateSelection(o).then(function(t){t||(i._selectFirstSelectableItem(),i.Trigger("ready",null,{})),i.signalTaskEnd()})}this.Trigger("ready",null,{})},_validateSelection:function(t){var e=this._validateKeys(t);return null===e?Promise.resolve(!0):e},_isEmptyGrid:function(){return this.ShouldUseGridRole()&&this.isCardLayout()&&!this.m_contentHandler.IsHierarchical()&&this.element[0].children[0]&&0===this.element[0].children[0].children[0].childElementCount},_setScrollY:function(t,e){this._skipScrollUpdate||this.signalTaskStart("waiting for scroll handler"),this._skipScrollUpdate=!0,t.scrollTop=e,this._handlePinGroupHeader()},_setScrollX:function(e,i){this._skipScrollUpdate||this.signalTaskStart("waiting for scroll handler"),this._skipScrollUpdate=!0,t.DomUtils.setScrollLeft(e,i)},_getScrollX:function(e){return t.DomUtils.getScrollLeft(e)},_validateKeys:function(e){for(var i=this,n=0;n<e.length;n++)if(null!=this.FindElementByKey(e[n]))return Promise.resolve(!0);if(this.m_contentHandler instanceof t.IteratingDataProviderContentHandler){var s=this.m_contentHandler.getDataSource();if(s.containsKeys)return new Promise(function(t){var n=new Set;e.forEach(function(t){n.add(t)}),i.signalTaskStart("Checking for keys"),s.containsKeys({keys:n}).then(function(e){t(e.results.size>0),i.signalTaskEnd()},function(){i.signalTaskEnd(),t(!1)})})}return null},_getScrollHeight:function(){return null==this.m_scrollHeight&&(this.m_scrollHeight=this._getScroller().scrollHeight),this.m_scrollHeight},_getClientHeight:function(){return null==this.m_clientHeight&&(this.m_clientHeight=this._getScroller().clientHeight),this.m_clientHeight},_isScrollable:function(){return Math.abs(this._getScrollHeight()-this._getClientHeight())>=1},syncScrollPosition:function(t,e){var i,n,s,l,o=this;if(this.ShouldUseGridRole()&&(e=void 0===e||e,this._isScrollable())){if(this.ShouldUpdateScrollPosition()){if(null!=this.m_scrollPosition?t=this.m_scrollPosition:void 0===t&&(t=this.GetOption("scrollPosition")),e&&t.key){var r=this._validateKeys([t.key]);if(r)return void r.then(function(e){e||delete t.key,o.syncScrollPosition(t,!1)})}if(n=(i=this._getScrollCoordinates(t)).x,s=i.y,isNaN(n)&&isNaN(s))return void(null!=this.m_scrollPosition&&(this.SetOption("scrollPosition",this._getCurrentScrollPosition(l),{_context:{originalEvent:null,internalSet:!0}}),this.signalTaskEnd(),this.m_scrollPosition=null))}void 0===i&&(s=this.GetOption("scrollTop"));var a=this._getScroller();if(l=a.scrollTop,!isNaN(n)&&isNaN(s)||!isNaN(n)&&s===l&&n!==this._getScrollX(a,n)){this._setScrollX(a,n);var h=this.GetOption("scrollPosition"),c={x:n=this._getScrollX(a),y:h.y,index:h.index,key:h.key,offsetX:n,offsetY:h.offsetY};h.parent&&(c.parent=h.parent),this.SetOption("scrollPosition",c,{_context:{originalEvent:null,internalSet:!0}})}else if(s!==l){if(this._setScrollY(a,s),isNaN(n)||n===this._getScrollX(a,n)||this._setScrollX(a,n),l=a.scrollTop,Math.abs(l-s)>=1&&this.m_contentHandler.hasMoreToFetch&&this.m_contentHandler.hasMoreToFetch())return null==this.m_scrollPosition&&this.signalTaskStart("Scroll position needs to resolve further"),this.m_scrollAndFetch=!0,void(this.m_scrollPosition=t);this.SetOption("scrollPosition",this._getCurrentScrollPosition(l),{_context:{originalEvent:null,internalSet:!0}})}else t&&(null==t.key||isNaN(t.index))&&this.SetOption("scrollPosition",this._getCurrentScrollPosition(l),{_context:{originalEvent:null,internalSet:!0}});null!=this.m_scrollPosition&&(this.signalTaskEnd(),this.m_scrollPosition=null)}},restoreCurrentItem:function(){var t=this.GetOption("currentItem");if(null!=t){var i=this.FindElementByKey(t);null==i||this.SkipFocus(e(i))||this.ActiveAndFocus(e(i),null)}},ClearCache:function(){this.m_items=null,this.m_groupItems=null},StartAnimation:function(t,e,i){return null==i&&(i=this.getAnimationEffect(e)),h.startAnimation(t,e,i,this.ojContext)},notifyContextMenuGesture:function(t,i,n){if(this.IsNodeEditableOrClickable(e(i.target)))return!1;var s=e(i.target).closest("."+this.getItemElementStyleClass());this.PrepareContextMenu(s),s.length>0&&!this.SkipFocus(e(s[0]))&&this.SetCurrentItem(e(s[0]),null);var l=this.element;2===i.button?l=this._findItem(e(i.target)):null!=this.m_active&&(l=this.m_active.elem);var o={launcher:l,initialFocus:"menu"};"keyboard"===n&&(o.position={my:"start top",at:"start bottom",of:this.m_active.elem}),this.ojContext._OpenContextMenu(i,n,o)},PrepareContextMenu:function(t){null!=this.m_dndContext&&this.m_dndContext.prepareContextMenu(this.ojContext._GetContextMenu())},IsElementEditableOrClickable:function(t){return null!=t.prop("nodeName").match(/^INPUT|SELECT|OPTION|BUTTON|^A\b|TEXTAREA/)},IsNodeEditableOrClickable:function(t){for(;null!=t&&t[0]!==this.element[0]&&"LI"!==t.prop("nodeName");)if(3===t[0].nodeType)t=t.parent();else{var e=t.attr("tabIndex"),i=t.attr("data-oj-tabindex");if(null!=e&&e>=0&&!t.hasClass(this.getFocusedElementStyleClass())&&!t.hasClass("oj-listview-cell-element"))return!0;if(this.IsElementEditableOrClickable(t)&&(-1!==e||-1!==i))return!0;t=t.parent()}return!1},_disableAllTabbableElements:function(t,i){var n=e(t);n.hasClass(this.getItemStyleClass())||(n=e(n.get(0).firstElementChild)),n.children().first().hasClass("oj-listview-cell-element")&&(n=e(n.get(0).firstElementChild));n.find("a, input, select, textarea, button, object, .oj-component-initnode, [tabIndex]").each(function(){e(this).removeAttr("data-first").removeAttr("data-last");var t=parseInt(e(this).attr("tabIndex"),10);!(isNaN(t)||t>=0)||void 0!==i&&this===document.activeElement||e(this).attr("tabIndex",-1).attr("data-tabmod",isNaN(t)?-1:t)})},_disableAllTabbableElementsBeforeItem:function(t){for(var e=this._getItemsCache(),i=e.index(t),n=0;n<=i;n++)this._disableAllTabbableElements(e[n],!0)},_disableAllTabbableElementsAfterItem:function(t){var e=this._getItemsCache(),i=e.index(t);if(-1!==i)for(var n=i;n<=e.length-1;n++)this._disableAllTabbableElements(e[n],!0)},restoreTabIndex:function(t){return e(t).find("[data-tabmod]").each(function(){var t=parseInt(e(this).attr("data-tabmod"),10);e(this).removeAttr("data-tabmod"),-1===t?e(this).removeAttr("tabIndex"):e(this).attr("tabIndex",t)})},_enableAllTabbableElements:function(t){var e=this.restoreTabIndex(t);(e=e.filter(":visible")).first().attr("data-first","true"),e.last().attr("data-last","true")},_cleanupTabbableElementProperties:function(t){e(t).find("[data-tabmod]").removeAttr("tabIndex").removeAttr("data-tabmod").removeAttr("data-first").removeAttr("data-last")},SkipFocus:function(t){return t.hasClass("oj-skipfocus")},GetFocusElement:function(){if(this._getListContainer().hasClass("oj-focus-ancestor")){if(this.m_active)return this.getFocusItem(this.m_active.elem)[0];var t=this.element.children("."+this.getEmptyTextStyleClass()).first();if(t.length>0&&0===t.attr("tabIndex"))return t[0]}return this.element[0]},_isFocusBlurTriggeredByDescendent:function(t){return void 0===t.relatedTarget||!(null==t.relatedTarget||!e.contains(this.ojContext.element.get(0),t.relatedTarget))},HandleFocus:function(t){if(this._getListContainer().addClass("oj-focus-ancestor"),null==this.m_active){var i=this._findItem(e(t.target));this.m_preActive||this._isFocusBlurTriggeredByDescendent(t)||null!=i&&!this.SkipFocus(i)||this._initFocus(t)}else this.m_preActive||t.target!==this.ojContext.element[0]||this._isFocusBlurTriggeredByDescendent(t)||(this.HighlightActive(),this._focusItem(this.m_active.elem)),this.RemoveRootElementTabIndex(),this._setTabIndex(this.m_active.elem)},_initFocus:function(t){for(var i=this._getItemsCache(),n=0;n<i.length;n++){var s=e(i[n]);if(!this.SkipFocus(s)){this.SetCurrentItem(s,t);break}}if(0===i.length){var l=this.element.children("."+this.getEmptyTextStyleClass()).first();l.length>0&&(l.attr("tabIndex",0),l.focus(),this.RemoveRootElementTabIndex())}},HandleFocusOut:function(t){this.HandleBlur(t)},_supportRelatedTargetOnBlur:function(){var e=t.AgentUtils.getAgentInfo();return!(e.browser===t.AgentUtils.BROWSER.FIREFOX&&parseInt(e.browserVersion,10)<48)},_isExtraBlurEvent:function(e){var i=t.AgentUtils.getAgentInfo();return null==e.relatedTarget&&i.browser===t.AgentUtils.BROWSER.IE&&e.target===this.ojContext.element.get(0)},HandleBlur:function(t){this._supportRelatedTargetOnBlur()&&!this._isExtraBlurEvent(t)&&(this._isFocusBlurTriggeredByDescendent(t)||this.m_preActive||this._doBlur(),this._isExpandCollapseIcon(t.target)&&this._focusOutHandler(e(t.target)))},_doBlur:function(){if(this._getListContainer().removeClass("oj-focus-ancestor"),this.UnhighlightActive(),null!=this.m_active)this._resetTabIndex(this.m_active.elem),this._removeSkipItemAriaLabel(this.m_active.elem);else{var t=this.element.children("."+this.getEmptyTextStyleClass()).first();t.length>0&&t.removeAttr("tabIndex")}this.SetRootElementTabIndex()},_handleMouseOut:function(t){var e=this.FindItem(t.target);null!=e&&(this.m_hoverItem=null,this._unhighlightElem(e,"oj-hover"))},_handleMouseOver:function(t){if(!this._recentTouch()){var e=this.FindItem(t.target);null==e||this.SkipFocus(e)||(this.m_hoverItem=e,this._highlightElem(e,"oj-hover"))}},_recentTouch:function(){return Date.now()-this._lastTouch<500},HandleKeyDown:function(t){if(this.isExpandable()){var e=t.keyCode;if(e===this.LEFT_KEY||e===this.RIGHT_KEY){var i=this.m_active.elem;if(e===this.LEFT_KEY){if(this.GetState(i)===this.STATE_EXPANDED)return void this.CollapseItem(i,t,!0,this.m_active.key,!0,!0)}else if(this.GetState(i)===this.STATE_COLLAPSED)return void this.ExpandItem(i,t,!0,this.m_active.key,!0,!0,!0)}}var n=this.HandleSelectionOrActiveKeyDown(t);null!=this.m_dndContext&&(n=n||this.m_dndContext.HandleKeyDown(t)),!0===n&&t.preventDefault(),this.m_keyProcessed=n},HandleKeyUp:function(t){t.keyCode===this.ESC_KEY&&this.m_keyProcessed&&t.stopPropagation(),this.m_keyProcessed=void 0},_handleMouseUpOrPanMove:function(t){this.m_preActiveItem&&this._unhighlightElem(this.m_preActiveItem,"oj-focus"),null!=this.m_dndContext&&this.m_dndContext._unsetDraggable(e(t.target))},_isNodeFocusable:function(t){return null!==t&&(!!t.hasAttribute("data-tabmod")||!e(t).hasClass(this.getItemElementStyleClass())&&this._isNodeFocusable(t.parentNode))},HandleMouseDownOrTouchStart:function(t){var i=e(t.target);null!=this.m_dndContext&&this.m_dndContext._setDraggable(i);var n=this._findItem(i,!0);null!=n&&this._isClickthroughDisabled(n)&&(this.m_preActive=!0,n=null),null==n||0===n.length||this.SkipFocus(n)||i.hasClass("oj-listview-drag-handle")||(this.m_preActive=!0,this._getListContainer().hasClass("oj-focus-ancestor")||this._getListContainer().addClass("oj-focus-ancestor"),this.m_preActiveItem=n,this._highlightElem(n,"oj-focus"),this._makeFocusable(n),n.get(0).contains(document.activeElement)||this._isNodeFocusable(i[0])||this._focusItem(n),this.RemoveRootElementTabIndex(),null!=this.m_active&&this.m_active.elem.get(0)!==n.get(0)&&this._resetTabIndex(this.m_active.elem),t.originalEvent.touches&&t.originalEvent.touches.length>0&&(this.m_touchPos={x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}))},HandleTouchEndOrCancel:function(t){if(null!=this.m_preActiveItem&&(this._unhighlightElem(this.m_preActiveItem,"oj-focus"),null!=this.m_touchPos)){var e=this.m_preActiveItem.offset(),i=this.getAnimationEffect("pointerUp");i.offsetX=this.m_touchPos.x-e.left+"px",i.offsetY=this.m_touchPos.y-e.top+"px";var n,s=this.m_preActiveItem.children("."+this.getGroupItemStyleClass());n=s.length>0?s.get(0):this.getFocusItem(this.m_preActiveItem).get(0),this.StartAnimation(n,"pointerUp",i),this.m_touchPos=null}this._lastTouch=Date.now(),this._handleMouseOut(t)},_enterActionableMode:function(){var t=this.m_active.elem;this._disableAllTabbableElements(t),this._enableAllTabbableElements(t),t.find("[data-first]").length>0&&this._setActionableMode(!0)},_exitActionableMode:function(){this._setActionableMode(!1),this._disableAllTabbableElements(this.m_active.elem)},HandleMouseClick:function(t){if(0===t.button){var i=this.getCollapseIconStyleClass(),n=this.getExpandIconStyleClass(),s=this.getGroupItemStyleClass(),l=e(t.target);if(l.hasClass(n))this._collapse(t),t.preventDefault();else if(l.hasClass(i))this._expand(t),t.preventDefault();else{var o=this._findItem(l);if(null==o||0===o.length||this.SkipFocus(o))return;if(this._isActionableMode()&&null!=this.m_active&&this.m_active.elem.get(0)!==o.get(0)&&this._exitActionableMode(),this._getListContainer().hasClass("oj-focus-ancestor")||this._getListContainer().addClass("oj-focus-ancestor"),this._isSelectionEnabled()&&this.IsSelectable(o[0])?(this._isTouchSupport()?this._handleTouchSelection(o,t):this.HandleClickSelection(o,t),this.ShouldUseGridRole()&&t.target===o.get(0)&&this._focusItem(o),this._shouldDragSelectedItems()&&this.m_dndContext.setSelectionDraggable()):this.HandleClickActive(o,t),this._isInputElement(l.get(0)))return void this._enterActionableMode();this.isExpandable()&&l.closest("."+s)&&(this.GetState(o)===this.STATE_COLLAPSED?this._expand(t):this.GetState(o)===this.STATE_EXPANDED&&this._collapse(t))}}},_shouldDragSelectedItems:function(){return null!=this.m_dndContext&&!this.m_dndContext.shouldDragCurrentItem()},_isTouchSupport:function(){return t.DomUtils.isTouchSupported()},_isNonWindowTouch:function(){return this._isTouchSupport()&&t.AgentUtils.getAgentInfo().os!==t.AgentUtils.OS.WINDOWS},_ctrlEquivalent:function(e){return t.DomUtils.isMetaKeyPressed(e)},_createSubId:function(t){return[this.element.attr("id"),t].join(":")},FindItem:function(t){return e(t).hasClass(this.getGroupStyleClass())?null:e(t).closest("."+this.getItemElementStyleClass())},_isClickthroughDisabled:function(t){return t.hasClass("oj-clickthrough-disabled")},_findItem:function(t,e){if(t.hasClass(this.getGroupStyleClass()))return null;for(var i=t;i.length>0;){if(this._isClickthroughDisabled(i))return e?i:null;if(i.hasClass(this.getItemElementStyleClass()))return i;i=i.parent()}return null},_getListContainerBorderWidth:function(){return null==this.m_borderWidth&&(this.m_borderWidth=parseInt(this._getListContainer().css("border-top-width"),10)+parseInt(this._getListContainer().css("border-bottom-width"),10)),this.m_borderWidth},scrollToItem:function(t){var i=t.key;if(null!=i){var n=this.FindElementByKey(i);if(null!=n)if(e(n).hasClass(this.getItemStyleClass()))this._scrollToVisible(n);else{var s=e(n).children("."+this.getGroupItemStyleClass()).first();this._scrollToGroupHeader(s.get(0))}}},_scrollToVisible:function(t){var i=0,n=t.offsetTop,s=t.offsetHeight,l=this._getListContainer()[0],o=l.scrollTop,r=l.offsetHeight;if(null!=this.m_groupItemToPin){var a=parseInt(this.m_groupItemToPin.style.top,10),h=e(this.m_groupItemToPin).outerHeight();n<=a&&a<n+s?i=(s+n-a)/2:n>=a&&n<a+h&&(i=(a+h-n)/2)}if(n>=o&&n+s<=o+r)i>0&&(l.scrollTop=o-i);else{var c=Math.max(0,Math.min(n-i,Math.abs(n+s-r)));c>o&&(c+=this._getListContainerBorderWidth()),l.scrollTop=c}},GetKey:function(t){return this.m_contentHandler.GetKey(t)},FindElementByKey:function(t){if(null!=this.m_keyElemMap){var e=this.m_keyElemMap.get(t);if(null!=e)return document.getElementById(e)}return this.m_contentHandler.FindElementByKey(t)},GetIndexOf:function(e,i){for(var n=0;n<e.length;n++)if(i===e[n]||t.Object.compareValues(i,e[n]))return n;return-1},_isExpandCollapseIcon:function(t){return e(t).hasClass(this.getExpandIconStyleClass())||e(t).hasClass(this.getCollapseIconStyleClass())},IsArrowKey:function(t){return this.isCardLayout()?t===this.UP_KEY||t===this.DOWN_KEY||t===this.LEFT_KEY||t===this.RIGHT_KEY:t===this.UP_KEY||t===this.DOWN_KEY},_getItemsCache:function(){if(null==this.m_items){var t=this.getGroupCollapseStyleClass(),i="."+this.getItemElementStyleClass()+":visible";this.m_items=this.element.find(i).filter(function(){return!e(this).parent().hasClass(t)||!e(this).parent().parent().hasClass("oj-collapsed")})}return this.m_items},_handleLastItemKeyboardFocus:function(t){var i=t.get(0).nextElementSibling;if(null==i||!e(i).hasClass(this.getItemElementStyleClass())){if(this.m_contentHandler.IsHierarchical()&&t.parent().hasClass(this.getGroupStyleClass())&&null!=t.parent().parent().get(0).nextElementSibling)return;var n=this._getScroller(),s=this._getScrollHeight();n.scrollTop<s&&(n.scrollTop=s)}},HandleArrowKeys:function(t,i,n){if(!this.m_contentHandler.IsReady())return!0;var s;s=!i||this.m_isNavigate?this.m_active.elem:this.m_selectionFrontier;var l=!1;switch(t){case this.UP_KEY:this.isCardLayout()&&e(s).hasClass(this.getItemStyleClass())?this._gotoItemAbove(s,i,n):this._gotoPrevItem(s,i,n),l=!0;break;case this.DOWN_KEY:this.isCardLayout()&&e(s).hasClass(this.getItemStyleClass())?this._gotoItemBelow(s,i,n):this._gotoNextItem(s,i,n),l=!0;break;case this.LEFT_KEY:case this.RIGHT_KEY:this.isCardLayout()&&("rtl"===this.ojContext._GetReadingDirection()&&(t=t===this.LEFT_KEY?this.RIGHT_KEY:this.LEFT_KEY),t===this.LEFT_KEY?this._gotoPrevItem(s,i,n):this._gotoNextItem(s,i,n),l=!0)}return l},_gotoNextItem:function(t,i,n){var s=this._getItemsCache(),l=s.index(t)+1;if(l<s.length){for(var o=e(s[l]);this.SkipFocus(o);){if((l+=1)===s.length)return;o=e(s[l])}i?(this._extendSelection(o,n),this.m_isNavigate=!1):(this.SetCurrentItem(o,n),this.m_isNavigate=!0),this._handleLastItemKeyboardFocus(o)}},_gotoPrevItem:function(t,i,n){var s=this._getItemsCache(),l=s.index(t)-1;if(l>=0){for(var o=e(s[l]);this.SkipFocus(o);){if((l-=1)<0)return;o=e(s[l])}i?(this._extendSelection(o,n),this.m_isNavigate=!1):(this.SetCurrentItem(o,n),this.m_isNavigate=!0)}},_getColumnCount:function(t){var e,i;return t.each(function(t){var n=this.offsetTop;if(void 0===i)i=n;else if(i!==n)return!1;e=t}),e+1},_updateSkipItemAriaLabel:function(t,i){var n=this._createSubId("extra_info");if(null==this.m_skipAriaLabelText){var s=e(document.createElement("div"));s.addClass("oj-helper-hidden-accessible").attr("id",n),this._getListContainer().append(s),this.m_skipAriaLabelText=s}this.m_skipAriaLabelText.text(this.ojContext.getTranslatedString("accessibleNavigateSkipItems",{numSkip:i}));var l=this.getFocusItem(t);l.uniqueId().attr("aria-labelledby",n+" "+l.prop("id"))},_removeSkipItemAriaLabel:function(t){var e=this.getFocusItem(t);e.length>0&&e.get(0).removeAttribute("aria-labelledby")},_gotoItemAbove:function(t,i,n){var s,l;if(t.hasClass(this.getItemElementStyleClass())){var o=t.parent(),r=o.children("li."+this.getItemElementStyleClass()),a=this._getColumnCount(r),h=r.index(t),c=h-a;if(c<0?o.hasClass(this.getGroupStyleClass())&&o.parent().hasClass(this.getItemElementStyleClass())&&(s=o.parent(),l=h):(s=e(r.get(c)),l=a-1),s&&s.length>0){if(this.SkipFocus(s))return;i?(this._extendSelection(s,n),this.m_isNavigate=!1):(null!=l&&l>0&&this._updateSkipItemAriaLabel(s,l),this.SetCurrentItem(s,n),this.m_isNavigate=!0)}}else this._gotoPrevItem(t)},_gotoItemBelow:function(t,i,n){var s,l;if(t.hasClass(this.getItemElementStyleClass())){var o=t.parent(),r=o.children("li."+this.getItemElementStyleClass()),a=this._getColumnCount(r),h=r.index(t),c=h+a;if(c>=r.length){var d=Math.ceil(r.length/a);l=r.length-1-h,h<Math.max(0,(d-1)*a)?(s=r.last(),l-=1):o.hasClass(this.getGroupStyleClass())&&(s=o.parent().next("li."+this.getItemElementStyleClass()))}else s=e(r.get(c)),l=a-1;if(s.length>0){if(this.SkipFocus(s))return;i?(this._extendSelection(s,n),this.m_isNavigate=!1):(null!=l&&l>0&&this._updateSkipItemAriaLabel(s,l),this.SetCurrentItem(s,n),this.m_isNavigate=!0),this._handleLastItemKeyboardFocus(s)}}else this._gotoNextItem(t)},_isActionableMode:function(){return"actionable"===this.m_keyMode},_setActionableMode:function(t){this.m_keyMode=t?"actionable":"navigation",t||this.element[0].focus()},getFocusItem:function(t){if(!t.hasClass(this.getFocusedElementStyleClass()))return e(t.find("."+this.getFocusedElementStyleClass()).first());if(this.ShouldUseGridRole()&&"row"===t.attr("role")){var i=t.children(".oj-listview-cell-element").first();return 0===i.length?t.children().first():i}return t},SetRootElementTabIndex:function(){this.element.attr("tabIndex",0)},RemoveRootElementTabIndex:function(){this.element.removeAttr("tabIndex")},_setTabIndex:function(t){this.getFocusItem(t).attr("tabIndex",0)},_resetTabIndex:function(t){var e=!0;"presentation"===t.attr("role")&&(e=!1);var i=this.getFocusItem(t);e?i.removeAttr("tabIndex"):i.attr("tabIndex",-1)},_makeFocusable:function(t){this._setTabIndex(t)},getSingleFocusableElement:function(t){var e="a, input, select, textarea, button",i=t.children(e);return 1===i.length&&0===i.first().find(e).length?i.first():t},_setCurrentItemOption:function(t,i,n){var s={item:this.ojContext._IsCustomElement()?n:e(n)};this.SetOption("currentItem",t,{_context:{originalEvent:i,internalSet:!0,extraData:s},changed:!0})},_setActive:function(t,e,i){var n;if(null!=t){var s=t[0],l=this.GetKey(s);if(null==this.m_active||l!==this.m_active.key){var o={key:l,item:t};return null!=this.m_active&&(o.previousKey=this.m_active.key,o.previousItem=this.m_active.elem,this._shouldDragSelectedItems()&&this._isTouchSupport()&&this.m_dndContext._unsetDraggable(o.previousItem),this._removeSkipItemAriaLabel(o.previousItem)),!!this.Trigger("beforeCurrentItem",e,o)&&(n={key:l,elem:t},this.m_active=n,this._shouldDragSelectedItems()&&this._isTouchSupport()&&this.m_dndContext._setDraggable(t),void 0!==i&&i||(this._makeFocusable(t),this.HighlightActive(),(null==e||e.originalEvent&&"click"!==e.originalEvent.type)&&this._focusItem(t),this.RemoveRootElementTabIndex(),o.previousItem&&this._resetTabIndex(o.previousItem)),!0)}l===this.m_active.key&&(n={key:l,elem:t},this.m_active=n,void 0!==i&&i||(this._makeFocusable(t),this.RemoveRootElementTabIndex()))}else this.m_active=null;return!1},_focusItem:function(t){this.getFocusItem(t).focus()},HighlightActive:function(){if(null!=this.m_active&&this._getListContainer().hasClass("oj-focus-ancestor")){var t=this.m_active.elem;this._highlightElem(t,"oj-focus")}},UnhighlightActive:function(){null!=this.m_active&&this._unhighlightElem(this.m_active.elem,"oj-focus")},HandleClickActive:function(t,i){var n=null!=this.m_active?this.m_active.elem.get(0):null;null==n||e(n).hasClass(this.getItemStyleClass())||(n=n.firstElementChild),null!=i&&null!=n&&n!==i.target&&n.contains(i.target)||this.SetCurrentItem(t,i,!this.ShouldUseGridRole()||i.target!==t.get(0))},SetCurrentItem:function(t,e,i){this.ActiveAndFocus(t,e,i)&&this._setCurrentItemOption(this.GetKey(t[0]),e,t.get(0))},ActiveAndFocus:function(t,e,i){this._scrollToVisible(t[0]),this.UnhighlightActive();var n=this._setActive(t,e,i);return this.HighlightActive(),n},enforceSelectionRequired:function(){if(this._isSelectionEnabled()&&this._isSelectionRequired()){var t=this.GetOption("selection");null!=t&&0!==t.length||this._selectFirstSelectableItem()}},_getFirstSelectableItem:function(){var t=this.element[0].querySelector(".oj-listview-cell-element[aria-selected]");return null==t?null:t.parentNode},_selectFirstSelectableItem:function(){var t=this._getFirstSelectableItem();if(t){var e=this.m_contentHandler.GetKey(t);null!=e&&(this._applySelection(t,e),this._setSelectionOption([e],null,[t]))}},_isSelectionEnabled:function(){return"none"!==this.GetOption("selectionMode")},_isSelectionRequired:function(){return this.GetOption("selectionRequired")},_isMultipleSelection:function(){return"multiple"===this.GetOption("selectionMode")},IsSelectable:function(t){return this.getFocusItem(e(t)).get(0).hasAttribute("aria-selected")},_filterSelection:function(t){for(var e=[],i=0;i<t.length;i++){var n=this.FindElementByKey(t[i]);if((null==n||null!=n&&this.IsSelectable(n))&&(e.push(t[i]),!this._isMultipleSelection()))break}return e},_setSelectionOption:function(i,n,s,l){var o={key:null,data:null},r=this.GetOption("firstSelectedItem");null!=r&&((null==i||0===i.length)&&null!=r.key||i[0]!==r.key&&!t.Object.compareValues(i[0],r.key))&&(null!=i&&i.length>0&&(o={key:i[0],data:null!=l?l:this.getDataForVisibleItem({key:i[0]})}),this.SetOption("firstSelectedItem",o,{_context:{originalEvent:n,internalSet:!0},changed:!0}));var a={items:this.ojContext._IsCustomElement()?s:e(null==s?{}:s)};this.SetOption("selection",i,{_context:{originalEvent:n,internalSet:!0,extraData:a},changed:!0})},_unhighlightSelection:function(){if(null!=this.m_keyElemMap){var t=this;e.each(this.GetOption("selection"),function(e,i){var n=t.FindElementByKey(i);null!=n&&t._unhighlightElem(n,"oj-selected")})}},_highlightElem:function(t,e){this.HighlightUnhighlightElem(t,e,!0)},_unhighlightElem:function(t,e){this.HighlightUnhighlightElem(t,e,!1)},HighlightUnhighlightElem:function(t,i,n){var s=e(t);"oj-selected"===i&&this.getFocusItem(s).attr("aria-selected",n?"true":"false");var l=s.children("."+this.getGroupItemStyleClass());l.length>0&&(s=e(l[0])),"oj-focus"===i?n?"actionable"!==this.m_keyMode&&this._focusInHandler(s):this._focusOutHandler(s):n?s.addClass(i):s.removeClass(i)},HandleClickSelection:function(t,e){this._scrollToVisible(t[0]);var i=this._ctrlEquivalent(e),n=e.shiftKey;this._isMultipleSelection()&&(i||n)?!i&&n?this._extendSelection(t,e):this._augmentSelectionAndFocus(t,e):this.SelectAndFocus(t,e)},_handleTouchSelection:function(t,e){this._isMultipleSelection()?e.shiftKey?this._extendSelection(t,e):this._augmentSelectionAndFocus(t,e):this.SelectAndFocus(t,e)},_clearSelection:function(t,e){this._unhighlightSelection(),t&&(this._isSelectionRequired()?this._selectFirstSelectableItem():this._setSelectionOption([],null,null)),this.m_selectionFrontier=void 0===e?null:e},SelectAndFocus:function(t,e){var i=this.GetKey(t[0]),n=this.GetOption("selection"),s=this.GetIndexOf(n,i);s>-1&&1===n.length&&this._isSelectionRequired()||(this._clearSelection(s>-1),-1===s&&this._augmentSelectionAndFocus(t,e,[]))},_extendSelection:function(t,e){null!=this.m_active&&(this.m_selectionFrontier!==t&&(this._unhighlightElem(t,"oj-focus"),this._extendSelectionRange(this.m_active.elem,t,e)))},_extendSelectionRange:function(t,e,i,n){!0===n?this._clearSelection(!1,this.m_selectionFrontier):this._clearSelection(!1,e),this._highlightRange(t,e,i),this.HighlightActive(),this._scrollToVisible(e[0])},_highlightRange:function(t,e,i){var n,s,l=[],o=[],r=this._getItemsCache(),a=r.index(t),h=r.index(e);a>h?(n=h,s=a):(n=a,s=h);for(var c=n;c<=s;c++){var d=r[c];if(this.IsSelectable(d)){var u=this.m_contentHandler.GetKey(d);this._applySelection(d,u),l.push(u),o.push(d)}}this._setSelectionOption(l,i,o)},_applySelection:function(t,i){null==this.m_keyElemMap&&(this.m_keyElemMap=this.m_contentHandler.createKeyMap()),this.m_keyElemMap.set(i,e(t).attr("id")),this._highlightElem(t,"oj-selected")},_augmentSelectionAndFocus:function(t,i,n){var s=t,l=this.GetKey(t[0]);null==n&&(n=this.GetOption("selection").slice(0));var o=null!=this.m_active?this.m_active.elem.get(0):null;(null==o||e(o).hasClass(this.getItemStyleClass())||(o=o.firstElementChild),null==i||null!=o&&o!==i.target&&o.contains(i.target))||(this.UnhighlightActive(),this._setActive(s,i)&&this._setCurrentItemOption(l,i,s.get(0)),this.HighlightActive());if(null!=(o=null!=this.m_active?this.m_active.elem.get(0):null)&&o===s.get(0)){var r=this.GetIndexOf(n,l);if(r>-1){if(1===n.length&&this._isSelectionRequired())return;this._unhighlightElem(t,"oj-selected"),n.splice(r,1)}else this.m_selectionFrontier=t,this._applySelection(t,l),n.push(l);for(var a=new Array(n.length),h=0;h<n.length;h++)a[h]=this.FindElementByKey(n[h]);this._setSelectionOption(n,i,a)}else null!=n&&0===n.length&&this._setSelectionOption(n,i,[])},ToggleSelection:function(t,e,i){var n=this.GetOption("selection").slice(0),s=this.m_active.elem,l=this.m_active.key,o=this.GetIndexOf(n,l);if(o>-1){if(i||1===n.length&&this._isSelectionRequired())return;this._unhighlightElem(s,"oj-selected"),n.splice(o,1),0===n.length&&(this.m_selectionFrontier=null)}else this.IsSelectable(s[0])&&(e||(this._clearSelection(!1),n.length=0),this.m_selectionFrontier=s,this._applySelection(s,l),n.push(l));for(var r=new Array(n.length),a=0;a<n.length;a++)r[a]=this.FindElementByKey(n[a]);this._setSelectionOption(n,t,r)},_isInputElement:function(t){return null!=t.nodeName.match(/^INPUT|SELECT|OPTION|TEXTAREA/)&&!t.readOnly},HandleSelectionOrActiveKeyDown:function(t){var e,i,n,s=!1;if(null==this.m_active||t.isDefaultPrevented())return!1;var l=t.keyCode,o=this.m_active.elem;if(this._isActionableMode()){if(l===this.ESC_KEY)this._exitActionableMode(),this.HighlightActive(),this._focusItem(o),this._setTabIndex(o),s=!0;else if(l===this.TAB_KEY){n=o.find("[data-first]");var r=o.find("[data-last]");t.shiftKey?n.length>0&&r.length>0&&n!==r&&t.target===n[0]&&(r[0].focus(),s=!0):n.length>0&&r.length>0&&n!==r&&t.target===r[0]&&(n[0].focus(),s=!0)}}else l===this.F2_KEY?(this._enterActionableMode(),(n=o.find("[data-first]")).length>0&&(n[0].focus(),this._isExpandCollapseIcon(n)&&this._focusInHandler(n),o.hasClass(this.getItemStyleClass())||(o=o.children("."+this.getGroupItemStyleClass()).first()),o.removeClass("oj-focus-highlight"))):l===this.SPACE_KEY&&this._isSelectionEnabled()?(e=this._ctrlEquivalent(t),(i=t.shiftKey)&&!e&&null!=this.m_selectionFrontier&&this._isMultipleSelection()?this._extendSelectionRange(this.m_selectionFrontier,this.m_active.elem,t,!0):this.ToggleSelection(t,e&&!i&&this._isMultipleSelection(),!1),s=!0):l===this.ENTER_KEY&&this._isSelectionEnabled()?this.ToggleSelection(t,!1,!0):this.IsArrowKey(l)?(e=this._ctrlEquivalent(t),i=t.shiftKey,e||(s=this.HandleArrowKeys(l,i&&this._isSelectionEnabled()&&this._isMultipleSelection(),t))):l===this.TAB_KEY&&(t.shiftKey?this._disableAllTabbableElementsBeforeItem(o):this._disableAllTabbableElementsAfterItem(o));return s},_isDisclosing:function(t){return!(!t||!this.m_disclosing)&&this.m_disclosing.indexOf(t)>-1},_setDisclosing:function(t,e){if(null!=t)if(null==this.m_disclosing&&(this.m_disclosing=[]),e)this.m_disclosing.push(t);else for(var i=this.m_disclosing.indexOf(t);i>-1;)this.m_disclosing.splice(i,1),i=this.m_disclosing.indexOf(t)},getAnimationEffect:function(t){null==this.defaultOptions&&(this.defaultOptions=l.parseJSONFromFontFamily(this.getOptionDefaultsStyleClass()));var e=this.defaultOptions.animation;return null==e?null:e[t]},isExpandable:function(){return"none"!==this.GetOption("drillMode")},_isExpandAll:function(){var e=this.GetOption("expanded");if("auto"===e){if(!this.isExpandable())return!0}else if("all"===e)return!0;return!!e.isAddAll&&(!this.isExpandable()&&e instanceof t._ojListViewExpandedKeySet||e.isAddAll())},expandKey:function(t,i,n,s,l){var o=this.FindElementByKey(t);null!=o&&this.ExpandItem(e(o),null,l,t,i,s,n)},_expand:function(t){var e=this.FindItem(t.target);null!=e&&e.length>0&&this.ExpandItem(e,t,!0,null,!0,!0,!0)},ExpandItem:function(t,e,i,n,s,l,o){if(this.GetState(t)===this.STATE_COLLAPSED&&(null==n&&(n=this.GetKey(t[0])),!i||!this._isDisclosing(n))){var r={item:t,key:n};if(o)if(!this.Trigger("beforeExpand",e,r)&&s)return;if(this.signalTaskStart("Expand item: "+n),i&&this._setDisclosing(n,!0),this.m_contentHandler.Expand(t,function(t){this._expandSuccess(t,i,e,r,l)}.bind(this)),this.m_items=null,null!=e&&e.stopPropagation(),!this.ojContext._IsCustomElement()&&null!=this._collapsedKeys){var a=this._collapsedKeys.indexOf(n);-1!==a&&this._collapsedKeys.splice(a,1)}this.signalTaskEnd()}},_expandSuccess:function(t,i,n,s,l){var o=this;this.signalTaskStart("Handle results from successful expand"),t.key=s.key;var r=this.AnimateExpand(e(t),i,n),a=t.parentNode;a=e(a),this.SetState(a,this.STATE_EXPANDED);var h=this.getCollapseIconStyleClass(),c=this.getExpandIconStyleClass(),d=this.getExpandingIconStyleClass(),u=this.getGroupItemStyleClass();a.children("."+u).find("."+h+", ."+d).removeClass(h).removeClass(d).addClass(c),l&&r.then(function(){if(o.ojContext._IsCustomElement()){var e=o.GetOption("expanded");if(o._isKeySet(e)&&!e.has(t.key)){var i=e.add([t.key]);o.SetOption("expanded",i,{_context:{originalEvent:n,internalSet:!0},changed:!0})}}o.Trigger("expand",n,s)}),r.then(function(){o.signalTaskEnd()})},_adjustAncestorsMaxHeight:function(t,i){t.parentsUntil("ul.oj-component-initnode","ul."+this.getGroupStyleClass()).each(function(){var t=parseInt(e(this).css("maxHeight"),10);t>0&&e(this).css("maxHeight",t+i+"px")})},AnimateExpand:function(t,i,n){var s,l=0,o=this,r=new Promise(function(t){s=t});if(i){this.signalTaskStart("Animate expand of group item"),t.css("maxHeight","100%"),t.children().each(function(){l+=e(this).outerHeight(!0)}),this._isTouchSupport()&&this._adjustAncestorsMaxHeight(t,l),t.css("maxHeight",l+"px"),this.signalTaskStart("Kick off expand animation");var a=t.get(0);this.StartAnimation(a,"expand").then(function(){o._handleExpandTransitionEnd(t,s)}),this.signalTaskEnd()}else this._isTouchSupport()?(t.children().each(function(){l+=e(this).outerHeight(!0)}),t.css("maxHeight",l+"px"),this._adjustAncestorsMaxHeight(t,l)):t.css("maxHeight",""),this.AnimateExpandComplete(t),s(null);return r},_handleExpandTransitionEnd:function(t,e){this._isTouchSupport()||t.css("maxHeight",""),this.AnimateExpandComplete(t),e(null),this.signalTaskEnd()},AnimateExpandComplete:function(t){t.removeClass(this.getGroupCollapseStyleClass()).addClass(this.getGroupExpandStyleClass()),this._setDisclosing(t[0].key,!1)},collapseKey:function(t,i,n,s){var l=this.FindElementByKey(t);null!=l&&this.CollapseItem(e(l),null,s,t,i,n)},_collapse:function(t){var e=this.FindItem(t.target);null!=e&&e.length>0&&this.CollapseItem(e,t,!0,null,!0,!0)},CollapseItem:function(t,e,i,n,s,l){var o=this;if(this.GetState(t)===this.STATE_EXPANDED&&(null==n&&(n=this.GetKey(t[0])),!i||!this._isDisclosing(n))){var r={item:t,key:n};if(!!this.Trigger("beforeCollapse",e,r)||!s){this.signalTaskStart("Collapse item: "+n),i&&this._setDisclosing(n,!0);var a=this.AnimateCollapse(t,n,i,e);this.SetState(t,this.STATE_COLLAPSED);var h=this.getCollapseIconStyleClass(),c=this.getExpandIconStyleClass();t.find("."+c).first().removeClass(c).addClass(h),this.m_items=null,null!=e&&e.stopPropagation(),l&&a.then(function(){if(o.ojContext._IsCustomElement()){var t=o.GetOption("expanded");if(o._isKeySet(t)){var i=t.delete([n]);o.SetOption("expanded",i,{_context:{originalEvent:e,internalSet:!0},changed:!0})}}o.Trigger("collapse",e,r)}),this.ojContext._IsCustomElement()||(null==this._collapsedKeys&&(this._collapsedKeys=[]),-1===this._collapsedKeys.indexOf(n)&&this._collapsedKeys.push(n)),a.then(function(){o.signalTaskEnd()})}}},AnimateCollapse:function(t,i,n,s){var l,o=0,r=this,a=new Promise(function(t){l=t}),h=t.children("ul").first();if(h[0].key=i,n){this.signalTaskStart("Animate collapse"),h.children().each(function(){o+=e(this).outerHeight()}),h.css("maxHeight",o+"px");var c=this.getAnimationEffect("collapse");c.persist="all",this.signalTaskStart("Kick off collapse animation");var d=h.get(0);this.StartAnimation(d,"collapse",c).then(function(){r._handleCollapseTransitionEnd(h,l)}),this.signalTaskEnd()}else h.css("maxHeight","0px"),this.AnimateCollapseComplete(h),l(null);return a},_handleCollapseTransitionEnd:function(t,e){this.AnimateCollapseComplete(t),e(null),this.signalTaskEnd()},AnimateCollapseComplete:function(t){t.removeClass(this.getGroupExpandStyleClass()).addClass(this.getGroupCollapseStyleClass()),null!=this.m_contentHandler&&this.m_contentHandler.Collapse(t),this._setDisclosing(t[0].key,!1)},_collapseAll:function(){this.signalTaskStart("Collapse all");var t=this;this._getItemsCache().each(function(){t.CollapseItem(e(this),null,!1,null,!1,!1)}),this.signalTaskEnd()},getExpanded:function(){var t=[],i=this;return this._getItemsCache().each(function(){var n=e(this);i.GetState(n)===i.STATE_EXPANDED&&t.push(i.GetKey(n[0]))}),t},getWidgetConstructor:function(){return a.__GetWidgetConstructor(this.element)},GetContainerStyleClass:function(){return this._isNonWindowTouch()?"oj-listview oj-listview-container-touch":"oj-listview oj-listview-container"},GetStyleClass:function(){return"oj-listview-element"},getItemStyleClass:function(){return"oj-listview-item"},getFocusedElementStyleClass:function(){return"oj-listview-focused-element"},getItemElementStyleClass:function(){return"oj-listview-item-element"},getGroupItemStyleClass:function(t){return t&&this._isPinGroupHeader()&&this._isPositionStickySupported()?"oj-listview-group-item oj-sticky":"oj-listview-group-item"},getGroupStyleClass:function(){return"oj-listview-group"},getGroupExpandStyleClass:function(){return"oj-listview-collapsible-transition"},getGroupCollapseStyleClass:function(){return this.getGroupExpandStyleClass()},getCollapseIconStyleClass:function(){return"oj-listview-collapse-icon"},getExpandIconStyleClass:function(){return"oj-listview-expand-icon"},getExpandingIconStyleClass:function(){return"oj-listview-expanding-icon"},getEmptyTextStyleClass:function(){return"oj-listview-no-data-message"},getEmptyTextMarkerClass:function(){return"oj-listview-empty-text"},getDepthStyleClass:function(t){return""},getOptionDefaultsStyleClass:function(){return"oj-listview-option-defaults"},_isPositionStickySupported:function(){return this._isTouchSupport()&&t.AgentUtils.getAgentInfo().os===t.AgentUtils.OS.IOS},_preventMouseWheelOverscroll:function(t,e){var i=e.originalEvent.wheelDelta;if(!isNaN(i)&&void 0!==this.m_contentHandler.hasMoreToFetch){var n=t.scrollTop;if(i<0){var s=this._getScrollHeight();this.m_contentHandler.hasMoreToFetch()&&n+this._getClientHeight()+Math.abs(i)>=s&&(t.scrollTop=s,e.preventDefault())}else n>0&&n-i<=0&&(t.scrollTop=0,e.preventDefault())}},_getScrollEventElement:function(){var t=this._getScroller();return t===document.body||t===document.documentElement?window:t},_findClosestElementToTop:function(t,e,i){var n=!1;if(!(0===t.length||e>=t.length)){var s,l=t[e],o=i-(s=0===e?0:l.offsetTop),r={index:e,elem:l,offsetTop:s,offset:o};if(Math.abs(o)<1)return r;var a=o>0;for(a?e+=1:e-=1;!n&&e>=0&&e<t.length;){if(s=(l=t[e]).offsetTop,n=(o=Math.abs(i-s))<1||(a?i<=s:i>=s)){(o<1||!a)&&(r={index:e,elem:l,offsetTop:s,offset:o});break}a&&r.offsetTop===s||(r={index:e,elem:l,offsetTop:s,offset:o}),a?e+=1:e-=1}return n||(e=a?t.length-1:0,r.index=e,r.elem=t[e]),r}},_getRootNodeForItems:function(){return this.isCardLayout()?this.element.get(0).firstElementChild.firstElementChild:this.element.get(0)},_getCurrentScrollPosition:function(t){var i,n,s={},l=this._getScroller();void 0===t&&(t=l.scrollTop),s.x=this._getScrollX(l),s.y=t;var o=this.m_contentHandler.IsHierarchical();if(!isNaN(this.m_itemHeight)&&this.m_itemHeight>0){var r=o?this._getItemsCache():e(this._getRootNodeForItems()).children("li."+this.getItemElementStyleClass()),a=this.GetOption("scrollPosition");Math.abs(a.y-t)<this.MINIMUM_ITEM_HEIGHT&&null!=a.key&&!isNaN(a.index)&&(o?null!=(n=this.FindElementByKey(a.key))&&(i=r.index(n)):i=a.index),isNaN(i)&&(i=Math.floor(t/this.m_itemHeight));var h=this._findClosestElementToTop(r,i,t);if(null!=h){if(n=h.elem,o){var c=n.parentNode;c!==this.element.get(0)&&(s.parent=this.GetKey(c.parentNode)),s.key=this.GetKey(h.elem),s.index=e(c).children().index(n)}else s.index=h.index,s.key=this.GetKey(h.elem);s.offsetY=h.offset,s.offsetX=s.x}}return s},_getOffsetTop:function(t){var e=this.element.get(0).offsetTop;return isNaN(this.m_elementOffset)||this.m_elementOffset===e?t.offsetTop:Math.max(0,t.offsetTop-e)},_getScrollTopByIndex:function(t,i){var n;if(null!=i)null!=(n=this.FindElementByKey(i))&&(n=e(n).children("ul").first());else{if(0===t)return 0;n=this.element.get(0),this.isCardLayout()&&(n=n.firstElementChild.firstElementChild)}if(null!=n){var s=e(n).children("."+this.getItemElementStyleClass())[t];if(null!=s)return this._getOffsetTop(s)}if(this.m_contentHandler.hasMoreToFetch&&this.m_contentHandler.hasMoreToFetch())return this._getScrollHeight()},_getScrollTopByKey:function(t){var e=this.FindElementByKey(t);return null!=e?this._getOffsetTop(e):this.m_contentHandler.hasMoreToFetch&&this.m_contentHandler.hasMoreToFetch()?this._getScrollHeight():void 0},_getScrollCoordinates:function(t){var e,i=t.x,n=t.offsetX;isNaN(i)||isNaN(n)||(i+=n);var s=t.key;isNaN(e)&&null!=s&&(e=this._getScrollTopByKey(s));var l=t.parent,o=t.index;isNaN(e)&&!isNaN(o)&&(e=this._getScrollTopByIndex(o,l));var r=t.offsetY;return isNaN(e)||isNaN(r)||(e+=r),isNaN(e)&&!isNaN(t.y)&&(e=t.y),{x:i,y:e}},_handleScroll:function(t){if(null!=this.m_contentHandler&&this.ShouldUseGridRole()){var e=this._getScroller().scrollTop;this.ojContext._IsCustomElement()||this.SetOption("scrollTop",e,{_context:{originalEvent:t,internalSet:!0}}),this.ShouldUpdateScrollPosition()&&this.SetOption("scrollPosition",this._getCurrentScrollPosition(e),{_context:{originalEvent:t,internalSet:!0}}),this._handlePinGroupHeader()}},_unregisterScrollHandler:function(){var t=e(this._getScrollEventElement());return this.ojContext._off(t,"scroll mousewheel"),t},_registerScrollHandler:function(){var t=this,e=this._unregisterScrollHandler();this.ojContext._on(e,{scroll:function(e){t._skipScrollUpdate||t.m_ticking||(window.requestAnimationFrame(function(){t._handleScroll(e),t.m_ticking=!1}),t.m_ticking=!0),t._skipScrollUpdate&&t.signalTaskEnd(),t._skipScrollUpdate=!1}}),"loadMoreOnScroll"===this.options.scrollPolicy&&this.ojContext._on(e,{mousewheel:function(e){t._preventMouseWheelOverscroll(t._getScroller(),e)}})},_isPinGroupHeader:function(){return"static"!==this.GetOption("groupHeaderPosition")&&this.m_contentHandler.IsHierarchical()},_getGroupItemsCache:function(){if(null==this.m_groupItems){var t="."+this.getGroupItemStyleClass()+":visible";this.m_groupItems=this.element.find(t).filter(function(){return!e(this).parent().hasClass("oj-collapsed")&&e(this).next().children().length>0})}return this.m_groupItems},_unpinGroupItem:function(t){e(t).removeClass("oj-pinned"),t.style.top="auto",t.style.width="auto"},_getNextGroupItem:function(t){var e=this._getGroupItemsCache(),i=e.index(t);return i>-1&&i<e.length-1?e[i+1]:null},_pinGroupItem:function(t,i){var n=t.offsetWidth,s=t.offsetHeight,l=this._getNextGroupItem(t);null!=l&&l.offsetTop<=i+s+5&&(i-=s),e(t).addClass("oj-pinned"),t.style.top=i+"px",t.style.width=n+"px"},_handlePinGroupHeader:function(){var t;if(this._isPinGroupHeader()&&!this._isPositionStickySupported()){var e=this._getScroller().scrollTop;if(null!=this.m_groupItemToPin&&0===e)return this._unpinGroupItem(this.m_groupItemToPin),void(this.m_groupItemToPin=null);var i=this._getGroupItemsCache(),n=0;null!=this.m_groupItemToPin&&(n=this.m_groupItemToPin.offsetHeight);for(var s=0;s<i.length;s++){var l=i[s];if(this.m_groupItemToPin!==l){var o=i[s].offsetTop,r=o+l.parentNode.offsetHeight;if(o<e&&r>e+n){t=l;break}}}if(null!=t&&t!==this.m_groupItemToPin)null!=this.m_groupItemToPin&&this._unpinGroupItem(this.m_groupItemToPin),this._pinGroupItem(t,e),this.m_groupItemToPin=t;else if(null!=this.m_groupItemToPin){var a=this._getNextGroupItem(this.m_groupItemToPin);if(null!=a&&a.offsetTop<=e+n)return void(this.m_groupItemToPin.style.top=a.offsetTop-n+"px");this.m_groupItemToPin.style.top=e+"px"}}},_getScroller:function(){var t=this.GetOption("scrollPolicyOptions");if(null!=t){var e=t.scroller;if(null!=e)return e}return this._getListContainer().get(0)},_scrollToGroupHeader:function(t){var e=this._getScroller(),i=e.scrollTop;null!=this.m_groupItemToPin&&(this._unpinGroupItem(this.m_groupItemToPin),this.m_groupItemToPin=null);var n=t.offsetTop;this._isPinGroupHeader()&&this._isPositionStickySupported()&&n<i&&(n=Math.max(0,n-t.parentNode.offsetHeight+t.offsetHeight)),e.scrollTop=n,i===e.scrollTop&&this._handlePinGroupHeader(),this._setFirstFocusableItemInGroupCurrent(t)},_setFirstFocusableItemInGroupCurrent:function(t){var i=this;e(t).next().children().each(function(){var t=e(this);if(!i.SkipFocus(t))return i.SetOption("currentItem",this.key),!1})}}),t.__registerWidget("oj.ojListView",e.oj.baseComponent,{widgetEventPrefix:"oj",options:{as:"",currentItem:null,data:null,dnd:{drag:null,drop:null,reorder:{items:"disabled"}},drillMode:"collapsible",expanded:new t._ojListViewExpandedKeySet,firstSelectedItem:{key:null,data:null},groupHeaderPosition:"sticky",item:{focusable:!0,renderer:null,selectable:!0},scrollPolicy:"auto",scrollPolicyOptions:{fetchSize:25,maxCount:500},scrollPosition:{x:0,y:0},scrollTop:0,selection:[],selectionMode:"none",selectionRequired:!1,animateStart:null,animateEnd:null,beforeCurrentItem:null,beforeExpand:null,beforeCollapse:null,collapse:null,copy:null,cut:null,expand:null,paste:null,ready:null,reorder:null},_ComponentCreate:function(){this._super(),this._setup()},_setup:function(){var i={};(i.element=this.element,i.OuterWrapper=this.OuterWrapper,i.ojContext=this,this._IsCustomElement())||this.options.expanded instanceof t._ojListViewExpandedKeySet&&(this.options.expanded="auto");i=e.extend(this.options,i),this.listview=new t._ojListView,this.listview.init(i)},_AfterCreate:function(){this._super();var t=this;this.listview._FixRendererContext=function(e){return t._FixRendererContext(e)},this.listview._WrapCustomElementRenderer=function(e){return t._WrapCustomElementRenderer(e)},this.listview.afterCreate()},_SetupResources:function(){this._super(),this.listview.setupResources()},_ReleaseResources:function(){this._super(),this.listview.releaseResources()},GetFocusElement:function(){return null!=this.listview?this.listview.GetFocusElement():this._super()},_destroy:function(){this.listview.destroy(),this._super()},_NotifyContextMenuGesture:function(t,e,i){this.listview.notifyContextMenuGesture(t,e,i)},_setOptions:function(t,e){if(this.listview.isAvailable()){var i=this.listview.setOptions(t,e);this._super(t,e),i?(t.data&&this.listview.adjustScrollPositionValueOnRefresh(),this.listview.refresh()):(t.selectionRequired||t.selection||t.selectionMode)&&this.listview.enforceSelectionRequired()}else this._super(t,e)},_setOption:function(t,i,n){var s,l=!0;if("selectionMode"===t?l="none"===i||"single"===i||"multiple"===i:"drillMode"===t?l="collapsible"===i||"none"===i:"scrollPolicy"===t?l="auto"===i||"loadMoreOnScroll"===i:"groupHeaderPosition"===t?l="static"===i||"sticky"===i:"firstSelectedItem"===t&&(l=!1),!l)throw new Error("Invalid value: "+i+" for key: "+t);this.listview.isAvailable()&&("selection"===t?(s=this.listview.getItems(i),n={_context:{extraData:{items:this._IsCustomElement()?s:e(s)}}}):"currentItem"===t&&(s=this.listview.getItems([i])[0],n={_context:{extraData:{items:this._IsCustomElement()?s:e(s)}}})),this._super(t,i,n)},_NotifyAttached:function(){this.listview.notifyAttached()},_NotifyDetached:function(){this.listview.notifyDetached()},_NotifyShown:function(){this.listview.notifyShown()},_VerifyConnectedForSetup:function(){return!0},widget:function(){return this.listview.getRootElement()},refresh:function(){this._super(),this.listview.refresh()},whenReady:function(){return this.listview.whenReady()},getNodeBySubId:function(t){return this.listview.getNodeBySubId(t)},getSubIdByNode:function(t){return this.listview.getSubIdByNode(t)},getContextByNode:function(t){return this.listview.getContextByNode(t)},getDataForVisibleItem:function(t){return this.listview.getDataForVisibleItem(t)},expand:function(t,e){this.listview.expandKey(t,e,!0,!0)},collapse:function(t,e){this.listview.collapseKey(t,e,!0)},getExpanded:function(){return this.listview.getExpanded()},getIndexerModel:function(){return null==this.indexerModel&&t.ListViewIndexerModel&&(this.indexerModel=new t.ListViewIndexerModel(this.listview)),this.indexerModel},scrollToItem:function(t){this.listview.scrollToItem(t)},_CompareOptionValues:function(e,i,n){switch(e){case"currentItem":case"selection":return t.Object.compareValues(i,n);default:return this._super(e,i,n)}}}),t.IteratingDataProviderContentHandler=function(e,i,n){t.IteratingDataProviderContentHandler.superclass.constructor.call(this,e,i,n)},t.Object.createSubclass(t.IteratingDataProviderContentHandler,t.DataSourceContentHandler,"oj.IteratingDataProviderContentHandler"),t.IteratingDataProviderContentHandler.prototype.Init=function(){t.IteratingDataProviderContentHandler.superclass.Init.call(this)},t.IteratingDataProviderContentHandler.prototype.IsHierarchical=function(){return!1},t.IteratingDataProviderContentHandler.prototype._destroyDomScroller=function(){null!=this.m_domScroller&&(this.m_domScroller.destroy(),this.m_domScroller=null,this.m_domScrollerMaxCountFunc=null),this._removeLoadingIndicator()},t.IteratingDataProviderContentHandler.prototype.Destroy=function(){t.IteratingDataProviderContentHandler.superclass.Destroy.call(this),this._removeDataSourceEventListeners(),this._destroyDomScroller(),this.m_loadingIndicator=null},t.IteratingDataProviderContentHandler.prototype.shouldHandleResize=function(){return this._isLoadMoreOnScroll()},t.IteratingDataProviderContentHandler.prototype.HandleResize=function(t,e){this._isLoadMoreOnScroll()&&this.m_height!==e&&(this.m_height=e,this.checkViewport())},t.IteratingDataProviderContentHandler.prototype.notifyShown=function(){this._isLoadMoreOnScroll()&&this.checkViewport()},t.IteratingDataProviderContentHandler.prototype.notifyAttached=function(){var t=this._getFetchTrigger();if(null!=t&&null!=this.m_domScroller){var e=this._getFetchTrigger();t!==e&&this.m_domScroller.setFetchTrigger(e),this.checkViewport()}},t.IteratingDataProviderContentHandler.prototype._isLoadMoreOnScroll=function(){return"loadMoreOnScroll"===this.m_widget.options.scrollPolicy},t.IteratingDataProviderContentHandler.prototype._getFetchSize=function(){return Math.max(0,this.m_widget.options.scrollPolicyOptions.fetchSize)},t.IteratingDataProviderContentHandler.prototype._getTotalSize=function(){return-1},t.IteratingDataProviderContentHandler.prototype._getScroller=function(){var i=this.m_widget.options.scrollPolicyOptions.scroller;return null!=i&&e.contains(i,this.m_root)?(void 0===this._fetchTrigger&&(this._fetchTrigger=t.DomScroller.calculateOffsetTop(i,this.m_root)+this._getLoadingIndicatorHeight()),i):this.m_widget.getRootElement()},t.IteratingDataProviderContentHandler.prototype._getFetchTrigger=function(){return void 0===this._fetchTrigger&&(this._fetchTrigger=this._getLoadingIndicatorHeight()),this._fetchTrigger},t.IteratingDataProviderContentHandler.prototype._getLoadingIndicatorHeight=function(){var t=e(document.createElement("div"));t.addClass(this.m_widget.getItemStyleClass()).css({visibility:"hidden",overflow:"hidden",position:"absolute"});var i=e(document.createElement("div"));i.addClass("oj-icon oj-listview-loading-icon"),t.append(i),e(this.m_widget.getRootElement()).append(t);var n=t.get(0).offsetHeight;return t.remove(),n},t.IteratingDataProviderContentHandler.prototype._getMaxCount=function(){return this.m_widget.options.scrollPolicyOptions.maxCount},t.IteratingDataProviderContentHandler.prototype.setDataSource=function(e){this._removeDataSourceEventListeners(),null!=e&&(this.m_handleModelMutateEventListener=this.handleModelMutateEvent.bind(this),this.m_handleModelRefreshEventListener=this.handleModelRefreshEvent.bind(this),e.addEventListener("mutate",this.m_handleModelMutateEventListener),e.addEventListener("refresh",this.m_handleModelRefreshEventListener)),t.IteratingDataProviderContentHandler.superclass.setDataSource.call(this,e)},t.IteratingDataProviderContentHandler.prototype._appendLoadingIndicator=function(){if(null==this.m_loadingIndicator){var t=e(document.createElement("li"));t.uniqueId().attr("role","presentation").addClass(this.m_widget.getItemStyleClass()).addClass("oj-listview-loading-icon-container");var i=e(document.createElement("div"));i.addClass("oj-icon oj-listview-loading-icon"),t.append(i),e(this.m_root).append(t),this.m_loadingIndicator=t}},t.IteratingDataProviderContentHandler.prototype._removeLoadingIndicator=function(){null!=this.m_loadingIndicator&&this.m_loadingIndicator.remove(),this.m_loadingIndicator=null},t.IteratingDataProviderContentHandler.prototype.hasMoreToFetch=function(){return null!=this.m_loadingIndicator},t.IteratingDataProviderContentHandler.prototype.afterRenderItem=function(i,n){if(t.IteratingDataProviderContentHandler.superclass.afterRenderItem.call(this,i,n),e(i).addClass(this.m_widget.getItemStyleClass()),this.m_widget._isSelectionEnabled()&&this.isSelectable(n)&&this.m_widget.getFocusItem(e(i)).attr("aria-selected",!1),this._isLoadMoreOnScroll()){var s=Math.min(this._getTotalSize(),this._getMaxCount());-1===s&&(s=this._getMaxCount()),s>0&&e(i).attr("aria-setsize",s).attr("aria-posinset",n.index+1)}this.m_widget.itemRenderComplete(i,n)},t.IteratingDataProviderContentHandler.prototype.afterRenderItemForInsertEvent=function(t,i){this.signalTaskStart("after render item from model insert event"),t.setAttribute("data-oj-context",""),this.afterRenderItem(t,i);var s=e(t),l=t.className;t.className="oj-listview-temp-item oj-listview-item-add-remove-transition",this.shouldUseGridRole()||s.children().wrapAll("<div></div>");var o=s.children().first();o[0].className=l,o[0].key=t.key,this.shouldUseGridRole()||(o.attr("role",t.getAttribute("role")),s[0].hasAttribute("aria-selected")&&o.attr("aria-selected",t.getAttribute("aria-selected")));var r=this;n.getContext(t).getBusyContext().whenReady().then(function(){null!=r.m_widget&&(r.signalTaskStart("kick off animation for insert item"),r.m_widget.StartAnimation(t,"add").then(function(){t.removeAttribute("data-oj-context"),r._handleAddTransitionEnd(i,t)}),r.signalTaskEnd())})},t.IteratingDataProviderContentHandler.prototype._handleScrollerMaxRowCount=function(){c.error("max count reached")},t.IteratingDataProviderContentHandler.prototype._removeDataSourceEventListeners=function(){var e=this.getDataSource();null!=e&&(e.removeEventListener("mutate",this.m_handleModelMutateEventListener),e.removeEventListener("refresh",this.m_handleModelRefreshEventListener),e instanceof t.TableDataSourceAdapter&&e.destroy())},t.IteratingDataProviderContentHandler.prototype.fetchRows=function(i){var n=0;if(this.signalTaskStart("fetching rows"),this.IsReady()){var s=this;this.m_fetching=!0,t.IteratingDataProviderContentHandler.superclass.fetchRows.call(this,i);var l=this.loadTemplateEngine();this.signalTaskStart("first fetch");var o={};o.size=this._isLoadMoreOnScroll()?this._getFetchSize():-1,this.m_dataProviderAsyncIterator=this.getDataSource().fetchFirst(o)[Symbol.asyncIterator]();var r=this.m_dataProviderAsyncIterator.next();s.fetchSize=o.size;var a=function(t){return t[0].done||-1!==s.fetchSize||"function"==typeof s.getDataSource().getPageCount?t:s.m_dataProviderAsyncIterator.next().then(function(e){return t[0].done=e.done,t[0].value.data=t[0].value.data.concat(e.value.data),t[0].value.metadata=t[0].value.metadata.concat(e.value.metadata),a(t)},function(t){s._handleFetchError(t),s.signalTaskEnd()})};return Promise.all([r,l]).then(function(t){return a(t)},function(t){s._handleFetchError(t),s.signalTaskEnd()}).then(function(i){if(s.m_fetching){if(null==s.m_widget)return;var l=i[0],o=i[1],r=s.getDataSource();r instanceof t.TableDataSourceAdapter&&(n=r.offset),0===n&&(o&&s.cleanItems(o),e(s.m_root).empty()),s._handleFetchedData(l,o)}},function(t){s._handleFetchError(t),s.signalTaskEnd()}),void this.signalTaskEnd()}this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype._handleFetchError=function(t){c.error(t),this.m_fetching=!1,null!=this.m_widget?(this._isLoadMoreOnScroll()&&this._removeLoadingIndicator(),this.m_widget.renderComplete()):c.info("handleFetchError: widget has already been destroyed")},t.IteratingDataProviderContentHandler.prototype._handleFetchSuccess=function(t,e,i){if(null!=this.m_widget){for(var n=this.m_root.childElementCount,s=document.createDocumentFragment(),l=0;l<t.length;l++){var o=t[l];this.addItem(s,-1,o,this.getMetadata(n,e[l],o),i),n+=1}this.m_root.appendChild(s)}},t.IteratingDataProviderContentHandler.prototype._registerDomScroller=function(){var e=this;this.m_domScrollerMaxCountFunc=function(t){null!=t?(e.signalTaskStart("handle results when maxCountLimit reached"),e._removeLoadingIndicator(),e.IsReady()&&e.signalTaskStart("dummy task"),e._handleFetchedData(t,e.getTemplateEngine()),e.m_widget.m_scrollHeight=null,e.signalTaskEnd(),e.signalTaskEnd()):(e._removeLoadingIndicator(),e.signalTaskEnd())};var i={fetchSize:this._getFetchSize(),fetchTrigger:this._getFetchTrigger(),maxCount:this._getMaxCount(),asyncIterator:this.m_dataProviderAsyncIterator,initialRowCount:this.m_root.childElementCount,success:this.m_domScrollerMaxCountFunc,error:this.signalTaskEnd.bind(this)};this.m_domScroller=new t.DomScroller(this._getScroller(),this.getDataSource(),i),this.m_domScroller._handleScrollerScrollTop=function(i,n){n-i<=1&&e.hasMoreToFetch()&&e.signalTaskStart("starts high-water mark scrolling"),t.DomScroller.prototype._handleScrollerScrollTop.call(this,i,n)}},t.IteratingDataProviderContentHandler.prototype._pushToEventQueue=function(t){null==this.m_eventQueue&&(this.m_eventQueue=[]),this.m_eventQueue.push(t)},t.IteratingDataProviderContentHandler.prototype._clearEventQueue=function(){null!=this.m_eventQueue&&(this.m_eventQueue.length=0)},t.IteratingDataProviderContentHandler.prototype._processEventQueue=function(){var t;if(null!=this.m_eventQueue&&this.m_eventQueue.length>0){for(var e=0;e<this.m_eventQueue.length;e++)if("refresh"===(t=this.m_eventQueue[e]).type)return void this.handleModelRefreshEvent(t.event);"mutate"===(t=this.m_eventQueue.shift()).type&&this.handleModelMutateEvent(t.event)}},t.IteratingDataProviderContentHandler.prototype.handleModelMutateEvent=function(t){null!=t.detail.remove&&this.handleModelRemoveEvent(t),null!=t.detail.add&&this.handleModelAddEvent(t),null!=t.detail.update&&this.handleModelChangeEvent(t)},t.IteratingDataProviderContentHandler.prototype._getIndex=function(t,i){if(null==t||0===t.length||i>=t.length)return-1;var n=t[i],s=this.FindElementByKey(n);return null!=s?e(this.m_root).children().index(s):-1},t.IteratingDataProviderContentHandler.prototype.handleModelAddEvent=function(t){if(null!=this.m_root)if(this.IsReady()){this.signalTaskStart("handling model add event"),this.m_superRoot&&0===this.m_root.childNodes.length&&this.m_superRoot.appendChild(this.m_root.parentNode);var e,i=t.detail.add,n=i.data,s=[];i.keys.forEach(function(t){s.push(t)});var l=i.addBeforeKeys?i.addBeforeKeys:i.afterKeys;l&&(e=[],l.forEach(function(t){e.push(t)}));var o=this.getTemplateEngine(),r=i.indexes;if(null!=n&&null!=s&&s.length>0&&n.length>0&&s.length===n.length&&(null==r||r.length===n.length)){for(var a=0;a<n.length;a++){this.signalTaskStart("handling model add event for item: "+s[a]);var h=null==r?this._getIndex(e,a)+1:r[a];this.addItem(this.m_root,h,n[a],this.getMetadata(h,s[a],n[a]),o,this.afterRenderItemForInsertEvent.bind(this)),this.signalTaskEnd()}this.IsReady()&&this.signalTaskStart("dummy task"),this.fetchEnd()}this.signalTaskEnd()}else this._pushToEventQueue({type:t.type,event:t})},t.IteratingDataProviderContentHandler.prototype._handleAddTransitionEnd=function(t,i){if(null!=this.m_widget){var n=e(i).children().first().attr("class");i.className=n,this.shouldUseGridRole()?e(i).children().first()[0].className="oj-listview-cell-element":e(i).children().children().unwrap(),this.m_widget.itemInsertComplete(i,t),this.signalTaskEnd()}else this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.handleModelRemoveEvent=function(t){var e=this,i=t.detail.remove.keys;if(null!=this.m_root&&null!=i&&0!==i.size)if(this.IsReady()){this.signalTaskStart("handling model remove event");var n=this.m_widget.options.selection,s=n.slice(0);if(i.forEach(function(t){var i=e.FindElementByKey(t);null!=i&&(e.signalTaskStart("handling model remove event for item: "+t),e._removeItem(i),e.signalTaskEnd());var l=e.m_widget.GetIndexOf(n,t);l>-1&&s.splice(l,1)}),n.length!==s.length){for(var l=new Array(s.length),o=0;o<s.length;o++)l[o]=this.FindElementByKey(s[o]);this.m_widget._setSelectionOption(s,null,l)}this.m_widget.ClearCache(),this.signalTaskEnd()}else this._pushToEventQueue({type:t.type,event:t})},t.IteratingDataProviderContentHandler.prototype._removeItem=function(t){var i=this;this.signalTaskStart("removing an item");var n=document.activeElement,s=t.contains(n),l=e(t),o=l.get(0).className;l.children().wrapAll("<div class='"+o+"'></div>"),l.get(0).className="oj-listview-item-add-remove-transition",this.signalTaskStart("kick off animation to remove an item");var r=l.get(0);this.m_widget.StartAnimation(r,"remove").then(function(){i._handleRemoveTransitionEnd(l,s)}),this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype._handleRemoveTransitionEnd=function(t,i){if(null!=this.m_widget){var n=e(t),s=n.parent();if(0!==s.length){this.m_widget.itemRemoveComplete(n.get(0));var l=this.getTemplateEngine();l&&l.clean(n.get(0)),n.remove(),0===s.get(0).childElementCount&&this.m_widget.renderComplete(),this.m_widget.enforceSelectionRequired(),i&&this.m_root.focus(),this.signalTaskEnd()}else this.signalTaskEnd()}else this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.handleModelChangeEvent=function(t){if(null!=this.m_root){this.signalTaskStart("handling model update event");var e=t.detail.update,i=e.data,n=[];e.keys.forEach(function(t){n.push(t)});for(var s=this.getTemplateEngine(),l=e.indexes,o=0;o<n.length;o++){var r=this.FindElementByKey(n[o]);if(null!=r){this.signalTaskStart("handling model update event for item: "+n[o]);var a=null==l?-1:l[o];this.replaceItem(r,a,i[o],this.getMetadata(a,n[o],i[o]),s,this.afterRenderItemForChangeEvent.bind(this)),this.signalTaskEnd()}}this.m_widget.ClearCache(),this.signalTaskEnd()}},t.IteratingDataProviderContentHandler.prototype.afterRenderItemForChangeEvent=function(t,e){var i=this;this.signalTaskStart("after render item for model change event"),this.afterRenderItem(t,e),this.m_widget.StartAnimation(t,"update").then(function(){i._handleReplaceTransitionEnd(t)}),this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype._handleReplaceTransitionEnd=function(t){null!=this.m_widget?(e(t).removeClass("oj-listview-item-add-remove-transition"),this.m_widget.restoreCurrentItem(),this.signalTaskEnd()):this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.handleModelRefreshEvent=function(t){null!=this.m_root&&(this.IsReady()?(this.signalTaskStart("handling model reset event"),this._clearEventQueue(),this.m_widget.ClearCache(),this._destroyDomScroller(),this.m_widget.adjustScrollPositionValueOnRefresh(),this.fetchRows(!0),this.signalTaskEnd()):this._pushToEventQueue({type:t.type,event:t}))},t.IteratingDataProviderContentHandler.prototype._handleFetchedData=function(t,e){var i=!1;if(null==this.m_root||null==t.value)return i;var n=t.value.data,s=t.value.metadata.map(function(t){return t.key});return n.length===s.length&&(this._handleFetchSuccess(n,s,e),this._isLoadMoreOnScroll()&&((i=!t.done&&this._isLoadMoreOnScroll())&&(null!=s&&0===s.length&&c.info("handleFetchedData: zero data returned while done flag is false"),null==this.m_domScroller&&this._registerDomScroller(),t.maxCountLimit||this._appendLoadingIndicator()),t.maxCountLimit&&this._handleScrollerMaxRowCount()),this.fetchEnd()),i},t.IteratingDataProviderContentHandler.prototype.fetchEnd=function(){var t=this;function e(){t.m_widget&&(t.m_widget.renderComplete(),t._processEventQueue(),t.checkViewport())}if(this.m_fetching=!1,this.isAsyncRendering()){var i=this.m_widget.m_scrollAndFetch;i&&t.signalTaskEnd(),n.getContext(this.m_root).getBusyContext().whenReady().then(function(){i&&t.signalTaskStart("scroll and fetch"),e()})}else e();t.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.checkViewport=function(){var t=this;if(this.signalTaskStart("checking viewport"),null!=this.m_domScroller&&this.IsReady()){var e=this.m_domScroller.checkViewport();null!=e&&(this.signalTaskStart("got promise from checking viewport"),e.then(function(e){null!=e&&t.m_domScrollerMaxCountFunc(e),t.signalTaskEnd()},null))}this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.getMetadata=function(t,e,i){var n=i.context;return null==n&&(n={}),null==n.index&&(n.index=t),null==n.key&&(n.key=e),n},t.IteratingDataProviderContentHandler.prototype.createKeyMap=function(t){if(this.getDataSource().createOptimizedKeyMap)return this.getDataSource().createOptimizedKeyMap(t);var e=new r;return t?(t.forEach(function(t,i){e.set(i,t)}),e):e},t.IteratingDataProviderContentHandler.prototype.createKeySet=function(t){return this.getDataSource().createOptimizedKeySet?this.getDataSource().createOptimizedKeySet(t):new d(t)},u.extension._WIDGET_NAME="ojListView",u.extension._INNER_ELEM="ul",u.extension._GLOBAL_TRANSFER_ATTRS=["aria-label"],t.CustomElementBridge.register("oj-list-view",{metadata:u})});