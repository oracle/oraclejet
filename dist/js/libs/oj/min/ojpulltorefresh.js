/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcontext","ojs/ojtranslation","hammerjs","promise","ojs/ojjquery-hammer","ojs/ojcomponentcore","touchr"],function(e,t,l,a,s){e.PullToRefreshUtils={};e.PullToRefreshUtils;return e.PullToRefreshUtils.setupPullToRefresh=function(l,o,r){var n,i,u,d,h,c,f,p,g,T,v,R,j,m,P,U,_;U=e.DomUtils.isTouchSupported(),e.PullToRefreshUtils.tearDownPullToRefresh(l),n=t(document.createElement("div")).addClass("oj-pulltorefresh-outer"),e.PullToRefreshUtils._renderAccessibleLink(l,n,o,r),i=t(document.createElement("div")).addClass("oj-pulltorefresh-panel"),n.append(i),(u=t(l)).prepend(n),U?_="touch":(_="pan",P={recognizers:[[s.Pan,{direction:s.DIRECTION_VERTICAL}]]},u.ojHammer(P)),u.on(_+"start.pulltorefresh",function(l){null==t.data(i[0],"data-pullstart")&&0===u[0].scrollTop&&(e.PullToRefreshUtils._handlePull(l,i,r),(g=i.find(".oj-pulltorefresh-icon")).length>0&&(T=g.parent().outerHeight(!0)),r&&!isNaN(r.threshold)&&(h=parseInt(r.threshold,10)),h=isNaN(h)?i.outerHeight(!0):Math.max(0,Math.min(h,i.outerHeight(!0))),i.css("height",0),i.removeClass("oj-pulltorefresh-transition"),U?(t.data(i[0],"data-pullstart",l.originalEvent.touches[0].clientY),t.data(i[0],"data-pullstart-horiz",l.originalEvent.touches[0].clientX)):t.data(i[0],"data-pullstart",0),d=!0)}).on(_+"move.pulltorefresh",function(l){if(null!=(c=t.data(i[0],"data-pullstart"))&&!((f=U?l.originalEvent.touches[0].clientY-parseInt(c,10):l.gesture.deltaY)<0)&&(l.preventDefault(),null==t.data(i[0],"data-closing")))if(null==t.data(i[0],"data-loading")){if(d){if(p=U?l.originalEvent.touches[0].clientX-parseInt(t.data(i[0],"data-pullstart-horiz"),10):l.gesture.deltaX,Math.abs(p)>f)return;d=!1}i.css("height",f),e.PullToRefreshUtils._fireEvent(l,"pull",i,f),null!=g&&g.length>0&&(null!=(v=t.data(i[0],"data-lasticonclass"))&&g.removeClass(v),(j=10*Math.round(f/h*10))>=100?(m="oj-pulltorefresh-icon-full",R=a.getTranslatedString("oj-pullToRefresh.titleIconFull")):(m="oj-pulltorefresh-icon-"+j+"-percent",R=a.getTranslatedString("oj-pullToRefresh.titleIcon"+j+"percent")),g.addClass(m),g.attr("title",R),t.data(i[0],"data-lasticonclass",m),e.PullToRefreshUtils._showHideDefaultText(i,f>T))}else i.css("height",Math.max(f,h))}).on(_+"cancel.pulltorefresh",function(){e.PullToRefreshUtils._cleanup(i)}).on(_+"end.pulltorefresh",function(a){if(null!=(c=t.data(i[0],"data-pullstart"))&&null==t.data(i[0],"data-closing"))return null!=t.data(i[0],"data-loading")?(f=t.data(i[0],"data-panelheight"),void i.css("height",f)):void(i.outerHeight()<h?(i.addClass("oj-pulltorefresh-transition").css("height",0),e.PullToRefreshUtils._cleanup(i)):e.PullToRefreshUtils._handleRelease(a,l,i,o))})},e.PullToRefreshUtils._handlePull=function(l,s,o){var r,n;e.PullToRefreshUtils._fireEvent(l,"pull",s,0),0===s.children().length&&(o&&(r=o.primaryText,n=o.secondaryText),e.PullToRefreshUtils._createDefaultContent(s,r,n)),s.prev().text(a.getTranslatedString("oj-pullToRefresh.ariaRefreshingLink")),s.css("height","auto"),t.data(s[0],"data-panelheight",s.outerHeight())},e.PullToRefreshUtils._handleRelease=function(s,o,r,n){var i,u,d,h,c;i=t.data(r[0],"data-panelheight"),r.addClass("oj-pulltorefresh-transition").css("height",i),e.PullToRefreshUtils._fireEvent(s,"release",r,i),t.data(r[0],"data-loading",!0),(u=r.find(".oj-pulltorefresh-icon")).length>0&&(null!=(d=t.data(r[0],"data-lasticonclass"))&&u.removeClass(d),u.addClass("oj-pulltorefresh-icon-full")),h=l.getContext(o).getBusyContext().addBusyState({description:"PullToRefresh:handleRelease"}),t.data(t(o)[0],"data-pulltorefresh-busystate",h),n().then(function(){c=function(){e.PullToRefreshUtils._fireEvent(s,"complete",r,i),e.PullToRefreshUtils._cleanup(r),r.off("transitionend",c),r.prev().text(""),e.PullToRefreshUtils._resolveBusyState(o)},r.prev().text(a.getTranslatedString("oj-pullToRefresh.ariaRefreshCompleteLink")),r.prev().prev().css("position",""),t.data(r[0],"data-closing",!0),r.on("transitionend",c),r.css("height",0)},function(){c=function(){e.PullToRefreshUtils._cleanup(r),r.off("transitionend",c),r.prev().text(""),e.PullToRefreshUtils._resolveBusyState(o)},r.prev().prev().css("position",""),t.data(r[0],"data-closing",!0),r.on("transitionend",c),r.css("height",0)})},e.PullToRefreshUtils.tearDownPullToRefresh=function(l){t(l).children(".oj-pulltorefresh-outer").remove(),t(l).off(".pulltorefresh"),e.PullToRefreshUtils._resolveBusyState(l)},e.PullToRefreshUtils._resolveBusyState=function(e){var l,a;l=t(e)[0],(a=t.data(l,"data-pulltorefresh-busystate"))&&(a(null),t.removeData(l,"data-pulltorefresh-busystate"))},e.PullToRefreshUtils._fireEvent=function(e,l,a,s){var o=t.Event("oj"+l);o.originalEvent=e,a.trigger(o,{content:a,distance:s})},e.PullToRefreshUtils._createDefaultContent=function(e,l,a){var s,o,r,n;e.addClass("oj-pulltorefresh-content").attr("aria-hidden","true"),(s=t(document.createElement("div"))).addClass("oj-icon oj-pulltorefresh-icon oj-pulltorefresh-icon-initial"),(o=t(document.createElement("div"))).addClass("oj-pulltorefresh-icon-container"),o.append(s),t.data(e[0],"data-lasticonclass","oj-pulltorefresh-icon-initial"),e.append(o),null!=l&&(r=t(document.createElement("div")).addClass("oj-pulltorefresh-primary-text").text(l),e.append(r),null!=a&&(n=t(document.createElement("div")).addClass("oj-pulltorefresh-secondary-text").text(a),e.append(n)))},e.PullToRefreshUtils._showHideDefaultText=function(e,t){var l,a;l=e.find(".oj-pulltorefresh-primary-text"),a=e.find(".oj-pulltorefresh-secondary-text"),t?(l&&l.show(),a&&a.show()):(l&&l.hide(),a&&a.hide())},e.PullToRefreshUtils._renderAccessibleLink=function(l,s,o,r){var n,i,u;(n=t(document.createElement("a"))).text(a.getTranslatedString("oj-pullToRefresh.ariaRefreshLink")),n.addClass("oj-helper-hidden-accessible").attr("href","#").focus(function(){n.css("position","static")}).blur(function(e){null!=e.relatedTarget&&n.css("position","")}).click(function(t){i=s.children().last(),e.PullToRefreshUtils._handlePull(t,i,r),e.PullToRefreshUtils._handleRelease(t,l,i,o)}),(u=t(document.createElement("div"))).addClass("oj-helper-hidden-accessible").attr("aria-live","polite"),s.append(n),s.append(u)},e.PullToRefreshUtils._cleanup=function(e){t.removeData(e[0],"data-pullstart"),t.removeData(e[0],"data-pullstart-horiz"),t.removeData(e[0],"data-loading"),t.removeData(e[0],"data-closing"),e.find(".oj-pulltorefresh-icon").length>0&&e.empty()},e.PullToRefreshUtils});