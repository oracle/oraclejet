/**
 * @license
 * Copyright (c) 2014, 2022, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojcore-base","jquery","ojs/ojcontext","ojs/ojdomutils","ojs/ojtranslation","hammerjs","ojs/ojthemeutils","ojs/ojjquery-hammer","ojs/ojcomponentcore","touchr","ojs/ojprogress-circle"],function(e,t,a,r,l,o,s,n,i,d,u,c){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;const h={};t._registerLegacyNamespaceProp("PullToRefreshUtils",h),h.setupPullToRefresh=function(e,t,r){var i,d,u,c,p,f,g,j,v,m,_,T,y,E,R,C,b,x,P=(n.parseJSONFromFontFamily("oj-refresher-option-defaults")||{}).loadingIcon;r&&r.refresherElement&&a.data(a(e)[0],"data-pulltorefresh-refresher",r.refresherElement),b=l.isTouchSupported(),h.tearDownPullToRefresh(e),i=a(document.createElement("div")).addClass("oj-pulltorefresh-outer"),h._renderAccessibleLink(e,i,t,r),d=a(document.createElement("div")).addClass("oj-pulltorefresh-panel"),i.append(d),(u=a(e)).prepend(i),b?x="touch":(x="pan",C={recognizers:[[s.Pan,{direction:s.DIRECTION_VERTICAL}]]},u.ojHammer(C)),u.on(x+"start.pulltorefresh",function(e){null==a.data(d[0],"data-pullstart")&&0===u[0].scrollTop&&(h._handlePull(e,d,r),(v=d.find(".oj-pulltorefresh-icon")).length>0&&("progresscircle"===P&&v[0].setAttribute("value","0"),m=v.parent().outerHeight(!0)),r&&!isNaN(r.threshold)&&(p=parseInt(r.threshold,10)),p=isNaN(p)?d.outerHeight(!0):Math.max(0,Math.min(p,d.outerHeight(!0))),d.css("height",0),d.removeClass("oj-pulltorefresh-transition"),b?(a.data(d[0],"data-pullstart",e.originalEvent.touches[0].clientY),a.data(d[0],"data-pullstart-horiz",e.originalEvent.touches[0].clientX)):a.data(d[0],"data-pullstart",0),c=!0)}).on(x+"move.pulltorefresh",function(e){if(null!=(f=a.data(d[0],"data-pullstart")))if((g=b?e.originalEvent.touches[0].clientY-parseInt(f,10):e.gesture.deltaY)<0)u[0].classList.remove("oj-pulltorefresh-action");else if(e.preventDefault(),null==a.data(d[0],"data-closing"))if(null==a.data(d[0],"data-loading")){if(c){if(j=b?e.originalEvent.touches[0].clientX-parseInt(a.data(d[0],"data-pullstart-horiz"),10):e.gesture.deltaX,Math.abs(j)>g)return;c=!1}d.css("height",g),u[0].classList.add("oj-pulltorefresh-action"),h._fireEvent(e,"pull",d,g),null!=v&&v.length>0&&(y=p>0?g/p:100,(isNaN(y)||y<0)&&(y=0),(E=10*Math.round(10*y))>=100?(R="oj-pulltorefresh-icon-full",T=o.getTranslatedString("oj-pullToRefresh.titleIconFull")):(R="oj-pulltorefresh-icon-"+E+"-percent",T=o.getTranslatedString("oj-pullToRefresh.titleIcon"+E+"percent")),"progresscircle"===P?(E=Math.min(Math.round(100*y),100),v[0].setAttribute("value",E)):(null!=(_=a.data(d[0],"data-lasticonclass"))&&v.removeClass(_),v.addClass(R)),a.data(d[0],"data-lasticonclass",R),v.attr("title",T),h._showHideDefaultText(d,g>m))}else d.css("height",Math.max(g,p))}).on(x+"cancel.pulltorefresh",function(){h._cleanup(d),u[0].classList.remove("oj-pulltorefresh-action")}).on(x+"end.pulltorefresh",function(r){if(null!=(f=a.data(d[0],"data-pullstart"))&&null==a.data(d[0],"data-closing")){if(null!=a.data(d[0],"data-loading"))return g=a.data(d[0],"data-panelheight"),void d.css("height",g);d.outerHeight()<p?(d.addClass("oj-pulltorefresh-transition").css("height",0),h._cleanup(d)):h._handleRelease(r,e,d,t),u[0].classList.remove("oj-pulltorefresh-action")}})},h._handlePull=function(e,t,r){var l,o;h._fireEvent(e,"pull",t,0),0===t.children().length&&(r&&(l=r.primaryText,o=r.secondaryText),h._createDefaultContent(t,l,o)),t.prev().text(h._getTranslatedString("oj-pullToRefresh.ariaRefreshingLink")),t.css("height","auto"),a.data(t[0],"data-panelheight",t.outerHeight())},h._handleRelease=function(e,t,l,o){var s,i,d,u,c,p=(n.parseJSONFromFontFamily("oj-refresher-option-defaults")||{}).loadingIcon;s=a.data(l[0],"data-panelheight"),l.addClass("oj-pulltorefresh-transition").css("height",s),h._fireEvent(e,"release",l,s),a.data(l[0],"data-loading",!0),(i=l.find(".oj-pulltorefresh-icon")).length>0&&("progresscircle"===p?i[0].setAttribute("value","-1"):(null!=(d=a.data(l[0],"data-lasticonclass"))&&i.removeClass(d),i.addClass("oj-pulltorefresh-icon-full")));var f=a.data(a(t)[0],"data-pulltorefresh-refresher")?a.data(a(t)[0],"data-pulltorefresh-refresher"):t;u=r.getContext(f).getBusyContext().addBusyState({description:"PullToRefresh:handleRelease"}),a.data(a(f)[0],"data-pulltorefresh-busystate",u),o().then(function(){c=function(){h._fireEvent(e,"complete",l,s),h._cleanup(l),l.off("transitionend",c),l.prev().text(""),h._resolveBusyState(t)},l.prev().text(h._getTranslatedString("oj-pullToRefresh.ariaRefreshCompleteLink")),l.prev().prev().css("position",""),a.data(l[0],"data-closing",!0),l.on("transitionend",c),l.css("height",0)},function(){c=function(){h._cleanup(l),l.off("transitionend",c),l.prev().text(""),h._resolveBusyState(t)},l.prev().prev().css("position",""),a.data(l[0],"data-closing",!0),l.on("transitionend",c),l.css("height",0)})},h.tearDownPullToRefresh=function(e){a(e).children(".oj-pulltorefresh-outer").remove(),a(e).off(".pulltorefresh"),e.classList.remove("oj-pulltorefresh-action"),h._resolveBusyState(e)},h._resolveBusyState=function(e){var t,r,l=a.data(e,"data-pulltorefresh-refresher")?a.data(e,"data-pulltorefresh-refresher"):e;t=a(l)[0],(r=a.data(t,"data-pulltorefresh-busystate"))&&(r(null),a.removeData(t,"data-pulltorefresh-busystate"))},h._fireEvent=function(e,t,r,l){var o=a.Event("oj"+t);o.originalEvent=e,r.trigger(o,{content:r,distance:l})},h._createDefaultContent=function(e,t,r){var l,o,s,i,d=(n.parseJSONFromFontFamily("oj-refresher-option-defaults")||{}).loadingIcon;e.addClass("oj-pulltorefresh-content").attr("aria-hidden","true"),"progresscircle"===d?((l=document.createElement("oj-progress-circle")).classList.add("oj-pulltorefresh-icon"),l.setAttribute("value","0"),l.setAttribute("size","sm"),l.setAttribute("data-oj-binding-provider","none")):(l=a(document.createElement("div"))).addClass("oj-icon oj-pulltorefresh-icon oj-pulltorefresh-icon-initial"),(o=a(document.createElement("div"))).addClass("oj-pulltorefresh-icon-container"),o.append(l),a.data(e[0],"data-lasticonclass","oj-pulltorefresh-icon-initial"),e.append(o),null!=t&&(s=a(document.createElement("div")).addClass("oj-pulltorefresh-primary-text").text(t),e.append(s),null!=r&&(i=a(document.createElement("div")).addClass("oj-pulltorefresh-secondary-text").text(r),e.append(i)))},h._showHideDefaultText=function(e,t){var a,r;a=e.find(".oj-pulltorefresh-primary-text"),r=e.find(".oj-pulltorefresh-secondary-text"),t?(a&&a.show(),r&&r.show()):(a&&a.hide(),r&&r.hide())},h._renderAccessibleLink=function(e,t,r,l){var o,s,n;(o=a(document.createElement("a"))).text(h._getTranslatedString("oj-pullToRefresh.ariaRefreshLink")),o.addClass("oj-helper-hidden-accessible").attr("href","#").focus(function(){o.css("position","static")}).blur(function(e){null!=e.relatedTarget&&o.css("position","")}).click(function(a){s=t.children().last(),h._handlePull(a,s,l),h._handleRelease(a,e,s,r)}),(n=a(document.createElement("div"))).addClass("oj-helper-hidden-accessible").attr("aria-live","polite"),t.append(o),t.append(n)},h._getTranslatedString=function(e){var t=o.getTranslatedString(e);if(t===e){var a="oj-ojRefresher."+e.split(".")[1];t=o.getTranslatedString(a)}return t},h._cleanup=function(e){a.removeData(e[0],"data-pullstart"),a.removeData(e[0],"data-pullstart-horiz"),a.removeData(e[0],"data-loading"),a.removeData(e[0],"data-closing"),e.find(".oj-pulltorefresh-icon").length>0&&e.empty()};const p=h.setupPullToRefresh,f=h.tearDownPullToRefresh;e.setupPullToRefresh=p,e.tearDownPullToRefresh=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ojpulltorefresh.js.map