/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojvalidation-base","ojs/ojlogger","ojs/ojeditablevalue","ojs/ojvalidation-number","ojs/ojbutton"],function(t,e,n,i){var s={properties:{asyncValidators:{type:"Array<Object>",value:[]},autocomplete:{type:"string",value:"on",extension:{_COPY_TO_INNER_ELEM:!0}},autofocus:{type:"boolean",value:!1,extension:{_COPY_TO_INNER_ELEM:!0}},converter:{type:"object",value:"oj.Validation.converterFactory(oj.ConverterFactory.CONVERTER_TYPE_NUMBER).createConverter()",properties:{type:{type:"string"},options:{type:"object"}}},describedBy:{type:"string"},disabled:{type:"boolean",value:!1},displayOptions:{type:"object",properties:{converterHint:{type:"Array<string>|string",value:["placeholder","notewindow"]},helpInstruction:{type:"Array<string>|string",value:["notewindow"]},messages:{type:"Array<string>|string",value:["inline"]},validatorHint:{type:"Array<string>|string",value:["notewindow"]}}},help:{type:"object",properties:{instruction:{type:"string"}}},helpHints:{type:"object",properties:{definition:{type:"string",value:""},source:{type:"string",value:""}}},labelHint:{type:"string",value:""},max:{type:"number"},messagesCustom:{type:"Array<Object>",writeback:!0,value:[]},min:{type:"number"},name:{type:"string",value:"",extension:{_COPY_TO_INNER_ELEM:!0}},placeholder:{type:"string",value:""},rawValue:{type:"string",writeback:!0,readOnly:!0},readonly:{type:"boolean",value:!1},required:{type:"boolean",value:!1},step:{type:"number",value:1},transientValue:{type:"number",writeback:!0,readOnly:!0},translations:{type:"object",value:{},properties:{numberRange:{type:"object",properties:{hint:{type:"object",properties:{exact:{type:"string"},inRange:{type:"string"},max:{type:"string"},min:{type:"string"}}},messageDetail:{type:"object",properties:{exact:{type:"string"},rangeOverflow:{type:"string"},rangeUnderflow:{type:"string"}}},messageSummary:{type:"object",properties:{rangeOverflow:{type:"string"},rangeUnderflow:{type:"string"}}}}},required:{type:"object",properties:{hint:{type:"string"},messageDetail:{type:"string"},messageSummary:{type:"string"}}},tooltipDecrement:{type:"string"},tooltipIncrement:{type:"string"}}},valid:{type:"string",writeback:!0,enumValues:["invalidHidden","invalidShown","pending","valid"],readOnly:!0},validators:{type:"Array<Object>",value:[]},value:{type:"number",writeback:!0},virtualKeyboard:{type:"string",enumValues:["auto","number","text"],value:"auto"}},methods:{refresh:{},stepDown:{},stepUp:{},validate:{},reset:{},showMessages:{},setProperty:{},getProperty:{},setProperties:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojAnimateStart:{},ojAnimateEnd:{}},extension:{}};t.__registerWidget("oj.ojInputNumber",e.oj.editableValue,{version:"1.0.0",defaultElement:"<input>",widgetEventPrefix:"oj",_ALLOWED_TYPES:["number","text"],options:{asyncValidators:[],autocomplete:void 0,autofocus:!1,converter:n.Validation.converterFactory(t.ConverterFactory.CONVERTER_TYPE_NUMBER).createConverter(),max:null,min:null,name:"",placeholder:"",rawValue:void 0,readOnly:!1,required:!1,step:1,transientValue:void 0,validators:[],value:null,virtualKeyboard:"auto"},getNodeBySubId:function(t){var e,n=this._superApply(arguments);return n||("oj-inputnumber-up"===(e=t.subId)&&(n=this.widget()[0].querySelector(".oj-inputnumber-up")),"oj-inputnumber-down"===e&&(n=this.widget()[0].querySelector(".oj-inputnumber-down")),"oj-inputnumber-input"===e&&(n=this.widget()[0].querySelector(".oj-inputnumber-input"))),n||null},getSubIdByNode:function(t){var e=null;return null!=t&&(t===this.widget()[0].querySelector(".oj-inputnumber-up")?e={subId:"oj-inputnumber-up"}:t===this.widget()[0].querySelector(".oj-inputnumber-down")?e={subId:"oj-inputnumber-down"}:t===this.widget()[0].querySelector(".oj-inputnumber-input")&&(e={subId:"oj-inputnumber-input"})),e||this._superApply(arguments)},refresh:function(){this._super(),this._setup()},stepDown:function(t){var e=this.options.step,n=(void 0!==t?t:1)*(e=null!=e?e:1)*-1;this._step(n)},stepUp:function(t){var e=this.options.step,n=(void 0!==t?t:1)*(e=null!=e?e:1);this._step(n)},widget:function(){return e(this.uiInputNumber)},_InitOptions:function(e,n){var i=this.options,s=this;if(this._superApply(arguments),this._IsCustomElement()||t.EditableValueUtils.initializeOptionsFromDom([{attribute:"disabled",validateOption:!0},{attribute:"placeholder"},{attribute:"value"},{attribute:"readonly",option:"readOnly",validateOption:!0},{attribute:"required",coerceDomValue:!0,validateOption:!0},{attribute:"title"},{attribute:"min"},{attribute:"max"},{attribute:"step"}],n,this,function(t){for(var e=["value","step","min","max"],n=0;n<e.length;n++){var r=e[n],a=r in t?t[r]:i[r];null!=a&&(t[r]="step"===r?s._parseStep(a):s._parse(r,a))}}),this._IsCustomElement()){var r=i.step;null!=r&&s._parseStep(r)}if(void 0===i.value)throw new Error("ojInputNumber has no value");if(this.initialValue=i.value,null!=i.min&&null!=i.max&&i.max<i.min)throw new Error("ojInputNumber's max must not be less than min")},_ComponentCreate:function(){this._super(),this._draw(),this._inputNumberDefaultValidators={},this._inputNumberDefaultAsyncValidators={},this._setup(),this._on(this._events),this._focusable(e(this.uiInputNumber))},_AfterCreate:function(){this._super(),this.option({transientValue:this.options.value},{_context:{writeback:!0,internalSet:!0,readOnly:!0}}),this._refreshAriaMinMax(),this.stepQueue=[],this._blurEnterSetValueCounter=0},_AfterSetOption:function(e,n,i){switch(this._superApply(arguments),e){case"min":case"max":this._Refresh(e,this.options[e]);break;case"readOnly":this._AfterSetOptionDisabledReadOnly(e,t.EditableValueUtils.readOnlyOptionOptions);break;case"required":this._AfterSetOptionRequired(e);break;case"validators":this._AfterSetOptionValidators(e);break;case"asyncValidators":this._AfterSetOptionAsyncValidators(e);break;case"converter":this._AfterSetOptionConverter(e);break;case"virtualKeyboard":this._SetInputType(this._ALLOWED_TYPES)}},_CanSetValue:function(){return!!this._super()&&!this.options.readOnly},_AfterSetOptionValue:function(t,e){this._superApply(arguments);var n,i,s=e?e._context:null;s&&(n=!!s.originalEvent,i=s.doNotClearMessages||!1),n||i||(this.initialValue=this.options.value)},_IsRequired:function(){return this.options.required},_AfterSetOptionRequired:t.EditableValueUtils._AfterSetOptionRequired,_AfterSetOptionValidators:t.EditableValueUtils._AfterSetOptionValidators,_AfterSetOptionAsyncValidators:t.EditableValueUtils._AfterSetOptionAsyncValidators,_AfterSetOptionConverter:t.EditableValueUtils._AfterSetOptionConverter,_ResetConverter:t.EditableValueUtils._ResetConverter,_ResetAllValidators:function(){this._inputNumberDefaultValidators={},this._inputNumberDefaultAsyncValidators={},this._superApply(arguments)},_GetConverter:function(){return this.options.converter?this._getConverter():e.oj.ojInputNumber.prototype.options.converter},_GetNormalizedValidatorsFromOption:t.EditableValueUtils._GetNormalizedValidatorsFromOption,_GetNormalizedAsyncValidatorsFromOption:t.EditableValueUtils._GetNormalizedAsyncValidatorsFromOption,_AriaRequiredUnsupported:function(){return!1},_setOption:function(t,e,n){var s;if(this._IsCustomElement()||"value"!==t&&"max"!==t&&"min"!==t)if("step"===t)s=this._parseStep(e);else{if("transientValue"===t)return void i.error(t+" option cannot be set");s=e}else s=this._parse(t,e);if(this._super(t,s,n),"value"===t&&this.option({transientValue:this.options.value},{_context:{writeback:!0,internalSet:!0,readOnly:!0}}),"max"!==t&&"min"!==t||this._AfterSetOptionValidators(),"disabled"===t&&(this.element[0].disabled=!!e),"readOnly"===t){var r=!!e;if(!r&&null==this.buttonSet){var a=this.options.value||0;this._createOjButtonset(),this._updateButtons(a)}this.element[0].readOnly=r,this._refreshStateTheming("readOnly",this.options.readOnly),this._refreshRoleSpinbutton("readOnly",this.options.readOnly)}},_destroy:function(){var n=this._super();return this.buttonSet&&(this.buttonSet.ojButtonset("destroy"),this.buttonSet.remove(),this.upButton=null,this.downButton=null,this.buttonSet=null),this.initialValue=null,t.DomUtils.unwrap(this.element,e(this.uiInputNumber)),clearTimeout(this.timer),n},validate:t.EditableValueUtils.validate,_Refresh:function(t,e,n){var i;switch(this._superApply(arguments),t){case"value":i=this.options.value||0,this._updateButtonsAria(i);break;case"disabled":i=this.options.value||0,this._updateButtons(i);break;case"max":case"min":this._refreshAriaMinMax(),i=this._getDisplayValueParsed(),this._updateButtons(i);break;case"converter":i=this.options.value,this._refreshAriaText(i);break;case"required":this._refreshRequired(e)}},_refreshRequired:t.EditableValueUtils._refreshRequired,_GetImplicitSyncValidators:function(){var i,s=this._superApply(arguments);if(null!=this.options.min||null!=this.options.max){i=this._createRangeValidatorOptions();var r=n.Validation.validatorFactory(t.ValidatorFactory.VALIDATOR_TYPE_NUMBERRANGE).createValidator(i);this._inputNumberDefaultValidators[t.ValidatorFactory.VALIDATOR_TYPE_NUMBERRANGE]=r}return e.extend(this._inputNumberDefaultValidators,s)},_GetImplicitAsyncValidators:function(){var t=this._superApply(arguments);return e.extend(this._inputNumberDefaultAsyncValidators,t)},_GetDefaultStyleClass:function(){return"oj-inputnumber"},_events:{compositionstart:function(){this._isComposing=!0},compositionend:function(t){this._isComposing=!1,this._SetRawValue(this.element.val(),t)},input:function(t){this._isComposing||this._SetRawValue(this.element.val(),t)},keydown:function(t){var n=e.ui.keyCode;t.keyCode===n.ENTER?(this._blurEnterSetValue(t),t.preventDefault()):this._start()&&this._keydown(t)&&t.preventDefault()},keyup:function(t){var n=e.ui.keyCode;switch(t.keyCode){case n.UP:case n.DOWN:default:this._stop(t)}},blur:function(t){this._blurEnterSetValue(t)},"touchstart .oj-inputnumber-button.oj-enabled":function(t){this._start(),this._repeat(null,t.currentTarget.classList.contains("oj-inputnumber-up")?1:-1,t)},"touchend .oj-inputnumber-button":function(t){this._stop(t)},"touchcancel .oj-inputnumber-button":function(t){this._stop(t)},"mousedown .oj-inputnumber-button.oj-enabled":function(t){this._isRealMouseEvent(t)&&(this._start(),this._repeat(null,t.currentTarget.classList.contains("oj-inputnumber-up")?1:-1,t))},"mouseup .oj-inputnumber-button":function(t){this._isRealMouseEvent(t)&&this._stop(t)},"mouseenter .oj-inputnumber-button.oj-enabled":function(t){t.currentTarget.classList.contains("oj-active")&&this._isRealMouseEvent(t)&&(this._start(),this._repeat(null,t.currentTarget.classList.contains("oj-inputnumber-up")?1:-1,t))},"mouseleave .oj-inputnumber-button":function(t){this._isRealMouseEvent(t)&&this._stop(t)}},_BUNDLE_KEY:{_TOOLTIP_DECREMENT:"tooltipDecrement",_TOOLTIP_INCREMENT:"tooltipIncrement"},_OPTION_TO_CSS_MAPPING:{readOnly:"oj-read-only"},_setup:function(){if(!0!==this.options.readOnly){var t=this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_INCREMENT),e=this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_DECREMENT);this.upButton.ojButton({label:t}),this.downButton.ojButton({label:e})}"boolean"==typeof this.options.readOnly&&(this.element[0].readOnly=this.options.readOnly),this._refreshStateTheming("readOnly",this.options.readOnly),this._refreshRoleSpinbutton("readOnly",this.options.readOnly),this._refreshRequired(this.options.required)},_markInternalComponents:function(){this.upButton[0].setAttribute("data-oj-internal",""),this.downButton[0].setAttribute("data-oj-internal",""),this.buttonSet[0].setAttribute("data-oj-internal","")},_createOjButtonset:function(){var t=this._createButtonset();this.inputNumberWrapper.appendChild(t.buttonSet);for(var n=this.uiInputNumber.querySelectorAll(".oj-inputnumber-button"),i=0,s=n?n.length:0;i<s;i++)n[i].setAttribute("tabIndex","-1");var r=t.upButton.parentNode;this.upButton=e(t.upButton).ojButton({display:"icons",label:this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_INCREMENT),icons:{start:"oj-component-icon oj-inputnumber-up-icon"}}),this.downButton=e(t.downButton).ojButton({display:"icons",label:this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_DECREMENT),icons:{start:"oj-component-icon oj-inputnumber-down-icon"}}),this.buttonSet=e(r).ojButtonset({focusManagement:"none"}),this._markInternalComponents()},_draw:function(){var e,n=this.element[0];n.classList.add("oj-inputnumber-input");var i=document.createElement("span");if(i.className="oj-inputnumber-wrapper",n.parentNode.insertBefore(i,n),i.appendChild(n),this.inputNumberWrapper=i,this.uiInputNumber=i,this.OuterWrapper)this.OuterWrapper.appendChild(i),this.uiInputNumber=this.OuterWrapper,this.uiInputNumber.classList.add("oj-inputnumber"),this.uiInputNumber.classList.add("oj-component");else{var s=document.createElement("div");s.className="oj-inputnumber oj-component",i.parentNode.insertBefore(s,i),s.appendChild(i),this.uiInputNumber=s}this._IsCustomElement()&&(e=this.widget()[0].getAttribute("id"))&&t.EditableValueUtils.setSubIdForCustomLabelFor(this._GetContentElement()[0],e),this.saveType=n.type,this._SetInputType(this._ALLOWED_TYPES),!0!==this.options.readOnly&&this._createOjButtonset()},_keydown:function(t){var n=e.ui.keyCode;switch(t.keyCode){case n.UP:return this._repeat(null,1,t),!0;case n.DOWN:return this._repeat(null,-1,t),!0;default:return!1}},_createButtonset:function(){var t=document.createElement("div");t.className="oj-buttonset-width-auto";var e=document.createElement("button");e.setAttribute("type","button"),e.className="oj-inputnumber-button oj-inputnumber-down",t.appendChild(e);var n=document.createElement("button");return n.setAttribute("type","button"),n.className="oj-inputnumber-button oj-inputnumber-up",t.appendChild(n),{buttonSet:t,downButton:e,upButton:n}},_start:function(){return this.spinning=!0,!0},_repeat:function(e,n,i,s){var r,a=!1,o=this,u=null!=this.options.step?this.options.step:1;n>0?this.upButton[0].classList.contains("oj-disabled")&&(a=!0):this.downButton[0].classList.contains("oj-disabled")&&(a=!0),e=e||500,clearTimeout(this.timer),this.timer=setTimeout(function(){a||o._repeat(40,n,i,!0)},e),s?(r=this.element[0],t.Context.getContext(r).getBusyContext().isReady()&&(this.stepQueue=[],this._spin(n*u,i,!0))):this._stepNoStartStop(n*u,i)},_spin:function(t,e,n){var i,s=this._GetDisplayValue()||0,r=this._ParseValueShowErrors(s);return void 0!==r?(i=this._adjustParsedValueOnSpinAndUpdateDisplay(r,t),this._valuePending=n,this._SetValue(i,e,{validationMode:this._VALIDATION_MODE.VALIDATORS_ONLY,targetOptions:n?["transientValue"]:["transientValue","value"]})):(this._updateButtonsAria(r),!1)},_adjustParsedValueOnSpinAndUpdateDisplay:function(t,e){var n,i,s=this.options,r=s.min,a=s.max,o=null!=s.step?s.step:1,u=this.initialValue;return n=this._precision(r,o,u),i=this._adjustValue(t,e,r,a,o,n,u),this._CanSetValue()&&void 0!==this._UpdateElementDisplayValue(i,!0)&&this._updateButtonsAria(i),i},_precision:function(t,e,n){var i=this._precisionOf(e);return null!=t&&(i=Math.max(i,this._precisionOf(t))),null!=n&&(i=Math.max(i,this._precisionOf(n))),i},_precisionOf:function(t){var e=t.toString(),n=e.indexOf(".");return-1===n?0:e.length-n-1},_adjustValue:function(t,e,n,s,r,a,o){var u,l,p;if(a>0)return this._adjustValueForFractions(t,e,n,s,r,a,o);null==(l=null!=n?n:o)&&(l=0);try{t=parseFloat(t.toFixed(a))}catch(e){e instanceof TypeError&&(i.warn("inputNumber's value after conversion is not a number. \nThe converter must convert the value to a Number. coercing using +"),t=+t)}p=t-l;var h=Math.round(p/r)*r;if(u=(h=parseFloat(h.toFixed(a)))===p?t+e:l+(p=e<0?Math.ceil(p/r)*r:Math.floor(p/r)*r)+e,u=parseFloat(u.toFixed(a)),null!=n&&u<n)return n;if(null!=s&&u>s){var d=Math.floor((s-l)/r)*r+l;return d=parseFloat(d.toFixed(a))}return u},_adjustValueForFractions:function(e,n,i,s,r,a,o){t.Assert.assert(a>0);var u=Math.pow(10,a),l=null!=i?Math.round(i*u):i,p=null!=s?Math.round(s*u):s,h=null!=r?Math.round(r*u):r;return this._adjustValue(Math.round(e*u),Math.round(n*u),l,p,h,0,Math.round(o*u))/u},_stop:function(t){if(this.spinning){if(this._valuePending){var e={originalEvent:t,internalSet:!0};this.option({value:this.options.transientValue},{_context:e}),this._valuePending=!1}clearTimeout(this.timer),this.spinning=!1}},_isRealMouseEvent:function(){return!t.DomUtils.recentTouchEnd()},_updateButtons:function(t){var e,n,i=this.options,s=i.max,r=i.min,a=this.downButton,o=this.upButton,u=null!=s,l=null!=r;this.uiInputNumber&&(a||o)&&(e=a[0].classList.contains("oj-disabled"),n=o[0].classList.contains("oj-disabled"),i.disabled||void 0===t||u&&l&&s===r&&t===s?(e||a.ojButton("disable"),n||o.ojButton("disable")):u&&t>=s?(e&&a.ojButton("enable"),n||o.ojButton("disable")):l&&t<=r?(e||a.ojButton("disable"),n&&o.ojButton("enable")):(e&&a.ojButton("enable"),n&&o.ojButton("enable")))},_getConverter:t.EditableValueUtils._GetConverter,_getDisplayValueParsed:function(){var t,e;try{e=this._GetDisplayValue()||0,t=this._parseValue(e)}catch(e){t=void 0}return t},_blurEnterSetValue:function(t){var e,n,i,s=this.element.val(),r=this;this._stop(t),this.stepQueue=[],this._blurEnterSetValueCounter+=1,i=this._blurEnterSetValueCounter,this._valuePending=!1,(n=this._SetValue(s,t,{targetOptions:["transientValue","value"]}))instanceof Promise?n.then(function(t){i===r._blurEnterSetValueCounter&&(t||(e=r._getDisplayValueParsed(),r._updateButtonsAria(e)))}):(e=n?this.options.value:this._getDisplayValueParsed(),this._updateButtonsAria(e))},_updateButtonsAria:function(t){this._refreshAriaValueNowText(t),this._updateButtons(t)},_createRangeValidatorOptions:function(){var t,e,n,i,s,r,a,o,u,l=this.options,p=l.min,h=l.max,d=null!=p?p:void 0,_=null!=h?h:void 0,c=l.translations,m=c&&c.numberRange||{},b=m.hint||{},v=m.messageDetail||{},y=m.messageSummary||{};return null!==b&&(t=b.min||null,e=b.max||null,n=b.inRange||null,i=b.exact||null),null!==v&&(s=v.rangeOverflow||null,r=v.rangeUnderflow||null,a=v.exact||null),null!==y&&(o=y.rangeOverflow||null,u=y.rangeUnderflow||null),{min:d,max:_,hint:{min:t||null,max:e||null,inRange:n||null,exact:i||null},messageDetail:{rangeOverflow:s||null,rangeUnderflow:r||null,exact:a||null},messageSummary:{rangeOverflow:o||null,rangeUnderflow:u||null},converter:this._GetConverter()}},_parse:function(t,e){var n;if(n=null!==e?+e:e,isNaN(n))throw new Error("ojInputNumber's "+t+" option is not a number");return n},_parseStep:function(t){var e;if(null===t)return 1;if((e=this._parse("step",t))<=0)throw new Error("Invalid step for ojInputNumber; step must be > 0");return(null===e||e<=0)&&(e=1),e},_refreshStateTheming:function(t,e){-1!==Object.keys(this._OPTION_TO_CSS_MAPPING).indexOf(t)&&(e?this.widget()[0].classList.add(this._OPTION_TO_CSS_MAPPING[t]):this.widget()[0].classList.remove(this._OPTION_TO_CSS_MAPPING[t]))},_refreshRoleSpinbutton:function(t,e){e?this.element[0].removeAttribute("role"):this.element[0].setAttribute("role","spinbutton")},_refreshAriaMinMax:function(){this._setAttr("aria-valuemin",this.options.min),this._setAttr("aria-valuemax",this.options.max)},_refreshAriaValueNowText:function(t){this._setAttr("aria-valuenow",t),this._refreshAriaText(t)},_refreshAriaText:function(t){var e=this.element.val();""===e||this._CompareOptionValues("value",""+t,e)?this._setAttr("aria-valuetext",null):this._setAttr("aria-valuetext",e)},_setAttr:function(t,e){void 0!==e&&(null===e?this.element[0].removeAttribute(t):this.element[0].setAttribute(t,e))},_stepNoStartStop:function(t,e){var n,i,s,r,a=this;if(void 0===t){if(0===this.stepQueue.length)return;i=(n=this.stepQueue.shift()).step,s=n.event}else{if(this.stepQueue.length>=1)return void this.stepQueue.push({step:t,event:e});i=t,s=e}(r=this._spin(i,s,!1))instanceof Promise&&(this.stepQueue.push({step:i,event:s}),r.then(function(){a.stepQueue.shift(),a._stepNoStartStop(void 0,s)}))},_step:function(t,e){this._start(),this._stepNoStartStop(t,e),this._stop(e)},_SetInputType:t.EditableValueUtils._SetInputType}),s.extension._WIDGET_NAME="ojInputNumber",s.extension._ALIASED_PROPS={readonly:"readOnly"},s.extension._INNER_ELEM="input",s.extension._GLOBAL_TRANSFER_ATTRS=["accesskey","aria-label","tabindex"],t.CustomElementBridge.register("oj-input-number",{metadata:s})});