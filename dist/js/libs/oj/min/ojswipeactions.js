/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojswipetoreveal","ojs/ojoption"],function(e,t){e.__registerWidget("oj.ojSwipeActions",t.oj.baseComponent,{version:"1.0.0",defaultElement:"<div>",widgetEventPrefix:"oj",options:{action:null},_ComponentCreate:function(){var e,n,s,i=this,o=!1,a=!1,c=!1;this._super(),this.element.uniqueId(),this.element[0].classList.add("oj-swipeactions","oj-component"),this.element[0].setAttribute("tabIndex","-1"),this._on(!0,{touchstart:function(e){null!=(s=i.element[0].querySelector(".oj-offcanvas-open"))&&s.offsetWidth>0&&e.preventDefault(),o=!0},touchend:function(e){o&&i._handleAction(e),o=!1},keydown:function(e){27===e.keyCode?(s=e.target.parentNode.parentNode).classList.contains("oj-offcanvas-open")&&(i._close({selector:s,_animate:!1}),e.preventDefault()):13===e.keyCode&&e.target.classList.contains("oj-swipeactions-action-panel")&&(a=!0)},keyup:function(e){13===e.keyCode&&a&&i._handleAction(e),a=!1},ojdefaultaction:function(n,s){(e=t(s.selector).children("oj-option.oj-swipetoreveal-default")).length>0&&(i._fireActionEvent(e[0],null),c=!0)},ojopen:function(e,t){c&&i._close(t),c=!1},ojclose:function(e,s){(n=t(s.selector).children(".oj-swipeactions-hide-actions-link")).length>0&&n[0].parentNode.removeChild(n[0])}}),this._focusable({applyHighlight:!0,setupHandlers:function(e,t){i._focusInHandler=e,i._focusOutHandler=t}}),this._setup()},_close:function(t){var n,s;n=e.Context.getContext(this.element[0]).getBusyContext(),s=n.addBusyState({description:"closing offcanvas"}),e.OffcanvasUtils.close(t).then(function(){s()})},_handleAction:function(e){var n=t(e.target).parents("oj-option");n.length>0&&(this._fireActionEvent(n[0],e),this._close({selector:n[0].parentNode}))},_SetupResources:function(){this._super(),this._setupOrReleaseOffcanvas(e.SwipeToRevealUtils.tearDownSwipeActions),this._setupOrReleaseOffcanvas(e.SwipeToRevealUtils.setupSwipeActions)},_ReleaseResources:function(){this._super(),this._setupOrReleaseOffcanvas(e.SwipeToRevealUtils.tearDownSwipeActions)},_setupOrReleaseOffcanvas:function(e){this._applyOffcanvas("oj-offcanvas-start",e),this._applyOffcanvas("oj-offcanvas-end",e)},_closeAllOffcanvas:function(){var e,t=this;e=function(e){t._close({selector:e})},this._applyOffcanvas("oj-offcanvas-start",e),this._applyOffcanvas("oj-offcanvas-end",e)},_applyOffcanvas:function(e,t){var n=this.element[0].querySelector("."+e);n&&t(n)},_fireActionEvent:function(n,s){var i,o;i={},s&&(i.originalEvent=s instanceof t.Event?s.originalEvent:s),(o={detail:i}).cancelable=!0,o.bubbles=!0,e.DomUtils.dispatchEvent(n,new CustomEvent("ojAction",o))},refresh:function(){this._super(),this._setupOrReleaseOffcanvas(e.SwipeToRevealUtils.tearDownSwipeActions),this._setup(),this._setupOrReleaseOffcanvas(e.SwipeToRevealUtils.setupSwipeActions)},_createOffcanvas:function(e,t){var n,s=e[t];s&&s.length>0&&"TEMPLATE"===s[0].tagName&&((n=document.createElement("div")).className="start"===t?"oj-offcanvas-start":"oj-offcanvas-end",this.element[0].appendChild(n),this._renderAccessibleLink(n))},_setup:function(){var n,s,i=this;this.element[0].classList.add("oj-offcanvas-inner-wrapper"),this.element[0].parentNode.classList.add("oj-offcanvas-outer-wrapper"),(s=(n=e.BaseCustomElementBridge.getSlotMap(this.element[0]))[""])&&s.length>0&&s[0].classList.add("oj-swipeactions-content"),this._createOffcanvas(n,"start"),this._createOffcanvas(n,"end"),t(this.element).on("ojpanstart",function(e,t){e.isDefaultPrevented()||i._renderOffcanvas(e.target)})},_renderOffcanvas:function(t,n){var s,i,o,a,c=this;t.setAttribute("role","toolbar"),t.setAttribute("data-oj-context",""),s=e.BaseCustomElementBridge.getSlotMap(this.element[0]),i=t.classList.contains("oj-offcanvas-start")?s.start[0]:s.end[0],o=e.Context.getContext(c.element[0]).getBusyContext(),a=o.addBusyState({description:"rendering ojoptions"}),e.Config.__getTemplateEngine().then(function(s){c._render(s,t,i),n?(o=e.Context.getContext(t).getBusyContext()).whenReady().then(function(){n(),a()}):a()},function(e){throw a(),"Error loading template engine: "+e})},_showAccessibleLinks:function(){var e,t,n=0;for(e=this.element[0].querySelectorAll("a.oj-helper-hidden-accessible"),t=0;t<e.length;t++)e[t].style.left=n+"px",e[t].className="oj-swipeactions-accessible-link",n=n+e[t].offsetWidth+5},_hideAccessibleLinks:function(){var e,t;for(e=this.element[0].querySelectorAll("a.oj-swipeactions-accessible-link"),t=0;t<e.length;t++)e[t].className="oj-helper-hidden-accessible"},_isIE11:function(){var t=e.AgentUtils.getAgentInfo();return"ie"===t.browser&&11===t.browserVersion},_renderAccessibleLink:function(n){var s,i,o,a,c,l,r,f=!1,d=this;(s=document.createElement("a")).setAttribute("tabIndex","0"),s.setAttribute("href","#"),s.textContent=this.getTranslatedString(n.classList.contains("oj-offcanvas-start")?"ariaShowStartActionsDescription":"ariaShowEndActionsDescription"),(i=e.AgentUtils.getAgentInfo().os===e.AgentUtils.OS.ANDROID)?(s.style.color="transparent",s.className="oj-swipeactions-accessible-link",n.classList.contains("oj-offcanvas-end")&&null!=(o=this.element[0].querySelector("a.oj-swipeactions-accessible-link"))&&(s.style.marginLeft=o.offsetWidth+5+"px"),s.addEventListener("touchstart",function(e){f=e.touches[0].force>0})):s.className="oj-helper-hidden-accessible",s.addEventListener("focus",function(){i||d._showAccessibleLinks(),d._closeAllOffcanvas()}),s.addEventListener("blur",function(e){null==e.relatedTarget||e.relatedTarget.classList.contains("oj-swipeactions-accessible-link")?null==e.relatedTarget&&d._isIE11()&&setTimeout(function(){document.activeElement.classList.contains("oj-swipeactions-accessible-link")||d._hideAccessibleLinks()},0):setTimeout(function(){i||d._hideAccessibleLinks()},0)}),s.addEventListener("click",function(s){f||(s.stopPropagation(),d._renderOffcanvas(n,function(){t(n).children("oj-option").addClass("oj-swipetoreveal-action").children().attr("tabIndex",0),(a={}).selector=n,a.autoDismiss="none",a._animate=!1,(c=document.createElement("a")).className="oj-swipeactions-hide-actions-link",c.setAttribute("tabIndex","0"),c.setAttribute("href","#"),c.setAttribute("aria-label",d.getTranslatedString("ariaHideActionsDescription")),c.addEventListener("click",function(e){d._close(a)}),i&&c.addEventListener("touchend",function(e){d._close(a)}),l=e.Context.getContext(d.element[0]).getBusyContext(),r=l.addBusyState({description:"opening offcanvas"}),e.OffcanvasUtils.open(a).then(function(){n.appendChild(c),r()})}))}),this.element[0].appendChild(s)},_render:function(e,n,s){var i,o=this;t(n).children("oj-option").remove(),i=[],e.execute(this.element[0],s,null).forEach(function(e){"OJ-OPTION"===e.tagName&&i.push(e)}),i.forEach(function(e){e.customOptionRenderer=o._customOptionRenderer.bind(o),n.appendChild(e)})},_customOptionRenderer:function(n){var s,i,o,a,c,l,r,f=this;t(n).children("div").length>0||(n.setAttribute("role","button"),n.classList.contains("oj-swipeactions-default")&&n.classList.add("oj-swipetoreveal-default"),(s=document.createElement("div")).className="oj-flex-bar oj-swipeactions-action-panel",s.addEventListener("focus",function(e){f._focusInHandler(t(s))}),s.addEventListener("blur",function(e){f._focusOutHandler(t(s))}),(i=document.createElement("div")).className="oj-flex-bar-center-absolute",s.appendChild(i),(o=document.createElement("div")).className="oj-flex oj-sm-flex-direction-column",i.appendChild(o),(c=(a=e.BaseCustomElementBridge.getSlotMap(n)).startIcon)&&c.forEach(function(e){o.appendChild(e)}),(l=document.createElement("div")).className="oj-flex-item oj-swipeactions-action-text",o.appendChild(l),(r=a[""])&&r.forEach(function(e){l.appendChild(e)}),t(n).prepend(s))}}),e.CustomElementBridge.registerMetadata("oj-swipe-actions","baseComponent",{properties:{},events:{action:{}},extension:{_WIDGET_NAME:"ojSwipeActions"}}),e.CustomElementBridge.register("oj-swipe-actions",{metadata:e.CustomElementBridge.getMetadata("oj-swipe-actions")})});