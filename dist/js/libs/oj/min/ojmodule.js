/**
 * @license
 * Copyright (c) 2014, 2024, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore-base","knockout","ojs/ojlogger","ojs/ojcontext","ojs/ojcustomelement-utils"],function(e,n,t,o,i){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;const l={};return e._registerLegacyNamespaceProp("ModuleBinding",l),l.defaults={viewPath:"text!views/",viewSuffix:".html",modelPath:"viewModels/",initializeMethod:"initialize",disposeMethod:"dispose",activatedHandler:"handleActivated",attachedHandler:"handleAttached",detachedHandler:"handleDetached",bindingsAppliedHandler:"handleBindingsApplied",deactivatedHandler:"handleDeactivated",transitionCompletedHandler:"handleTransitionCompleted"},l._EMPTY_MODULE="oj:blank",function(){function r(e,t,o){var i=t||e,l=[];o&&e===i&&(o.parentNode.removeChild(o),l.push(o)),n.virtualElements.setDomNodeChildren(i,l)}function a(e,n){e.forEach(function(e){n.appendChild(e)})}function d(e,t){for(var o,i=0;i<e.length&&!(o=n.contextFor(e[i]));i++);return o&&o.$module&&o.$module===t}function u(e,n,t){var o={};t[0]&&(o.viewModel=t[0]),t[1]&&(o.view=t[1]);var i=new CustomEvent(n,{detail:o});e.dispatchEvent(i)}function s(e,t,o){if(e&&e[t]){var i={element:o[0],valueAccessor:o[1]};return o.length>2&&(i.viewModel=o[2],o.length>3&&(i["boolean"==typeof o[3]?"fromCache":"cachedNodes"]=o[3])),n.ignoreDependencies(e[t],e,[i])}}function c(e,t,o){if(null!=e){var i=l.defaults[t];if(null!=i&&e){var r,a=e[i];if("function"==typeof a)return o&&(r={element:o[0],valueAccessor:o[1]},o.length>2&&(r["boolean"==typeof o[2]?"fromCache":"cachedNodes"]=o[2])),n.ignoreDependencies(a,e,[r])}}}function f(e,t,o){if(e&&t){var i=e[t];"function"==typeof i&&n.ignoreDependencies(i,e,[o])}}function v(e,t,o){for(var i=e;null!=i;){var l=n.virtualElements.nextSibling(i),r=i.nodeType;i===t||1!==r&&8!==r||o(i),i=l}}function p(e,t){for(var o=t.length-1;o>=0;o--)n.virtualElements.prepend(e,t[o])}function h(e,n){if(n)for(var t=0;t<e.length;t++){var o=e[t];1===o.nodeType&&n(o)}}function m(e,n,o){var i=e||require,l=new Promise(function(e,n){i([o],e,n)});return l=l.catch(function(e){throw t.error("ojModule failed to load "+o),e})}n.bindingHandlers.ojModule={init:function(w,g,b,y,C){var E,M,j,P,N,V,D,A,H={},O=-1,$=w.parentNode&&"OJ-MODULE"===w.parentNode.nodeName,T=$?function(){}:c,_=$?function(){}:s,x=$?f:function(){},F=$?u:function(){};function S(){V&&(V(),V=null)}var B=function(e){T(e,"disposeMethod",[w,g])},L=function(){B(E)};n.utils.domNodeDisposal.addDisposeCallback(w,function(){L();for(var e=Object.keys(H),n=0;n<e.length;n++){var t=H[e[n]].model;B(t)}S()});var k=new Error("Promise cancelled because ojModule is fetching new View and ViewModel"),U=function(e){if(e!==O)throw k},q=w;return 8===w.nodeType&&(q=w.parentNode,n.virtualElements.setDomNodeChildren(w,[]),N=w.nextSibling),n.computed(function(){if(O+=1,!V){var u=o.getContext(q).getBusyContext();V=u.addBusyState({description:"ojModule binding on a node with the Id "+w.id+"is loading the module. Binding evaluator: "+g.toString()})}var s,c,f,b,y,B,I,z,J,Y,K,R,W,G,Q=0===O,X=n.utils.unwrapObservable,Z=X(g());"string"==typeof Z?s=Z:(s=X(Z.name),c=X(Z.viewName),f=X(Z.params),b=X(Z.viewModelFactory),y=X(Z.createViewFunction),B=X(Z.cacheKey),I=X(Z.lifecycleListener),z=X(Z.animation),R=X(Z.view),W=X(Z.viewModel),J=X(Z.require),G=X(Z.cleanupMode)),null==J||J instanceof Function||(K=J.viewPath,Y=J.modelPath,J=J.instance),c=null==c?s:c;var ee,ne,te,oe,ie=l._EMPTY_MODULE===c,le=_(I,"activated",[w,g]);if(F(q,"ojTransitionStart",[W]),ie?(ee=Promise.resolve([]),ne=Promise.resolve(null)):null!=(te=null==B?null:H[B])&&(delete H[B],ee=Promise.resolve(te.view),ne=Promise.resolve(te.model)),null==ee&&null!=R&&(ee=Promise.resolve(R)),null==ne&&(null!=W?ne=Promise.resolve(W):null!=b&&(ne=n.ignoreDependencies(b.createViewModel,b,[f,g])),null==ne&&null!=s&&(null==Y&&(Y=l.defaults.modelPath),ne=m(J,"viewModel",Y+s)),null!=ne&&(ne=ne.then(function(e,n){return U(e),n="function"==typeof n?new n(f):T(n,"initializeMethod",[w,g])||n}.bind(null,O)),null==ee&&null!=y&&(ee=ne.then(function(e,n){if(U(e),null==n)throw S(),new Error("createViewFunction option cannot be used when the ViewModel is null");var t=n[y];if(null==t)throw S(),new Error("function specified by the createViewFunction option was not found on the ViewModel");return t.call(n)}.bind(null,O)))),null==ee)){if(null==c)throw S(),new Error("View name or view instance must be specified");null==K&&(K=l.defaults.viewPath),ee=m(J,"view",K+c+l.defaults.viewSuffix)}if(null==ee)throw S(),new Error("ojModule is missing a View");null!=ne&&(oe=ne.then(function(e,n){return U(e),T(n,"activatedHandler",[w,g])}.bind(null,O))),Promise.all([ee,ne,le,oe,M]).then(function(o,l){if(o===O){var u=l[0];if(null==u)throw S(),new Error("The module's View was resolved to null");var s=function(e,t){var o=e;if("string"==typeof o)o=n.utils.parseHtmlFragment(o,document);else if(function(e){if(window.DocumentFragment)return e instanceof DocumentFragment;return e&&11===e.nodeType}(o))o=n.utils.arrayPushAll([],o.childNodes);else{if(!Array.isArray(o))throw t(),new Error("The View ("+o+") has an unsupported type");o=n.utils.arrayPushAll([],o)}return o}(u,S),c=l[1];!function(e,n,t,o,i){if(o&&n.length>0&&!d(n,t)){if(n[0]._oj_module_used_view)throw i(),new Error("The oj-module with id '"+e.id+"' cannot apply binding on a previously cleaned view.");Object.defineProperty(n[0],"_oj_module_used_view",{value:!0})}}(w,s,c,$,S);var m,b=!1,y=function(e,t,o){for(var i=[],l=n.virtualElements.firstChild(e);null!=l&&l!==o;l=l.nextSibling)l!==t&&i.push(l);return i}(w,P,N),V=function(e,t){const o=[],i=n.virtualElements.childNodes(e);for(let e=0;e<i.length;e++){const n=i[e];if(n!==t){const e=n.nodeType;1!==e&&8!==e||o.push(n)}}return o}(w,P);null==j||D?$&&(m=y):(b=!0,m=y,P||((P=document.createElement("div")).className="oj-helper-module-cache",n.virtualElements.prepend(w,P)));var k=!1,U=function(t){if(!k){if(k=!0,b)a(y,P),r(w,t||w,P);else if($&&"none"===A)for(var o=0;o<m.length;o++){var l=m[o];l.parentNode.removeChild(l)}else V.forEach(function(e){n.cleanNode(e)}),r(w,t||w,P);Q||(_(I,"detached",[w,g,E,m]),T(E,"detachedHandler",[w,g,m]),x(E,"disconnected",m),F(q,"ojViewDisconnected",[E,m]),_(I,"deactivated",[w,g,E]),T(E,"deactivatedHandler",[w,g])),b?(h(m,i.CustomElementUtils.subtreeHidden),H[j]={model:E,view:m}):$&&"none"===A?h(m,e.Components?e.Components.subtreeDetached:null):L(),E=c,j=B,D=ie,A=G}},J=function(){_(I,"transitionCompleted",[w,g,c]),T(c,"transitionCompletedHandler",[w,g]),x(c,"transitionCompleted",s),F(q,"ojTransitionEnd",[c]),S()};if(null!=z){var Y=function(e,n,t,o,i,l){return{node:l?e.parentNode:e,valueAccessor:l?null:n,isInitial:t,oldViewModel:o,newViewModel:i}}(w,g,Q,E,c,$),K=function(o,i,l,r,d,u,s){var c,f,v=o,m=i.canAnimate,w=null==m||m.call(i,v);if(!w)return;var g=i.prepareAnimation.call(i,v);g&&(c=g.newViewParent,f=g.oldViewParent);var b=c||l;f&&f!==l?a(r,f):b===l&&u(null);b!==l&&n.virtualElements.setDomNodeChildren(b,[]);d(b);var y=Array.prototype.slice.call(b.childNodes),C=!1,E=function(){if(!C&&(C=!0,l!==b)){p(l,y);var n=l.parentNode&&"OJ-MODULE"===l.parentNode.nodeName;e.Components&&!n&&(h(y,e.Components.subtreeDetached),h(y,e.Components.subtreeAttached))}},M=u.bind(null,f);v.newViewParent=c,v.oldViewParent=f,v.oldViewNodes=r,v.removeOldView=M,v.insertNewView=E;var j=function(){M(),E(),s()},P=i.animate.call(i,v).then(j,function(){j(),t.error("ojModule animation promise was rejected")});return P}(Y,z,w,y,R,U,J);M=function(e){if(!e)return e;var n=new Promise(function(n,t){e.then(n,n)});return n}(K)}else M=void 0;M||(U(null),R(null),J())}function R(t){var o=t||w,i=$&&d(s,c);p(o,s);var l=null!=te;if(l?h(s,e.Components?e.Components.subtreeShown:null):i&&h(s,e.Components?e.Components.subtreeAttached:null),_(I,"attached",[o,g,c,l]),T(c,"attachedHandler",[o,g,l]),x(c,"connected",s),F(q,"ojViewConnected",[c]),!l&&!i){var r=C.createChildContext(c,void 0,function(e){e.$module=c,e.$params=f});$&&(r.$parent=void 0,r.$parents=void 0,r.$parentContext=void 0,r.$props=void 0,r.$properties=void 0,r.$slotNodeCounts=void 0,r.$slotCounts=void 0,r.$unique=void 0,r.$uniqueId=void 0,r.$provided=void 0),function(e,t,o,i){var l=n.bindingProvider.instance,r=l.preprocessNode;r&&(v(t,i,function(e){r.call(l,e)}),t=n.virtualElements.firstChild(e));v(t,i,function(e){n.applyBindings(o,e)})}(o,s[0],r,P),_(I,"bindingsApplied",[o,g,c]),T(c,"bindingsAppliedHandler",[o,g])}}}.bind(null,O),function(e,n){n!==k&&null!=n&&(S(),t.error(n))}.bind(null,O))},null,{disposeWhenNodeIsRemoved:w}),{controlsDescendantBindings:!0}}},n.virtualElements.allowedBindings.ojModule=!0}(),l});
//# sourceMappingURL=ojmodule.js.map