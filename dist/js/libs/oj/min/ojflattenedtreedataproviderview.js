/**
 * @license
 * Copyright (c) 2014, 2023, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore-base","ojs/ojset","ojs/ojeventtarget","ojs/ojobservable","ojs/ojmap","ojs/ojdataprovider","ojs/ojkeyset"],function(t,e,s,a,i,r,n){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;
/**
     * @preserve Copyright 2013 jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     */
var h=function(t,e,s,a){return new(s||(s=Promise))(function(i,r){function n(t){try{o(a.next(t))}catch(t){r(t)}}function h(t){try{o(a.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(n,h)}o((a=a.apply(t,e||[])).next())})};class o{constructor(t,e){var s;this.dataProvider=t,this.options=e,this.AsyncIterable=(s=class{constructor(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=()=>this._asyncIterator,this._clientId=Symbol(),this._parent._mapClientIdToIteratorInfo.set(this._clientId,0)}},Symbol.asyncIterator,s),this.AsyncIterator=class{constructor(t,e,s){this._parent=t,this._nextFunc=e,this._params=s}next(){return this._nextFunc(this._params)}},this.AsyncIteratorYieldResult=class{constructor(t,e){this._parent=t,this.value=e,this.value=e,this.done=!1}},this.AsyncIteratorReturnResult=class{constructor(t,e){this._parent=t,this.value=e,this.value=e,this.done=!0}},this.Item=class{constructor(t,e,s){this._parent=t,this.metadata=e,this.data=s,this.metadata=e,this.data=s}},this.FlattenedTreeItemMetadata=class{constructor(t,e,s,a,i,r){this._parent=t,this.key=e,this.parentKey=s,this.indexFromParent=a,this.treeDepth=i,this.isLeaf=r,this.key=e,this.parentKey=s,this.indexFromParent=a,this.treeDepth=i,this.isLeaf=r}},this.FetchListResult=class{constructor(t,e,s,a){this._parent=t,this.fetchParameters=e,this.data=s,this.metadata=a,this.fetchParameters=e,this.data=s,this.metadata=a}},this.FetchByOffsetParameters=class{constructor(t,e,s,a,i,r){this._parent=t,this.offset=e,this.size=s,this.sortCriteria=a,this.filterCriterion=i,this.attributes=r,this.offset=e,this.size=s,this.sortCriteria=a,this.filterCriterion=i,this.attributes=r}},this.FetchByOffsetResults=class{constructor(t,e,s,a){this._parent=t,this.fetchParameters=e,this.results=s,this.done=a,this.fetchParameters=e,this.results=s,this.done=a}},this.FetchByKeysResults=class{constructor(t,e,s){this._parent=t,this.fetchParameters=e,this.results=s,this.fetchParameters=e,this.results=s}},this.DataProviderMutationEventDetail=class{constructor(t,e,s,a){this._parent=t,this.add=e,this.remove=s,this.update=a,this.add=e,this.remove=s,this.update=a}},this.DataProviderRefreshEventDetail=class{constructor(t){this.disregardAfterKey=t,this.disregardAfterKey=t}},this.DataProviderOperationEventDetail=class{constructor(t,e,s,a,i,r){this._parent=t,this.keys=e,this.metadata=s,this.data=a,this.indexes=i,this.transient=r,this.keys=e,this.metadata=s,this.data=a,this.indexes=i,this.transient=r}},this.DataProviderAddOperationEventDetail=class{constructor(t,e,s,a,i,r,n){this._parent=t,this.keys=e,this.afterKeys=s,this.addBeforeKeys=a,this.metadata=i,this.data=r,this.indexes=n,this.keys=e,this.afterKeys=s,this.addBeforeKeys=a,this.metadata=i,this.data=r,this.indexes=n}},null==this.options&&(this.options={}),this.options.expanded||(this.options.expanded=new n.KeySetImpl([])),this._expandedObservable=new a.BehaviorSubject(this._getExpandedObservableValue(this.options.expanded,Promise.resolve())),this.dataProvider.addEventListener("mutate",this._handleUnderlyingMutation.bind(this)),this.dataProvider.addEventListener("refresh",this._handleUnderlyingRefresh.bind(this)),this._cache=[],this._mapClientIdToIteratorInfo=new Map,this._mapParentKeyToInfo=new i,this._done=!1}_getChildrenFromCacheByParentKey(t){return this._cache.filter(e=>e.metadata.parentKey===t)}_calculateItemIndex(t,e,s){var a,i;let n;if(this._currentSortCriteria){const a=this._getChildrenFromCacheByParentKey(t),i=r.SortUtils.getNaturalSortCriteriaComparator(this._currentSortCriteria),h=a[a.length-1];if(a.length>0)if(i(h.data,e.data[s])>=0){for(let t=0;t<a.length;t++)if(i(e.data[s],a[t].data)<0){n=this._getItemIndexByKey(a[t].metadata.key)-1;break}}else n=this._getItemIndexByKey(h.metadata.key)+this._getLocalDescendentCount(h.metadata.key)+1;else n=this._getItemIndexByKey(t)}else if((null===(a=null==e?void 0:e.addBeforeKeys)||void 0===a?void 0:a.length)>0)if(null===t){if(null!==e.addBeforeKeys[s]){n=this._getItemIndexByKey(e.addBeforeKeys[s])-1}else n=this._cache.length}else{n=this._getItemIndexByKey(t)+this._getLocalDescendentCount(t),n===this._cache.length-1&&(n+=1)}else if((null===(i=null==e?void 0:e.indexes)||void 0===i?void 0:i.length)>0){const a=this._getItemIndexByKey(t);n=-1===a?e.indexes[s]+1:a+this._getLocalDescendentCount(t)+1}else n=this._getItemIndexByKey(this._getLastItemByParentKey(t).metadata.key)+1;return n}_incrementIndexFromParent(t,e){const s=this._getLastIndex();for(let a=t;a<=s;a++){let t=this._getEntry(a);if(null!=t){const s=t.metadata.treeDepth;if(s===e)t.metadata.indexFromParent+=1;else if(s<e)return}}}_decrementIndexFromParent(t,e){const s=this._getLastIndex();for(let a=t;a<=s;a++){let t=this._getEntry(a);if(null!=t){const s=t.metadata.treeDepth;if(s===e)t.metadata.indexFromParent-=1;else if(s<e)return}}}_handleUnderlyingMutation(t){let e=null,s=null,a=null;const i=t.detail.add;if(i&&i.data&&i.data.length){const t=[],s=[],a=[],r=[],n=[],h=new Set,o=new Set;i.parentKeys.forEach((e,h)=>{if((null===e||this._isExpanded(e)&&this._getItemByKey(e))&&(!this._currentFilterCriteria||this._currentFilterCriteria&&this._currentFilterCriteria.filter(i.data[h]))){let d=this._calculateItemIndex(e,i,h);const c=this._updateItemMetadata(new this.Item(this,i.metadata[h],i.data[h]),e,i.indexes[h]);this._spliceItemToCache(c,d),this._incrementIndexFromParent(d+1,c.metadata.treeDepth),s.push(c.data),t.push(c.metadata),a.push(d+1),n.push(e),o.add(i.metadata[h].key),r.push(this._getKeyByIndex(d+2)),this._incrementIteratorOffset(d+1)}else this._mapParentKeyToInfo.delete(e)}),o.size>0&&(e=new this.DataProviderAddOperationEventDetail(this,o,h,r,t,s,a))}const n=t.detail.remove;if(n&&n.data&&n.data.length){const t=n.metadata.map(t=>t.key),e=[],a=[],i=[],r=new Set;t.forEach((t,s)=>{const n=this._getItemIndexByKey(t);if(-1!=n){const s=this._getLocalDescendentCount(t)+1;this._decrementIndexFromParent(n,this._cache[n].metadata.treeDepth);this._cache.splice(n,s).forEach((t,s)=>{r.add(t.metadata.key),e.push(t.metadata),a.push(t.data),i.push(n+s),this._decrementIteratorOffset(n),this._mapParentKeyToInfo.delete(t.metadata.key)})}}),r.size>0&&(s=new this.DataProviderOperationEventDetail(this,r,e,a,i))}const h=t.detail.update;if(h&&h.data&&h.data.length){const t=[],e=[],s=[],i=new Set;h.metadata.forEach((a,r)=>{this._mapParentKeyToInfo.delete(a.key);const n=this._getItemByKey(a.key);if(null!=n){const o=this._getItemIndexByKey(a.key),d=h.data[r],c=new this.FlattenedTreeItemMetadata(this,h.metadata[r].key,n.metadata.parentKey,n.metadata.indexFromParent,n.metadata.treeDepth,null===this.getChildDataProvider(h.metadata[r].key));this._cache.splice(o,1,new this.Item(this,c,d)),i.add(h.metadata[r].key),t.push(c),e.push(d),s.push(o)}}),i.size>0&&(a=new this.DataProviderOperationEventDetail(this,i,t,e,s))}if(e||s||a){const t=new this.DataProviderMutationEventDetail(this,e,s,a);this.dispatchEvent(new r.DataProviderMutationEvent(t))}}_handleUnderlyingRefresh(t){var e;if(null===(e=null==t?void 0:t.detail)||void 0===e?void 0:e.keys){const e=t.detail.keys;for(let t=0;t<this._cache.length;t++){const s=this._cache[t];if(e.has(s.metadata.key)){this._mapParentKeyToInfo.delete(s.metadata.key);const e=new r.DataProviderRefreshEvent(new this.DataProviderRefreshEventDetail(s.metadata.key));this._cache.splice(t+1,this._cache.length).forEach(e=>{this._decrementIteratorOffset(t+1),this._mapParentKeyToInfo.delete(e.metadata.key)}),this.dispatchEvent(e);break}}}else this._clearCaches(),this.dispatchEvent(new r.DataProviderRefreshEvent)}_getExpandedObservableValue(t,e){return{value:t,completionPromise:e}}getChildDataProvider(t){return this._mapParentKeyToInfo.has(t)||this._isExpanded(t)&&this._mapParentKeyToInfo.set(t,{done:!1}),this.dataProvider.getChildDataProvider(t)}containsKeys(t){return this.dataProvider.containsKeys(t)}fetchByKeys(t){const e=new i;return t.keys.forEach(s=>{const a=this._getItemByKey(s);a&&(e.set(s,a),t.keys.delete(s))}),0===t.keys.size?Promise.resolve(new this.FetchByKeysResults(this,t,e)):this.dataProvider.fetchByKeys(t).then(t=>(t.results.forEach((t,s)=>{e.set(s,t)}),new this.FetchByKeysResults(this,t.fetchParameters,e)))}fetchByOffset(t){const e=null!=(null==t?void 0:t.size)?t.size:-1,s=null!=(null==t?void 0:t.sortCriteria)?t.sortCriteria:null,a=null!=(null==t?void 0:t.offset)&&t.offset>0?t.offset:0,i=null!=(null==t?void 0:t.filterCriterion)?t.filterCriterion:null,r=null!=(null==t?void 0:t.attributes)?t.attributes:null;return t=new this.FetchByOffsetParameters(this,a,e,s,i,r),this._isSameCriteria(s,i)?this._checkCacheByOffset(t)&&Promise.resolve(this._getFetchByOffsetResultsFromCache(t)):(this._clearCaches(),this._currentSortCriteria=s,this._currentFilterCriteria=i),this._fetchByOffset(t)}fetchFirst(t){this._fetchSize=null!=t?t.size:-1;const e=null!=t?t.sortCriteria:null,s=null!=t?t.filterCriterion:null,a=null!=t?t.attributes:null;this._isSameCriteria(e,s)||(this._currentSortCriteria=e,this._currentFilterCriteria=s,this._clearCaches());const i=()=>{const t=this._mapClientIdToIteratorInfo.get(r._clientId);let i=new this.FetchByOffsetParameters(this,t,this._fetchSize,e,s,a);return this.fetchByOffset(i).then(e=>{const s=e.results,a=s.map(t=>t.data),n=s.map(t=>t.metadata),h=0===a.length;return this._isSameCriteria(e.fetchParameters.sortCriteria,e.fetchParameters.filterCriterion)||(i.sortCriteria=e.fetchParameters.sortCriteria,i.filterCriterion=e.fetchParameters.filterCriterion),this._mapClientIdToIteratorInfo.set(r._clientId,t+n.length),h?new this.AsyncIteratorReturnResult(this,new this.FetchListResult(this,i,a,n)):new this.AsyncIteratorYieldResult(this,new this.FetchListResult(this,i,a,n))})},r=new this.AsyncIterable(this,new this.AsyncIterator(this,i,t));return r}getCapability(t){if("fetchByOffset"===t){return{caching:"visitedByCurrentIterator",implementation:"randomAccess"}}if("fetchFirst"===t){return{caching:"visitedByCurrentIterator",iterationSpeed:"delayed"}}return this.dataProvider.getCapability(t)}getTotalSize(){return Promise.resolve(-1)}isEmpty(){return this.dataProvider.isEmpty()}_isSameCriteria(t,e){if(t){if(!this._currentSortCriteria||t[0].attribute!=this._currentSortCriteria[0].attribute||t[0].direction!=this._currentSortCriteria[0].direction)return!1}else if(this._currentSortCriteria)return!1;if(e){if(!this._currentFilterCriteria)return!1;for(const t in this._currentFilterCriteria)if(!this._filterCompare(this._currentFilterCriteria,e,t))return!1;for(const t in e)if(!this._filterCompare(this._currentFilterCriteria,e,t))return!1}else if(this._currentFilterCriteria)return!1;return!0}_filterCompare(t,e,s){return!(!t[s]||!e[s]||t[s]!==e[s])}_checkCacheByOffset(t,e){if(-1===t.size&&!0===this._done)return!0;if(null!=e){if(this._getLocalDescendentCount(e)>=t.size&&-1!==t.size)return!0}else if(this._cache.length>=t.offset+t.size&&-1!==t.size)return!0;return!1}_getFetchByOffsetResultsFromCache(t){const e=this._cache.slice(t.offset,-1===t.size?void 0:t.offset+t.size),s=![...this._mapParentKeyToInfo.values()].some(t=>!1===t.done);return new this.FetchByOffsetResults(this,t,e,s)}_clearCaches(){this._cache=[],this._mapParentKeyToInfo.clear()}_fetchByOffset(t){if(0===this._cache.length){const e=-1===t.size?-1:t.offset+t.size,s=new this.FetchByOffsetParameters(this,0,e,t.sortCriteria,t.filterCriterion,t.attributes);return this._fetchChildrenByOffsetFromDataProvider(s,this.dataProvider,null,t).then(t=>t.fetchResult)}const e=this._getLastEntry();let s=e.metadata.key,a=0;!e.metadata.isLeaf&&this._isExpanded(s)||(s=e.metadata.parentKey,a=e.metadata.indexFromParent+1);const i=null===s?this.dataProvider:this.getChildDataProvider(s),r=this._getRemainingSize(t),n=new this.FetchByOffsetParameters(this,a,r,t.sortCriteria,t.filterCriterion,t.attributes);return this._fetchChildrenByOffsetFromAncestors(n,i,s,t).then(t=>t.fetchResult)}_fetchChildrenByOffsetFromAncestors(t,e,s,a,i){const r=(e,s)=>{const n=this._getItemByKey(e);if(this._checkCacheByOffset(a,i)||s.done&&null===e||null===n)return Promise.resolve();const h=n.metadata.parentKey,o=n.metadata.indexFromParent,d=null===h?this.dataProvider:this.getChildDataProvider(h),c=new this.FetchByOffsetParameters(this,o+1,this._getRemainingSize(a),t.sortCriteria,t.filterCriterion,t.attributes);return this._fetchChildrenByOffsetFromDataProvider(c,d,h,a,i).then(r.bind(this,h))};return this._fetchChildrenByOffsetFromDataProvider(t,e,s,a,i).then(r.bind(this,s)).then(()=>({fetchResult:this._getFetchByOffsetResultsFromCache(a)}))}_fetchChildrenByOffsetFromDataProvider(t,e,s,a,i){var r;if(null===(r=this._mapParentKeyToInfo.get(s))||void 0===r?void 0:r.done)return Promise.resolve({fetchResult:new this.FetchByOffsetResults(this,t,[],!0)});const n=e=>h(this,void 0,void 0,function*(){const r=e.results;if(this._isSameCriteria(e.fetchParameters.sortCriteria,e.fetchParameters.filterCriterion)||(a.sortCriteria=e.fetchParameters.sortCriteria,a.filterCriterion=e.fetchParameters.filterCriterion),0===r.length||this._checkCacheByOffset(a,i)){const t={};return i&&(t.expandKey=i),t.done=0===r.length&&e.done,Promise.resolve(t)}const h=r.shift(),o=this._updateItemMetadata(h,s);if(this._pushItemToCache(o,s),this._isExpanded(o.metadata.key)){const e=this._mapParentKeyToInfo.get(o.metadata.key),s=this.getChildDataProvider(o.metadata.key),r=this._getRemainingSize(a,i);if(null!=s&&!e.done&&0!==r){const e=new this.FetchByOffsetParameters(this,0,r,t.sortCriteria,t.filterCriterion,t.attributes);yield this._fetchChildrenByOffsetFromDataProvider(e,s,o.metadata.key,a,i)}}return n(new this.FetchByOffsetResults(this,t,r,e.done))});return e.fetchByOffset(t).then(n).then(t=>{this._mapParentKeyToInfo.set(s,{done:t.done});const e={fetchResult:this._getFetchByOffsetResultsFromCache(a)};return t.expandKey&&(e.returnObject=t,t.done=!0===t.done&&this._isDescendentTreeDone(t.expandKey)),e})}_isDescendentTreeDone(t){const e=this._getChildrenFromCacheByParentKey(t);if(0===e.length)return!0;if(!this._isDone(t))return!1;const s=e[e.length-1].metadata.key;return this._isDescendentTreeDone(s)}_isDone(t){return this._mapParentKeyToInfo.has(t)&&this._mapParentKeyToInfo.get(t).done}_getRemainingSize(t,e){return-1===t.size?-1:e?t.size-this._getLocalDescendentCount(e):t.size+t.offset-this._cache.length}_isExpanded(t){return this.options.expanded.has(t)}setExpanded(t){const e=this.createOptimizedKeySet(),s=this.createOptimizedKeySet();this._oldExpanded=this.options.expanded,this.options.expanded=t;const a=this._oldExpanded,i=this.options.expanded;if(i.isAddAll()||a.isAddAll()){if(!i.isAddAll()||!a.isAddAll())return this._clearCaches(),this.dispatchEvent(new r.DataProviderRefreshEvent),void this.getExpandedObservable().next(this._getExpandedObservableValue(this.options.expanded,Promise.resolve()));{const t=i.deletedValues(),r=a.deletedValues();t.forEach(t=>{a.has(t)&&s.add(t)}),r.forEach(t=>{i.has(t)&&e.add(t)})}}else{const t=i.values(),r=a.values();t.forEach(t=>{a.has(t)||e.add(t)}),r.forEach(t=>{i.has(t)||s.add(t)})}const n=this._removeKeysNotInCache(e),h=this._expand(n),o=this._collapse(s),d=new Promise(t=>{h.then(e=>{const s=e.operationAddEventDetail,a=e.fetchedCountMap;let i=null,n=null;if(-1!==this._fetchSize&&a.forEach((t,e)=>{const s=t.count;if(!t.done&&s>=this._fetchSize){const t=this._getItemIndexByKey(e);(t<n||null===n)&&(n=t,i=e)}}),null!==n){const t=this._getLastDescendentByParentKey(i),e=this._getItemIndexByKey(t.metadata.key),s=this._cache.splice(e+1,this._cache.length);s.forEach(t=>{this._mapParentKeyToInfo.delete(t.metadata.key),this._mapParentKeyToInfo.has(t.metadata.parentKey)&&this._mapParentKeyToInfo.set(t.metadata.parentKey,{done:!1})});const r=s.length+a.get(i).count;for(let t=0;t<r;t++)this._decrementIteratorOffset(n+1)}if(null===i){const t=new this.DataProviderMutationEventDetail(this,s,o,null);(s.keys.size>0||o.keys.size>0)&&this.dispatchEvent(new r.DataProviderMutationEvent(t))}if(null!==i){const t=new r.DataProviderRefreshEvent(new this.DataProviderRefreshEventDetail(i));this.dispatchEvent(t)}t()})});this.getExpandedObservable().next(this._getExpandedObservableValue(this.options.expanded,d))}getExpandedObservable(){return this._expandedObservable}_pushItemToCache(t,e){const s=this._getLastItemByParentKey(e),a=null==s?this._getItemIndexByKey(e):this._getItemIndexByKey(s.metadata.key)+this._getLocalDescendentCount(s.metadata.key);this._cache.splice(a+1,0,t)}_spliceItemToCache(t,e){this._cache.splice(e+1,0,t)}_removeKeysNotInCache(t){const e=new Set;return t.forEach(t=>{this._getItemByKey(t)&&e.add(t)}),e}_updateItemMetadata(t,e,s){let a=0;const i=this._getLastItemByParentKey(e);let r=null==i?0:i.metadata.indexFromParent+1;if(null!=s&&(r=s),null!=e){a=this._getItemByKey(e).metadata.treeDepth+1}return new this.Item(this,new this.FlattenedTreeItemMetadata(this,t.metadata.key,e,r,a,null===this.getChildDataProvider(t.metadata.key)),t.data)}_getItemByKey(e){let s=null;return this._cache.some(a=>{if(t.Object.compareValues(a.metadata.key,e))return s=a,!0}),s}_getItemIndexByKey(e){let s=-1;return this._cache.some((a,i)=>{if(t.Object.compareValues(a.metadata.key,e))return s=i,!0}),s}_getLastEntry(){return this._cache[this._getLastIndex()]}_getEntry(t){return this._cache[t]}_getLastDescendentByParentKey(t){const e=this._getLastItemByParentKey(t);return e?e.metadata.isLeaf?e:this._getLastDescendentByParentKey(e.metadata.key):this._getItemByKey(t)}_getLastItemByParentKey(e){let s=null;return this._cache.slice().reverse().some(a=>{if(t.Object.compareValues(a.metadata.parentKey,e))return s=a,!0}),s}_getLastIndex(){return this._cache.length-1}_getLocalDescendentCount(t){const e=this._getItemByKey(t);let s=0;if(null!=e){const a=this._getItemIndexByKey(t),i=e.metadata.treeDepth,r=this._getLastIndex();for(let t=a+1;t<=r;t++){if(!(this._getEntry(t).metadata.treeDepth>i))return s;s+=1}}return s}_expand(t){const e=[];return t.forEach(t=>{const s=new this.FetchByOffsetParameters(this,0,this._fetchSize,this._currentSortCriteria,this._currentFilterCriteria,null);this._mapParentKeyToInfo.set(t,{done:!1});const a=this.getChildDataProvider(t);e.push(this._fetchChildrenByOffsetFromDataProvider(s,a,t,s,t))}),Promise.all(e).then(e=>{const s=this.createOptimizedKeySet(),a=this.createOptimizedKeySet(),i=[],r=[],n=[],h=[],o=new Map;return t.forEach(t=>{const d=this._getLocalDescendentCount(t);if(d>0){o.set(t,{count:d,done:!1});for(let s=0;s<e.length;s++)if(e[s].returnObject&&e[s].returnObject.expandKey===t&&e[s].returnObject.done){o.get(t).done=!0;break}const c=this._getItemIndexByKey(t)+1;let l=t;this._cache.slice(c,c+d).forEach((t,e)=>{s.add(t.metadata.key),a.add(l),r.push(t.metadata),n.push(t.data),h.push(c+e),i.push(this._getKeyByIndex(c+e+1)),l=t.metadata.key,this._incrementIteratorOffset(c)})}}),{operationAddEventDetail:new this.DataProviderAddOperationEventDetail(this,s,a,i,r,n,h),fetchedCountMap:o}})}_getKeyByIndex(t){var e,s;return(null===(s=null===(e=this._cache[t])||void 0===e?void 0:e.metadata)||void 0===s?void 0:s.key)?this._cache[t].metadata.key:null}_collapse(t){const e=[],s=[],a=[],i=this.createOptimizedKeySet();return t.forEach(t=>{const r=this._getLocalDescendentCount(t);if(this._mapParentKeyToInfo.delete(t),r>0){const n=this._getItemIndexByKey(t);this._cache.splice(n+1,r).forEach((t,r)=>{this._mapParentKeyToInfo.delete(t.metadata.key),i.add(t.metadata.key),e.push(t.metadata),s.push(t.data),a.push(n+r+1),this._decrementIteratorOffset(n+1)})}}),new this.DataProviderOperationEventDetail(this,i,e,s,a,!0)}_decrementIteratorOffset(t){this._mapClientIdToIteratorInfo.forEach((e,s)=>{t<e&&this._mapClientIdToIteratorInfo.set(s,e-1)})}_incrementIteratorOffset(t){this._mapClientIdToIteratorInfo.forEach((e,s)=>{t<e&&this._mapClientIdToIteratorInfo.set(s,e+1)})}createOptimizedKeySet(t){return this.dataProvider.createOptimizedKeySet?this.dataProvider.createOptimizedKeySet(t):new e(t)}createOptimizedKeyMap(t){if(this.dataProvider.createOptimizedKeyMap)return this.dataProvider.createOptimizedKeyMap(t);if(t){const e=new i;return t.forEach((t,s)=>{e.set(s,t)}),e}return new i}}return t._registerLegacyNamespaceProp("FlattenedTreeDataProviderView",o),s.EventTargetMixin.applyMixin(o),o});
//# sourceMappingURL=ojflattenedtreedataproviderview.js.map