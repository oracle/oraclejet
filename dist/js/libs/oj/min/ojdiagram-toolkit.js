/**
 * @license
 * Copyright (c) 2014, 2022, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["exports","ojs/ojdvt-toolkit","ojs/ojdvt-panzoomcanvas","ojs/ojkeyboardfocus-utils","ojs/ojdvt-overview","ojs/ojcustomelement-utils"],function(t,e,i,n,s,o){"use strict";class a extends e.BaseComponentDefaults{constructor(t){super({alta:{skin:e.CSSStyle.SKIN_ALTA,emptyText:null,selectionMode:"none",animationOnDataChange:"none",animationOnDisplay:"none",maxZoom:1,highlightMatch:"all",nodeHighlightMode:"node",linkHighlightMode:"link",panning:"none",panZoomState:{zoom:0,centerX:null,centerY:null},overview:{fitArea:"content",preserveAspectRatio:"meet"},touchResponse:"auto",zooming:"none",promotedLinkBehavior:"lazy",_statusMessageStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA),dnd:{drag:{nodes:{},ports:{}},drop:{background:{},nodes:{},links:{},ports:{}}},styleDefaults:{animationDuration:500,hoverBehaviorDelay:200,_highlightAlpha:.1,_overviewStyles:{overview:{backgroundColor:"rgb(228,229,230)"},overviewContent:{padding:"10px"},viewport:{backgroundColor:"rgb(255,255,255)",borderColor:"rgb(74,76,78)"},node:{shape:"inherit"}},nodeDefaults:{_containerStyle:new e.CSSStyle("border-color:#abb3ba;background-color:#f9f9f9;border-width:.5px;border-radius:1px;padding-top:20px;padding-left:20px;padding-bottom:20px;padding-right:20px;"),labelStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA_BOLD_12+"color:#383A47"),hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",icon:{width:10,height:10,pattern:"none",shape:"circle"}},linkDefaults:{startConnectorType:"none",endConnectorType:"none",width:1,_style:{_type:"solid"},hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",labelStyle:new e.CSSStyle(e.BaseComponentDefaults.FONT_FAMILY_ALTA_BOLD_12+"color:#383A47"),_hitDetectionOffset:10},promotedLink:{startConnectorType:"none",endConnectorType:"none",width:1,_style:{_type:"dot",strokeDasharray:"2,3"},color:"#778999",hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",_hitDetectionOffset:10}}}},t)}getNoCloneObject(){return{data:!0,nodeData:!0,linkData:!0,nodes:!0,links:!0}}}class r extends e.CategoryRolloverHandler{constructor(t,e){super(t,e),this.setHoverDelay(100)}GetRolloverCallback(t){return()=>{this.SetHighlightMode(!0),this._callbackObj.processEvent(t)}}GetRolloutCallback(t){return()=>{this.SetHighlightModeTimeout(),this._callbackObj.processEvent(t)}}}const d={GetCollapsedContainers:(t,e)=>{for(var i=[];e.length>0;){var n=e.shift();if(n.nodes)n.nodes.forEach(t=>{e.push(t)});else{var s=t.getChildDataProvider(n.id);!s||"yes"===s.isEmpty()||"disjoint"===n.descendantsConnectivity||i.push(n)}}return i},GetNodeOption:(t,e)=>{for(var i=[e.getId()];e&&e.getGroupId();){var n=e.getGroupId();i.push(n),e=t.getNodeById(n)}for(var s=i.pop(),o=[t.getOptions()],a=t.getCtx();s&&o[0].nodes;)o=o[0].nodes.filter(t=>d.compareValues(a,t.id,s)),s=i.pop();return o[0]},compareValues:(t,i,n)=>!i&&!n||e.Obj.compareValues(t,i,n),RotateBounds:(t,i,n)=>{if(null==i&&!n)return t;var s=new e.Point(t.x,t.y),o=new e.Point(t.x+t.w,t.y),a=new e.Point(t.x,t.y+t.h),r=new e.Point(t.x+t.w,t.y+t.h),d=new e.Matrix;null!=i&&(n&&(d=d.translate(-n.x,-n.y)),d=d.rotate(i),n&&(d=d.translate(n.x,n.y)));var h=d.transformPoint(s),l=d.transformPoint(o),g=d.transformPoint(a),u=d.transformPoint(r),c=Math.min(Math.min(h.x,l.x),Math.min(g.x,u.x)),_=Math.max(Math.max(h.x,l.x),Math.max(g.x,u.x)),p=Math.min(Math.min(h.y,l.y),Math.min(g.y,u.y)),m=Math.max(Math.max(h.y,l.y),Math.max(g.y,u.y));return new e.Rectangle(c,p,_-c,m-p)}},h={GetStrokeDash:(t,e)=>"solid"==t?null:"dash"===t?e?"8,2":"6,4":"dot"===t?e?"4,1":"2,3":"dashDot"===t?e?"10,1,4,1":"8,3,2,3":null,GetStrokeDashOffset:(t,e)=>e&&"solid"!=t?1:null,getStrokeObject:(t,e)=>({_type:t,strokeDasharray:h.GetStrokeDash(t,e),strokeDashoffset:h.GetStrokeDashOffset(t,e)}),processStrokeDashArray:t=>{if(t){var e=t.split(/[\s,]+/);return e.length%2>0&&(e=e.concat(e)),e.toString()}return t},getCustomUnderlay:t=>{if(t){for(var i=t.split(/[\s,]+/),n="",s=0;s<i.length;s++){var o=e.CSSStyle.toNumber(i[s].trim());n+=s%2==0?o+2:o>=2?o-2:0,s<i.length-1&&(n+=", ")}return n}return null},ConvertToPath:t=>{var e=[];if(t)for(var i=0;i<t.length;i+=2)0==i?e.push("M"):e.push("L"),e.push(t[i],t[i+1]);return e},ConvertToPoints:t=>{var e=[];if(t)for(var i=0;i<t.length;i++)isNaN(t[i])||e.push(t[i]);return e},IsPath:t=>!!(t&&t.length>0)&&isNaN(t[0]),GetLinkBounds:t=>{var i=new e.Rectangle(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n=t.getPoints();if(n)if(h.IsPath(n))i=e.PathUtils.getDimensions(n);else for(var s,o,a,r,l=0;l<n.length;l+=2){var g=n[l],u=n[l+1];s=Math.max(i.x+i.w,g),o=Math.max(i.y+i.h,u),a=Math.min(i.x,g),r=Math.min(i.y,u),i.x=a,i.y=r,i.w=s-a,i.h=o-r}var c=new e.Rectangle(i.x,i.y,i.w,i.h),_=t.getLabelPosition(),p=t.getLabelRotationAngle(),m=t.getLabelRotationPoint(),C=t.getLabelBounds();return _&&C&&(null!=p&&(C=d.RotateBounds(C,p,m)),c.x=Math.min(i.x,C.x+_.x),c.y=Math.min(i.y,C.y+_.y),c.w=Math.max(i.x+i.w,C.x+_.x+C.w)-c.x,c.h=Math.max(i.y+i.h,C.y+_.y+C.h)-c.y),c}},l={CreateConnectorShape:(t,e,i,n)=>{var s=n.GetAppliedLinkWidth();switch(e){case"arrow":return l.CreateFilledArrowConnector(t,s,n.getLinkColor());case"arrowConcave":return l.CreateFilledConcaveArrowConnector(t,s,n.getLinkColor());case"arrowOpen":return l.CreateOpenArrowConnector(t,s,i);case"circle":return l.CreateCircleConnector(t,s,i);case"rectangle":return l.CreateRectangleConnector(t,s,i);case"rectangleRounded":return l.CreateRoundedRectangleConnector(t,s,i)}return null},TransformConnector:(t,e,i,n)=>{var s=l.CalcConnectorTransform(t,e,i,n);t.setMatrix(s)},CalcConnectorTransform:(t,i,n,s)=>{var o=-1,a=0,r=0,d=0;if(n){var h=n.length;1===s?(h>=2&&(r=n[h-2],d=n[h-1]),h>=4?(o=n[h-4],a=n[h-3]):(o=r-1e-4,a=d)):(h>=2&&(r=n[0],d=n[1]),h>=4?(o=n[2],a=n[3]):(o=r+1e-4,a=d))}var g=r,u=d,c=l.CalcConnectorRotation(o,a,r,d),_=t._connectorOrigMat;_||(_=t.getMatrix(),t._connectorOrigMat=_);var p=new e.Matrix;return(p=(p=p.rotate(c)).translate(g,u)).concat(_)},_getCachedDims:t=>{var e=t._cachedDims;return e||(e=t.getDimensions(),t._cachedDims=e),e},CalcConnectorRotation:(t,e,i,n)=>{var s=n-e,o=i-t;return Math.atan2(s,o)},CreateFilledConcaveArrowConnector:(t,i,n)=>{var s=6*l._getReduce(i,.5),o=.8*s,a=[-.22*s,-.5*o,.78*s,0,-.22*s,.5*o,0,0],r=new e.Polygon(t,a);return r.setSolidFill(n),r},CreateFilledArrowConnector:(t,i,n)=>{var s=5*l._getReduce(i,.5),o=.8*s,a=[0,-.5*o,s,0,0,.5*o],r=new e.Polygon(t,a);return r.setSolidFill(n),r},_getReduce:(t,e)=>{if(t<=1)return t;var i=t-1;return 1+(i*=e)},CreateOpenArrowConnector:(t,i,n)=>{var s=3*i,o=n.getWidth(),a=[-s+o*Math.sqrt(2)/2,-s,o*Math.sqrt(2)/2,0,-s+o*Math.sqrt(2)/2,s],r=new e.Polyline(t,a);return r.setStroke(n),r.setFill(null),r},getCircleRadius:t=>2*t,getRectangleLength:t=>3*t,CreateCircleConnector:(t,i,n)=>{var s=l.getCircleRadius(i),o=new e.Circle(t,s,0,s);return o.setStroke(n),o.setFill(null),o},CreateRectangleConnector:(t,i,n)=>{var s=l.getRectangleLength(i),o=new e.Rect(t,0,-s/2,s,s);return o.setStroke(n),o.setFill(null),o},CreateRoundedRectangleConnector:(t,e,i)=>{var n=l.CreateRectangleConnector(t,e,i);return n.setCornerRadius(e),n},GetConnectorOffset:(t,e,i,n)=>l.getStandardConnectorOffset(e,n.GetAppliedLinkWidth(),i.getWidth()),getStandardConnectorOffset:(t,e,i)=>{switch(t){case"arrowOpen":return i*Math.sqrt(2);case"arrow":return 5*l._getReduce(e,.5);case"arrowConcave":return.78*(6*l._getReduce(e,.5));case"circle":return 2*l.getCircleRadius(i)+i/2;case"rectangle":case"rectangleRounded":return l.getRectangleLength(i)+i/2;default:return 0}}};class g extends e.Container{constructor(t,i,n,s,o){super(t),i||(i=["M",0,0,"L",1,0]),this._stroke=n,this._stroke||(this._stroke=new e.Stroke("#ffffff",1,1,!0)),this._underlay=new e.Path(t,i),this._underlay.setStroke(this._stroke),this._underlay.setFill(null),this._underlay.setStyle(s).setClassName(o),this.addChild(this._underlay),this._underlayStart=null,this._underlayStartType=null,this._underlayEnd=null,this._underlayEndType=null}addUnderlayStart(t,e,i){var n=this.CreateConnectorUnderlay(t,e,i,0);this._underlayStart&&this.removeChild(this._underlayStart),this._underlayStart=n,this._underlayStartType=e,this.addChild(this._underlayStart)}addUnderlayEnd(t,e,i){var n=this.CreateConnectorUnderlay(t,e,i,1);this._underlayEnd&&this.removeChild(this._underlayEnd),this._underlayEnd=n,this._underlayEndType=e,this.addChild(this._underlayEnd)}CreateConnectorUnderlay(t,i,n,s){var o=new e.Stroke(this._stroke.getColor(),this._stroke.getAlpha(),this._stroke.getWidth(),!1,this._stroke.getDashProps()),a=l.CreateConnectorShape(this.getCtx(),i,o,n);return l.TransformConnector(a,i,t,s),a}getUnderlay(){return this._underlay}getUnderlayStart(){return this._underlayStart}getUnderlayEnd(){return this._underlayEnd}setStroke(t,i){var n,s;(this._stroke=t,this._underlay.setStroke(t),this._underlayStart)&&("arrow"==this._underlayStartType||"arrowConcave"==this._underlayStartType?(n=new e.Stroke(t.getColor(),t.getAlpha(),i),this._underlayStart.setSolidFill(t.getColor())):n=new e.Stroke(t.getColor(),t.getAlpha(),t.getWidth()),this._underlayStart.setStroke(n));this._underlayEnd&&("arrow"==this._underlayEndType||"arrowConcave"==this._underlayEndType?(s=new e.Stroke(t.getColor(),t.getAlpha(),i),this._underlayEnd.setSolidFill(t.getColor())):s=new e.Stroke(t.getColor(),t.getAlpha(),t.getWidth()),this._underlayEnd.setStroke(s))}getStroke(){return this._stroke}hideUnderlayStart(){this._underlayStart&&this.removeChild(this._underlayStart)}hideUnderlayEnd(){this._underlayEnd&&this.removeChild(this._underlayEnd)}showUnderlayStart(){this._underlayStart&&this.addChild(this._underlayStart)}showUnderlayEnd(){this._underlayEnd&&this.addChild(this._underlayEnd)}}const u=0,c=1,_=2;class p extends e.Container{constructor(t,i,n,s){super(t,null,n.id),this._diagram=i,this._selected=!1,this._selectable=!0,this._data=n,this._isHighlighted=!0,this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null,this.setPromoted(s),this.isSelectable()&&this.setCursor(e.SelectionEffectUtils.getSelectingCursor()),this.setGroupId(p._getCommonAncestorId(this,i)),this.hasActiveInnerElems=!1}getData(){return this._data}setData(t){this._data=t}getId(){return this.getData().id}getStartId(){return this.getData().startNode}getEndId(){return this.getData().endNode}getLabelBounds(){var t=null;return this._labelObj&&(t=this._labelObj.getDimensions()),t}getLinkStyle(){return this.getData().svgStyle||this.getData().style}getLinkWidth(){return this.getData().width}getLinkColor(){return this.getData().color}getStartConnectorType(){return this.getData().startConnectorType}getEndConnectorType(){return this.getData().endConnectorType}getStartConnectorOffset(){return this.getStartConnectorType()?l.getStandardConnectorOffset(this.getStartConnectorType(),this.GetAppliedLinkWidth(),this.GetAppliedLinkWidth()):0}getEndConnectorOffset(){return this.getEndConnectorType()?l.getStandardConnectorOffset(this.getEndConnectorType(),this.GetAppliedLinkWidth(),this.GetAppliedLinkWidth()):0}render(){var t=this.GetDiagram(),e=this.getGroupId(),i=t.getNodeById(this.getStartId()).getGroupId(),n=t.getNodeById(this.getEndId()).getGroupId();if(e){var s=this.getCtx(),o=t.getNodeById(e).GetChildNodePane();d.compareValues(s,e,i)&&d.compareValues(s,e,n)?o.addChildAt(this,0):o.addChild(this)}else i||n?t.getNodesPane().addChild(this):t.getLinksPane().addChild(this);p._renderLinkLabels(t,this.getData(),this),this.setAriaRole("img"),this.UpdateAriaLabel(),this._diagram.getEventManager().associate(this,this)}setPoints(t){var i=this._getCustomRenderer("renderer");if(i){this._customPoints=t;var n={hovered:!1,selected:!1,focused:!1,inActionableMode:this.hasActiveInnerElems};this._applyCustomLinkContent(i,this._getState(),n)}else{!this._pathCmds&&t&&p._renderLinkShape(this.getData(),this),this._arPoints=t,h.IsPath(t)?(this._pathCmds=t,this._points=h.ConvertToPoints(t)):(this._points=t,this._pathCmds=h.ConvertToPath(t)),this._shape&&this._shape instanceof e.Path&&(this._shape.setCommandsArray(this._pathCmds),this._endConnector?l.TransformConnector(this._endConnector,this.getEndConnectorType(),this._points,1):this._endConnector=this.CreateConnector(this._points,this.getEndConnectorType(),1),this._startConnector?l.TransformConnector(this._startConnector,this.getStartConnectorType(),this._points,0):this._startConnector=this.CreateConnector(this._points,this.getStartConnectorType(),0));var s=null,o=null;this._linkUnderlay&&this._linkUnderlay.getUnderlay()instanceof e.Path&&this._linkUnderlay.getUnderlay().setCommandsArray(this._pathCmds),this._linkUnderlay&&(s=this._linkUnderlay.getUnderlayStart())&&l.TransformConnector(s,this.getStartConnectorType(),this._points,0),this._linkUnderlay&&(o=this._linkUnderlay.getUnderlayEnd())&&l.TransformConnector(o,this.getEndConnectorType(),this._points,1),this._hitDetectionUnderlay&&this._hitDetectionUnderlay.getUnderlay()instanceof e.Path&&this._hitDetectionUnderlay.getUnderlay().setCommandsArray(this._pathCmds),this._startHandle&&this._startHandle.setPosition(this.getLinkStart()),this._endHandle&&this._endHandle.setPosition(this.getLinkEnd())}}_getState(){return{hovered:this._isShowingHoverEffect,selected:this.isSelected(),focused:this._isShowingKeyboardFocusEffect,inActionableMode:this.hasActiveInnerElems}}_applyCustomLinkContent(t,i,n){var s=this._diagram.getOptions()._contextHandler;if(s){var o=t(s(this.isPromoted()?"promotedLink":"link",this.getElem(),this._customLinkContent,null,this.getDataContext(),i,n,this._customPoints));if(o||!this._customLinkContent){var a=p._processLinkContent(o);if(this._customLinkContent&&a!=this._customLinkContent)this._checkAndMoveContents()||(this._customLinkContent.namespaceURI===e.ToolkitUtils.SVG_NS?this.getContainerElem().removeChild(this._customLinkContent):Array.isArray(this._customLinkContent)&&this._customLinkContent.forEach(t=>{this.getContainerElem().removeChild(t)})),this._customLinkContent=null;a===this._contentStoredInTouchEventContainer&&(this._hasContentBoundToTouchEvent=!0),this._customLinkContent||(a&&a.namespaceURI===e.ToolkitUtils.SVG_NS?(p._insertCustomElem(this,a,this._labelObj),this._customLinkContent=a):a&&Array.isArray(a)?(a.forEach(t=>{p._insertCustomElem(this,t,this._labelObj)}),this._customLinkContent=a):this._diagram.Log("Diagram: could not add custom link content for the link "+this.getId()+o,1)),p._fixLinkPath(this)}}else this._diagram.Log("Diagram: could not add custom link content - context handler is undefined",1)}static _renderLinkShape(t,i){var n=i._pathCmds;n||(n=["M",0,0,"L",0,0]);var s=t.id,o=t.color,a=t.width,r=t.svgStyle||t.style,d=e.CSSStyle.toNumber(t._hitDetectionOffset);i._hitDetectionUnderlay=i.CreateUnderlay("#000000",0,d),i.addChildAt(i._hitDetectionUnderlay,0);var l,g=new e.Path(i.getCtx(),n,s),u=t.svgClassName||t.className;if(g.setFill(null),g.setClassName(u),i.getCtx().isCustomElement())g.setStyle(r);else if(r&&r instanceof Object){r._type==p.CUSTOM_STYLE&&r.strokeDasharray&&(r.strokeDasharray=h.processStrokeDashArray(r.strokeDasharray)),l={dashArray:r.strokeDasharray,dashOffset:r.strokeDashoffset};var c=e.JsonUtils.clone(r);["_type","strokeDasharray","strokeDashoffset"].forEach(t=>{delete c[t]}),g.setStyle(c)}else"solid"!==r&&(l={dashArray:h.GetStrokeDash(r),dashOffset:h.GetStrokeDashOffset(r)});var _=new e.Stroke(o,1,a,!0,l);g.setStroke(_),i.setShape(g),i.addChildAt(g,1)}static _renderLinkLabels(t,i,n){var s=i.label;if(s){var o=e.Agent.isRightToLeft(t.getCtx()),a=s.indexOf("\n")>0,r=o?e.MultilineText.H_ALIGN_RIGHT:e.MultilineText.H_ALIGN_LEFT,d=o?e.OutputText.H_ALIGN_RIGHT:e.OutputText.H_ALIGN_LEFT,h=a?r:d,l=a?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_TOP,g=p.createText(t.getCtx(),s,i.labelStyle,h,l,a),u=i.labelStyle.getMaxWidth()||i.labelStyle.getWidth(),c=e.CSSStyle.toNumber(u);u?c>0&&e.TextUtils.fitText(g,c,1/0,n)&&(n._labelObj=g):(n.addChild(g),n._labelObj=g)}}static createText(t,i,n,s,o,a){var r;return n.hasBackgroundStyles()?r=a?new e.BackgroundMultilineText(t,i,0,0,n,null,!0):new e.BackgroundOutputText(t,i,0,0,n):(r=a?new e.MultilineText(t,i,0,0,null,!0):new e.OutputText(t,i,0,0)).setCSSStyle(n),r.setHorizAlignment(s),r.setVertAlignment(o),r}setSelected(t){var e=this._getState();this._selected=t;var i=this._getCustomRenderer("selectionRenderer");i?this._applyCustomLinkContent(i,this._getState(),e):t?this._showFeedback(this._isShowingHoverEffect,!0):this._hideFeedback(),this.UpdateAriaLabel()}isSelectable(){return this.GetDiagram().isSelectionSupported()&&"off"!=this.getData().selectable&&!this.hasActiveInnerElems}_showFeedback(t,i){var n="redwood"===this.getCtx().getThemeBehavior();if(!t||n&&i)this._savedStroke&&(this.getShape().setStroke(this._savedStroke),this.ReplaceConnectorColor(this.getStartConnector(),this._savedStroke),this.ReplaceConnectorColor(this.getEndConnector(),this._savedStroke),this._savedStroke=null);else{this._savedStroke||(this._savedStroke=this.getShape().getStroke());var s=this.getShape().getStroke(),o=new e.Stroke(this.getData().hoverInnerColor,s.getAlpha(),s.getWidth(),s.isFixedWidth(),s.getDashProps());this.getShape().setStroke(o),this.ReplaceConnectorColor(this.getStartConnector(),o),this.ReplaceConnectorColor(this.getEndConnector(),o)}this._linkUnderlay||(this._linkUnderlay=this.CreateFeedbackUnderlay("#000000",1,0,this.getData().svgStyle,this.getData().svgClassName),this.addChildAt(this._linkUnderlay,0));var a=i?this.getData().selectionColor:this.getData().hoverOuterColor,r=this._linkUnderlay.getStroke(),d=2+this.GetAppliedLinkWidth(),h=this.GetStyledLinkStroke(r,a,d);this._linkUnderlay.setStroke(h,2)}_hideFeedback(){this._savedStroke&&(this.getShape().setStroke(this._savedStroke),this.ReplaceConnectorColor(this.getStartConnector(),this._savedStroke),this.ReplaceConnectorColor(this.getEndConnector(),this._savedStroke),this._savedStroke=null),this._linkUnderlay&&(this.removeChild(this._linkUnderlay),this._linkUnderlay.destroy&&this._linkUnderlay.destroy(),this._linkUnderlay=null)}GetStyledLinkStroke(t,i,n){if(this.getCtx().isCustomElement())return new e.Stroke(i,t.getAlpha(),n,t.isFixedWidth());if((r=this.GetAppliedLinkStyle())&&r instanceof Object){var s=r._type;if(s==p.CUSTOM_STYLE){var o=null!=r.strokeDashoffset?e.CSSStyle.toNumber(r.strokeDashoffset)+1:1;a={dashArray:h.getCustomUnderlay(r.strokeDasharray),dashOffset:o}}else a={dashArray:h.GetStrokeDash(s,!0),dashOffset:h.GetStrokeDashOffset(s,!0)};return new e.Stroke(i,t.getAlpha(),n,!0,a)}var a,r=this.GetAppliedLinkStyle();return"solid"!==strokeType1&&(a={dashArray:h.GetStrokeDash(r,!0),dashOffset:h.GetStrokeDashOffset(r,!0)}),new e.Stroke(i,t.getAlpha(),n,!0,a)}handleTouchStart(){this._hasContentBoundToTouchEvent=!0}handleTouchEnd(){this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null}showHoverEffect(){if(!this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!0;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this._showFeedback(!0,this.isSelected())}}hideHoverEffect(){var t=this._getState();this._isShowingHoverEffect=!1;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this.isSelected()?this._showFeedback(!1,!0):this._hideFeedback()}highlight(t){if(this._isHighlighted!==t){var e=t?1:this._diagram.getOptions().styleDefaults._highlightAlpha;this.setAlpha(e),this._isHighlighted=t}}getDatatip(){var t=this.GetDiagram().getOptions().tooltip,i=t?t.renderer:null;return i?this.GetDiagram().getCtx().getTooltipManager().getCustomTooltip(i,this.getDataContext()):e.Displayable.resolveShortDesc(this.getShortDesc(),()=>p.getShortDescContext(this))}getShortDesc(){var t=this.GetDiagram().getOptions().translations;if(this.isPromoted()){var i=this.getData()._links.length;return e.ResourceUtils.format(t[i>1?"promotedLinks":"promotedLink"],[i])}return this.getData().shortDesc}getDataContext(){var t,e;this.GetDiagram().isDataProviderMode()?this.isPromoted()?(t=this.getData()._links.map(t=>t._itemData),e=this.getData()._links[0]._noTemplate?t:this.getData()._links):(e=this.getData(),t=this.getData()._itemData):e=this.isPromoted()?this.getData()._links:this.getData()._itemData;var i={id:this.getId(),type:this.isPromoted()?"promotedLink":"link",label:this.getData().label,data:e,itemData:t,component:this.GetDiagram().getOptions()._widgetConstructor};return this.getCtx().fixRendererContext(i)}static getShortDescContext(t){var e,i;return t.GetDiagram().isDataProviderMode()?t.isPromoted()?(e=t.getData()._links.map(t=>t._itemData),i=t.getData()._links[0]._noTemplate?e:t.getData()._links):(i=t.getData(),e=t.getData()._itemData):i=t.isPromoted()?t.getData()._links:t.getData()._itemData,{id:t.getId(),label:t.getData().label,data:i,itemData:e}}getAriaLabel(){var t=this.GetDiagram().getOptions(),i=[],n=t.translations,s=t._keyboardUtils;return this.isSelectable()&&i.push(n[this.isSelected()?"stateSelected":"stateUnselected"]),this.isPromoted()&&i.push(n.promotedLinkAriaDesc),s.getActionableElementsInNode(this.getElem()).length>0&&i.push(n.accessibleContainsControls),e.Displayable.generateAriaLabel(this.getShortDesc(),i,()=>p.getShortDescContext(this))}UpdateAriaLabel(){if(!e.Agent.deferAriaCreation()){var t=this.getAriaLabel();t&&this.setAriaProperty("label",t)}}getNextNavigable(t){if(this.hasActiveInnerElems)return null;var i,n;if(t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey)return this;if(t.keyCode==e.KeyboardEvent.UP_ARROW||t.keyCode==e.KeyboardEvent.DOWN_ARROW){(i=this.getKeyboardFocusNode())||(i=this.GetDiagram().getNodeById(this.getStartId()));var s=this,o=this.GetDiagram().getNavigableLinksForNodeId(i.getId()),a=this.GetDiagram().getEventManager().getKeyboardHandler();return a&&a.getNextNavigableLink&&(s=a.getNextNavigableLink(i,this,t,o)),s.setKeyboardFocusNode(i),this._diagram.ensureObjInViewport(t,s),s}return t.keyCode==e.KeyboardEvent.RIGHT_ARROW||t.keyCode==e.KeyboardEvent.LEFT_ARROW?(n=this._movingToStart(t.keyCode)?this.getStartId():this.getEndId(),i=this.GetDiagram().getNodeById(n),this._diagram.ensureObjInViewport(t,i),i):t.type==e.MouseEvent.CLICK?this:null}_movingToStart(t){var i=this.getLinkStart(),n=this.getLinkEnd(),s=i.x<n.x;return!(t==e.KeyboardEvent.RIGHT_ARROW&&s||t==e.KeyboardEvent.LEFT_ARROW&&!s)}getLinkStart(){if(this._customPoints)return h.IsPath(this._customPoints)?new e.Point(this._customPoints[1],this._customPoints[2]):new e.Point(this._customPoints[0],this._customPoints[1]);if(!this._points)return null;var t=this._points[0],i=this._points[1];return new e.Point(t,i)}getLinkEnd(){if(this._customPoints){var t=this._customPoints.length;return new e.Point(this._customPoints[t-2],this._customPoints[t-1])}if(!this._points)return null;t=this._points.length;var i=this._points[t-2],n=this._points[t-1];return new e.Point(i,n)}showKeyboardFocusEffect(){var t=this._getState();this._isShowingKeyboardFocusEffect=!0;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this.showHoverEffect()}hideKeyboardFocusEffect(){var t=this._getState();this._isShowingKeyboardFocusEffect=!1;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomLinkContent(e,this._getState(),t):this.hideHoverEffect()}isShowingKeyboardFocusEffect(){return this._isShowingKeyboardFocusEffect}getCategories(){return this.getData().categories?this.getData().categories:[this.getId()]}isHidden(){var t=this.GetDiagram().getOptions().hiddenCategories;return!(!t||!e.ArrayUtils.hasAnyItem(t,this.getCategories()))||(!this.GetDiagram().getNodeById(this.getStartId())||!this.GetDiagram().getNodeById(this.getEndId()))}animateUpdate(t,i,n){var s=i.getPoints(),o=this.getPoints(),a=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur());if(!e.ArrayUtils.equals(s,o)){this.setPoints(s);var r=e.Animator.TYPE_POLYLINE;o.length>0&&isNaN(o[0])&&(r=e.Animator.TYPE_PATH),a.getAnimator().addProp(r,this,this.getPoints,this.setPoints,o)}if(i._labelObj&&this._labelObj){var d=i._labelObj.getMatrix(),h=this._labelObj.getMatrix();d.equals(h)||(this._labelObj.setMatrix(d),a.getAnimator().addProp(e.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,h))}if(i.getShape()&&this.getShape()){var l=i.getShape().getStroke(),g=this.getShape().getStroke();l&&g&&l instanceof e.Stroke&&g instanceof e.Stroke&&(l.getColor()!=g.getColor()||l.getWidth()!=g.getWidth())&&(this.getShape().setStroke(l),a.getAnimator().addProp(e.Animator.TYPE_STROKE,this.getShape(),this.getShape().getStroke,this.getShape().setStroke,g))}var u=i.getTranslateX(),m=i.getTranslateY(),C=this.getTranslateX(),v=this.getTranslateY();if(u!=C&&(this.setTranslateX(u),a.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateX,this.setTranslateX,C)),m!=v&&(this.setTranslateY(m),a.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateY,this.setTranslateY,v)),this._getCustomRenderer("renderer")){var y=i.getContainerElem().querySelector(".oj-diagram-link-path"),f=this.getContainerElem().querySelector(".oj-diagram-link-path");if(y&&f){var S=e.ToolkitUtils.getAttrNullNS(y,"d"),b=e.ToolkitUtils.getAttrNullNS(f,"d");e.ToolkitUtils.setAttrNullNS(f,"d",S);a.getAnimator().addProp(e.Animator.TYPE_PATH,f,t=>{var i=e.ToolkitUtils.getAttrNullNS(f,"d");return e.PathUtils.createPathArray(i)},t=>{e.ToolkitUtils.setAttrNullNS(f,"d",t.join(" "))},e.PathUtils.createPathArray(b))}for(var P=p._getFadeInCustomItems(this._customLinkContent,f,y),D=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur()),E=0;E<P.length;E++){var k=P[E];e.ToolkitUtils.setAttrNullNS(k,"opacity","0");D.getAnimator().addProp(e.Animator.TYPE_NUMBER,k,()=>{var t=e.ToolkitUtils.getAttrNullNS(k,"opacity");return Number(t)},t=>{e.ToolkitUtils.setAttrNullNS(k,"opacity",t)},1)}t.add(D,_)}if(n){var I=this;e.Playable.appendOnEnd(a,()=>{I.getParent().removeChild(I)})}t.add(a,c)}animateDelete(t){this.GetDiagram().getLinksPane().addChild(this);var i=this,n=new e.AnimFadeOut(this.getCtx(),this,t.getAnimDur());e.Playable.appendOnEnd(n,()=>{i.getParent().removeChild(i),i.destroy()}),t.add(n,u)}animateInsert(t){this.setAlpha(0),t.add(new e.AnimFadeIn(this.getCtx(),this,t.getAnimDur()),_)}animateCollapse(t,i){if(i&&0!=i.length){var n=this._customPoints?this._customPoints:this.getPoints();Array.isArray(n)&&(n=n.slice());var s=this.getTranslateX(),o=this.getTranslateY();this.animateUpdate(t,i[0]);for(var a=1;a<i.length;a++){var r={id:"_fakeLink"+a+this.getId()};r=e.JsonUtils.merge(r,this.getData());var d=new p(this.GetDiagram().getCtx(),this.GetDiagram(),r,!0);d.render(),d.setPoints(n),d.setTranslate(s,o),d.animateUpdate(t,i[a],!0)}}}animateExpand(t,e){if(e&&0!=e.length)for(var i=0;i<e.length;i++)e[i].animateUpdate(t,this)}setLabelAlignments(t,i){var n=this._labelObj instanceof e.MultilineText||this._labelObj instanceof e.BackgroundMultilineText;"baseline"==i&&(i=n?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_AUTO),this._labelObj.setHorizAlignment(t),this._labelObj.setVertAlignment(i)}setGroupId(t){this._groupId=t}getGroupId(){return this._groupId}static _getCommonAncestorId(t,e){for(var i=(t,e)=>{for(var i=[],n=e.getNodeById(t)?e.getNodeById(t).getGroupId():null;n;)i.push(n),n=e.getNodeById(n)?e.getNodeById(n).getGroupId():null;return i},n=i(t.getStartId(),e),s=i(t.getEndId(),e),o=0;o<n.length;o++)if(s.indexOf(n[o])>-1)return n[o];return null}static GetPromotedLinkId(t,e,i){return t.isDataProviderMode()?{name:"_promoted",startId:e,endId:i}:"_plL"+e+"_L"+i}ShowDropEffect(){this._dropEffect||this._createDropEffect("oj-diagram-link oj-active-drop")}ShowRejectedDropEffect(){this._dropEffect||this._createDropEffect("oj-diagram-link oj-invalid-drop")}ClearDropEffect(){this._dropEffect&&(this.removeChild(this._dropEffect),this._dropEffect=null)}_createDropEffect(t){var i=e.CSSStyle.toNumber(this.getData()._hitDetectionOffset);this._dropEffect=this.CreateFeedbackUnderlay("#000000",0,i,null,t),this._dropEffect.setMouseEnabled(!1),this.addChild(this._dropEffect)}static ConvertLinkData(t){return{id:t.id,startNode:t.startNode,endNode:t.endNode,label:t.label,selectable:t.selectable,shortDesc:t.shortDesc,categories:t.categories,_itemData:t}}getAnimationState(){var t,e;this._labelObj&&((t={matrix:this._labelObj.getMatrix()}).getMatrix=()=>t.matrix),this.getShape()&&((e={stroke:this.getShape().getStroke()}).getStroke=()=>e.stroke);var i=this.isPromoted()?this.getData()._links:null;return{partialUpdate:!0,id:this.getId(),promoted:this.isPromoted(),includedLinks:i,points:this.getPoints(),shape:e,tx:this.getTranslateX(),ty:this.getTranslateY(),_labelObj:t,getId:function(){return this.id},isPromoted:function(){return this.promoted},getData:function(){return{_links:this.includedLinks}},getPoints:function(){return this.points},getShape:function(){return this.shape},getTranslateX:function(){return this.tx},getTranslateY:function(){return this.ty}}}static _fixLinkPath(t){var i=t.getContainerElem().querySelector(".oj-diagram-link-path");if(i){var n=t._customPoints,s=h.IsPath(n)?n:h.ConvertToPath(n);i.setAttributeNS(null,"d",e.PathUtils.getPathString(s))}}static _getFadeInCustomItems(t,e,i){var n,s=[];if(e&&i){var o=t;Array.isArray(t)&&t.forEach(t=>{t.contains(e)?o=t:s.push(t)});for(var a=e;a!==o;)s=s.concat(((t,e)=>{for(var i=[];t;)1===t.nodeType&&t!==e&&i.push(t),t=t.nextSibling;return i})((n=a).parentNode.firstChild,n)),a=a.parentNode}else t&&(s=Array.isArray(t)?t:[t]);return s}static _insertCustomElem(t,e,i){var n=i?i.getOuterElem():null;t&&t.getContainerElem().insertBefore(e,n)}_getCustomRenderer(t){var e=this._diagram.getOptions().linkContent,i=null;if(e){var n=e.renderer;i=e[t],i=n&&i?i:n}return i}GetCreationFeedbackPoints(t){var e=this._customPoints?this._customPoints:this.getPoints();return[e[0],e[1],t.x,t.y]}static _processLinkContent(t){var i=null;if(t.namespaceURI===e.ToolkitUtils.SVG_NS&&"svg"===t.tagName)i=[],Array.prototype.forEach.call(t.childNodes,t=>{i.push(t)});else if(t.namespaceURI===e.ToolkitUtils.SVG_NS)i=t;else if(Array.isArray(t)){i=[];for(var n=0;n<t.length;n++){if(t[n].namespaceURI===e.ToolkitUtils.SVG_NS&&"svg"===t[n].tagName){Array.prototype.forEach.call(t[n].childNodes,t=>{i.push(t)});break}t[n].namespaceURI===e.ToolkitUtils.SVG_NS&&i.push(t[n])}}return Array.isArray(i)&&0===i.length?null:i}_checkAndMoveContents(){return!!this._hasContentBoundToTouchEvent&&(this.GetDiagram().storeTouchEventContent(this._customLinkContent,this),this._contentStoredInTouchEventContainer=this._customLinkContent,this._hasContentBoundToTouchEvent=!1,!0)}getDisplayable(){return this}GetDiagram(){return this._diagram}getStartConnector(){return this._startConnector}getEndConnector(){return this._endConnector}setShape(t){this._shape=t}getShape(){return this._shape}setLabelRotationAngle(t){this._labelRotAngle=t,p.PositionLabel(this._labelObj,this.getLabelPosition(),t,this.getLabelRotationPoint())}getLabelRotationAngle(){return this._labelRotAngle}setLabelRotationPoint(t){this._labelRotPoint=t,p.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelRotationAngle(),t)}getLabelRotationPoint(){return this._labelRotPoint}getLabelPosition(){return this._labelPos}setLabelPosition(t){t&&(this._labelPos=t,p.PositionLabel(this._labelObj,t,this.getLabelRotationAngle(),this.getLabelRotationPoint()))}setLabelBounds(t){}setSelectable(t){this._selectable=t}isSelected(){return this._selected}setPromoted(t){this._bPromoted=t}isPromoted(){return this._bPromoted}GetAppliedLinkStyle(){return this.getLinkStyle()}GetAppliedLinkWidth(){return this.getLinkWidth()}CreateConnector(t,i,n){if(i){var s=this._shape.getStroke(),o=new e.Stroke(s.getColor(),s.getAlpha(),s.getWidth()),a=l.CreateConnectorShape(this.getCtx(),i,o,this);return a&&(this._shape.addChild(a),l.TransformConnector(a,i,t,n)),a}}getPoints(){return this._arPoints}static CalcLabelMatrix(t,i,n){var s=new e.Matrix;return null!=i&&(n&&(s=s.translate(-n.x,-n.y)),s=s.rotate(i),n&&(s=s.translate(n.x,n.y))),t&&(s=s.translate(t.x,t.y)),s}static PositionLabel(t,e,i,n){if(t){var s=p.CalcLabelMatrix(e,i,n);t.setMatrix(s)}}CreateUnderlay(t,i,n,s,o){i||0==i||(i=1),n||0==n||(n=0);var a=this.GetAppliedLinkWidth()+n,r=new e.Stroke(t,i,a,!0);return new g(this.getCtx(),this._pathCmds,r,s,o)}CreateFeedbackUnderlay(t,e,i,n,s){var o=this.CreateUnderlay(t,e,i,n,s);return this._startConnector&&this.getStartConnectorType()&&o.addUnderlayStart(this._points,this.getStartConnectorType(),this),this._endConnector&&this.getEndConnectorType()&&o.addUnderlayEnd(this._points,this.getEndConnectorType(),this),o}ReplaceConnectorColor(t,i){if(t){var n=null;if(i.getColor&&(n=i.getColor()),n){var s=t.getStroke(),o=t.getFill();s&&t.setStroke(new e.Stroke(n,s.getAlpha(),s.getWidth(),s.isFixedWidth(),s.getDashProps())),o&&t.setSolidFill(n)}}}getKeyboardBoundingBox(t){return this.getGroupId()&&this._diagram.getOptions().renderer?this._diagram.getCustomObjKeyboardBoundingBox(this):this.getDimensions(t)}getTargetElem(){return this.getElem()}setKeyboardFocusNode(t){this._keyboardNavNode=t}getKeyboardFocusNode(){return this._keyboardNavNode}}p.CUSTOM_STYLE="customStyle";const m={prepareNodeStyle:(t,i)=>{!t||null==t[i]||t[i]instanceof Object||(t[i]=e.CSSStyle.cssStringToObject(t[i]))},prepareLinkStyle:(t,e)=>{t&&null!=t[e]&&(t[e]instanceof Object?null==t[e]._type&&(t[e]._type=p.CUSTOM_STYLE):t[e]=h.getStrokeObject(t[e]))},getNodeDefaultStyles:t=>{var e=t.getOptions().styleDefaults.nodeDefaults;return m.prepareNodeStyle(e,"backgroundStyle"),m.prepareNodeStyle(e,"containerStyle"),e},getNodeStyles:(t,i,n)=>{if(t.isDataProviderMode())return e.JsonUtils.merge(i,n,{_itemData:!0,id:!0,nodes:!0});var s={id:i.id,label:i.label,selectable:i.selectable,shortDesc:i.shortDesc,categories:i.categories,nodes:i.nodes,_itemData:i};if(t.getOptions().nodeProperties){var o=e.JsonUtils.clone(t.getOptions().nodeProperties(i));m.prepareNodeStyle(o,"backgroundStyle"),m.prepareNodeStyle(o,"containerStyle"),s=e.JsonUtils.merge(s,o,{_itemData:!0})}return e.JsonUtils.merge(s,n,{_itemData:!0})},getLinkDefaultStyles:(t,i)=>{var n=t.getOptions().styleDefaults[i];m.prepareLinkStyle(n,"style");var s=t.getCtx().isCustomElement()?"svgStyle":"style";return n[s]=e.JsonUtils.merge(n[s],n._style),t.getCtx().isCustomElement()&&["_type"].forEach(t=>{delete n[s][t]}),n},getLinkStyles:(t,i,n)=>{if(t.isDataProviderMode())return e.JsonUtils.merge(i,n,{_itemData:!0,id:!0});var s=p.ConvertLinkData(i);if(t.getOptions().linkProperties){var o=e.JsonUtils.clone(t.getOptions().linkProperties(i));m.prepareLinkStyle(o,"style"),s=e.JsonUtils.merge(s,o,{_itemData:!0})}return e.JsonUtils.merge(s,n,{_itemData:!0})},getAnimDur:t=>e.CSSStyle.getTimeMilliseconds(t.getOptions().styleDefaults.animationDuration)/1e3,getAnimOnDisplay:t=>t.getOptions().animationOnDisplay,getAnimOnDataChange:t=>t.getOptions().animationOnDataChange};class C extends e.Container{constructor(t,i,n){super(t,null,n.id),this._diagram=i,this._bDisclosed=!1,this._selected=!1,this._selectable=!0,this._data=n,this._isHighlighted=!0,this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null,this.isSelectable()&&this.setCursor(e.SelectionEffectUtils.getSelectingCursor()),this.hasActiveInnerElems=!1}GetDiagram(){return this._diagram}getData(){return this._data}setData(t){this._data=t}getId(){return this._data.id}getContentBounds(t){return!this._contentDims&&t&&(this._contentDims=this._calcContentDims()),this._contentDims}getLayoutBounds(t){return this.getContentBounds(t)}setLabelPosition(t){t&&(this._labelPos=t,C.PositionLabel(this._labelObj,t,this.getLabelRotationAngle(),this.getLabelRotationPoint()))}getLabelPosition(){return this._labelPos}setLabelBounds(t){}getLabelBounds(t){var e=null;return this._labelObj&&t&&(e=this._labelObj.getDimensions()),e}setSelected(t){var e=this._getState();this._selected=t;var i=this._getCustomRenderer("selectionRenderer");i?this._applyCustomNodeContent(i,this._getState(),e):this.processDefaultSelectionEffect(t),this.UpdateAriaLabel()}processDefaultSelectionEffect(t){this.getSelectionShape()&&this.getSelectionShape().setSelected(t)}isDisclosed(){return this._bDisclosed}setDisclosed(t){this._bDisclosed=t}isSelected(){return this._selected}setSelectable(t){this._selectable=t}isSelectable(){return this.GetDiagram().isSelectionSupported()&&"off"!=this.getData().selectable&&!this.hasActiveInnerElems}GetIcon(){return this._shape}render(){this._cleanUp();var t=this.getData(),e=this._getCustomRenderer("renderer");if(e){if(this._applyCustomNodeContent(e,this._getState(),{hovered:!1,selected:!1,focused:!1,zoom:1,expanded:!1,inActionableMode:!1},!0),this.isDisclosed()){var i=this.GetDiagram().getPanZoomCanvas().getZoom(),n=this.getElem().getBoundingClientRect(),s=this._childNodePane?this._childNodePane.getElem().getBoundingClientRect():null;s&&(this._containerPadding={left:(s.left-n.left)/i,right:(n.right-s.right)/i,top:(s.top-n.top)/i,bottom:(n.bottom-s.bottom)/i})}this._selectionShape&&(this.removeChild(this._selectionShape),this._selectionShape=null)}else this.isDisclosed()?C._renderContainer(this._diagram,t,this):(C._renderNodeBackground(this._diagram,t,this),C._renderNodeIcon(this._diagram,t,this)),C._addHoverSelectionDefaultStrokes(this.getSelectionShape(),t);C._renderNodeLabels(this._diagram,t,this),this._setDraggableStyleClass(),C._renderContainerButton(this._diagram,t,this),this.setAriaRole(this.isDisclosed()?"group":"img"),this.UpdateAriaLabel(),this._diagram.getEventManager().associate(this,this)}_applyCustomNodeContent(t,i,n,s){var o=this._diagram.getOptions()._contextHandler;if(o){var a=this.getDataContext(),r=null;if(this.isDisclosed()){var d=this.GetChildNodePane(),h=d.getDimensions();r={element:d.getElem(),w:h?h.w-h.x:null,h:h?h.h-h.y:null}}s&&this._nodeContext&&this._diagram.getOptions()._cleanTemplate(this.getId());var l=o("node",this.getElem(),this._customNodeContent,r,a,i,n),g=t(l);if(this._nodeContext=l,g||!this._customNodeContent||!this.getCtx().isCustomElement()){if(this._customNodeContent&&g!=this._customNodeContent)this._checkAndMoveContents()||(this._customNodeContent.namespaceURI===e.ToolkitUtils.SVG_NS?this.getContainerElem().removeChild(this._customNodeContent):Array.isArray(this._customNodeContent)?this._customNodeContent.forEach(t=>{this.getContainerElem().removeChild(t)}):this.removeChild(g)),this._customNodeContent=null;g===this._contentStoredInTouchEventContainer&&(this._hasContentBoundToTouchEvent=!0),g&&g.namespaceURI===e.ToolkitUtils.SVG_NS?this._customNodeContent||(this._appendChildElem(this.getContainerElem(),g,r?r.element:null),this._customNodeContent=g):g&&Array.isArray(g)?this._customNodeContent||(g.forEach(t=>{this._appendChildElem(this.getContainerElem(),t,r?r.element:null)}),this._customNodeContent=g):g instanceof e.BaseComponent?this._customNodeContent||(this.addChild(g),this._customNodeContent=g):g&&this._diagram.Log("Diagram: could not add custom node content for the node "+this.getId()+g,1)}}else this._diagram.Log("Diagram: could not add custom node content - context handler is undefined",1)}_appendChildElem(t,e,i){if(e.querySelector){var n=e.querySelector("oj-diagram-child-content");if(n){var s=n.parentNode;i?s.replaceChild(i,n):s.removeChild(n)}}this._labelObj?t.insertBefore(e,this._labelObj.getElem()):t.insertBefore(e,this._containerButton?this._containerButton.getElem():null)}static _renderNodeBackground(t,i,n){if(!t.getCtx().isCustomElement()){var s=i.backgroundSvgStyle||i.backgroundStyle,o=e.JsonUtils.clone(s),a=[e.CSSStyle.WIDTH,e.CSSStyle.HEIGHT,e.CSSStyle.BACKGROUND_COLOR,e.CSSStyle.BORDER_COLOR,e.CSSStyle.BORDER_WIDTH,e.CSSStyle.BORDER_RADIUS];if(!(s=C._getNodeCSSStyle(o,i._backgroundStyle,a)).isEmpty()){var r=e.CSSStyle.toNumber(s.getStyle(e.CSSStyle.WIDTH)),d=e.CSSStyle.toNumber(s.getStyle(e.CSSStyle.HEIGHT)),h=s.getStyle(e.CSSStyle.BACKGROUND_COLOR),l=s.getStyle(e.CSSStyle.BORDER_COLOR),g=e.CSSStyle.toNumber(s.getStyle(e.CSSStyle.BORDER_WIDTH)),u=e.CSSStyle.toNumber(s.getStyle(e.CSSStyle.BORDER_RADIUS)),c=new e.Rect(t.getCtx(),0,0,r,d);c.setSolidFill(h),u&&(c.setRx(u),c.setRy(u)),l&&c.setStroke(new e.Stroke(l,1,g)),o&&a.forEach(t=>{delete o[e.CSSStyle.cssStringToObjectProperty(t)]});var _=i.backgroundSvgClassName||i.backgroundClassName;c.setStyle(o).setClassName(_),n.addChild(c),n.setSelectionShape(c),n._background=c}}}static _renderNodeIcon(t,i,n){var s=i.icon;if(s){var o,a=s.width,r=s.height,d=s.color,h=s.borderRadius;o=s.source?new e.ImageMarker(t.getCtx(),a/2,r/2,a,r,h,s.source,s.sourceSelected,s.sourceHover,s.sourceHoverSelected):new e.SimpleMarker(t.getCtx(),s.shape,a/2,r/2,a,r,h),"none"!=s.pattern?o.setFill(new e.PatternFill(s.pattern,d)):o.setSolidFill(d),null!=s.opacity&&o.setAlpha(s.opacity),s.borderColor&&o.setStroke(new e.Stroke(s.borderColor,1,s.borderWidth));var l=s.svgStyle||s.style,g=s.svgClassName||s.className;o.setStyle(l).setClassName(g),n.addChild(o),n._shape=o,C._setIconPosition(i,n),n._background||n.setSelectionShape(o)}}static _setIconPosition(t,i){if(i._background){var n=t.icon,s=i._background.getWidth(),o=i._background.getHeight(),a=n.width,r=n.height,d=.5*(s-a),h=.5*(o-r);if(void 0!==n.positionX)d=parseFloat(n.positionX),e.Agent.isRightToLeft(i.getCtx())&&(d=s-d-a);else{var l=n.halign;"start"==l?l=e.Agent.isRightToLeft(i.getCtx())?"right":"left":"end"==l&&(l=e.Agent.isRightToLeft(i.getCtx())?"left":"right"),d="left"==l?0:"right"==l?s-a:d}void 0!==n.positionY?h=parseFloat(n.positionY):"top"==n.valign?h=0:"bottom"==n.valign&&(h=o-r),i._shape.setTranslate(d,h)}}static _renderNodeLabels(t,i,n){var s=i.label;if(s){var o=e.Agent.isRightToLeft(t.getCtx()),a=s.indexOf("\n")>0,r=o?e.MultilineText.H_ALIGN_RIGHT:e.MultilineText.H_ALIGN_LEFT,d=o?e.OutputText.H_ALIGN_RIGHT:e.OutputText.H_ALIGN_LEFT,h=a?r:d,l=a?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_TOP,g=C.createText(t.getCtx(),s,i.labelStyle,h,l,a),u=i.labelStyle.getMaxWidth()||i.labelStyle.getWidth(),c=e.CSSStyle.toNumber(u);u?c>0&&e.TextUtils.fitText(g,c,1/0,n)&&(n._labelObj=g):(n.addChild(g),n._labelObj=g)}}static createText(t,i,n,s,o,a){var r;return n.hasBackgroundStyles()?r=a?new e.BackgroundMultilineText(t,i,0,0,n,null,!0):new e.BackgroundOutputText(t,i,0,0,n):(r=a?new e.MultilineText(t,i,0,0,null,!0):new e.OutputText(t,i,0,0)).setCSSStyle(n),r.setHorizAlignment(s),r.setVertAlignment(o),r}static _addHoverSelectionDefaultStrokes(t,i){var n,s,o,a,r=i.hoverInnerColor,d=i.hoverOuterColor,h=i.selectionColor;if("redwood"===t.getCtx().getThemeBehavior()){var l;l=i.icon&&i.icon.color?i.icon.color:d,n=new e.Stroke(r,1,1,!0),s=new e.Stroke(l,1,3,!0),o=new e.Stroke(r,1,1,!0),a=new e.Stroke(h,1,3,!0),t.setHoverStroke(n,s).setSelectedStroke(o,a)}else{n=new e.Stroke(r,1,4,!0),s=new e.Stroke(d,1,8,!0),o=new e.Stroke(r,1,2,!0),a=new e.Stroke(h,1,6,!0);var g=new e.Stroke(r,1,4,!0),u=new e.Stroke(h,1,8,!0);t.setHoverStroke(n,s).setSelectedStroke(o,a).setSelectedHoverStroke(g,u)}}static _addHoverSelectionOuterStrokes(t,i){var n,s,o,a,r=i.hoverInnerColor,d=i.hoverOuterColor,h=i.selectionColor;if("redwood"===t.getCtx().getThemeBehavior())n=new e.Stroke(r,1,1,!0),s=new e.Stroke(d,1,3,!0),o=new e.Stroke(r,1,1,!0),a=new e.Stroke(h,1,3,!0),t.setHoverStroke(n,s).setSelectedStroke(o,a);else{n=new e.Stroke(r,1,2,!0),s=new e.Stroke(d,1,2,!0),o=new e.Stroke(r,1,1,!0),a=new e.Stroke(h,1,2,!0);var l=new e.Stroke(r,1,2,!0),g=new e.Stroke(h,1,2,!0);t.setHoverStroke(n,s).setSelectedStroke(o,a).setSelectedHoverStroke(l,g)}}setSelectionShape(t){this._selectionShape=t}getSelectionShape(){if(!this._selectionShape){var t=this.getContentBounds(!0);if(t){var i=new e.Rect(this._diagram.getCtx(),t.x,t.y,t.w,t.h);i.setInvisibleFill(),i.setStrokeAlignment("outer"),this.setSelectionShape(i),this.addChildAt(i,0),C._addHoverSelectionOuterStrokes(i,this.getData()),this._selectionShape=i}}return this._selectionShape}handleTouchStart(){this._hasContentBoundToTouchEvent=!0}handleTouchEnd(){this._hasContentBoundToTouchEvent=!1,this._contentStoredInTouchEventContainer=null}showHoverEffect(){if(!this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!0;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultHoverEffect(!0)}}hideHoverEffect(){if(this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!1;var e=this._getCustomRenderer("hoverRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultHoverEffect(!1)}}processDefaultHoverEffect(t){this.getSelectionShape()&&(t?this.getSelectionShape().showHoverEffect():this.getSelectionShape().hideHoverEffect())}getDatatip(){var t=this.GetDiagram().getOptions().tooltip,i=t?t.renderer:null;return i?this.GetDiagram().getCtx().getTooltipManager().getCustomTooltip(i,this.getDataContext()):e.Displayable.resolveShortDesc(this.getShortDesc(),()=>C.getShortDescContext(this))}getShortDesc(){return this.getData().shortDesc}getDataContext(){var t=this.getData(),e=t._noTemplate?t._itemData:t,i={id:this.getId(),type:"node",label:t.label,data:this.GetDiagram().isDataProviderMode()?e:t._itemData,itemData:this.GetDiagram().isDataProviderMode()?t._itemData:null,component:this.GetDiagram().getOptions()._widgetConstructor};return this.getCtx().fixRendererContext(i)}static getShortDescContext(t){var e=t.getData(),i=e._noTemplate?e._itemData:e;return{id:t.getId(),label:e.label,data:t.GetDiagram().isDataProviderMode()?i:e._itemData,itemData:t.GetDiagram().isDataProviderMode()?e._itemData:null}}getAriaLabel(){var t=this.GetDiagram().getOptions(),i=[],n=t.translations,s=t._keyboardUtils;return this.isSelectable()&&i.push(n[this.isSelected()?"stateSelected":"stateUnselected"]),this.isContainer()&&i.push(n[this.isDisclosed()?"stateExpanded":"stateCollapsed"]),s.getActionableElementsInNode(this.getElem()).length>0&&i.push(n.accessibleContainsControls),e.Displayable.generateAriaLabel(this.getShortDesc(),i,()=>C.getShortDescContext(this))}UpdateAriaLabel(){if(!e.Agent.deferAriaCreation()){var t=this.getAriaLabel();t&&this.setAriaProperty("label",t)}}getNextNavigable(t){var i=null;if(this.hasActiveInnerElems)return null;if(t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey)i=this;else if((t.keyCode==e.KeyboardEvent.OPEN_ANGLED_BRACKET||e.KeyboardEvent.CLOSE_ANGLED_BRACKET)&&t.altKey){var n=this.GetDiagram().getNavigableLinksForNodeId(this.getId()),s=this.GetDiagram().getEventManager().getKeyboardHandler();s&&s.getFirstNavigableLink&&(i=s.getFirstNavigableLink(this,t,n)),i?i.setKeyboardFocusNode(this):i=this}else if(t.keyCode==e.KeyboardEvent.OPEN_BRACKET){if(this.isDisclosed())i=this.getChildNodes()[0];else i=this}else if(t.keyCode==e.KeyboardEvent.CLOSE_BRACKET)i=(o=this.getGroupId()?this.GetDiagram().getNodeById(this.getGroupId()):null)||this;else if(t.type==e.MouseEvent.CLICK)i=this;else{var o=this.getGroupId()?this.GetDiagram().getNodeById(this.getGroupId()):null,a=o?o.getChildNodes():this.GetDiagram().GetRootNodeObjects();i=e.KeyboardHandler.getNextAdjacentNavigable(this,t,a)}return t instanceof e.KeyboardEvent&&this._diagram.ensureObjInViewport(t,i),i}HandleKeyboardEvent(t){t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey&&t.shiftKey&&this.isContainer()&&this.GetDiagram().setNodeDisclosed(this.getId(),!this.isDisclosed())}isContainer(){if(this._diagram.isTreeDataProvider()){var t=this._diagram.getOptions().nodeData.getChildDataProvider(this.getId());return!!t&&"yes"!==t.isEmpty()}return!this._diagram.isDataProviderMode()&&0!=this.GetDiagram().getOptions().data.getChildCount(this.getData())}showKeyboardFocusEffect(){if(!this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!0;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultFocusEffect(!0)}}hideKeyboardFocusEffect(){if(this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!1;var e=this._getCustomRenderer("focusRenderer");e?this._applyCustomNodeContent(e,this._getState(),t):this.processDefaultFocusEffect(!1)}}processDefaultFocusEffect(t){this.processDefaultHoverEffect(t)}isShowingKeyboardFocusEffect(){return this._isShowingKeyboardFocusEffect}getCategories(){return this.getData().categories?this.getData().categories:[this.getId()]}isHidden(){var t=this.GetDiagram().getOptions().hiddenCategories;return!(!t||!e.ArrayUtils.hasAnyItem(t,this.getCategories()))}_calcContentDims(){var t,i=null;if(this._customNodeContent)if(this._customNodeContent instanceof e.BaseComponent)(t=this._customNodeContent.getDimensions())&&(i=new e.Rectangle(t.x,t.y,t.w,t.h));else{var n=this._customNodeContent;if(Array.isArray(n))for(var s=0;s<n.length;s++)if(n[s].namespaceURI===e.ToolkitUtils.SVG_NS){n=n[s];break}(t=n.getBBox())&&(i=new e.Rectangle(t.x,t.y,t.width,t.height))}else this.isDisclosed()?i=this._containerShape.GetDimensionsWithStroke(this):(i=this._background?this._background.GetDimensionsWithStroke(this):null)&&this._shape?i=i.getUnion(this._shape.GetDimensionsWithStroke(this)):!i&&this._shape&&(i=this._shape.GetDimensionsWithStroke(this));return i}animateUpdate(t,i){var n,s,o=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur());if(this.isDisclosed()||i.isDisclosed())if(this.isDisclosed()&&i.isDisclosed())if(i._labelObj&&this._labelObj&&(n=i._labelObj.getMatrix(),s=this._labelObj.getMatrix(),n.equals(s)||(this._labelObj.setMatrix(n),o.getAnimator().addProp(e.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,s))),this._getCustomRenderer("renderer"))this._animateCustomUpdate(t,i);else{if(C._animatePosition(o,i,this),C._animateContainer(o,i._containerShape,this._containerShape),e.Agent.isRightToLeft(this.getCtx())&&i._containerButton&&this._containerButton){var a=i._containerButton.getTranslateX(),r=this._containerButton.getTranslateX();a!=r&&(this._containerButton.setTranslateX(a),o.getAnimator().addProp(e.Animator.TYPE_NUMBER,this._containerButton,this._containerButton.getTranslateX,this._containerButton.setTranslateX,r))}if(!i.partialUpdate){for(var d=[],h=[],l=this.getChildNodeIds(),g=0;g<l.length;g++)d.push(this.GetDiagram().getNodeById(l[g]));for(var u=i.getChildNodeIds(),_=t.getOldDiagram().NodesMap,p=0;p<u.length;p++)h.push(_.get(u[p]));t.constructAnimation(h,d)}}else this._animateCustomUpdate(t,i);else C._animatePosition(o,i,this),i._shape&&this._shape&&(o.getAnimator().addProp(e.Animator.TYPE_RECTANGLE,this._shape,this._shape.getCenterDimensions,this._shape.setCenterDimensions,this._shape.getCenterDimensions()),this._shape.setCenterDimensions(i._shape.getCenterDimensions())),i._labelObj&&this._labelObj&&(n=i._labelObj.getMatrix(),s=this._labelObj.getMatrix(),n.equals(s)||(this._labelObj.setMatrix(n),o.getAnimator().addProp(e.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,s))),C._animateFill(o,i._background,this._background),C._animateFill(o,i._shape,this._shape);t.add(o,c)}_animateCustomUpdate(t,i){var n,s=i.getContentBounds(),o=this.getContentBounds();if(s.equals(o))return n=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur()),C._animatePosition(n,i,this),void t.add(n,c);var a=o.w/s.w,r=s.w/o.w;n=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur());var d=new e.Point(i.getTranslateX()+.5*s.w,i.getTranslateY()+.5*s.h),h=this.getTranslateX(),l=this.getTranslateY();this.setTranslateX(d.x-o.w*r*.5),this.setTranslateY(d.y-o.w*r*.5),n.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateX,this.setTranslateX,h),n.getAnimator().addProp(e.Animator.TYPE_NUMBER,this,this.getTranslateY,this.setTranslateY,l),t.add(n,c),this.setScaleX(r),this.setScaleY(r);var g=new e.AnimScaleTo(this.getCtx(),this,new e.Point(1,1),t.getAnimDur());t.add(g,c);var u=i.partialUpdate?i.origContent:i;if(u){this.getParent().addChild(u);var _=new e.Point(this.getTranslateX()+.5*o.w,this.getTranslateY()+.5*o.h);n.getAnimator().addProp(e.Animator.TYPE_NUMBER,u,i.getTranslateX,u.setTranslateX,_.x-s.w*a*.5),n.getAnimator().addProp(e.Animator.TYPE_NUMBER,u,i.getTranslateY,u.setTranslateY,_.y-s.h*a*.5);var p=new e.AnimScaleTo(this.getCtx(),u,new e.Point(a,a),t.getAnimDur());t.add(p,c);var m=new e.AnimFadeOut(this.getCtx(),u,t.getAnimDur());t.add(m,c);var v=this;e.Playable.appendOnEnd(m,()=>{v.getParent().removeChild(u)}),this.setAlpha(0);var y=new e.AnimFadeIn(this.getCtx(),this,t.getAnimDur());t.add(y,c)}}static _animatePosition(t,i,n){if(n&&i){var s=i.getTranslateX(),o=i.getTranslateY(),a=n.getTranslateX(),r=n.getTranslateY();s!=a&&(n.setTranslateX(s),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,n,n.getTranslateX,n.setTranslateX,a)),o!=r&&(n.setTranslateY(o),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,n,n.getTranslateY,n.setTranslateY,r))}}static _animateContainer(t,i,n){n&&i&&(C._animateFill(t,i,n),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,n,n.getWidth,n.setWidth,n.getWidth()),n.setWidth(i.getWidth()),t.getAnimator().addProp(e.Animator.TYPE_NUMBER,n,n.getHeight,n.setHeight,n.getHeight()),n.setHeight(i.getHeight()))}static _animateFill(t,i,n){i&&n&&n.getFill()instanceof e.SolidFill&&!n.getFill().equals(i.getFill())&&(t.getAnimator().addProp(e.Animator.TYPE_FILL,n,n.getFill,n.setFill,n.getFill()),n.setFill(i.getFill()))}animateDelete(t){this.GetDiagram().getNodesPane().addChild(this);var i=new e.AnimFadeOut(this.getCtx(),this,t.getAnimDur());e.Playable.appendOnEnd(i,()=>{this.getParent().removeChild(this),this.destroy()}),t.add(i,u)}animateInsert(t){this.setAlpha(0),t.add(new e.AnimFadeIn(this.getCtx(),this,t.getAnimDur()),_)}_getState(t){return{hovered:this._isShowingHoverEffect,selected:this.isSelected(),focused:this._isShowingKeyboardFocusEffect,zoom:t||this.GetDiagram().getPanZoomCanvas().getZoom(),expanded:this.isDisclosed(),inActionableMode:this.hasActiveInnerElems}}rerenderOnZoom(t){var e=this._getCustomRenderer("zoomRenderer");if(e){var i=this._getState(t.oldZoom),n=this._getState(t.newZoom);this._applyCustomNodeContent(e,n,i)}}highlight(t){if(this._isHighlighted!==t){this._isHighlighted=t;var e=t?1:this._diagram.getOptions().styleDefaults._highlightAlpha;!this._customNodeContent&&this.isDisclosed()?(this._containerShape&&this._containerShape.setAlpha(e),this._containerButton&&this._containerButton.setAlpha(e),this._labelObj&&this._labelObj.setAlpha(e),this._selectionShape&&this._selectionShape.setAlpha(e)):this.setAlpha(e)}}setLabelAlignments(t,i){var n=this._labelObj instanceof e.MultilineText||this._labelObj instanceof e.BackgroundMultilineText;"baseline"==i&&(i=n?e.MultilineText.V_ALIGN_TOP:e.OutputText.V_ALIGN_AUTO),this._labelObj.setHorizAlignment(t),this._labelObj.setVertAlignment(i)}getContainerPadding(){if(!this._containerPadding&&this._getCustomRenderer("renderer")){var t=this.GetDiagram().getPanZoomCanvas().getZoom(),e=this.getElem().getBoundingClientRect(),i=this._childNodePane?this._childNodePane.getElem().getBoundingClientRect():null;i&&(this._containerPadding={left:(i.left-e.left)/t,right:(e.right-i.right)/t,top:(i.top-e.top)/t,bottom:(e.bottom-i.bottom)/t})}else if(!this._containerPadding){var n=this._data.containerSvgStyle||this._data.containerStyle,s=C._getNodeCSSStyle(n,this._data._containerStyle,["padding-left","padding-right","padding-top","padding-bottom"]);this._containerPadding={left:s.getPadding("padding-left"),right:s.getPadding("padding-right"),top:s.getPadding("padding-top"),bottom:s.getPadding("padding-bottom")}}return this._containerPadding}setContainerPadding(){}getChildNodeIds(){return this._childNodeIds}addChildNodeId(t){this._childNodeIds||(this._childNodeIds=[]),this._childNodeIds.push(t)}removeChildNodeId(t){this._childNodeIds&&e.ArrayUtils.removeItem(this._childNodeIds,t)}removeChildNode(t){t&&(this.removeChildNodeId(t.getId()),this._childNodePane.removeChild(t))}getChildNodes(){for(var t=[],e=this._childNodeIds?this._childNodeIds.length:-1,i=0;i<e;i++){var n=this.GetDiagram().getNodeById(this._childNodeIds[i]);n&&t.push(n)}return t}setGroupId(t){this._groupId=t}getGroupId(){return this._groupId}GetChildNodePane(t){return this._childNodePane||t||(this._childNodePane=new e.Container(this.getCtx()),this.addChild(this._childNodePane)),this._childNodePane}handleDisclosure(t){e.EventManager.consumeEvent(t),this._diagram.setNodeDisclosed(this.getId(),!this.isDisclosed())}static _renderContainer(t,i,n){var s=t.getCtx().isCustomElement()?null:i.containerSvgStyle||i.containerStyle,o=e.JsonUtils.clone(s),a=[e.CSSStyle.BACKGROUND_COLOR,e.CSSStyle.BORDER_COLOR,e.CSSStyle.BORDER_WIDTH,e.CSSStyle.BORDER_RADIUS],r=C._getNodeCSSStyle(o,i._containerStyle,a),d=r.getStyle(e.CSSStyle.BACKGROUND_COLOR),h=r.getStyle(e.CSSStyle.BORDER_COLOR),l=e.CSSStyle.toNumber(r.getStyle(e.CSSStyle.BORDER_WIDTH)),g=e.CSSStyle.toNumber(r.getStyle(e.CSSStyle.BORDER_RADIUS)),u=n.GetChildNodePane(),c=n.getContainerPadding();u.setTranslate(c.left,c.top);var _=u.getDimensionsWithStroke(),p=new e.Rect(t.getCtx(),0,0,_.w+c.left+c.right,_.h+c.top+c.bottom);p.setSolidFill(d),g&&(p.setRx(g),p.setRy(g)),h&&p.setStroke(new e.Stroke(h,1,l)),o&&a.forEach(t=>{delete o[e.CSSStyle.cssStringToObjectProperty(t)]});var m=t.getCtx().isCustomElement()?null:i.containerSvgClassName||i.containerClassName;p.setStyle(o).setClassName(m),n.addChildAt(p,0),n.setSelectionShape(p),n._containerShape=p}static _getNodeCSSStyle(t,i,n){var s=new e.CSSStyle;return n.forEach(n=>{var o=null,a=e.CSSStyle.cssStringToObjectProperty(n);t&&null!=t[a]?o=t[a]:i&&(o=i.getStyle(n)),s.setStyle(n,o)}),s}static _renderContainerButton(t,i,n){if(n.isContainer()&&"off"!=i.showDisclosure){var s=t.getCtx(),o=e.Agent.isRightToLeft(s),a=t.getOptions(),r=o?"M1 0 19 0 A 1 1 0 0 1 20 1 L 20 19 A 1 1 0 0 1 19 19 L 1 1 A 1 1 0 0 1 1 0z":"M1 0 19 0 A 1 1 0 0 1 19 1 L 1 19 A 1 1 0 0 1 0 19 L 0 1 A 1 1 0 0 1 1 0z",d=new e.Path(s,r),h=a._resources[n.isDisclosed()?"collapse":"expand"],l=e.ToolkitUtils.getIconStyle(s,h.icon),g=h.width/2+1,u=o?20-g:g,c=new e.IconButton(t.getCtx(),"outlined",{style:l,size:h.width,pos:{x:u,y:g}},d,null,n.handleDisclosure,n);n.addChild(c);var _=n.getContentBounds(!0);if(_){var p=o?_.x+_.w-20-.5:_.x+.5,m=_.y+.5;c.setTranslate(p,m)}n._containerButton=c}}isDragAvailable(){return!0}getDragTransferable(){return this._isDraggable()?[this.getId()]:null}getDragFeedback(){if(this._diagram.getEventManager().LinkCreationStarted)return null;if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1){for(var t=this._diagram.getSelectionHandler().getSelection(),e=[],i=0;i<t.length;i++)e.push(t[i]);return e}return this}ShowDropEffect(){this._dropEffect||this._createDropEffect("oj-active-drop")}ShowRejectedDropEffect(){this._dropEffect||this._createDropEffect("oj-invalid-drop")}ClearDropEffect(){this._dropEffect&&(this.removeChild(this._dropEffect),this._dropEffect=null)}_createDropEffect(t){var i;if(this._customNodeContent||this.isDisclosed()||this._background||this._shape&&this._shape instanceof e.ImageMarker){var n=this.getContentBounds(!0);if(n){i=new e.Rect(this._diagram.getCtx(),n.x,n.y,n.w,n.h);var s=this._customNodeContent?null:this.isDisclosed()?this._containerShape.getRx():this._background?this._background.getRx():null;s&&(i.setRx(s),i.setRy(s))}}else this._shape&&this._shape instanceof e.SimpleMarker&&(i=this._shape.copyShape());i&&(i.setInvisibleFill(),i.setClassName(t),i.setMouseEnabled(!1)),this.addChild(i),this._dropEffect=i}_setDraggableStyleClass(){if(this._diagram.getEventManager().IsDragSupported()&&this._isDraggable()){var t=this._customNodeContent?this:this.isDisclosed()?this._containerShape:this._background?this._background:this._shape,i=t.getElem()?t.getElem():t;e.ToolkitUtils.addClassName(i,"oj-draggable")}}_isDraggable(){return"off"!==this.getData().draggable&&!1!==this.getData().draggable}_cleanUp(t){if(this._containerShape&&(this.removeChild(this._containerShape),t&&t.addChild(this._containerShape),this._containerShape=null),this._background&&(this.removeChild(this._background),t&&t.addChild(this._background),this._background=null),this._shape&&(this.removeChild(this._shape),t&&t.addChild(this._shape),this._shape=null),this._labelObj&&(this.removeChild(this._labelObj),t&&t.addChild(this._labelObj),this._labelObj=null),this._containerButton&&(this.removeChild(this._containerButton),t&&t.addChild(this._containerButton),this._containerButton=null),this._customNodeContent){if(this._childNodePane&&(this._childNodePane.setParent(null),this.addChild(this._childNodePane)),this._customNodeContent.namespaceURI===e.ToolkitUtils.SVG_NS)this.getContainerElem().removeChild(this._customNodeContent),t&&e.ToolkitUtils.appendChildElem(t.getContainerElem(),this._customNodeContent);else if(Array.isArray(this._customNodeContent))for(var i=0;i<this._customNodeContent.length;i++)this.getContainerElem().removeChild(this._customNodeContent[i]),t&&e.ToolkitUtils.appendChildElem(t.getContainerElem(),this._customNodeContent[i]);else this._customNodeContent instanceof e.BaseComponent&&(this.removeChild(this._customNodeContent),t&&t.addChild(this._customNodeContent));this._customNodeContent=null}this._contentDims=null}getAnimationState(t){var i,n,s,o,a=this.getContentBounds();return this._shape&&((i={centerDimensions:this._shape.getCenterDimensions(),fill:this._shape.getFill()}).getCenterDimensions=()=>i.centerDimensions,i.getFill=()=>i.fill),this._labelObj&&((n={matrix:this._labelObj.getMatrix()}).getMatrix=()=>n.matrix),this.isDisclosed()&&this._containerShape&&((s={fill:this._containerShape.getFill(),width:this._containerShape.getWidth(),height:this._containerShape.getHeight()}).getFill=()=>s.fill,s.getWidth=()=>s.width,s.getHeight=()=>s.height),t&&(o=new e.Container(this.getCtx()),this._cleanUp(o),o.setTranslate(this.getTranslateX(),this.getTranslateY())),{partialUpdate:!0,id:this.getId(),disclosed:this.isDisclosed(),tx:this.getTranslateX(),ty:this.getTranslateY(),contentBounds:a,origContent:o,_shape:i,_labelObj:n,_containerShape:s,getId:function(){return this.id},isDisclosed:function(){return this.disclosed},getTranslateX:function(){return this.tx},getTranslateY:function(){return this.ty},getContentBounds:function(){return this.contentBounds}}}appendChildNodesData(t,i){this._data.nodes instanceof Array||(this._data.nodes=[]),this._data.nodes=e.ArrayUtils.insert(this._data.nodes,t,i)}removeChildNodesData(t){if(this._data.nodes instanceof Array)for(var e=0;e<t.length;e++)for(var i=t[e].id,n=0;n<this._data.nodes.length;n++)if(this._data.nodes[n].id===i){this._data.nodes.splice(n,1);break}}_getCustomRenderer(t){var e=this._diagram.getOptions().nodeContent,i=null;if(e){var n=e.renderer;i=e[t],i=n&&i?i:null}return i}_checkAndMoveContents(){return!!this._hasContentBoundToTouchEvent&&(this.GetDiagram().storeTouchEventContent(this._customNodeContent,this),this._contentStoredInTouchEventContainer=this._customNodeContent,this._hasContentBoundToTouchEvent=!1,!0)}CanOptimizeDimensions(){return!this._customNodeContent}getDisplayable(){return this}setLabelRotationAngle(t){this._labelRotAngle=t,C.PositionLabel(this._labelObj,this.getLabelPosition(),t,this.getLabelRotationPoint())}getLabelRotationAngle(){return this._labelRotAngle}setLabelRotationPoint(t){this._labelRotPoint=t,C.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelRotationAngle(),t)}getLabelRotationPoint(){return this._labelRotPoint}GetNodeBounds(){var t=this.getLayoutBounds(!0),i=new e.Rectangle(t.x,t.y,t.w,t.h),n=this.getLabelPosition(),s=this.getLabelRotationAngle(),o=this.getLabelRotationPoint(),a=this.getLabelBounds(!0);return n&&a&&(null!=s&&(a=d.RotateBounds(a,s,o)),i.x=Math.min(t.x,a.x+n.x),i.y=Math.min(t.y,a.y+n.y),i.w=Math.max(t.x+t.w,a.x+n.x+a.w)-i.x,i.h=Math.max(t.y+t.h,a.y+n.y+a.h)-i.y),i}static CalcLabelMatrix(t,i,n){var s=new e.Matrix;return null!=i&&(n&&(s=s.translate(-n.x,-n.y)),s=s.rotate(i),n&&(s=s.translate(n.x,n.y))),t&&(s=s.translate(t.x,t.y)),s}static PositionLabel(t,e,i,n){if(t){var s=C.CalcLabelMatrix(e,i,n);t.setMatrix(s)}}SetPosition(t,e){this.setTranslate(t,e)}GetPosition(){return new e.Point(this.getTranslateX(),this.getTranslateY())}getKeyboardBoundingBox(t){if(this._customNodeContent)return this._diagram.getCustomObjKeyboardBoundingBox(this);var i=this.getContentBounds(t),n=this.localToStage(new e.Point(i.x,i.y)),s=this.localToStage(new e.Point(i.x+i.w,i.y+i.h));return new e.Rectangle(n.x,n.y,s.x-n.x,s.y-n.y)}getTargetElem(){return this.getElem()}addOutLinkId(t){this._outLinkIds||(this._outLinkIds=[]),this._outLinkIds.push(t)}removeOutLinkId(t){if(this._outLinkIds){var e=this._outLinkIds.indexOf(t);-1!=e&&this._outLinkIds.splice(e,1)}}getOutLinkIds(){return this._outLinkIds}addInLinkId(t){this._inLinkIds||(this._inLinkIds=[]),this._inLinkIds.push(t)}removeInLinkId(t){if(this._inLinkIds){var e=this._inLinkIds.indexOf(t);-1!=e&&this._inLinkIds.splice(e,1)}}getInLinkIds(){return this._inLinkIds}}class v extends e.EventManager{constructor(t,e,i){super(t,e,i,i),this._linkDragSelector=null,this._linkDropSelector=null,this._prevRolloverEvent=null,this.OJ_ACTIVE_DROP="oj-active-drop",this.OJ_INVALID_DROP="oj-invalid-drop"}addListeners(t){super.addListeners(t),this._component.addEvtListener("focusout",this._handleFocusout,!1,this),this._component.addEvtListener("focusin",this._handleFocusin,!1,this)}RemoveListeners(t){super.RemoveListeners(t),this._component.removeEvtListener("focusout",this._handleFocusout,!1,this),this._component.removeEvtListener("focusin",this._handleFocusin,!1,this),this._clearOpenPopupListeners()}_clearFocusoutTimeout(){this._focusoutTimeout&&(clearTimeout(this._focusoutTimeout),this._focusoutTimeout=null)}_clearOpenPopupListeners(){null!=this._openPopup&&(this._openPopup.removeEventListener("focusin",this._handlePopupFocusinListener),this._openPopup.removeEventListener("focusout",this._handlePopupFocusoutListener),this._openPopup=null),this._handlePopupFocusinListener=null,this._handlePopupFocusoutListener=null}_handlePopupFocusout(t){this._handleFocusout(t,!0)}_handlePopupFocusin(t){this._handleFocusin(t,!0)}_handleFocusout(t,e){if(this._clearFocusoutTimeout(),!e){this._clearOpenPopupListeners();var i=n.getLogicalChildPopup(this._component.getElem());if(null!=i)return this._openPopup=i,this._handlePopupFocusinListener=this._handlePopupFocusin.bind(this),this._handlePopupFocusoutListener=this._handlePopupFocusout.bind(this),i.addEventListener("focusin",this._handlePopupFocusinListener),void i.addEventListener("focusout",this._handlePopupFocusoutListener)}this._focusoutTimeout=setTimeout(function(){var t=this._component.getOptions()._keyboardUtils;if(this._component.activeInnerElemsNodeId){const e=this._component.getNodeById(this._component.activeInnerElemsNodeId);t.disableAllFocusable(e.getElem(),!0),e.hasActiveInnerElems=!1,this._component.activeInnerElems=null,this._component.activeInnerElemsNodeId=null}}.bind(this),100)}_handleFocusin(t,e){this._clearFocusoutTimeout(),e||this._clearOpenPopupListeners()}showFocusEffect(t,e){this.ShowFocusEffect(t,e)}ShowFocusEffect(t,e){this._component.isPanning()||super.ShowFocusEffect(t,e)}ProcessRolloverEvent(t,i,n){var s=this._component.getOptions();if("dim"==s.hoverBehavior&&(!this._prevRolloverEvent||this._prevRolloverEvent.obj!==i||this._prevRolloverEvent.bOver!==n)){var o=i.getCategories?i.getCategories():[];s.highlightedCategories=n?o.slice():null;var a=e.EventFactory.newCategoryHighlightEvent(s.highlightedCategories,n),r=e.CSSStyle.getTimeMilliseconds(s.styleDefaults.hoverBehaviorDelay);this.RolloverHandler.processEvent(a,this._component.GetAllNodeObjects(),r,"any"==s.highlightMatch),this._prevRolloverEvent={obj:i,bOver:n}}}CreateCategoryRolloverHandler(t,e){return new r(t,e)}ProcessKeyboardEvent(t){var i=!0,n=t.keyCode,s=this.getFocus(),o=s instanceof C?s._customNodeContent:null;if(o&&n!=e.KeyboardEvent.TAB&&this._bPassOnEvent)o.fireKeyboardListener(t),t.preventDefault();else if(n==e.KeyboardEvent.TAB&&o instanceof e.BaseComponent)!t.shiftKey&&s.isShowingKeyboardFocusEffect()?(s.hideKeyboardFocusEffect(),o.fireKeyboardListener(t),t.preventDefault(),this._bPassOnEvent=!0):t.shiftKey&&this._bPassOnEvent?(this.ShowFocusEffect(t,s),t.preventDefault(),this._bPassOnEvent=!1):(this._bPassOnEvent&&s.showKeyboardFocusEffect(),i=super.ProcessKeyboardEvent(t),this._bPassOnEvent=!1);else if(n==e.KeyboardEvent.SPACE&&t.ctrlKey&&t.shiftKey)s&&s.HandleKeyboardEvent&&s.HandleKeyboardEvent(t);else if((n==e.KeyboardEvent.ZERO||n==e.KeyboardEvent.NUMPAD_ZERO)&&t.ctrlKey&&t.altKey){if(s){var a=this._component.getPanZoomCanvas(),r=s.getKeyboardBoundingBox(this.getCtx().getStage()),d=a.getContentPane().stageToLocal({x:r.x,y:r.y}),h=a.getContentPane().stageToLocal({x:r.x+r.w,y:r.y+r.h}),l={x:d.x,y:d.y,w:h.x-d.x,h:h.y-d.y},g="none"!=m.getAnimOnDataChange(this._component)?new e.Animator(this.getCtx(),this._component.getAnimDur()):null;a.zoomToFit(g,l),g&&g.play()}}else{if(n==e.KeyboardEvent.TAB&&s){var u=this._component.activeInnerElems?this._component.activeInnerElems.length:void 0;if(u)return(t.shiftKey?this._component.activeInnerElems[0]:this._component.activeInnerElems[u-1])===document.activeElement&&(t.shiftKey?this._component.activeInnerElems[u-1].focus():this._component.activeInnerElems[0].focus(),t.preventDefault()),i;this._component.ensureObjInViewport(t,s);var c=this._component.Options._keyboardUtils;c.disableAllFocusable(this._component.getNodesPane().getElem(),!0,!0),c.disableAllFocusable(this._component.getLinksPane().getElem(),!0,!0)}i=super.ProcessKeyboardEvent(t)}return i}GetTouchResponse(){var t=this._component.getOptions();return"none"!==t.panning||"none"!==t.zooming?e.EventManager.TOUCH_RESPONSE_TOUCH_HOLD:t.touchResponse===e.EventManager.TOUCH_RESPONSE_TOUCH_START?e.EventManager.TOUCH_RESPONSE_TOUCH_START:e.EventManager.TOUCH_RESPONSE_AUTO}HandleTouchClickInternal(t){return this.GetEventInfo(t,"panned")}StoreInfoByEventType(t){return"panned"!=t&&super.StoreInfoByEventType(t)}isDndSupported(){return!0}GetDragSourceType(t){var e,i=this.DragSource.getDragObject();return i&&i.__dragType?i.__dragType:i instanceof C?(null===this._linkDragSelector&&(this._linkDragSelector=this._component.getOptions().dnd.drag.ports.selector),this._linkDragSelector&&(e=this._getPortElement(document.elementFromPoint(t.getNativeEvent().clientX,t.getNativeEvent().clientY),this._linkDragSelector))&&(this.LinkCreationStarted=!0,i.__dragPort=e),i.__dragType=e?"ports":"nodes",i.__dragType):null}GetDragDataContexts(t){var i,n=this.DragSource.getDragObject(),s=[];if(this._component.isSelectionSupported()&&this._component.getSelectionHandler().getSelectedCount()>1){for(var o=this._component.getSelectionHandler().getSelection(),a=this._getTopLeftContentCorner(o),r=this._component.getPanZoomCanvas().getZoom(),d=0;d<o.length;d++)if(o[d]instanceof C){i=o[d].getDataContext();var h=o[d].getDimensions(this._context.getStage());i.nodeOffset=new e.Point((h.x-a.x)/r,(h.y-a.y)/r),t&&e.ToolkitUtils.cleanDragDataContext(i),s.push(i)}}else if(n instanceof C){if(i=n.getDataContext(),t&&e.ToolkitUtils.cleanDragDataContext(i),"ports"===n.__dragType&&n.__dragPort)return t?{dataContext:i}:{dataContext:i,portElement:n.__dragPort};i.nodeOffset=new e.Point(0,0),s.push(i)}return s}GetDropOffset(t){var i;if(this._component.isSelectionSupported()&&this._component.getSelectionHandler().getSelectedCount()>1)i=this._getTopLeftContentCorner(this._component.getSelectionHandler().getSelection());else{var n=this.DragSource.getDragObject();n instanceof C&&(i=n.getDimensions(this._context.getStage()))}if(i){var s=this._context.pageToStageCoords(t.pageX,t.pageY),o=this._component.getPanZoomCanvas().getZoom();return new e.Point((i.x-s.x)/o,(i.y-s.y)/o)}return null}_getTopLeftContentCorner(t){if(!t)return null;for(var i=Number.MAX_VALUE,n=Number.MAX_VALUE,s=0;s<t.length;s++)if(t[s]instanceof C){var o=t[s].getDimensions(this._context.getStage());i=o?Math.min(o.x,i):i,n=o?Math.min(o.y,n):n}return new e.Point(i,n)}OnDndDragStart(t){var e=this.DragSource.getDragObject();e&&e.__dragType&&(e.__dragType=null,e.__dragPort=null),this.LinkCreationStarted=!1,super.OnDndDragStart(t)}OnDndDragOver(t){super.OnDndDragOver(t),this.LinkCreationStarted&&this._component.ShowLinkCreationFeedback(t)}OnDndDragEnd(t){super.OnDndDragEnd(t),this.LinkCreationStarted&&(this._component.HideLinkCreationFeedback(),this.LinkCreationStarted=!1),this._component.getPanZoomCanvas().panZoomEnd(),this._setPanningEnabled(!0)}_setPanningEnabled(t){this._component.IsPanningEnabled()&&this._component.getPanZoomCanvas().setPanningEnabled(t)}IsDragSupported(){if(!this._isDragSupported){var t=this._component.getOptions();this._isDragSupported=this.isDndSupported()&&(t.dnd.drag.nodes.dataTypes||t.dnd.drag.ports.dataTypes)}return this._isDragSupported}OnMouseDown(t){var e=this.GetLogicalObject(t.target);this.IsDragSupported()&&e instanceof C&&this._setPanningEnabled(!1),super.OnMouseDown(t)}OnMouseUp(t){super.OnMouseUp(t),this._setPanningEnabled(!0)}HandleImmediateTouchStartInternal(t){var e=this.GetLogicalObject(t.target);this.IsDragSupported()&&1==t.targetTouches.length&&e instanceof C&&this._setPanningEnabled(!1),(e instanceof C||e instanceof p)&&e.handleTouchStart(),this._component.handleTouchStart()}HandleImmediateTouchEndInternal(t){var e=this.GetLogicalObject(t.target);this.IsDragSupported()&&this._setPanningEnabled(!0),(e instanceof C||e instanceof p)&&e.handleTouchEnd(),this._component.handleTouchEnd()}GetDropTargetType(t){var e,i=this.GetLogicalObject(t.target);return this._component.getCache().putToCache("dropTarget",i),i?i instanceof C?(null===this._linkDropSelector&&(this._linkDropSelector=this._component.getOptions().dnd.drop.ports.selector),this._linkDropSelector&&(e=this._getPortElement(t.getNativeEvent().target,this._linkDropSelector)),i.__dropPort=e,e?"ports":"nodes"):i instanceof p?"links":null:"background"}GetDropEventPayload(t){var i=t.getNativeEvent().dataTransfer,n=Number(i.getData(e.EventManager.DROP_OFFSET_X_DATA_TYPE))||0,s=Number(i.getData(e.EventManager.DROP_OFFSET_Y_DATA_TYPE))||0,o=this._component.getPanZoomCanvas().getContentPane().stageToLocal(this.getCtx().pageToStageCoords(t.pageX,t.pageY)),a=this._component.getLayoutOffset(),r={x:o.x-a.x+n,y:o.y-a.y+s},d=this.GetLogicalObject(t.target);if(d instanceof C){d.__dropPort?(r.dataContext=d.getDataContext(),r.portElement=d.__dropPort):r.nodeContext=d.getDataContext();var h=d.getDimensions(this._context.getStage()),l=h?this._component.getPanZoomCanvas().getContentPane().stageToLocal({x:h.x,y:h.y}):null;r.nodeX=l?o.x-l.x+n:null,r.nodeY=l?o.y-l.y+s:null}else d instanceof p&&(r.linkContext=d.getDataContext());return r}ShowDropEffect(t){var i=this.GetDropTargetType(t),n=this._component.getCache().getFromCache("dropTarget");"background"===i?this._component.getPanZoomCanvas().getBackgroundPane().setClassName(this.OJ_ACTIVE_DROP):"nodes"===i||"links"===i?n&&n.ShowDropEffect&&n.ShowDropEffect():n&&"ports"===i&&n.__dropPort&&e.ToolkitUtils.addClassName(n.__dropPort,this.OJ_ACTIVE_DROP)}ShowRejectedDropEffect(t){var i=this.GetDropTargetType(t),n=this._component.getCache().getFromCache("dropTarget");"background"===i?this._component.getPanZoomCanvas().getBackgroundPane().setClassName(this.OJ_INVALID_DROP):"nodes"===i||"links"===i?n&&n.ShowRejectedDropEffect&&n.ShowRejectedDropEffect():n&&"ports"===i&&n.__dropPort&&e.ToolkitUtils.addClassName(n.__dropPort,this.OJ_INVALID_DROP)}ClearDropEffect(){this._component.getPanZoomCanvas().getBackgroundPane().setClassName(null);var t=this._component.getCache().getFromCache("dropTarget");t&&t.ClearDropEffect&&t.ClearDropEffect(),t&&t.__dropPort&&(e.ToolkitUtils.removeClassName(t.__dropPort,this.OJ_ACTIVE_DROP),e.ToolkitUtils.removeClassName(t.__dropPort,this.OJ_INVALID_DROP)),this._component.getCache().putToCache("dropTarget",null)}_getPortElement(t,e){return t&&t.closest?t.closest(e):null}}class y extends i.PanZoomCanvasKeyboardHandler{constructor(t,e){super(t,e),this._diagram=t,this._OUTGOING=0,this._INGOING=1}isNavigationEvent(t){var i=!1;switch(t.keyCode){case e.KeyboardEvent.OPEN_BRACKET:case e.KeyboardEvent.CLOSE_BRACKET:i=!0;break;case e.KeyboardEvent.OPEN_ANGLED_BRACKET:case e.KeyboardEvent.CLOSE_ANGLED_BRACKET:i=!!t.altKey;break;default:i=super.isNavigationEvent(t)}return i}processKeyDown(t){var i=t.keyCode,n=this.GetDiagram(),s=n.getOptions()._keyboardUtils,o=this._eventManager.getFocus();const a=n.activeInnerElems;if(!a&&o&&s.disableAllFocusable(o.getElem(),!0),i==e.KeyboardEvent.TAB){if(o)return e.EventManager.consumeEvent(t),o;var r=n.GetRootNodeObjects();if(r.length>0){e.EventManager.consumeEvent(t);var d=this.getDefaultNavigable(r);return this.GetDiagram().ensureObjInViewport(t,d),d}}else if(!a&&i==e.KeyboardEvent.F2&&o){this._eventManager.hideTooltip();var h=s.enableAllFocusable(o.getElem());o instanceof C&&o.isDisclosed()&&o.GetChildNodePane(!0)&&(s.disableAllFocusable(o.GetChildNodePane().getElem(),!0),h=(h=Array.from(h)).filter(t=>-1!==t.tabIndex)),h.length>0&&(n.activeInnerElems=h,o.hasActiveInnerElems=!0,n.activeInnerElemsNodeId=o.getId(),h[0].focus())}else a&&o&&(i==e.KeyboardEvent.ESCAPE||t.keyCode===e.KeyboardEvent.F2)&&(n.activeInnerElems=null,s.disableAllFocusable(o.getElem(),!0),o.hasActiveInnerElems=!1,n._context._parentDiv.focus(),this._eventManager.ShowFocusEffect(t,o),this._eventManager.ProcessRolloverEvent(t,o,!0),t.preventDefault(),t.stopPropagation());return super.processKeyDown(t)}GetVisibleNode(t){return this.GetDiagram().getNodeById(t)}GetDiagram(){return this._diagram}isSelectionEvent(t){return t.keyCode!=e.KeyboardEvent.TAB&&(this.isNavigationEvent(t)&&!t.ctrlKey)}isMultiSelectEvent(t){return t.keyCode==e.KeyboardEvent.SPACE&&t.ctrlKey}getFirstNavigableLink(t,i,n){var s=i.keyCode;if(!n||n.length<1||!t)return null;for(var o=n[0],a=t.getKeyboardBoundingBox(),r=a.x+a.w/2,d=0;d<n.length;d++){var h=n[d],l=h.getKeyboardBoundingBox(),g=l.x+l.w/2;if(s==e.KeyboardEvent.OPEN_ANGLED_BRACKET&&g<=r||s==e.KeyboardEvent.CLOSE_ANGLED_BRACKET&&g>=r){o=h;break}}return o}getNextNavigableLink(t,i,n,s){if(!s)return null;if(!i)return s[0];if(!t)return i;this._addSortingAttributes(t,s),s.sort(this._getLinkComparator()),this._removeSortingAttributes(s);for(var o=n.keyCode==e.KeyboardEvent.DOWN_ARROW,a=0,r=0;r<s.length;r++){if(s[r]===i){a=o?r==s.length-1?0:r+1:0==r?s.length-1:r-1;break}}return s[a]}_getClockwiseAngle(t,e){var i=this.GetVisibleNode(e.getStartId?e.getStartId():e.getData().getStartId()),n=this.GetVisibleNode(e.getEndId?e.getEndId():e.getData().getEndId()),s=t==i?n:i,o=this._getNodeCenter(t),a=this._getNodeCenter(s),r=Math.atan2(a.y-o.y,a.x-o.x);return r=r<0?r+2*Math.PI:r}_getNodeCenter(t){var i=t.getKeyboardBoundingBox();return new e.Point(i.x+i.w/2,i.y+i.h/2)}_getNodesDistance(t){var e=this.GetVisibleNode(t.getStartId?t.getStartId():t.getData().getStartId()),i=this.GetVisibleNode(t.getEndId?t.getEndId():t.getData().getEndId()),n=this._getNodeCenter(e),s=this._getNodeCenter(i);return Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2))}_getLinkDirection(t,e){return t==this.GetVisibleNode(e.getEndId?e.getEndId():e.getData().getEndId())?this._INGOING:this._OUTGOING}_getLinkComparator(){return(t,e)=>{var i=t.__angle,n=e.__angle,s=-1;return!y._anglesAreEqualWithinTolerance(i,n)&&i>n?s=1:y._anglesAreEqualWithinTolerance(i,n)&&(t.__distance>e.__distance||e.__distance==t.__distance&&t.__direction>e.__direction?s=1:e.__distance==t.__distance&&t.__direction==e.__direction&&(s=0)),s}}_removeSortingAttributes(t){for(var e=0;e<t.length;e++){var i=t[e];i.__angle=void 0,i.__distance=void 0,i.__direction=void 0}}_addSortingAttributes(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.__angle=this._getClockwiseAngle(t,n),n.__distance=this._getNodesDistance(n),n.__direction=this._getLinkDirection(t,n)}}static _anglesAreEqualWithinTolerance(t,e){var i=Math.abs(t-e)<=1e-7;return i||(i=Math.abs(2*Math.PI+Math.min(t,e)-Math.max(t,e))<=1e-7),i}}const f={CalcViewportFromMatrix:t=>{var i=t.getPanZoomCanvas().getContentPaneMatrix(),n=new e.Rectangle(0,0,t.getWidth(),t.getHeight()),s=i.getTx(),o=i.getTy(),a=i.getA(),r=n.x-s/a,d=n.y-o/a,h=n.w/a,l=n.h/a;return new e.Rectangle(r,d,h,l)},ConfigureOverviewWindow:(t,i)=>{var n=new e.Container(t.getCtx());n.addChild(i),t.addChild(n),i.render(),f._positionOverviewWindow(t,i);var s=i.getOverviewWidth(),o=i.getOverviewHeight(),a=new e.ClipPath(t.getId()+"dgr_ovClip");a.addRect(i.getTranslateX(),i.getTranslateY(),s,o),i.setClipPath(a),i.UpdateViewport();var r=t.Options.styleDefaults._overviewStyles,d=new e.Rect(t.getCtx(),0,0,s,o);d.setInvisibleFill(),d.setStroke(new e.Stroke(r.overview.backgroundColor,1,1)),d.setMouseEnabled(!1),n.addChild(d)},CreateOverviewContent:(t,i,n,s)=>{var o=new e.Container(t.getCtx());o.setMouseEnabled(!1),i.Nodes=new(t.getCtx().ojMap);var a=t.GetViewBounds();i.ContentBounds=a?a.clone():null,i.StretchFactor={h:1,v:1};var r=t.GetRootNodeObjects();return r.length>0&&(r.forEach(e=>{f.CreateOverviewNode(t,i,e,o)}),f._adjustNodePositionsForAspectRatio(t,i,n,s),f.ZoomToFitOverviewContent(t,i,o,n,s)),o},CreateOverviewNode:(t,i,n,s)=>{if(n){var o=f._createOverviewNodeShape(t,n);if(f._positionOverviewNode(n,o),i.Nodes.set(n.getId(),o),s.addChild(o),n.isDisclosed()){o._ovChildNodePane=new e.Container(t.getCtx()),o.addChild(o._ovChildNodePane);var a=n.getContainerPadding();o._ovChildNodePane.setTranslate(a.left,a.top),n.getChildNodeIds().forEach(e=>{var n=t.getNodeById(e);f.CreateOverviewNode(t,i,n,o._ovChildNodePane)})}}},RemoveOverviewWindow:(t,e)=>{if(e){e.setClipPath(null);var i=e.getParent();t.removeChild(i)}},UpdateOverviewWindow:(t,i)=>{i.ContentBounds=t.GetViewBounds(),f._positionOverviewWindow(t,i),f._updateOverviewNodes(t,i),i.Nodes.size>0&&f.ZoomToFitOverviewContent(t,i,i.Content,i.Width,i.Height),i.UpdateViewport();var n=i.getOverviewWidth(),s=i.getOverviewHeight();i.setClipPath(null);var o=new e.ClipPath(t.getId()+"dgr_ovClip");o.addRect(i.getTranslateX(),i.getTranslateY(),n,s),i.setClipPath(o);var a=i.getParent().getChildIndex(1);a instanceof e.Rect&&(a.setWidth(n),a.setHeight(s))},UpdateOverviewContent:(t,e,i,n)=>{var s=n.data.nodes;if(s&&0!==s.length){var o,a=n.parentId,r=a?t.getNodeById(a):null,d=[];if("add"==i)r?(o=f._findRootNode(t,r),f._removeNode(e,o.getId()),d.push(o)):s.forEach(e=>{d.push(t.getNodeById(e.id))});else if("change"==i){var h=new(t.getCtx().ojMap);s.forEach(e=>{(o=f._findRootNode(t,t.getNodeById(e.id)))&&h.set(o.getId(),o)}),h.forEach((t,i,n)=>{f._removeNode(e,i),d.push(t)})}else"remove"==i&&(r?(o=f._findRootNode(t,r),f._removeNode(e,o.getId()),d.push(o)):s.forEach(t=>{f._removeNode(e,t.id)}));d.forEach(i=>{f.CreateOverviewNode(t,e,i,e.Content)})}},TransformFromContentToViewportCoords:(t,i,n)=>{var s=n.Content,o=s.getTranslateX(),a=s.getTranslateY(),r=s.getScaleX(),d=s.getScaleY(),h=t*r*n.StretchFactor.h+o,l=i*d*n.StretchFactor.v+a;return new e.Point(h,l)},TransformFromViewportToContentCoords:(t,i,n)=>{var s=n.Content,o=s.getTranslateX(),a=s.getTranslateY(),r=s.getScaleX(),d=s.getScaleY(),h=(t-o)/r/n.StretchFactor.h,l=(i-a)/d/n.StretchFactor.v;return new e.Point(h,l)},ZoomToFitOverviewContent:(t,e,i,n,s)=>{var o=e.ContentBounds,a=f._calcOverviewScale(t,o,n,s,e);i.setScale(a,a);var r=(n-o.w*a)/2-o.x*a,d=(s-o.h*a)/2-o.y*a;i.setTranslate(r,d)},_adjustNodePositionsForAspectRatio:(t,i,n,s)=>{if("meet"!==t.Options.overview.preserveAspectRatio){var o,a=t.GetViewBounds(),r=2*e.CSSStyle.toNumber(t.Options.styleDefaults._overviewStyles.overviewContent.padding);if("canvas"===t.Options.overview.fitArea){var d=f._getCanvasDimensions(t);o=d.w/d.h}else o=a.w/a.h;var h=(n-r)/(s-r);if(h==o)return;var l=h>o?h/o:1,g=h<o?o/h:1;i.ContentBounds=a.clone(),i.ContentBounds.w=i.ContentBounds.w*l,i.ContentBounds.h=i.ContentBounds.h*g,i.StretchFactor={h:l,v:g};var u=t.GetRootNodeObjects();if(u.length>0){var c=f._getNodesStretchFactor(i,u,i.StretchFactor);if(1===c.h&&1===c.v)return i.ContentBounds=a.clone(),void(i.StretchFactor={h:1,v:1});u.forEach(t=>{f._adjustNodePosition(i.Nodes.get(t.getId()),c)})}}},_getCanvasDimensions:t=>{var i;if("fixed"===t.Options.panning||"none"===t.Options.panning)i=new e.Dimension(t.Width,t.Height);else{var n=t.GetViewBounds(),s=t.getPanZoomCanvas().getMinZoom();i=new e.Dimension(2*n.w*s,2*n.h*s)}return i},_adjustNodePosition:(t,e)=>{var i=t.getCenterDimensions(),n=t.getTranslateX(),s=t.getTranslateY();if(e.h>1){var o=(n+i.x-e.tx)*e.h+e.tx;t.setTranslateX(o-.5*i.w)}else if(e.v>1){var a=(s+i.y-e.ty)*e.v+e.ty;t.setTranslateY(a-.5*i.h)}},_getNodesStretchFactor:(t,e,i)=>{var n={h:1,v:1};if(i.h>1){var s,o,a=Number.MAX_VALUE,r=-Number.MAX_VALUE;e.forEach(t=>{var e=t.getContentBounds(),i=t.getTranslateX()+e.x+.5*e.w;s=i<a?e:s,o=i>r?e:o,a=Math.min(i,a),r=Math.max(i,r)});var d=.5*s.w,h=.5*o.w;n={h:r===a?1:(t.ContentBounds.w-d-h)/(r-a),v:1,tx:d}}if(i.v>1){var l,g,u=Number.MAX_VALUE,c=-Number.MAX_VALUE;e.forEach(t=>{var e=t.getContentBounds(),i=t.getTranslateY()+e.y+.5*e.h;l=i<u?e:l,g=i>c?e:g,u=Math.min(i,u),c=Math.max(i,c)});var _=.5*l.h,p=.5*g.h;n={h:1,v:c===u?1:(t.ContentBounds.h-_-p)/(c-u),ty:_}}return n},_calcOverviewScale:(t,i,n,s,o)=>{var a=2*e.CSSStyle.toNumber(t.Options.styleDefaults._overviewStyles.overviewContent.padding),r=n-a,d=s-a;if("canvas"===t.Options.overview.fitArea){var h=t.GetViewBounds(),l=t.getPanZoomCanvas().getMinZoom(),g=f._getCanvasDimensions(t),u=Math.min((g.h-h.h*l)/2,(g.w-h.w*l)/2),c=o.StretchFactor.h,_=o.StretchFactor.v,p=r/g.w*c,m=d/g.h*_,C=Math.min(p,m);r-=2*u*c*C,d-=2*u*_*C}var v=r/i.w,y=d/i.h;return Math.min(v,y)},_createOverviewNodeShape:(t,i)=>{var n=t.Options.styleDefaults._overviewStyles.node,s=i.getData();s.overview&&(n=e.JsonUtils.merge(s.overview.icon,n));var o=n.shape;i.isDisclosed()||t.Options.renderer&&"inherit"==o?o="rectangle":"inherit"==o&&(o=s.icon.shape);var a=i.getLayoutBounds(),r=a.w,d=a.h,h=new e.SimpleMarker(t.getCtx(),o,r/2,d/2,r,d,0);h.setSolidFill(s.icon.color);var l=[i.isDisclosed()?"oj-diagram-overview-container-node":"oj-diagram-overview-node"];return n.svgClassName&&l.push(n.svgClassName),h.setStyle(n.svgStyle).setClassName(l.join(" ")),h},_findRootNode:(t,e)=>{for(var i=e,n=e?e.getGroupId():null;n;)n=(i=t.getNodeById(n)?t.getNodeById(n):i).getGroupId();return i},_positionOverviewNode:(t,e)=>{var i=t.getTranslateX(),n=t.getTranslateY();e.setTranslate(i,n)},_positionOverviewWindow:(t,i)=>{var n=t.Options.overview.halign,s=t.Options.overview.valign,o=e.CSSStyle.toNumber(t.Options.styleDefaults._overviewStyles.overview.padding),a=i.getOverviewWidth(),r=i.getOverviewHeight(),d=t.Width,h=t.Height;switch(n){case"start":n=e.Agent.isRightToLeft(t.getCtx())?"right":"left";break;case"end":n=e.Agent.isRightToLeft(t.getCtx())?"left":"right"}var l="center"==n?(d-a)/2:"right"==n?d-a-o:o,g="middle"==s?(h-r)/2:"bottom"==s?h-r-o:o;i.getParent().setTranslate(l,g)},_removeNode:(t,e)=>{var i=t.Nodes.get(e);i&&i.getParent().removeChild(i)},_updateOverviewNodes:(t,e)=>{e.Nodes.forEach((i,n,s)=>{var o=t.getNodeById(n);o&&i?f._positionOverviewNode(o,i):i&&!o&&e.Nodes.delete(n)}),f._adjustNodePositionsForAspectRatio(t,e,e.Width,e.Height)}};class S{constructor(t,e){this.x=null===t||isNaN(t)?0:t,this.y=null===e||isNaN(e)?0:e}}class b{constructor(t,e,i,n){this.x=null===t||isNaN(t)?0:t,this.y=null===e||isNaN(e)?0:e,this.w=null===i||isNaN(i)?0:i,this.h=null===n||isNaN(n)?0:n}}class P{constructor(){this._bReadOnly=!1,this._selected=!1,this._bDisclosed=!1,this.IsRendered=!0,this.ContentOffset=new S(0,0)}setId(t){this._id=t}getId(){return this._id}setBounds(t){this._bounds=t,this._origBounds=t}getBounds(){return!this._bounds&&this.Component&&this.Component.updateNodeDims(this),this._bounds}setContentBounds(t){this._contentBounds=t,this._origContentBounds=t}getContentBounds(){return!this._contentBounds&&this.Component&&this.Component.updateNodeDims(this),this._contentBounds}setPosition(t){this._position=t,this.UpdateParentNodes(),this.setDirty()}getPosition(){return this._position}getRelativePosition(t){var e=this.LayoutContext;if(e){for(var i=new S(0,0),n=this,s=!1;n;){var o=n.getContainerId();if(o){var a=e.getNodeById(o);a&&this.Component&&!a.IsRendered&&this.Component.renderNodeFromContext(a,!0)}if(i.x+=n.ContentOffset.x+n.getPosition().x,i.y+=n.ContentOffset.y+n.getPosition().y,d.compareValues(e.Context,o,t))s=!0,n=null;else if((n=e.getNodeById(o))&&n.isDisclosed()){var r=n.getContainerPadding();r&&(i.x+=r.left,i.y+=r.top)}else n=null}return s||(i=null),i}return null}setLabelPosition(t){this._labelPosition=t,this.setDirty()}getLabelPosition(){return this._labelPosition}setLabelBounds(t){this._labelBounds=t}getLabelBounds(){return!this._labelBounds&&this.Component&&this.Component.updateNodeDims(this),this._labelBounds}setLayoutAttributes(t){this._layoutAttrs=t}getLayoutAttributes(){return this._layoutAttrs}setReadOnly(t){this._bReadOnly=t}isReadOnly(){return this._bReadOnly}setContainerId(t){this._containerId=t}getContainerId(){return this._containerId}setSelected(t){this._selected=t}getSelected(){return this._selected}setLabelRotationAngle(t){this._labelRotAngle=t,this.setDirty()}getLabelRotationAngle(){return this._labelRotAngle}setLabelRotationPoint(t){this._labelRotPoint=t,this.setDirty()}getLabelRotationPoint(){return this._labelRotPoint}SetContainerPaddingObj(t){this.isDisclosed()&&(this._containerPadding=t,t&&(this._origBounds&&(this._origBounds=new b(this._origBounds.x,this._origBounds.y,this._origBounds.w-(t.left+t.right),this._origBounds.h-(t.top+t.bottom))),this._origContentBounds&&(this._origContentBounds=new b(this._origContentBounds.x,this._origContentBounds.y,this._origContentBounds.w-(t.left+t.right),this._origContentBounds.h-(t.top+t.bottom)))))}setContainerPadding(t,e,i,n){this.isDisclosed()&&(this._containerPadding={},"number"!=typeof t&&"string"!=typeof t&&(n=t.left,e=t.right,i=t.bottom,t=t.top),this._containerPadding.top=t,this._containerPadding.right=e,this._containerPadding.bottom=i,this._containerPadding.left=n,this._origBounds&&(this._bounds=new b(this._origBounds.x,this._origBounds.y,this._origBounds.w+n+e,this._origBounds.h+t+i)),this._origContentBounds&&(this._contentBounds=new b(this._origContentBounds.x,this._origContentBounds.y,this._origContentBounds.w+n+e,this._origContentBounds.h+t+i)),this.setDirty())}getContainerPadding(){return this._containerPadding}setDisclosed(t){this._bDisclosed=t}isDisclosed(){return this._bDisclosed}setChildNodes(t){this._childNodes=t}getChildNodes(){return this._childNodes}setParentNode(t){this._parentNode=t}getParentNode(){return this._parentNode}UpdateParentNodes(){var t=this.getParentNode();t&&t.IsRendered&&(t.Reset(),t.UpdateParentNodes())}Reset(){this.IsRendered=!1,this.setBounds(null),this.setContentBounds(null),this.setLabelBounds(null),this.setDirty()}setLabelValign(t){this._labelValign=t,this.setDirty()}setLabelHalign(t){this._labelHalign=t,this.setDirty()}getLabelValign(){return this._labelValign}getLabelHalign(){return this._labelHalign}setData(t){this._data=t}getData(){return this._data}setDirty(){this.LayoutContext&&this.LayoutContext.getDirtyContext().set(this.getId(),!0)}copyFrom(t){t&&(this.setPosition(t.getPosition()),this.setLabelPosition(t.getLabelPosition()),this.setLabelRotationAngle(t.getLabelRotationAngle()),this.setLabelRotationPoint(t.getLabelRotationPoint()),this.setLabelValign(t.getLabelValign()),this.setLabelHalign(t.getLabelHalign()),t.getContainerPadding()&&this.setContainerPadding(t.getContainerPadding()))}}class D{constructor(){this._startConnectorOffset=0,this._endConnectorOffset=0,this._linkWidth=1,this._selected=!1,this._bPromoted=!1}setId(t){this._id=t}getId(){return this._id}setStartId(t){this._startId=t}getStartId(){return this._startId}setEndId(t){this._endId=t}getEndId(){return this._endId}setPoints(t){this._points="string"==typeof t?e.PathUtils.createPathArray(t):t,this.setDirty()}getPoints(){return this._points}setLabelPosition(t){this._labelPosition=t,this.setDirty()}getLabelPosition(){return this._labelPosition}setLabelBounds(t){this._labelBounds=t}getLabelBounds(){return this._labelBounds}setStartConnectorOffset(t){this._startConnectorOffset=t}getStartConnectorOffset(){return this._startConnectorOffset}setEndConnectorOffset(t){this._endConnectorOffset=t}getEndConnectorOffset(){return this._endConnectorOffset}setLinkWidth(t){this._linkWidth=t}getLinkWidth(){return this._linkWidth}setLayoutAttributes(t){this._layoutAttrs=t}getLayoutAttributes(){return this._layoutAttrs}setSelected(t){this._selected=t}getSelected(){return this._selected}setLabelRotationAngle(t){this._labelRotAngle=t,this.setDirty()}getLabelRotationAngle(){return this._labelRotAngle}setLabelRotationPoint(t){this._labelRotPoint=t,this.setDirty()}getLabelRotationPoint(){return this._labelRotPoint}setPromoted(t){this._bPromoted=t}isPromoted(){return this._bPromoted}setLabelValign(t){this._labelValign=t,this.setDirty()}setLabelHalign(t){this._labelHalign=t,this.setDirty()}getLabelValign(){return this._labelValign}getLabelHalign(){return this._labelHalign}setCoordinateSpace(t){this._coordinateContainerId=t,this.setDirty()}getCoordinateSpace(){return this._coordinateContainerId}setData(t){this._data=t}getData(){return this._data}setDirty(){this.LayoutContext&&this.LayoutContext.getDirtyContext().set(this.getId(),!0)}copyFrom(t){t&&(this.setPoints(t.getPoints()),this.setLabelPosition(t.getLabelPosition()),this.setLabelRotationAngle(t.getLabelRotationAngle()),this.setLabelRotationPoint(t.getLabelRotationPoint()),this.setLabelValign(t.getLabelValign()),this.setLabelHalign(t.getLabelHalign()),this.setCoordinateSpace(t.getCoordinateSpace()))}}const E=t=>void 0===t||null==t?null:new b(t.x,t.y,t.w,t.h),k=t=>void 0===t||null==t?null:new S(t.x,t.y),I=t=>t?new e.Rectangle(t.x,t.y,t.w,t.h):null,N=t=>t?new e.Point(t.x,t.y):null,L=(t,e,i)=>{var n=e/t.w;return{zoom:n,centerX:t.x+.5*e/n,centerY:t.y+.5*i/n}},x=(t,i,n)=>{var s=t.centerX,o=t.centerY,a=t.zoom?t.zoom:1,r=s-.5*i/a,d=o-.5*n/a,h=i/a,l=n/a;return new e.Rectangle(r,d,h,l)};class A{constructor(t){this._nodeCount=0,this._linkCount=0,this._bLocaleR2L=!1,this._nodes=new t.ojMap,this._links=new t.ojMap,this._arNodes=[],this._arLinks=[],this._dirtyContext=new t.ojMap,this.Context=t}setLayout(t){this._layout=t}getLayout(){return this._layout}setLayoutAttributes(t){this._layoutAttrs=t}getLayoutAttributes(){return this._layoutAttrs}addNode(t){this.getNodeById(t.getId())||(this._nodeCount++,this._arNodes.push(t)),this._nodes.set(t.getId(),t)}addNodeToMap(t){this._nodes.set(t.getId(),t)}removeNode(t,i){i&&(t?e.ArrayUtils.removeItem(t.getChildNodes(),i):(e.ArrayUtils.removeItem(this._arNodes,i),this._nodeCount--),this._nodes.delete(i.getId()))}getNodeById(t){return this._nodes.get(t)}getNodeByIndex(t){return this._arNodes[t]}getNodeCount(){return this._nodeCount}addLink(t){this.getLinkById(t.getId())||(this._linkCount++,this._arLinks.push(t)),this._links.set(t.getId(),t)}removeLink(t){t&&(this.getLinkById(t.getId())&&(e.ArrayUtils.removeItem(this._arLinks,t),this._linkCount--),this._links.delete(t.getId()))}getLinkById(t){return this._links.get(t)}getLinkByIndex(t){return this._arLinks[t]}getLinkCount(){return this._linkCount}localToGlobal(t,e){var i=this.GetGlobalOffset(e);return new S(t.x+i.x,t.y+i.y)}GetGlobalOffset(t){for(var e=new S(0,0);t;){e.x+=t.ContentOffset.x+t.getPosition().x,e.y+=t.ContentOffset.y+t.getPosition().y;var i=t.getContainerId();if(i){if((t=this.getNodeById(i))&&t.isDisclosed()){var n=t.getContainerPadding();n&&(e.x+=n.left,e.y+=n.top)}}else t=null}return e}setLocaleR2L(t){this._bLocaleR2L=t}isLocaleR2L(){return this._bLocaleR2L}setComponentSize(t){this._componentSize=t}getComponentSize(){return this._componentSize}setViewport(t){this._panZoomState=t?L(t,this._componentSize.w,this._componentSize.h):null}getViewport(){return this._panZoomState?x(this._panZoomState,this._componentSize.w,this._componentSize.h):null}setPanZoomState(t){this._panZoomState=t}getPanZoomState(){return this._panZoomState}setContainerId(t){this._containerId=t}getContainerId(){return this._containerId}setContainerPadding(t,e,i,n){this.getContainerId()&&(this._containerPadding={},"number"!=typeof t&&"string"!=typeof t&&(n=t.left,e=t.right,i=t.bottom,t=t.top),this._containerPadding.top=t,this._containerPadding.right=e,this._containerPadding.bottom=i,this._containerPadding.left=n)}getContainerPadding(){return this._containerPadding}setCurrentPanZoomState(t){this._currentPanZoomState=t}getCurrentViewport(){return this._currentPanZoomState?x(this._currentPanZoomState,this._componentSize.w,this._componentSize.h):null}getCommonContainer(t,e){for(var i=(t,e)=>{for(var i=[],n=e.getNodeById(t)?e.getNodeById(t).getContainerId():null;n;)i.push(n),n=e.getNodeById(n)?e.getNodeById(n).getContainerId():null;return i.reverse(),i},n=i(t,this),s=i(e,this),o=null,a=0;a<n.length&&a<s.length&&d.compareValues(this.Context,n[a],s[a]);a++)o=n[a];return o}getEventData(){return this._eventData}setEventData(t){this._eventData=t}setDirtyContext(t){this._dirtyContext=t}getDirtyContext(){return this._dirtyContext}}class O extends s.Overview{constructor(t){super(t.getCtx(),t.processEvent,t),this._id=t.getId()+"_overview"}renderData(t,e){this.Content=f.CreateOverviewContent(this._callbackObj,this,t,e),this.addChild(this.Content),this.Content.setMouseEnabled(!1)}render(){var t=Math.min(this._callbackObj.Width,this._callbackObj.Options.overview.width),e=Math.min(this._callbackObj.Height,this._callbackObj.Options.overview.height),i=this._callbackObj.Options.styleDefaults._overviewStyles,n={xMin:0,xMax:t,yMin:0,yMax:e,x1:0,x2:t,y1:0,y2:e,style:{overviewBackgroundColor:i.overview.backgroundColor,windowBackgroundColor:i.viewport.backgroundColor,windowBorderTopColor:i.viewport.borderColor,windowBorderRightColor:i.viewport.borderColor,windowBorderBottomColor:i.viewport.borderColor,windowBorderLeftColor:i.viewport.borderColor,timeAxisBarColor:"#00000000"},animationOnClick:"off",featuresOff:"zoom"},s=0===this._callbackObj.GetAllRoots().length;this._viewportConstraints={xMin:s?0:-Number.MAX_VALUE,yMin:s?0:-Number.MAX_VALUE,xMax:s?t:Number.MAX_VALUE,yMax:s?e:Number.MAX_VALUE},this._callbackObj.IsPanningEnabled()||this.setMouseEnabled(!1),super.render(n,t,e)}animateInsert(){}animateDelete(){}animateUpdate(t,i){this.Content.setAlpha(0),t.add(new e.AnimFadeIn(this.getCtx(),this.Content,t.getAnimDur()),c);var n=this.getChildIndex(this.Content);this.addChildAt(i.Content,n+1);var s=new e.AnimFadeOut(this.getCtx(),i.Content,t.getAnimDur());e.Playable.appendOnEnd(s,()=>{i.Content.getParent().removeChild(i.Content)}),t.add(s,c);var o=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur()),a=i.GetAnimParams(),r=this.GetAnimParams();this.SetAnimParams(a),o.getAnimator().addProp(e.Animator.TYPE_NUMBER_ARRAY,this,this.GetAnimParams,this.SetAnimParams,r),t.add(o,c)}updateConstraints(t,e,i,n){var s=this._callbackObj.getPanZoomCanvas().getZoom(),o=f.TransformFromContentToViewportCoords(-i/s,-n/s,this),a=f.TransformFromContentToViewportCoords(-t/s,-e/s,this),r=this._viewportPosition.x2-this._viewportPosition.x1,d=this._viewportPosition.y2-this._viewportPosition.y1,h=this._callbackObj.getPanDir();this._viewportConstraints={xMin:"y"===h?this._viewportPosition.x1:o.x,xMax:"y"===h?this._viewportPosition.x2:a.x+r,yMin:"x"===h?this._viewportPosition.y1:o.y,yMax:"x"===h?this._viewportPosition.y2:a.y+d}}getMinimumPositionX(){return this._viewportConstraints.xMin}getMinimumPositionY(){return this._viewportConstraints.yMin}getMaximumPositionX(){return this._viewportConstraints.xMax}getMaximumPositionY(){return this._viewportConstraints.yMax}getMinimumWindowWidth(){return 0}getMaximumWindowWidth(){return Number.MAX_VALUE}getMinimumWindowHeight(){return 0}getMaximumWindowHeight(){return Number.MAX_VALUE}UpdateViewport(){if(!this._bCancelUpdateViewport){var t=f.CalcViewportFromMatrix(this._callbackObj),e=f.TransformFromContentToViewportCoords(t.x,t.y,this),i=f.TransformFromContentToViewportCoords(t.x+t.w,t.y+t.h,this);this._viewportPosition={x1:e.x,x2:i.x,y1:e.y,y2:i.y},this.setViewportRange(e.x,i.x,e.y,i.y)}}HandleViewportChange(t){var e=void 0!==t.newX1?t.newX1:this._viewportPosition.x1,i=void 0!==t.newY1?t.newY1:this._viewportPosition.y1,n=f.TransformFromViewportToContentCoords(this._viewportPosition.x1,this._viewportPosition.y1,this),s=f.TransformFromViewportToContentCoords(e,i,this);this._viewportPosition.x1=e,this._viewportPosition.y1=i;var o=this._callbackObj.getPanZoomCanvas().getZoom(),a=(s.x-n.x)*o,r=(s.y-n.y)*o;0===a&&0===r||(this._bCancelUpdateViewport=!0,this._callbackObj.getPanZoomCanvas().panBy(-a,-r,null,null,!0),this._bCancelUpdateViewport=!1)}GetAnimParams(){var t=[],e=this.getSlidingWindow(),i=this.getLeftHandle(),n=this.getRightHandle(),s=this.getBottomBar(),o=this.getTopBar();return t.push(e.getTranslateX(),e.getTranslateY(),e.getWidth(),e.getHeight()),t.push(i.getX1(),i.getY1(),i.getX2(),i.getY2()),t.push(n.getX1(),n.getY1(),n.getX2(),n.getY2()),t.push(s.getX1(),s.getY1(),s.getX2(),s.getY2()),t.push(o.getX1(),o.getY1(),o.getX2(),o.getY2()),t}SetAnimParams(t){var e=this.getSlidingWindow(),i=this.getLeftHandle(),n=this.getRightHandle(),s=this.getBottomBar(),o=this.getTopBar(),a=0;e.setTranslateX(t[a++]),e.setTranslateY(t[a++]),e.setWidth(t[a++]),e.setHeight(t[a++]),i.setX1(t[a++]),i.setY1(t[a++]),i.setX2(t[a++]),i.setY2(t[a++]),n.setX1(t[a++]),n.setY1(t[a++]),n.setX2(t[a++]),n.setY2(t[a++]),s.setX1(t[a++]),s.setY1(t[a++]),s.setX2(t[a++]),s.setY2(t[a++]),o.setX1(t[a++]),o.setY1(t[a++]),o.setX2(t[a++]),o.setY2(t[19])}CloneAnim(){var t=this.getCtx(),i=new e.Container(t,"g",this.getId());i.ContentBounds=this._callbackObj.GetViewBounds(),i.setMouseEnabled(!1);var n=new e.Container(t,"g","ovContentClone");i.addChild(n),i.Content=n,i.Nodes=new t.ojMap,i.Diagram=this._callbackObj;var s=this._callbackObj.GetRootNodeObjects();s.length>0&&(s.forEach(t=>{f.CreateOverviewNode(i.Diagram,i,t,n)}),f.ZoomToFitOverviewContent(i.Diagram,i,n,this.Width,this.Height));var o=this.GetAnimParams();return i.GetAnimParams=()=>o,i}}class w extends e.Automation{GetSubIdForDomElement(t){var e=this._comp.getEventManager().GetLogicalObject(t);return e&&e instanceof C?"node["+this._comp.GetAllNodes().indexOf(e.getId())+"]":e&&e instanceof p?"link["+this._comp.GetAllLinks().indexOf(e.getId())+"]":null}getDomElementForSubId(t){if(t==e.Automation.TOOLTIP_SUBID)return this.GetTooltipElement(this._comp);var i=this._parseSubId(t),n=i.component,s=i.index,o=null;return"node"==n?o=this._getNode(s):"link"==n&&(o=this._getLink(s)),o?o.getElem():null}_parseSubId(t){var e=t,i=-1,n=t.substring(0,t.indexOf("["));return n&&(e="node"==n||"link"==n?n:null,i=parseInt(t.substring(t.indexOf("[")+1,t.indexOf("]")))),{component:e,index:i}}getNodeCount(){return this._comp.GetAllNodes().length}getLinkCount(){return this._comp.GetAllLinks().length}getNode(t){var i=this._getNode(t);if(i){var n={id:i.getId(),selected:i.isSelected(),tooltip:i.getShortDesc(),label:i.getData().label,icon:this._getMarkerData(i.GetIcon()),expanded:i.isDisclosed()},s=i.getData().backgroundStyle;return s&&s instanceof Object&&(s=e.CSSStyle.cssObjectToString(s)),n.background=s,n}return null}getLink(t){var i=this._getLink(t);if(i){var n={id:i.getId(),selected:i.isSelected(),tooltip:i.getShortDesc(),label:i.getData().label,color:i.getLinkColor(),width:i.getLinkWidth(),style:this._getLinkStyleFromObject(i.getLinkStyle()),startNode:i.getStartId(),endNode:i.getEndId(),startConnectorType:i.getStartConnectorType(),endConnectorType:i.getEndConnectorType(),promoted:i.isPromoted()};return i.isPromoted()&&(n.links=e.JsonUtils.clone(i.getData()._links)),n}return null}getPromotedLink(t,e){var i=this._getNode(t),n=this._getNode(e);if(!i||!n)return null;var s=p.GetPromotedLinkId(this._comp,i.getId(),n.getId()),o=this._comp.getLinkById(s);return o?{id:o.getId(),selected:o.isSelected(),tooltip:o.getShortDesc(),color:o.getLinkColor(),width:o.getLinkWidth(),style:this._getLinkStyleFromObject(o.getLinkStyle()),startNode:o.getStartId(),endNode:o.getEndId(),startConnectorType:o.getStartConnectorType(),endConnectorType:o.getEndConnectorType(),count:o.getData()._links.length}:null}_getLinkStyleFromObject(t){if(this._comp.getCtx().isCustomElement())return e.CSSStyle.cssObjectToString(t);if(t&&t instanceof Object){if(t._type==p.CUSTOM_STYLE){var i=e.JsonUtils.clone(t);return delete i._type,e.CSSStyle.cssObjectToString(i)}return t._type}return t}getExpanded(){return this._comp.DisclosedNodes}_getMarkerData(t){if(t){var i={};return i.shape=t instanceof e.SimpleMarker?t.getType():"none",t.getFill()&&(i.color=t.getFill().getColor()),i}return null}_getNode(t){var e=this._comp.GetAllNodes();return t>=0&&t<e.length?this._comp.getNodeById(e[t]):null}_getLink(t){var e=this._comp.GetAllLinks();return t>=0&&t<e.length?this._comp.getLinkById(e[t]):null}}class T{constructor(t,e,i){this._diagram=t,this._context=t.getCtx(),this._nodes=[],this._newNodes=[],this._links=[],this._newLinks=[],this._processedObjMap=new this._context.ojMap,this.PanZoomMatrix=this._diagram.getPanZoomCanvas().getContentPane().getMatrix(),this.IsPartialUpdate=!(!e||!i),t.Overview&&(this.Overview=this.IsPartialUpdate?t.Overview.CloneAnim():t.Overview),this.NodesMap=this._diagram.GetAllNodesMap(),this.LinksMap=this._diagram.GetAllLinksMap(),this._setNodes(e,i),this._setLinks(e,i)}getId(){return this._diagram.getId()}getOptions(){return this._diagram.getOptions()}getNodes(){return this._nodes}getLinks(){return this._links}getNewNodes(){return this._newNodes}getNewLinks(){return this._newLinks}updateStateFromEvent(t,e){if(e){var i,n,s,o=e.data.nodes,a=e.data.links;if("add"==t){for(i=0;o&&i<o.length;i++){var r=this._diagram.getNodeById(o[i].id);r&&(!0===this._wasParentDisclosed&&this._newNodes.push(r),this._processedObjMap.set(r.getId(),!0))}for(i=0;a&&i<a.length;i++)s=a[i].id,(n=this._diagram.getLinkById(s)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[s]))&&(this._newLinks.push(n),this._processedObjMap.set(n.getId(),!0))}else if("change"==t)for(i=0;a&&i<a.length;i++)s=a[i].id,(n=this._diagram.getLinkById(s)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[s]))&&(this._newLinks.push(n),this._processedObjMap.set(n.getId(),!0))}}updateStateFromLayoutContext(t){if(this.IsPartialUpdate){var e=this;t.getDirtyContext().forEach((t,i,n)=>{if(!e._processedObjMap.has(i)){var s=e._diagram.getNodeById(i)||e._diagram.getLinkById(i);s instanceof C?(e._nodes.push(s.getAnimationState()),e._newNodes.push(s),e._processedObjMap.set(i,!0)):s instanceof p&&(e._links.push(s.getAnimationState()),e._newLinks.push(s),e._processedObjMap.set(i,!0))}})}}_setNodes(t,e){if(this.IsPartialUpdate){var i,n=e.data.nodes,s=e.parentId;if("add"==t)this._addAncestorStates(s);else if("change"==t)for(var o=0;n&&o<n.length;o++)(i=this._diagram.getNodeById(n[o].id))&&(this._addAncestorStates(i.getGroupId()),this._nodes.push(i.getAnimationState()),this._newNodes.push(i),this._processedObjMap.set(i.getId(),!0));else if("remove"==t&&(this._addAncestorStates(s),n&&!s))for(var a=0;a<n.length;a++)(i=this._diagram.getNodeById(n[a].id))&&(this._nodes.push(i),this._processedObjMap.set(i.getId(),!0))}else this._nodes=this._diagram.GetRootNodeObjects()}_setLinks(t,e){if(this.IsPartialUpdate){var i,n,s,o=e.data.links;if(!o)return;if("change"==t)for(i=0;i<o.length;i++)s=o[i].id,(n=this._diagram.getLinkById(s)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[s]))&&(this._links.push(n.getAnimationState()),this._processedObjMap.set(n.getId(),!0));else if("remove"==t)for(i=0;i<o.length;i++)s=o[i].id,(n=this._diagram.getLinkById(s)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[s]))&&(this._links.push(n),this._processedObjMap.set(n.getId(),!0))}else this._links=this._diagram.GetAllLinkObjects()}_addAncestorStates(t){var e=t?this._diagram.getNodeById(t):null;for(this._wasParentDisclosed=!e||e.isDisclosed();e;){var i=d.compareValues(this._context,e.getId(),t)||e.isDisclosed()&&this._diagram.getOptions().renderer,n=e.getAnimationState(i);this._nodes.push(n),this._newNodes.push(e),this._processedObjMap.set(e.getId(),!0),e=e.getGroupId()?this._diagram.getNodeById(e.getGroupId()):null}}}class R extends e.DataAnimationHandler{constructor(t,e,i,n){super(t,e),this._oldDiagram=i,this._newDiagram=n}getOldDiagram(){return this._oldDiagram}getNewDiagram(){return this._newDiagram}getAnimDur(){return m.getAnimDur(this._oldDiagram)}constructAnimation(t,e){var i=!1;if(e&&e.length>0&&(i=e[0]instanceof p),i&&!this.getCtx().isOffscreen()){var n,s,o,a=this.getCtx(),r=R._expandLinksArrayToMap(a,t),d=R._expandLinksArrayToMap(a,e),h=new a.ojMap,l=this,g=new Set;r.forEach((t,e,i)=>{if(n=t,s=d.get(e))if(n.isPromoted()||s.isPromoted()){var a=n.isPromoted()?n.getData()._links.length:1,u=s.isPromoted()?s.getData()._links.length:1;a>u&&!h.has(n.getId())?l._constructExpandCollapseAnimation(n,d,h,!0):a<u&&!h.has(s.getId())?l._constructExpandCollapseAnimation(s,r,h,!1):a!=u||h.has(s.getId())||(s.animateUpdate(l,n),h.set(s.getId(),!0))}else s.animateUpdate(l,n);else o=n.getId(),-1==l.getNewDiagram().GetAllLinks().indexOf(o)&&(g.has(o)||(n.animateDelete(l),g.add(o)))}),d.forEach((t,e,i)=>{n=r.get(e),s=t,n||l.getOldDiagram().LinksMap.has(s.getId())||s.animateInsert(l)})}else super.constructAnimation(t,e)}_constructExpandCollapseAnimation(t,e,i,n){for(var s=[],o=t.getData()._links,a=0;a<o.length;a++){var r=e.get(o[a].id);r&&-1===s.indexOf(r)&&s.push(r)}s.length>0&&(n?t.animateExpand(this,s):t.animateCollapse(this,s),i.set(t.getId(),!0))}static _expandLinksArrayToMap(t,e){for(var i=new t.ojMap,n=0;n<e.length;n++){var s=e[n];if(s)if(s.isPromoted())for(var o=s.getData()._links,a=0;a<o.length;a++)i.set(o[a].id,s);else i.set(s.getId(),s)}return i}}class B extends i.PanZoomComponent{constructor(t,i,n){super(t,i,n),this.getCtx().getStage().getElem().setAttributeNS(null,"text-rendering","geometricPrecision"),this._linksPane=new e.Container(t),this._nodesPane=new e.Container(t),this._topPane=new e.Container(t),e.Agent.isTouchDevice()&&(this._touchEventPane=new e.Container(t),this._touchEventPane.setStyle({display:"none"})),this.Defaults=new a(t),this.EventManager=new v(t,this.processEvent,this),this.EventManager.addListeners(this),e.Agent.isTouchDevice()||this.EventManager.setKeyboardHandler(new y(this,this.EventManager)),this._nodes=new t.ojMap,this._arNodeIds=[],this._arRootIds=[],this._links=new t.ojMap,this._arLinkIds=[],this._renderCount=0,this._deferredObjCount=0,this._allNodeIdsMap=new t.ojMap,this._unresolvedNodeIds=[],this._nodesToResolve=[],this._touchEventContentDiagramObjRef=null,this.setId("diagram")}static newInstance(t,e,i){return new B(t,e,i)}_calcPanZoomState(t){var e=t.getPanX(),i=t.getPanY(),n=t.getZoom(),s=this.getLayoutOffset();return{zoom:n,centerX:(.5*this.Width-e)/n-s.x,centerY:(.5*this.Height-i)/n-s.y}}PreRender(){this._bRendered&&(this._currentPanZoomState=this._calcPanZoomState(this.getPanZoomCanvas())),!this.IsResize()&&this._bRendered&&("none"!=m.getAnimOnDataChange(this)&&(this._oldDataAnimState=new T(this)),this._bRendered=!1,this._oldPanZoomCanvas=this.getPanZoomCanvas(),this._setDataSourceListeners(this.getOptions().data,!1)),this.IsResize()?this._layoutContext&&(this._layoutContext.setEventData(null),this._layoutContext.setComponentSize(new b(0,0,this.getWidth(),this.getHeight()))):(this.ResetNodesAndLinks(),this._oldLayoutContext=this._layoutContext,this._layoutContext=null)}ResetNodesAndLinks(){var t=this.getCtx();if(this.setLinksPane(new e.Container(t)),this.setNodesPane(new e.Container(t)),this.setTopPane(new e.Container(t)),this._nodes=new t.ojMap,this._arNodeIds=[],this._arRootIds=[],this._links=new t.ojMap,this._arLinkIds=[],this._highlightedObjects=null,this._promotedLinksMap=null,this._linkToPromotedMap=null,this._collapsedNodes=null,this.isDataProviderMode()||(this.getOptions().nodes=[],this.getOptions().links=[]),this._allNodeIdsMap=new t.ojMap,this._unresolvedNodeIds=[],f.RemoveOverviewWindow(this,this.Overview),this.Overview=null,this.activeInnerElems){var i=document.activeElement;if(this.getElem().contains(i)){if(this._oldActiveElemId=i.id,!this._oldActiveElemId){for(;!(o.CustomElementUtils.isElementRegistered(i.tagName)&&i.id||"OJ-DIAGRAM"===i.tagName);)i=i.parentElement;"OJ-DIAGRAM"!==i.tagName&&(this._oldActiveCustomElemId=i.id)}}else this.activeInnerElems=null}}_onAnimationEnd(){this._deleteContainer&&(this.removeChild(this._deleteContainer),this._deleteContainer.destroy()),this._deleteContainer=null,this.Animation&&this.getEventManager().addListeners(this),this.AnimationStopped||this.RenderComplete(),this.Animation=null,this.AnimationStopped=!1,this._bRendered&&(this._oldDataAnimState=null)}animateUpdate(t,i){var n=new e.CustomAnimation(this.getCtx(),null,t.getAnimDur()),s=i.PanZoomMatrix,o=this.getPanZoomCanvas().getContentPane().getMatrix();s.equals(o)||(this.getPanZoomCanvas().getContentPane().setMatrix(s),n.getAnimator().addProp(e.Animator.TYPE_MATRIX,this.getPanZoomCanvas().getContentPane(),this.getPanZoomCanvas().getContentPane().getMatrix,this.getPanZoomCanvas().getContentPane().setMatrix,o));var a=i.IsPartialUpdate?i.getNewNodes():this.GetRootNodeObjects(),r=i.IsPartialUpdate?i.getNewLinks():this.GetAllLinkObjects();t.constructAnimation(i.getNodes(),a),t.constructAnimation(i.getLinks(),r),t.constructAnimation([i.Overview],[this.Overview]),t.add(n,c)}_resolveDeferredData(t,e){if(null==e||this._isNodeDisclosed(e.id)||this._discoverLinks(t,e)){var i=t.getData(e);this._deferredObjCount++;var n=this,s=this._renderCount;i.then(i=>{n._renderDeferredData(s,t,e||n.getOptions(),i)},i=>{n._renderDeferredData(s,t,e||n.getOptions(),null)})}}_renderDeferredData(t,e,i,n){if(t===this._renderCount&&this.getCtx().isReadyToRender()){if(null!=n){if(i.nodes=n.nodes,Array.isArray(n.links)&&(this.getOptions().links=this.getOptions().links.concat(n.links)),this._findUnresolvedLinks(n),Array.isArray(i.nodes))for(this._nodesToResolve=this._nodesToResolve.concat(i.nodes);this._nodesToResolve.length>0;)this._resolveDeferredData(e,this._nodesToResolve.shift())}else i.nodes=null;this._deferredObjCount--,0===this._deferredObjCount&&this.RenderComponentInternal()}}_findUnresolvedLinks(t,e){if(!("none"===this.getOptions().promotedLinkBehavior||this.isDataProviderMode()&&"lazy"===this.getOptions().promotedLinkBehavior)){var i=(t,n)=>{Array.isArray(t.nodes)&&t.nodes.forEach(t=>{n.set(t.id,!0),e&&i(t,n)})};i(t,this._allNodeIdsMap);for(var n=this._unresolvedNodeIds.length-1;n>=0;n--)this._allNodeIdsMap.has(this._unresolvedNodeIds[n])&&this._unresolvedNodeIds.splice(n,1);if(Array.isArray(t.links))for(var s=0;s<t.links.length;s++){var o=t.links[s];this._allNodeIdsMap.has(o.startNode)||this._unresolvedNodeIds.push(o.startNode),this._allNodeIdsMap.has(o.endNode)||this._unresolvedNodeIds.push(o.endNode)}}}_discoverLinks(t,e){var i=this.getOptions().promotedLinkBehavior;return!("none"===i||0==this._unresolvedNodeIds.length||"lazy"==i&&t.getChildCount(e)<=0)&&"disjoint"!=t.getDescendantsConnectivity(e)}_setDataSourceListeners(t,e){t&&(this._dataSourceAddEventHandler||(this._dataSourceAddEventHandler=this.handleDataSourceChangeEvent.bind(this,"add")),this._dataSourceRemoveEventHandler||(this._dataSourceRemoveEventHandler=this.handleDataSourceChangeEvent.bind(this,"remove")),this._dataSourceChangeEventHandler||(this._dataSourceChangeEventHandler=this.handleDataSourceChangeEvent.bind(this,"change")),e?(t.on("add",this._dataSourceAddEventHandler),t.on("remove",this._dataSourceRemoveEventHandler),t.on("change",this._dataSourceChangeEventHandler)):(t.off("add",this._dataSourceAddEventHandler),t.off("remove",this._dataSourceRemoveEventHandler),t.off("change",this._dataSourceChangeEventHandler)))}addDataSourceEventListeners(){this._setDataSourceListeners(this.getOptions().data,!0)}removeDataSourceEventListeners(){this._setDataSourceListeners(this.getOptions().data,!1)}_fetchDataProviderData(t,e){var i=this.isTreeDataProvider()?d.GetCollapsedContainers(t,e,[]):[];if(i.length>0){var n=this,s=i.map(e=>n.Options._fetchDataHandler(t,n._context.KeySetImpl([e.id]),e,e.id)),o=this._renderCount;Promise.all(s).then(i=>{if(o===n._renderCount&&n.getCtx().isReadyToRender()){e=[],i.forEach(t=>{Array.isArray(t)&&t.forEach(t=>{n._allNodeIdsMap.set(t.id,!0),e.push(t)})});for(var s=n._unresolvedNodeIds.length-1;s>=0;s--)n._allNodeIdsMap.has(n._unresolvedNodeIds[s])&&n._unresolvedNodeIds.splice(s,1);n._unresolvedNodeIds.length>0?n._fetchDataProviderData(t,e):n.RenderComponentInternal()}})}else this.RenderComponentInternal()}isDataProviderMode(){return!!this.getOptions().nodeData}isTreeDataProvider(){var t=this.getOptions().nodeData;return!(!t||!t.getChildDataProvider)}Render(){if(super.Render(),this.InitComponentInternal(),this._deferredObjCount=0,this._nodesToResolve=[],this._bRendered||this.IsResize())0===this._deferredObjCount&&this.RenderComponentInternal();else if(this._renderCount++,this.isDataProviderMode()){this._findUnresolvedLinks({nodes:this.Options.nodes,links:this.Options.links},!0);var t=this._unresolvedNodeIds.length>0?this.Options.nodes.slice():[];this._fetchDataProviderData(this.Options.nodeData,t)}else if(this.getOptions().data){var e=this.getOptions().data;this._setDataSourceListeners(e,!1),this._resolveDeferredData(e,null)}else this.RenderComponentInternal()}InitComponentInternal(){var t=this.getPanZoomCanvas();t.setMinZoom(this.getMinZoom()),t.setMaxZoom(this.getMaxZoom()),t.setAnimDur(this.getAnimDur()),t.getContentPane().addChild(this._linksPane),t.getContentPane().addChild(this._nodesPane),t.getContentPane().addChild(this._topPane),this._touchEventPane&&t.getContentPane().addChild(this._touchEventPane)}RenderComponentInternal(){var t;if(this._bRendered||this.IsResize()||(this._setDataSourceListeners(this.getOptions().data,!0),this.prepareNodes(this.getOptions().nodes),this.renderLinks(this.getOptions().links),this.getCtx().setKeyboardFocusArray([this])),t=0===this._nodes.size)this._processContent(t);else{this.contains(this._oldPanZoomCanvas)||this.addChild(this._oldPanZoomCanvas);var e=this.layout(),i=this,n=this._renderCount;e.then(()=>{n===i._renderCount&&i._processContent(t)},()=>{n===i._renderCount&&(i._oldPanZoomCanvas&&(i.removeChild(i._oldPanZoomCanvas),i._oldPanZoomCanvas.destroy(),i._oldPanZoomCanvas=null),i._bRendered=!0,this._currentPanZoomState=null)})}}_processContent(t){var i;if(t||(this.removeChild(this._oldPanZoomCanvas),this._processHighlighting(),this._processInitialSelections(),this._updateKeyboardFocusEffect(),(i=null==this._cachedViewBounds)&&(this._cachedViewBounds=this.GetViewBounds()),this.panZoom()),!this._bRendered){var n=this.getPanZoomCanvas();n.setPanningEnabled(this.IsPanningEnabled()),n.setPanDir(this.getPanDir()),n.setZoomingEnabled(this.IsZoomingEnabled()),n.setZoomToFitEnabled(this.IsZoomingEnabled())}!this.Overview&&this.Options.overview&&"on"==this.Options.overview.rendered?(this.Overview=new O(this),f.ConfigureOverviewWindow(this,this.Overview)):this.Overview&&f.UpdateOverviewWindow(this,this.Overview),this.StopAnimation(!0);var s=m.getAnimOnDisplay(this),o=m.getAnimOnDataChange(this);if(this._bRendered||"none"===s||this._oldDataAnimState){if("none"!==o&&this._oldDataAnimState){this._deleteContainer=new e.Container(this.getCtx(),"g","Delete Container"),this.addChild(this._deleteContainer);var a=new R(this.getCtx(),this._deleteContainer,this._oldDataAnimState,this);a.constructAnimation([this._oldDataAnimState],[this]),this.Animation=a.getAnimation()}}else this.Animation=e.BlackBoxAnimationHandler.getInAnimation(this.getCtx(),e.BlackBoxAnimationHandler.ALPHA_FADE,this,null,m.getAnimDur(this));if(this.Animation?(this.getEventManager().hideTooltip(),this.getEventManager().removeListeners(this),this.Animation.setOnEnd(this._onAnimationEnd,this),this.Animation.play()):this._onAnimationEnd(),this._oldPanZoomCanvas&&(this._oldPanZoomCanvas.destroy(),this._oldPanZoomCanvas=null),this._bRendered=!0,this._currentPanZoomState=null,this.RefreshEmptyText(t),this.IsPanningEnabled()){var r=this._cachedViewBounds;if(null!=r){var d=this.getPanZoomCanvas().getZoom();this.ConstrainPanning(r.x,r.y,r.w,r.h,d)}}this.ClearLayoutPanZoomState(),i&&(this._cachedViewBounds=null)}panZoom(t){var e=this.getPanZoomCanvas(),i=this.getLayoutOffset();t||(t=(t=this.GetLayoutPanZoomState())||{zoom:0,centerX:null,centerY:null});var n=t.zoom,s=t.centerX,o=t.centerY,a=this.IsPanningEnabled(),r=this.IsZoomingEnabled();e.setPanningEnabled(!0),e.setZoomingEnabled(!0),this.SetPanningEnabled(!0);try{0!==n?(this.AdjustMinZoom(),n=e.ConstrainZoom(n),e.zoomTo(n,0,0,null,!0),null!==s||null!==o?e.panTo(this.Width/2-(s+i.x)*n,this.Height/2-(o+i.y)*n):e.center(null,this._cachedViewBounds)):(this._zoomToFit(),null===s&&null===o||e.panTo(this.Width/2-(s+i.x)*n,this.Height/2-(o+i.y)*n))}finally{this.SetPanningEnabled(a),e.setPanningEnabled(a),e.setZoomingEnabled(r)}}_zoomToFit(){var t=this.getPanZoomCanvas();if(this._bRendered){if(this.IsResize()||this._partialUpdate){var e=this.AdjustMinZoom(),n=e||this._cachedViewBounds;t.setZoomToFitPadding(i.PanZoomCanvas.DEFAULT_PADDING),t.setZoomToFitEnabled(!0),t.zoomToFit(null,n),t.setZoomToFitEnabled(this.IsZoomingEnabled())}}else this.AdjustMinZoom(),t.zoomToFit(null,this._cachedViewBounds)}RefreshEmptyText(t){if(t&&this.getEmptyText())this._emptyTextDisplay?(this._emptyTextDisplay.setX(this.Width/2),this._emptyTextDisplay.setY(this.Height/2),e.TextUtils.fitText(this._emptyTextDisplay,this.getWidth()-2*e.TextUtils.EMPTY_TEXT_BUFFER,1/0,this)):this._emptyTextDisplay=this.CreateEmptyText(this.getEmptyText());else if(this._emptyTextDisplay){var i=this._emptyTextDisplay.getParent();i&&i.removeChild(this._emptyTextDisplay),this._emptyTextDisplay=null}}CreateEmptyText(t){var i=this.getOptions();return this.renderEmptyText(this,t,new e.Rectangle(0,0,this.getWidth(),this.getHeight()),this.getEventManager(),i._statusMessageStyle)}setEmptyText(t){this._emptyText=t}getEmptyText(){return this._emptyText}SetOptions(t){super.SetOptions(t),this.isDataProviderMode()||(this.Options.nodes=[],this.Options.links=[]),this.SetPanningEnabled("none"!=this.Options.panning),this.SetZoomingEnabled("none"!=this.Options.zooming),this.setSelectionMode(this.Options.selectionMode),this.setEmptyText(this.Options.emptyText?this.Options.emptyText:this.Options.translations.labelNoData)}static getDefaults(t){return(new a).getDefaults(t)}getMaxZoom(){var t=this.getOptions().maxZoom,e=parseFloat(t);return e>0?e:1}getMinZoom(){var t=this.getOptions().minZoom;if(t){var e=parseFloat(t);return e>0&&(t=Math.min(e,this.getMaxZoom())),t}return 0}getPanDir(){return this.getOptions().panDirection}SetPanningEnabled(t){this._panningEnabled=t}IsPanningEnabled(){return this._panningEnabled}SetZoomingEnabled(t){this._zoomingEnabled=t}IsZoomingEnabled(){return this._zoomingEnabled}getSelectionHandler(){return this._selectionHandler}setSelectionMode(t){this._selectionHandler="single"==t?new e.SelectionHandler(this.getCtx(),e.SelectionHandler.TYPE_SINGLE):"multiple"==t?new e.SelectionHandler(this.getCtx(),e.SelectionHandler.TYPE_MULTIPLE):null,this.getEventManager().setSelectionHandler(this._selectionHandler)}isSelectionSupported(){return!!this._selectionHandler}getNodesPane(){return this._nodesPane}setNodesPane(t){this._nodesPane=t}getLinksPane(){return this._linksPane}setLinksPane(t){this._linksPane=t}getTopPane(){return this._topPane}setTopPane(t){this._topPane=t}getAnimDur(){return m.getAnimDur(this)}processEvent(t){var e=t.type;if("categoryHighlight"==e)this._processHighlighting(!0);else if("selection"==e)this.getOptions().selection=t.selection;else if("overview"==e){var i=t.subtype;return void("scrollPos"==i||"scrollTime"==i?this.Overview.HandleViewportChange(t):"scrollEnd"==i&&this.getPanZoomCanvas().writebackPan())}t&&this.dispatchEvent(t)}prepareNodes(t){if(t){this._prepareNodes(null,t);var e=this.getOptions().expanded;if(!e||!e.has&&!this.DisclosedNodes){var i="all"===e?this._arNodeIds.slice(0):e;this.DisclosedNodes=e?i:[]}}}renderLinks(t){if(t){for(var i=m.getLinkDefaultStyles(this,"linkDefaults"),n=0;n<t.length;n++){var s=t[n];if(!this._isLinkPromoted(s)){s=m.getLinkStyles(this,s,i);var o=new p(this.getCtx(),this,s,!1),a=o.getId();if(this._arLinkIds.push(a),!o.isHidden()){var r=this.getNodeById(o.getStartId()),d=this.getNodeById(o.getEndId());r.addOutLinkId(a),d.addInLinkId(a),o.render(),this._links.set(a,o)}}}if(this._promotedLinksMap){var h=m.getLinkDefaultStyles(this,"promotedLink"),l=this;this._promotedLinksMap.forEach((t,i,n)=>{if(!l._links.has(i)){var s=e.JsonUtils.merge(t,h),o=new p(l.getCtx(),l,s,!0),a=o.getId(),r=l.getNodeById(o.getStartId()),d=l.getNodeById(o.getEndId());r.addOutLinkId(a),d.addInLinkId(a),o.render(),l._arLinkIds.push(a),l._links.set(a,o)}})}}}panZoomReset(t){this._panZoomReset=t}layout(){var t=this.getOptions().layout,i=this._getLayoutContext();i.setDirtyContext(new(this.getCtx().ojMap));var n=this._currentPanZoomState;if(n&&this.dispatchEvent(new e.EventFactory.newEvent("beforePanZoomReset")),this._panZoomReset?(i.setPanZoomState(null),this.IsResize()?i.setCurrentPanZoomState(null):i.setCurrentPanZoomState(n)):(i.setCurrentPanZoomState(n),i.setPanZoomState(n||this.getOptions().panZoomState)),t&&"function"==typeof t){for(var s=i.getNodeCount(),o=0;o<s;o++){var a=i.getNodeByIndex(o);this.renderLeafNodeFromContext(a)}var r=this,d=t(i);d||(d={then:(t,e)=>{t()}}),this.setAlphas(0);var h=this._renderCount;return d.then(t=>{if(r._renderCount===h||r.IsResize()){r.setAlphas(1),r._oldDataAnimState&&r._oldDataAnimState.updateStateFromLayoutContext(i);for(var e=i.getNodeCount(),n=0;n<e;n++){var s=i.getNodeByIndex(n);r.renderNodeFromContext(s,!0)}r.ApplyLayoutContext(i,!0)}},t=>{}),d}this.Log("Diagram: Layout function is not defined",1)}setAlphas(t){this._bRendered||(this.getLinksPane().setAlpha(t),this.getNodesPane().setAlpha(t))}getNodeById(t){return this._nodes.get(t)}getLinkById(t){return this._links.get(t)}GetAllLinks(){return this._arLinkIds}GetAllLinksMap(){var t=new(this.getCtx().ojMap);return this._links&&this._links.forEach((e,i,n)=>{t.set(i,e)}),t}GetAllLinkObjects(){var t=[];return this._links&&this._links.forEach((e,i,n)=>{t.push(e)}),t}GetAllNodes(){return this._arNodeIds}GetAllNodesMap(){var t=new(this.getCtx().ojMap);return this._nodes&&this._nodes.forEach((e,i,n)=>{t.set(i,e)}),t}GetAllNodeObjects(){var t=[];return this._nodes&&this._nodes.forEach((e,i,n)=>{t.push(e)}),t}GetAllRoots(){return this._arRootIds}GetRootNodeObjects(){for(var t=[],e=0;this._arRootIds&&e<this._arRootIds.length;e++){var i=this._nodes.get(this._arRootIds[e]);i&&t.push(i)}return t}_setPanZoomState(t,i,n){var s=this.getLayoutOffset(),o=null!==t&&n?(.5*this.Width-t)/n-s.x:this.Options.panZoomState.centerX,a=null!==i&&n?(.5*this.Height-i)/n-s.y:this.Options.panZoomState.centerY;this.dispatchEvent(new e.EventFactory.newOptionChangeEvent("panZoomState",{zoom:n,centerX:o,centerY:a}))}HandlePanEvent(t){super.HandlePanEvent(t),"panned"===t.subtype&&this._setPanZoomState(t.newX,t.newY,t.zoom),this.Overview&&this.Overview.UpdateViewport()}HandleZoomEvent(t){var i;switch(super.HandleZoomEvent(t),this.Overview&&this.Overview.UpdateViewport(),t.subtype){case"adjustPanConstraints":if(this.IsPanningEnabled()){var n=t.newZoom,s=this.GetViewBounds();this.ConstrainPanning(s.x,s.y,s.w,s.h,n)}break;case"zoomed":i=this.getOptions().nodeContent||{},!e.Agent.isTouchDevice()&&i.zoomRenderer&&t.oldZoom!==t.newZoom&&this._nodes.forEach((e,i,n)=>{e.rerenderOnZoom(t)}),t.panAndZoom||this._setPanZoomState(t.pos.x,t.pos.y,t.newZoom);break;case"zoomToFitEnd":case"zoomEnd":i=this.getOptions().nodeContent||{},e.Agent.isTouchDevice()&&i.zoomRenderer&&t.oldZoom!==t.newZoom&&this._nodes.forEach((e,i,n)=>{e.rerenderOnZoom(t)})}}getNavigableLinksForNodeId(t){var e=[];return this._links.forEach((i,n,s)=>{var o=i.getStartId(),a=i.getEndId();o!=t&&a!=t||!i.getVisible()||e.push(i)}),e}_processInitialSelections(){if(this.Options.selection&&this.isSelectionSupported()){var t=[];this._nodes.forEach((e,i,n)=>{t.push(e)}),this._links.forEach((e,i,n)=>{t.push(e)}),this.getSelectionHandler().processInitialSelections(this.Options.selection,t)}}_processHighlighting(t){t&&this.EventManager.removeListeners(this,!0),this._highlightedObjects&&(this._updateAlphas(!1,this._highlightedObjects),this._highlightedObjects=null);var i=this.Options.highlightedCategories;if(i&&0!==i.length){var n="any"==this.Options.highlightMatch;this._highlightedObjects=new(this.getCtx().ojMap);var s=[],o=this;this._nodes.forEach((t,a,r)=>{(n?e.ArrayUtils.hasAnyItem(t.getCategories(),i):e.ArrayUtils.hasAllItems(t.getCategories(),i))&&(o._highlightedObjects.set(a,t),s.push(t))}),this._processNodeConnections(s);var a=[];this._links.forEach((t,s,r)=>{(n?e.ArrayUtils.hasAnyItem(t.getCategories(),i):e.ArrayUtils.hasAllItems(t.getCategories(),i))&&(o._highlightedObjects.set(s,t),a.push(t))}),"linkAndNodes"==this.Options.linkHighlightMode&&this._processLinkConnections(a),this._updateAlphas(!0,this._highlightedObjects),t&&setTimeout(()=>{o.getEventManager().addListeners(o)},0)}else t&&this.EventManager.addListeners(this)}_processNodeConnections(t){var e=this.Options.nodeHighlightMode;if("node"!=e){for(var i="nodeAndIncomingLinks"==e||"nodeAndLinks"==e,n="nodeAndOutgoingLinks"==e||"nodeAndLinks"==e,s=[],o=0;o<t.length;o++){var a=t[o],r=i&&a.getInLinkIds()?a.getInLinkIds():[];r=n&&a.getOutLinkIds()?r.concat(a.getOutLinkIds()):r;for(var d=0;d<r.length;d++){var h=r[d];this._highlightedObjects.set(h,this.getLinkById(h)),s.push(this.getLinkById(h))}}this._processLinkConnections(s)}}_processLinkConnections(t){for(var e=0;e<t.length;e++){var i=t[e],n=i.getStartId(),s=i.getEndId();this._highlightedObjects.set(n,this.getNodeById(n)),this._highlightedObjects.set(s,this.getNodeById(s))}}_updateAlphas(t,e){var i=this._nodes.size+this._links.size;if(e.size!==i)if(this._arNodeIds.length==this._arRootIds.length){var n=t?this.Options.styleDefaults._highlightAlpha:1,s=this.getLinksPane(),o=this.getNodesPane();if(e.size>.5*i){var a=this.getBottomPane();a.setAlpha(n),this._links.forEach((i,n,o)=>{var r=e.get(n);!r&&t?a.addChild(i):r||s.addChild(i)}),this._nodes.forEach((i,n,s)=>{var r=e.get(n);!r&&t?a.addChild(i):r||o.addChild(i)})}else{var r=this.getTopPane();s.setAlpha(n),o.setAlpha(n);var d=[],h=[];e.forEach((t,e,i)=>{t instanceof p?d.push(t):t instanceof C&&h.push(t)});for(var l=0;l<d.length;l++)t?r.addChild(d[l]):s.addChild(d[l]);for(var g=0;g<h.length;g++)t?r.addChild(h[g]):o.addChild(h[g])}}else t?(e.forEach((t,e,i)=>{t.highlight(!0)}),this._nodes.forEach((t,i,n)=>{e.has(i)||t.highlight(!1)}),this._links.forEach((t,i,n)=>{e.has(i)||t.highlight(!1)})):(this._nodes.forEach((t,e,i)=>{t.highlight(!0)}),this._links.forEach((t,e,i)=>{t.highlight(!0)}))}highlight(t){this.Options.highlightedCategories=e.JsonUtils.clone(t),this._processHighlighting()}select(t){this.Options.selection=e.JsonUtils.clone(t),this._processInitialSelections()}getAutomation(){return this.Automation||(this.Automation=new w(this)),this.Automation}Log(t,e){var i=this.getOptions()._logger;if(i)switch(e){case 1:i.error&&i.error(t);break;case 2:i.warn&&i.warn(t);break;case 3:i.info&&i.info(t);break;default:i.log&&i.log(t)}}processDefaultHoverEffect(t,e){var i=this.getNodeById(t);i&&i.processDefaultHoverEffect(e)}processDefaultSelectionEffect(t,e){var i=this.getNodeById(t);i&&i.processDefaultSelectionEffect(e)}processDefaultFocusEffect(t,e){var i=this.getNodeById(t);i&&i.processDefaultFocusEffect(e)}updateNodeDims(t){if(t.IsRendered){var e=this.getNodeById(t.getId());t.setBounds(E(e.getLayoutBounds(!0))),t.setContentBounds(E(e.getContentBounds(!0))),t.setLabelBounds(E(e.getLabelBounds(!0)))}else this.renderNodeFromContext(t,!0)}renderLeafNodeFromContext(t){if(this.getNodeById(t.getId()).isDisclosed())for(var e=t.getChildNodes(),i=0;i<e.length;i++){var n=e[i];this.renderLeafNodeFromContext(n)}else this.renderNodeFromContext(t,!1)}renderNodeFromContext(t,e){if(!t.IsRendered){var i=this.getNodeById(t.getId());if(i.isDisclosed()){var n=this.CreateEmptyLayoutContext();n.setDirtyContext(t.LayoutContext?t.LayoutContext.getDirtyContext():null),this._oldDataAnimState&&this._oldDataAnimState.updateStateFromLayoutContext(n);for(var s=t.getChildNodes(),o=0;o<s.length;o++){var a=s[o];this.renderNodeFromContext(a,!1),n.addNode(a)}for(var r=0;r<s.length;r++)this.updateNodeDims(s[r]);this.ApplyLayoutContext(n)}i.render();var d=i.isDisclosed()?i.getContainerPadding():null;d&&t.setContainerPadding(d.top,d.right,d.bottom,d.left),t.setBounds(E(i.getLayoutBounds(e))),t.setContentBounds(E(i.getContentBounds(e))),t.setLabelBounds(E(i.getLabelBounds(e))),t.IsRendered=!0}}_prepareNodes(t,e){if(e)for(var i=m.getNodeDefaultStyles(this),n=0;n<e.length;n++){var s=m.getNodeStyles(this,e[n],i),o=new C(this.getCtx(),this,s),a=o.getId();t?(t.addChildNodeId(a),o.setGroupId(t.getId())):this._arRootIds.push(a),this._arNodeIds.push(a),s.nodes&&s.nodes.length>0&&(this._isNodeDisclosed(a)?(o.setDisclosed(!0),this._prepareNodes(o,s.nodes)):this._addToCollapsedArray(o)),o.isHidden()||(t&&t.GetChildNodePane()?t.GetChildNodePane().addChild(o):this.getNodesPane().addChild(o),this._nodes.set(a,o))}}setNodeDisclosed(t,i){i!=this._isNodeDisclosed(t)&&this.dispatchEvent(new e.EventFactory.newEvent(i?"beforeExpand":"beforeCollapse",t))}expand(t){var i=!1,n=this.getOptions().expanded;n&&n.has&&!n.has(t)?(i=!0,n=n.add([t]),this.applyOptions({expanded:n},this.Defaults.getNoCloneObject())):(this.DisclosedNodes||(this.DisclosedNodes=[]),this.DisclosedNodes.indexOf(t)<0&&(this.DisclosedNodes.push(t),i=!0));if(i){var s=this.getNodeById(t);if(this.isDataProviderMode()&&!s.getData().nodes){var o=d.GetNodeOption(this,s),a=this,r=this._renderCount;this.getOptions()._fetchDataHandler(this.getOptions().nodeData,n,o,t).then(i=>{r===a._renderCount&&(a.render(a.getOptions(),a.Width,a.Height),a.dispatchEvent(new e.EventFactory.newEvent("expand",t)))})}else this.render(this.getOptions(),this.Width,this.Height),this.dispatchEvent(new e.EventFactory.newEvent("expand",t))}}collapse(t){var i=!1,n=this.getOptions().expanded;if(n&&n.has&&n.has(t))i=!0,n=n.delete([t]),this.applyOptions({expanded:n},this.Defaults.getNoCloneObject());else{var s=-1;this.DisclosedNodes&&(s=this.DisclosedNodes.indexOf(t)),s>-1&&(this.DisclosedNodes.splice(s,1),i=!0)}i&&(this.render(this.getOptions(),this.Width,this.Height),this.dispatchEvent(new e.EventFactory.newEvent("collapse",t)))}_addLayoutContextForChildNodes(t,e,i,n){if(t.isDisclosed()){var s=t.getChildNodeIds(),o=this._createLayoutContextForChildNodes(e,i,s,n);e.setChildNodes(o)}}_appendLayoutContextForChildNodes(t,i,n,s,o){if(t.isDisclosed()){var a=s.reduce((t,e)=>(t.push(e.id),t),[]),r=this._createLayoutContextForChildNodes(i,n,a,!0),d=i.getChildNodes()||[];r=e.ArrayUtils.insert(d,r,o),i.setChildNodes(r),i.setDisclosed(!0),i.SetContainerPaddingObj(B.getLayoutContainerPadding(t.getContainerPadding())),i.UpdateParentNodes()}}_createLayoutContextForChildNodes(t,e,i,n){for(var s=[],o=0;o<i.length;o++){var a=this.getNodeById(i[o]);if(a.getVisible()){var r=this.CreateLayoutContextNode(a,null,n,e);r.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getNodeById(i[o]):null),e.addNodeToMap(r),r.setParentNode(t),s.push(r),this._addLayoutContextForChildNodes(a,r,e,n)}}return s}_isNodeDisclosed(t){var e=this.getOptions().expanded;if(e&&e.has)return e.has(t);var i=this.DisclosedNodes?this.DisclosedNodes:e;return i&&i.indexOf(t)>-1||i&&i.indexOf("all")>-1}_isLinkPromoted(t){var e=this.getNodeById(t.startNode),i=this.getNodeById(t.endNode);if(e&&i||!this._collapsedNodes)return!1;if("none"===this.getOptions().promotedLinkBehavior)return!0;var n=e?e.getId():this._findFirstVisibleAncestor(t.startNode),s=i?i.getId():this._findFirstVisibleAncestor(t.endNode);if(!n||!s)return!1;if(n===s)return!1;var o=p.GetPromotedLinkId(this,n,s);return this._promotedLinksMap||(this._promotedLinksMap=new(this.getCtx().ojMap)),this._promotedLinksMap.has(o)?this._promotedLinksMap.get(o)._links.push(t):this._promotedLinksMap.set(o,{id:o,startNode:n,endNode:s,_links:[t]}),this._linkToPromotedMap||(this._linkToPromotedMap=new(this.getCtx().ojMap)),this._linkToPromotedMap.set(t.id,o),!0}_addToCollapsedArray(t){this._collapsedNodes||(this._collapsedNodes=[]),this._collapsedNodes.push(t)}_findFirstVisibleAncestor(t){for(var e=this.getCtx(),i=(t,n)=>{if(t)for(var s=0;s<t.length;s++)if(d.compareValues(e,t[s].id,n)||i(t[s].nodes,n))return!0;return!1},n=0;n<this._collapsedNodes.length;n++){var s=this._collapsedNodes[n];if(i(s.getData().nodes,t))return s.getId()}return null}_updateKeyboardFocusEffect(){var t=this.getEventManager().getFocus(),e=this.Options._keyboardUtils;oj.Context.getContext(this.getContainerElem()).getBusyContext().whenReady().then(()=>{if(e.disableAllFocusable(this.getElem(),!0),this.activeInnerElems){var t=this.getNodeById(this.activeInnerElemsNodeId);this._oldActiveElemId&&this._enableActiveElems(this._oldActiveElemId,t)||this._oldActiveCustomElemId&&this._enableActiveElems(this._oldActiveCustomElemId,t)||(this.activeInnerElems=null,this._context._parentDiv.focus(),t.showKeyboardFocusEffect(),t.hasActiveInnerElems=!1),this.EventManager.setFocus(t),this._oldActiveElemId=null,this._oldActiveCustomElemId=null}});var i,n=!1;t&&(t instanceof C?i=this.getNodeById(t.getId()):t instanceof p&&(i=this.getLinkById(t.getId())),n=t.isShowingKeyboardFocusEffect(),i&&n&&i.showKeyboardFocusEffect(),this.getEventManager().setFocus(i))}_enableActiveElems(t,e){var i=document.getElementById(t);if(i&&e.getElem().contains(i)){var n=this.Options._keyboardUtils,s=n.enableAllFocusable(e.getElem());return e instanceof C&&e.isDisclosed()&&e.GetChildNodePane(!0)&&(n.disableAllFocusable(e.GetChildNodePane().getElem(),!0),s=(s=Array.from(s)).filter(t=>-1!==t.tabIndex)),s.length>0&&(i?i.focus():s[0].focus(),this.activeInnerElems=s,e.hasActiveInnerElems=!0),!0}return!1}clearDisclosedState(){this.DisclosedNodes=null}ShowLinkCreationFeedback(t){if(this.getEventManager().LinkCreationStarted){var i=this._context.pageToStageCoords(t.pageX,t.pageY),n=this.getPanZoomCanvas().getContentPane().stageToLocal({x:i.x,y:i.y});if(this._linkCreationFeedBack){var s=this._linkCreationFeedBack.GetCreationFeedbackPoints(n);this._linkCreationFeedBack.setPoints(s)}else{var o=this.getEventManager().DragSource.getDragObject();if(o instanceof C){var a=this.getEventManager().DragSource.getDragCoords(),r=this.getPanZoomCanvas().getContentPane().stageToLocal({x:a.x,y:a.y}),d=this.getOptions().styleDefaults.linkDefaults;m.prepareLinkStyle(d,"style");var h=this.getOptions().dnd.drag.ports.linkStyle;if(h&&"function"==typeof h){var l=h({dataContext:o.getDataContext(),portElement:o.__dragPort});l&&(d.style=e.JsonUtils.merge(l.svgStyle,d.style),d.svgClassName=l.svgClassName||d.className)}var g={id:"linkFeedback",startNode:o.getId(),endNode:o.getId()};g=e.JsonUtils.merge(g,d);var u=new p(this.getCtx(),this,g,!1);this.getNodesPane().addChild(u),u.setMouseEnabled(!1),u.setPoints([r.x,r.y,n.x,n.y]),this._linkCreationFeedBack=u}}}}HideLinkCreationFeedback(){this.getNodesPane().removeChild(this._linkCreationFeedBack),this._linkCreationFeedBack=null}handleDataSourceChangeEvent(t,i){if("none"!==m.getAnimOnDataChange(this)&&(this.dispatchEvent(e.EventFactory.newEvent("notready")),this._oldDataAnimState=new T(this,t,i)),this._currentPanZoomState=this._calcPanZoomState(this.getPanZoomCanvas()),this.IsPanningEnabled()){var n=this.getPanZoomCanvas();n.setMinPanY(null),n.setMaxPanY(null),n.setMinPanX(null),n.setMaxPanX(null)}var s,o,a=i.data.nodes,r=i.data.links;if("add"==t){if(o=(s=i.parentId)?this.getNodeById(s):null,"all"===this.getOptions().expanded&&a){var d=this.DisclosedNodes,h=t=>{for(var e=0;e<t.length;e++)d.push(t[e].id),t[e].nodes&&h(t[e].nodes)};h(a)}o?(o.appendChildNodesData(a,i.index),this._isNodeDisclosed(s)&&(o.setDisclosed(!0),this._prepareNodes(o,a))):this._prepareNodes(null,a),this.renderLinks(r)}else if("change"==t){if(a)for(var l=m.getNodeDefaultStyles(this),g=0;g<a.length;g++){var u=this.getNodeById(a[g].id);if(u){var c=m.getNodeStyles(this,a[g],l);u.setData(c)}}r&&(this._removeLinks(r),this.renderLinks(r))}else"remove"==t&&((o=(s=i.parentId)?this.getNodeById(s):null)?(this._removeNodes(o,a),o.removeChildNodesData(a),o.getData().nodes&&0!==o.getData().nodes.length||o.setDisclosed(!1)):this._removeNodes(null,a),this._removeLinks(r));this._oldDataAnimState&&this._oldDataAnimState.updateStateFromEvent(t,i),this._updateLayoutContext(t,i);var _=0===this.GetAllNodes().length;if(_)this._processContent(_);else{this._renderCount++;var p=this.layout(),C=this,v=this._renderCount;p.then(()=>{v===C._renderCount&&(C._partialUpdate=!0,C._updateOverview(t,i),C._processContent(!1),C._partialUpdate=!1)},()=>{v===C._renderCount&&(C.removeChild(C._oldPanZoomCanvas),C._oldPanZoomCanvas=null,C._bRendered=!0,this._currentPanZoomState=null)})}}_updateOverview(t,e){this.Overview&&f.UpdateOverviewContent(this,this.Overview,t,e)}_updateLayoutContext(t,e){this._layoutContext||(this._layoutContext=this.CreateEmptyLayoutContext());var i=this._layoutContext;i.setEventData({type:t,data:e});var n,s,o,a,r,d,h,l,g,u=e.data.nodes,c=e.data.links;if(e.parentId&&(a=i.getNodeById(e.parentId),r=this.getNodeById(e.parentId)),"add"==t){if(u)if(a&&r)a.Reset(),this._appendLayoutContextForChildNodes(r,a,i,u,e.index);else for(n=0;n<u.length;n++)o=u[n].id,this.getNodeById(o)&&(s=this.CreateLayoutContextNode(this.getNodeById(o),null,!0,i),this._addLayoutContextForChildNodes(this.getNodeById(o),s,i,!0),i.addNode(s));if(c)for(n=0;n<c.length;n++)if(d=c[n].id,h=this.getLinkById(d)||this.getLinkById(this._linkToPromotedMap.get(d))){if(i.getLinkById(h.getId()))continue;l=h.getData().startNode,g=h.getData().endNode,i.getNodeById(l)&&i.getNodeById(g)&&i.addLink(this.CreateLayoutContextLink(h,l,g,i))}}else if("change"==t){if(u)for(n=0;n<u.length;n++)o=u[n].id,(s=i.getNodeById(o))&&(s.Reset(),s.UpdateParentNodes());if(c){for(n=i.getLinkCount()-1;n>=0;n--){var _=i.getLinkByIndex(n);this._links.get(_.getId())||i.removeLink(_)}for(n=0;n<c.length;n++)d=c[n].id,(h=this.getLinkById(d)||this.getLinkById(this._linkToPromotedMap.get(d)))&&(i.removeLink(i.getLinkById(h.getId())),l=h.getData().startNode,g=h.getData().endNode,i.getNodeById(l)&&i.getNodeById(g)&&i.addLink(this.CreateLayoutContextLink(h,l,g,i)))}}else if("remove"==t){if(u){for(n=0;n<u.length;n++)o=u[n].id,s=i.getNodeById(o),i.removeNode(a,s);a&&r&&(a.Reset(),a.UpdateParentNodes(),a.setDisclosed(r.isDisclosed()))}for(n=i.getLinkCount()-1;n>=0;n--){var p=i.getLinkByIndex(n);this._links.get(p.getId())||i.removeLink(p)}}}_getLayoutContext(){if(!this._layoutContext){for(var t=this.CreateEmptyLayoutContext(),e=0;e<this._arRootIds.length;e++){var i=this._arRootIds[e];if(this.getNodeById(i)){var n=!this._bRendered,s=this.getNodeById(i),o=this.CreateLayoutContextNode(s,null,n,t);o.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getNodeById(i):null),this._addLayoutContextForChildNodes(s,o,t,n),t.addNode(o)}}var a=this;this._links.forEach((e,i,n)=>{var s=e.getData().startNode,o=e.getData().endNode;if(t.getNodeById(s)&&t.getNodeById(o)){var r=a.CreateLayoutContextLink(e,s,o,t);r.copyFrom(a._oldLayoutContext?a._oldLayoutContext.getLinkById(i):null),t.addLink(r)}}),this._layoutContext=t,this._oldLayoutContext=null}return this._layoutContext}getTouchEventPane(){return this._touchEventPane||null}getBottomPane(){this._bottomPane||(this._bottomPane=new e.Container(this.getCtx()),this.getPanZoomCanvas().getContentPane().addChildAt(this._bottomPane,0));return this._bottomPane}CreateEmptyLayoutContext(){var t=new A(this.getCtx());return t.setLocaleR2L(e.Agent.isRightToLeft(this.getCtx())),t.setComponentSize(new b(0,0,this.getWidth(),this.getHeight())),t}CreateLayoutContextNode(t,e,i,n){var s=new P;s.setId(t.getId?t.getId():t.getData().getId()),s.setBounds(E(t.getLayoutBounds())),s.setContentBounds(E(t.getContentBounds()));var o=t.getLayoutAttributes?t.getLayoutAttributes(e):t.getData()._itemData;return s.setLayoutAttributes(o),s.setData(o),s.setLabelBounds(E(t.getLabelBounds())),s.setLabelPosition(k(t.getLabelPosition())),s.setSelected(t.isSelected()),t.isDisclosed()&&(s.setDisclosed(!0),s.SetContainerPaddingObj(B.getLayoutContainerPadding(t.getContainerPadding()))),s.setContainerId(t.getGroupId()),s.Component=this,s.IsRendered=!i,s.LayoutContext=n,s}ApplyLayoutContext(t,i){var n=t.getContainerPadding();if(n){var s=t.getContainerId();if(s){var o=this.getNodeById(s);o&&o.setContainerPadding(B.getContainerPadding(n))}}for(var a,r,d,l=Number.MAX_VALUE,g=Number.MAX_VALUE,u=0;u<t.getNodeCount();u++){(d=(a=t.getNodeByIndex(u)).getPosition())&&(l=Math.min(l,d.x),g=Math.min(g,d.y));var c=a.getLabelBounds(),_=a.getLabelPosition();c&&_&&(l=Math.min(l,_.x+c.x),g=Math.min(g,_.y+c.y))}for(var p=0;p<t.getLinkCount();p++){r=t.getLinkByIndex(p);var m=h.GetLinkBounds(r);l=Math.min(l,m.x),g=Math.min(g,m.y)}for(var C=new e.Point(-l,-g),v=C.x,y=C.y,f=t.getDirtyContext(),b=0;b<t.getNodeCount();b++)if((a=t.getNodeByIndex(b)).getContainerId()&&(a.ContentOffset=new S(C.x,C.y)),f.has(a.getId())){var P=this.getNodeById(a.getId());if((d=a.getPosition())&&P.SetPosition(d.x+v,d.y+y),this.ApplyLabelPosition(a,P,N(d)),P.isDisclosed()){var D=a.getContainerPadding();D&&P.setContainerPadding(B.getContainerPadding(D))}}for(var E=0;E<t.getLinkCount();E++)if(r=t.getLinkByIndex(E),f.has(r.getId())){var k=this.getLinkById(r.getId()),I=this.GetLinkTranslationOffset(k,r,C),L=I.x,x=I.y,A=r.getPoints();A&&k.setPoints(A),k.setTranslate(L,x),this.ApplyLabelPosition(r,k,new e.Point(0,0))}var O=t.getPanZoomState();O&&(this._layoutPanZoomState=O),i&&(this._layoutOffset=new e.Point(v,y))}GetLinkTranslationOffset(t,i,n){var s=new e.Point(0,0),o=this.getCtx();if(t.getGroupId()){if(!d.compareValues(o,t.getGroupId(),i.getCoordinateSpace())){for(var a=i.getCoordinateSpace(),r=this.getNodeById(t.getGroupId());r;){var h=r.getContainerPadding();s.x-=h.left-r.GetPosition().x,s.y-=h.top-r.GetPosition().y;var l=r.getGroupId();r=d.compareValues(o,l,a)?null:this.getNodeById(l)}a||(s.x+=n.x,s.y+=n.y)}}else s=n;return s}GetLayoutPanZoomState(){return this._layoutPanZoomState}IsLayoutPanZoomState(){return!!this._layoutPanZoomState}ClearLayoutPanZoomState(){this._layoutPanZoomState=null}AdjustMinZoom(){if(0==this.getMinZoom()){var t=this.getPanZoomCanvas(),e=this.GetViewBounds(),i=this.CalculateMinimumScale(e);return t.setMinZoom(Math.min(i,t.getMaxZoom())),e}return null}CalculateMinimumScale(t){if(!t)return 0;var e=this.getPanZoomCanvas(),i=(this.Width-2*e.getZoomToFitPadding())/t.w,n=(this.Height-2*e.getZoomToFitPadding())/t.h;return Math.min(i,n)}GetViewBounds(){if(this._cachedViewBounds)return this._cachedViewBounds;for(var t,e,i,n,s,o,a,r,d,l=null,g=this.GetAllRoots(),u=0;u<g.length;u++)s=g[u],(n=this.getNodeById(s))&&n.getVisible()&&(t=n.GetNodeBounds(),e=n.getTranslateX(),i=n.getTranslateY(),t.x+=e,t.y+=i,l?(r=l.x,d=l.y,l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),l.w=Math.max(r+l.w,t.x+t.w)-l.x,l.h=Math.max(d+l.h,t.y+t.h)-l.y):l=t);for(var c=this.GetAllLinks(),_=0;_<c.length;_++)if(a=c[_],(o=this.getLinkById(a))&&o.getVisible()){if(o.getGroupId())continue;t=h.GetLinkBounds(o),e=o.getTranslateX(),i=o.getTranslateY(),t.x+=e,t.y+=i,l?(r=l.x,d=l.y,l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),l.w=Math.max(r+l.w,t.x+t.w)-l.x,l.h=Math.max(d+l.h,t.y+t.h)-l.y):l=t}return l}ConstrainPanning(t,e,i,n,s){var o,a,r,d,h=this.getPanZoomCanvas();if("fixed"===this.Options.panning){var l=h.getMinZoom(),g=(h.getSize().w-i*l)/2-t*l,u=(h.getSize().h-n*l)/2-e*l,c=s/l;o=h.getSize().w-h.getSize().w*c+g*c,r=h.getSize().h-h.getSize().h*c+u*c,a=g*c,d=u*c}else{var _=h.getSize().w/2,p=h.getSize().h/2;o=_-(i+t)*s,r=p-(n+e)*s,a=_-t*s,d=p-e*s}if(this.IsLayoutPanZoomState()){var m,C,v=this.getLayoutOffset(),y=this.GetLayoutPanZoomState(),f=y.centerX?(y.centerX+v.x)*s-this.Width/2:-v.x*s,S=y.centerY?(y.centerY+v.y)*s-this.Height/2:-v.y*s;-f*s<o?(o-=m=o+f*s,a+=m):-f*s>a&&(o-=m=-f*s-a,a+=m),-S*s<r?(r-=C=r+S*s,d+=C):-S*s>d&&(r-=C=-S*s-d,d+=C)}h.setMinPanX(o),h.setMinPanY(r),h.setMaxPanX(a),h.setMaxPanY(d),this.Overview&&this.Overview.updateConstraints(o,r,a,d)}static getContainerPadding(t){var e=new Object;return e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e}static getLayoutContainerPadding(t){var e=new Object;return e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e}ApplyLabelPosition(t,i,n){var s=t.getLabelBounds();s=I(s);var o=t.getLabelPosition();if(s&&o){var a=new e.Point(o.x-n.x,o.y-n.y),r=t.getLabelRotationAngle(),d=N(t.getLabelRotationPoint());i.setLabelBounds(s),i.setLabelPosition(a),i.setLabelAlignments(t.getLabelHalign(),t.getLabelValign()),null!=r&&i.setLabelRotationAngle(r),d&&i.setLabelRotationPoint(d)}}getLayoutOffset(){return this._layoutOffset?this._layoutOffset:new e.Point(0,0)}getCustomObjKeyboardBoundingBox(t){var i=t.getElem().getBoundingClientRect(),n=this.getPanZoomCanvas().getContentPane().getElem().getBoundingClientRect(),s=this.getPanZoomCanvas().getContentPane().getMatrix();return new e.Rectangle(i.left-n.left+s.getTx(),i.top-n.top+s.getTy(),i.width,i.height)}CreateLayoutContextLink(t,e,i,n){var s,o=new D;return o.setId(t.getId?t.getId():t.getData().getId()),o.setStartId(e||t.getData().getStartId()),o.setEndId(i||t.getData().getEndId()),t.isPromoted()?(s=t.getData()._links,this.isDataProviderMode()&&(s=s.map(t=>t._itemData))):s=t.getData()._itemData,o.setLayoutAttributes(s),o.setData(s),o.setLabelBounds(E(t.getLabelBounds())),o.setLabelPosition(k(t.getLabelPosition())),o.setStartConnectorOffset(t.getStartConnectorOffset()),o.setEndConnectorOffset(t.getEndConnectorOffset()),o.setLinkWidth(t.getLinkWidth()),o.setSelected(t.isSelected()),o.setPromoted(t.isPromoted()),o.LayoutContext=n,o}_removeNodes(t,i){if(i&&(!t||t.isDisclosed())){for(var n=[],s=0;s<i.length;s++){var o=i[s].id,a=this.getNodeById(o);this._removeNodes(a,a.getData().nodes),this._links.forEach((t,e,i)=>{t.getStartId()!=o&&t.getEndId()!=o||n.push(t.getData())}),t?t.removeChildNode(a):(e.ArrayUtils.removeItem(this._arRootIds,o),this.getNodesPane().removeChild(a)),e.ArrayUtils.removeItem(this._arNodeIds,o),this._nodes.delete(o)}this._removeLinks(n)}}_removeLinks(t){if(t&&0!=t.length)for(var i=0;i<t.length;i++){var n,s,o=t[i].id,a=this.getLinkById(o);if(a)a.getParent().removeChild(a),n=this.getNodeById(a.getStartId()),s=this.getNodeById(a.getEndId()),n&&n.removeOutLinkId(o),s&&s.removeInLinkId(o),e.ArrayUtils.removeItem(this._arLinkIds,o),this._links.delete(o);else if(this._linkToPromotedMap&&this._linkToPromotedMap.has(o)){var r=this._linkToPromotedMap.get(o),h=this._links.get(r),l=h?h.getData()._links:null;if(l&&1==l.length&&l[0].id==o)h.getParent().removeChild(h),n=this.getNodeById(h.getStartId()),s=this.getNodeById(h.getEndId()),n&&n.removeOutLinkId(r),s&&s.removeInLinkId(r),e.ArrayUtils.removeItem(this._arLinkIds,h.getId()),this._links.delete(h.getId()),this._promotedLinksMap.delete(h.getId()),this._linkToPromotedMap.delete(o);else if(l){for(var g=0;g<l.length;g++)d.compareValues(this.getCtx(),l[g].id,o)&&l.splice(g,1);this._linkToPromotedMap.delete(o)}}}}handleTouchStart(){}handleTouchEnd(){this._clearTouchEventContent(),this._touchEventContentDiagramObjRef&&this._touchEventContentDiagramObjRef.handleTouchEnd&&(this._touchEventContentDiagramObjRef.handleTouchEnd(),this._touchEventContentDiagramObjRef=null)}storeTouchEventContent(t,i){this.getTouchEventPane()&&t&&(this._touchEventContentDiagramObjRef=i,t.namespaceURI===e.ToolkitUtils.SVG_NS?e.ToolkitUtils.appendChildElem(this.getTouchEventPane().getElem(),t):Array.isArray(t)&&t.forEach(t=>{e.ToolkitUtils.appendChildElem(this.getTouchEventPane().getElem(),t)}))}_clearTouchEventContent(){if(this.getTouchEventPane())for(var t=this.getTouchEventPane().getElem();t.firstChild;)t.removeChild(t.firstChild)}}t.Diagram=B,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ojdiagram-toolkit.js.map