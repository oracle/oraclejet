/**
 * @license
 * Copyright (c) 2014, 2022, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["knockout","ojs/ojkoshared","ojs/ojcontext","ojs/ojtemplateengine-utils"],function(e,t,r,o){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;return new class{constructor(){this._defaultProps=new Map,this._bindingProvider={__ContextFor:e.contextFor,__ExtendBindingContext:t.extendBindingContext,__KoComputed:e.computed,__Observable:e.observable}}execute(e,t,r,n,a){const d=t.getAttribute("data-oj-as"),c=o.TemplateEngineUtils.getContext(this._bindingProvider,e,t,r,n,d);if(t.render)return this._executeVDomTemplate(t,c);throw new Error("The render property is expected on the template for component "+e.id)}clean(t){let r=t&&t.querySelectorAll?Array.from(t.querySelectorAll('[data-oj-vdom-template-root=""]')):[];return t&&t.hasAttribute&&t.hasAttribute("data-oj-vdom-template-root")&&r.push(t),r.forEach(e=>{o.PreactTemplate.clean(e)}),0===r.length?e.cleanNode(t):null}resolveProperties(e,t,r,n,a,d,c,l){const s=t.render;if(s){const e=o.TemplateEngineUtils.getResolvedDefaultProps(this._defaultProps,r,n);return o.PreactTemplate.resolveVDomTemplateProps(t,s,r,n,a,e,c)}throw new Error("The render property is expected on the template for component "+e.id)}defineTrackableProperty(e,t,r,n){o.TemplateEngineUtils.createPropertyBackedByObservable(this._bindingProvider,e,t,r,n)}_executeVDomTemplate(t,n){const a=r.getContext(t).getBusyContext(),d=e.pureComputed({read:()=>t.render(n.$current)}).extend({rateLimit:{timeout:0,method:(e,t)=>{let r;return()=>{if(!r){const o=a.addBusyState({description:"pending changes for the template element"});r=setTimeout(()=>{r=void 0,e(),o()},t)}}}}}),c=d();o.PreactTemplate.extendTemplate(t,o.PreactTemplate._ROW_CACHE_FACTORY,e=>{t._cachedRows.forEach(t=>{let r=e(t.currentContext);o.PreactTemplate.renderNodes(r,t,!0)})});const l=document.createElement("div"),s={currentContext:n.$current,template:t,parentStub:l,computedVNode:d,vnode:void 0,nodes:void 0};return o.PreactTemplate.renderNodes(c,s,!0),t._cachedRows.push(s),d.subscribe(e=>{const r=t._cachedRows.find(e=>e.computedVNode===d);r&&o.PreactTemplate.renderNodes(e,r,!0)}),s.nodes}}});
//# sourceMappingURL=ojtemplateengine-preact-ko.js.map