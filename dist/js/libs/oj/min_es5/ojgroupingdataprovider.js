!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return r}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw s}}}}function r(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["ojs/ojcore-base","jquery","knockout","ojs/ojarraytreedataprovider","ojs/ojarraydataprovider","ojs/ojdataprovider","ojs/ojeventtarget","ojs/ojtreedataprovider","ojs/ojmap"],function(r,n,a,o,c,u,h,l,d){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c,d=d&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d;
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
var _=function(){function h(e,t,r,n){i(this,h),this.dataProvider=e,this.sortComparator=t,this.sectionRenderer=r,this.options=n,this._getKeyAttribute=function(){var e=null!=this.options?this.options.keyAttributes:null;return e||(e="id"),e},this.GroupAsyncIterator=function(){function e(t,r,n,a){i(this,e),this._parent=t,this._baseIterable=r,this._dataprovider=n,this._params=a}return s(e,[{key:"next",value:function(){var e=this,t=0;e._parent._currentRootSection&&(t=Object.keys(e._parent._sections).indexOf(e._parent._currentRootSection));var r=e._parent._currentBaseOffset<t;return this._parent._getDataFromDataProvider(this._params,"root",r).then(function(){e._parent._updateSectionIndex();var t=new e._parent.FetchByOffsetParameters(e._parent,e._parent._currentBaseOffset,e._params.size,e._params.sortCriteria,e._params.filterCriterion);return e._dataprovider.fetchByOffset(t).then(function(t){for(var r=t.results,n=r.map(function(e){return e.data}),i=r.map(function(e){return e.metadata}),a=0;a<i.length;a++)i[a]=e._parent._getNodeMetadata(r[a].data),n[a]=e._parent.sectionRenderer(i[a].key);return e._parent._currentBaseOffset=e._parent._currentBaseOffset+n.length,t.done&&e._parent._dataFetchComplete&&0==n.length?Promise.resolve(new e._parent.AsyncIteratorReturnResult(e._parent,new e._parent.FetchListResult(e._parent,e._params,n,i))):Promise.resolve(new e._parent.AsyncIteratorYieldResult(e._parent,new e._parent.FetchListResult(e._parent,e._params,n,i)))})})}}]),e}(),this.TreeAsyncIterator=function(){function e(t,r,n,a,s){i(this,e),this._parent=t,this._isParentSection=r,this._parentKey=n,this._dataprovider=a,this._params=s,this._parent._registerIteratorOffset(this,this._parentKey,0)}return s(e,[{key:"next",value:function(){var e=this,t=e._parent._getIteratorOffset(e),r=new e._parent.FetchByOffsetParameters(e._parent,t.offset,e._params.size,e._params.sortCriteria,e._params.filterCriterion),n=e._parent._sections[e._parentKey].children().length-t.offset>0;return this._parent._getDataFromDataProvider(this._params,this._parentKey,n).then(function(i){return void 0===i&&e._parent._updateSectionIndex(),e._dataprovider.fetchByOffset(r).then(function(r){var i=r.results,a=r.done,s=i.map(function(e){return e.data}),o=i.map(function(t){return e._parent._getNodeMetadata(t.data)});if(e._isParentSection)for(var c=0;c<o.length;c++)s[c]=e._parent.sectionRenderer(o[c].key);(e._parent._updateIteratorOffset(e,t.offset+s.length),n&&a)&&(e._parent._sections[e._parentKey].next||(a=!1));return a&&0==s.length?Promise.resolve(new e._parent.AsyncIteratorReturnResult(e._parent,new e._parent.FetchListResult(e._parent,e._params,s,o))):Promise.resolve(new e._parent.AsyncIteratorYieldResult(e._parent,new e._parent.FetchListResult(e._parent,e._params,s,o)))})})}}]),e}(),this.TreeAsyncIterable=function(){return function e(t,r){i(this,e),this._parent=t,this._asyncIterator=r,this[Symbol.asyncIterator]=function(){return this._asyncIterator}}}(),this.FetchListParameters=function(){return function e(t,r,n,a){i(this,e),this._parent=t,this.size=r,this.sortCriteria=n,this.attributes=a,this.size=r,this.sortCriteria=n,this.attributes=a}}(),this.FetchByOffsetParameters=function(){return function e(t,r,n,a,s){i(this,e),this._parent=t,this.offset=r,this.size=n,this.sortCriteria=a,this.filterCriterion=s,this.size=n,this.sortCriteria=a,this.offset=r,this.filterCriterion=s}}(),this.FetchListResult=function(){return function e(t,r,n,a){i(this,e),this._parent=t,this.fetchParameters=r,this.data=n,this.metadata=a,this.fetchParameters=r,this.data=n,this.metadata=a}}(),this.AsyncIteratorYieldResult=function(){return function e(t,r){i(this,e),this._parent=t,this.value=r,this.value=r,this.done=!1}}(),this.AsyncIteratorReturnResult=function(){return function e(t,r){i(this,e),this._parent=t,this.value=r,this.value=r,this.done=!0}}(),this._dataProvider=e,this._addEventListeners(this._dataProvider),this._initialize()}return s(h,[{key:"containsKeys",value:function(e){return this.fetchByKeys(e).then(function(t){var r=new Set;return e.keys.forEach(function(e){null!=t.results.get(e)&&r.add(e)}),Promise.resolve({containsParameters:e,results:r})})}},{key:"getCapability",value:function(e){return"filter"===e?null:this._baseDataProvider.getCapability(e)}},{key:"getTotalSize",value:function(){return this._baseDataProvider.getTotalSize()}},{key:"isEmpty",value:function(){return this._baseDataProvider.isEmpty()}},{key:"getChildDataProvider",value:function(e){var t=this,r=this._getChildren(e),i=this._isParentSection(e);function a(e,t){this._parentKey=t.parentKey,this._isParentSection=t.isParentSection,this._isParentSection?(this._baseDataProvider=new c(e.childData,{}),this._baseTreeDataProvider=new o(e.childData,{keyAttributes:t.keyAttributes})):(this._baseDataProvider=new c(e.children,{keyAttributes:t.keyAttributes}),this._baseTreeDataProvider=new o(e.children,{keyAttributes:t.keyAttributes}))}return a.prototype.containsKeys=function(e){return this._baseTreeDataProvider.containsKeys(e)},a.prototype.getCapability=function(e){return this._baseTreeDataProvider.getCapability(e)},a.prototype.getTotalSize=function(){return this._baseTreeDataProvider.getTotalSize()},a.prototype.isEmpty=function(){return this._baseTreeDataProvider.isEmpty()},a.prototype.fetchByOffset=function(e){return this._baseTreeDataProvider.fetchByOffset(e)},a.prototype.fetchByKeys=function(e){return this._baseTreeDataProvider.fetchByKeys(e)},a.prototype.getChildDataProvider=function(e){return t.getChildDataProvider(e)},a.prototype.fetchFirst=function(e){e&&e.filterCriterion&&((e=n.extend({},e)).filterCriterion=null);var r=this._baseDataProvider,i=this._isParentSection,a=this._parentKey;return new t.TreeAsyncIterable(t,new t.TreeAsyncIterator(t,i,a,r,e))},a.prototype._getId=function(e){return t._getId(e)},r?new a(this._sections[e],{keyAttributes:this._getKeyAttribute(),parentKey:e,isParentSection:i}):null}},{key:"fetchFirst",value:function(e){e&&e.filterCriterion&&((e=n.extend({},e)).filterCriterion=null);var t=this._baseDataProvider.fetchFirst(e);return this._initializeTreeCache(),new this.TreeAsyncIterable(this,new this.GroupAsyncIterator(this,t,this._baseDataProvider,e))}},{key:"fetchByOffset",value:function(e){var t=this._baseDataProvider.fetchByOffset(e),r=this;return t.then(function(e){for(var t=e.results,n=[],i=0;i<t.length;i++){var a=t[i].metadata,s=t[i].data;a=r._getNodeMetadata(s),n.push({data:s,metadata:a})}return{done:e.done,fetchParameters:e.fetchParameters,results:n}})}},{key:"fetchByKeys",value:function(e){var t=this,r=new Map;return e.keys.forEach(function(e){var n=t._getNodeForKey(e);n&&r.set(e,{metadata:{key:e},data:n})}),Promise.resolve({fetchParameters:e,results:r})}},{key:"_getChildren",value:function(e){return this._sections[e]?this._sections[e].children:null}},{key:"_isParentSection",value:function(e){if(e in this._sections){var t=this._sections[e];if(t&&t.children().length>0&&this._sections[t.children()[0]])return!0}return!1}},{key:"_initialize",value:function(){this._mapKeyToNode=new Map,this._mapNodeToKey=new d,this._mapArrayToSequenceNum=new Map,this._sections={},this._sectionRoots=a.observableArray(),this._sectionRootData=a.observableArray(),this._dataFetchComplete=!1,this._internalIterator=null,this.treeData=a.observableArray([]),this._initializeTreeCache(),this._createSections(),this._storedAddSection=[],this._storedAddSectionKeys=[],this._storedRemoveSection=[],this._baseDataProvider=null,this._processSectionsArray([])}},{key:"_initializeTreeCache",value:function(){this._treeKeyMap=[],this._treeMetadata=[],this._treeData=[],this._currentFirstSection=null,this._currentSectionKey=null,this._currentRootSection=null,this._currentSectionData=[],this._currentOffset=0,this._currentBaseOffset=0,this._iteratorOffsets=new Map,this._dataFetchComplete=!1,this._internalIterator=null}},{key:"_registerIteratorOffset",value:function(e,t,r){this._iteratorOffsets.set(e,{parentKey:t,offset:r})}},{key:"_getIteratorOffset",value:function(e){return this._iteratorOffsets.get(e)}},{key:"_updateIteratorOffset",value:function(e,t){var r=this._iteratorOffsets.get(e);r.offset=t,this._iteratorOffsets.set(e,r)}},{key:"_unregisterIteratorOffset",value:function(e){this._iteratorOffsets.delete(e)}},{key:"_getRootDataProvider",value:function(){return this}},{key:"_getDataFromDataProvider",value:function(e,t,r){var n=this;if(!this._inCurrentFetchingSection(t)||r)return Promise.resolve(!0);n._internalIterator||(n._internalIterator=this._dataProvider.fetchFirst(e)[Symbol.asyncIterator]());return function e(){return n._internalIterator.next().then(function(t){if(n._treeData=n._treeData.concat(t.value.data),n._treeMetadata=n._treeMetadata.concat(t.value.metadata),t.value.metadata.forEach(function(e){n._treeKeyMap.push(e.key)}),t.done?n._dataFetchComplete=!0:n._dataFetchComplete=!1,!t.done&&t.value.data.length!=t.value.fetchParameters.size)return e()})}()}},{key:"_inCurrentFetchingSection",value:function(e){return"root"===e||this._currentSectionKey==e}},{key:"_processSectionsArray",value:function(e){var t=this;this.treeData().forEach(function(r,n){t._processNode(r,e)}),this._baseDataProvider||(this._baseDataProvider=new r.ArrayDataProvider(this.treeData,null))}},{key:"_processTreeArray",value:function(e,t){var r=this;(e instanceof Array?e:e()).forEach(function(e,n){r._processNode(e,t)})}},{key:"_processNode",value:function(e,t,r){var n={key:null,keyPath:null};null!=r?(n.key=r,n.keyPath=t,n.keyPath.push(r)):n=this._createKeyObj(e,t,this._treeData),this._setMapEntry(n.key,e);var i=this._getChildren(e);return i&&this._processTreeArray(i,n.keyPath),n}},{key:"_createSections",value:function(){var e=this;if(this.options&&this.options.groupByStrategy)"function"==typeof this.options.groupByStrategy?this._groupingFunction=this.options.groupByStrategy:"string"==typeof this.options.groupByStrategy&&(this._groupingFunction=function(t){return e._getVal(t,e.options.groupByStrategy)});else{var t=[],r=new Date(Date.now());t.push(r);var n=new Date(Date.now()),i=n.setDate(r.getDate()-1),a=n.setDate(r.getDate()-7);t.push(i),t.push(a);var s=(n=new Date(Date.now())).setMonth(r.getMonth()-1);t.push(s);var o=(n=new Date(Date.now())).setFullYear(r.getFullYear()-1);t.push(o),this._groupingFunction=function(e){if(e&&e.date){for(var r=new Date(e.date),n=1;r<t[n]&&5!=n;)n++;return[["In the past day","In the past week","In the past month","In the past year","Earlier"][n-1]]}return["Section 1"]}}this.treeData&&this.treeData.valueHasMutated()}},{key:"_getSectionKeyFromArray",value:function(e){if(e){if(Array.isArray(e)&&e.length>0)return e[e.length-1];if("string"==typeof e)return e}return null}},{key:"_createNewSection",value:function(r,n,i,s,o){var c,h,l=this,d=i.indexOf(r),_=null;0!=d&&(_=i[d-1]);var f=null,p=null,y=d==this._getDepth(i),v=!1;y&&(f=s,p=o),null!=_?(_ in this._sections&&this._sections[_].active||(this._createNewSection(_,n,i,s,o),n&&(n=!1)),c=this._sections[_].children,h=this._sections[_].childData):(c=this._sectionRoots,h=this._sectionRootData,v=!0);var g=null;if(null==o)if(null==s)c().length>0&&(s=c()[c().length-1],y&&(f=s)),c.push(r),h.push(l.sectionRenderer(r));else{for(g=this._sections[s];g.depth>d;)g=this._sections[this._sections[s].parent];if(g.depth==d){s=g.key;var m=c.indexOf(s);m>=0?(c.splice(m+1,0,r),h.splice(m+1,0,l.sectionRenderer(r))):(c.push(r),h.push(l.sectionRenderer(r))),o=g.next}else s=null,o=null,c.push(r),h.push(l.sectionRenderer(r))}else{for(var S=this._sections[o];S.depth>d;)S=this._sections[this._sections[o].parent];if(S.depth==d){o=S.key;var k=c.indexOf(o);k>=0?(c.splice(k,0,r),h.splice(k,0,l.sectionRenderer(r))):(c.push(r),h.push(l.sectionRenderer(r))),s=S.previous}else s=null,o=null,c.push(r),h.push(l.sectionRenderer(r))}r in this._sections?(this._sections[r].active=!0,this._sections[r].previous=s,this._sections[r].next=o,this._sections[r].previousLeaf=f,this._sections[r].nextLeaf=p,this._sections[r].parent=_):this._sections[r]={parent:_,key:r,children:a.observableArray([]),childData:a.observableArray([]),previous:s,next:o,previousLeaf:f,nextLeaf:p,depth:d,active:!0,index:function(){return null!=this.parent?l._sections[this.parent].children.indexOf(this.key):l._sectionRoots.indexOf(this.key)},cutoffIndex:function(){return l._getCutoffIndex(l._sections[this.key].previousLeaf)+l._sections[this.key].children().length}},null!=s&&(this._sections[s].next=r),null!=o&&(this._sections[o].previous=r),d==this._getDepth(i)&&(null!=f&&(this._sections[f].nextLeaf=r),null!=p&&(this._sections[p].previousLeaf=r)),d!=this._getDepth(i)||o!=this._currentFirstSection&&null!=this._currentFirstSection||(this._currentFirstSection=r);var K=null;null!=o&&(K=[o]);var D=l.sectionRenderer(r);if(this._processNode(D,[],r),n&&-1==this._storedAddSectionKeys.indexOf(this._sections[r].parent)){var b=r,O={key:r},x=this._sections[r].index(),A={data:[D],indexes:[x],keys:new Set([b]),metadata:[O],addBeforeKeys:K,parentKeys:[_]},P=new u.DataProviderMutationEvent({add:A,remove:null,update:null});if(this._storedAddSection.push(P),this._storedAddSectionKeys.push(r),!this._dataFetchComplete&&v&&this._currentBaseOffset>x&&this._currentBaseOffset++,!this._dataFetchComplete){var I,F=t(this._internalIterator);try{for(F.s();!(I=F.n()).done;){var w=e(I.value,2),R=w[0],M=w[1];M.parentKey===_&&M.offset>x&&M.offset++,this._updateIteratorOffset(R,M.offset)}}catch(e){F.e(e)}finally{F.f()}}}this.treeData.valueHasMutated()}},{key:"_removeSection",value:function(r){var n=this._sections[r],i=n.parent,a=n.previous,s=n.next,o=n.previousLeaf,c=n.nextLeaf,h=!0;if(this._sections[s]&&this._sections[s].previous==r&&(this._sections[s].previous=n.previous),this._sections[a]&&this._sections[a].next==r&&(this._sections[a].next=n.next),this._sections[c]&&this._sections[c].previousLeaf==r&&(this._sections[c].previousLeaf=n.previousLeaf),this._sections[o]&&this._sections[o].nextLeaf==r&&(this._sections[o].nextLeaf=n.nextLeaf),this._sections[i]&&-1!=this._sections[i].children.indexOf(r)){var l=this._sections[i].children.indexOf(r);if(!this._dataFetchComplete){var d,_=t(this._internalIterator);try{for(_.s();!(d=_.n()).done;){var f=e(d.value,2),p=f[0],y=f[1];y.parentKey===i&&y.offset>l&&y.offset--,this._updateIteratorOffset(p,y.offset)}}catch(e){_.e(e)}finally{_.f()}}this._sections[i].children.splice(l,1),this._sections[i].childData.splice(l,1),0===this._sections[i].children().length&&(this._removeSection(i),h&&(h=!1))}if(this._sections[r].active=!1,this._sections[r].children([]),this._sections[r].childData([]),null==this._sections[r].parent){var v=this._sectionRoots.indexOf(r);this._sectionRoots.splice(v,1),this._sectionRootData.splice(v,1),!this._dataFetchComplete&&this._currentBaseOffset>v&&this._currentBaseOffset--}if(r==this._currentFirstSection&&(this._currentFirstSection=s),h){var g={key:r},m={data:[this.sectionRenderer(r)],indexes:null,keys:new Set([r]),metadata:[g]},S=new u.DataProviderMutationEvent({add:null,remove:m,update:null});this._storedRemoveSection.push(S)}this.treeData.valueHasMutated()}},{key:"_updateSectionIndex",value:function(){for(var e=this._currentOffset;e<this._treeData.length;e++){var t=this._treeData[e],r=this._treeKeyMap[e];this._processNode(t,[],r);var n=this._groupingFunction(t),i=this._getSectionKeyFromArray(n);null==this._currentSectionKey&&(i in this._sections||this._createNewSection(i,!1,n,this._currentSectionKey,null),this._currentSectionKey=i,this._currentRootSection=this._getSectionArray(n)[0]),i===this._currentSectionKey?this._currentSectionData.push(t):(i in this._sections&&this._sections[i].active||this._createNewSection(i,!1,n,this._currentSectionKey,null),this._sections[this._currentSectionKey].children(this._currentSectionData),this._sections[this._currentSectionKey].childData(this._getChildDataFromChildren(this._currentSectionKey)),this._currentSectionKey=i,this._currentRootSection=this._getSectionArray(n)[0],this._currentSectionData=[t]),this._currentOffset++}this._currentSectionData.length>0&&(this._sections[this._currentSectionKey].children(this._currentSectionData),this._sections[this._currentSectionKey].childData(this._getChildDataFromChildren(this._currentSectionKey)));var a=[];for(var s in this._sections)null==this._sections[s].parent&&a.push(this.sectionRenderer(s));this.treeData(a),this.treeData.valueHasMutated()}},{key:"_getSectionArray",value:function(e){return Array.isArray(e)?e:[e]}},{key:"_getChildDataFromChildren",value:function(e){var t=this,r=[];return this._sections[e].children().forEach(function(e){r.push(t.sectionRenderer(e))}),r}},{key:"_createKeyObj",value:function(e,t,r){var n=this._getId(e),i=t?t.slice():[];return null==n?(i.push(this._incrementSequenceNum(r)),n=i):(i.push(n),this.options&&"siblings"==this.options.keyAttributesScope&&(n=i)),{key:n,keyPath:i}}},{key:"_getId",value:function(e){var t,r=null!=this.options?this.options.keyAttributes:null;if(r||(r="id"),null!=r){var n;if(Array.isArray(r))for(t=[],n=0;n<r.length;n++)t[n]=this._getVal(e,r[n]);else t="@value"==r?this._getAllVals(e):this._getVal(e,r);return t}return null}},{key:"_getDepth",value:function(e){return Array.isArray(e)?e.length-1:0}},{key:"_getVal",value:function(e,t,r){if("string"==typeof t){var n=t.indexOf(".");if(n>0){var i=t.substring(0,n),a=t.substring(n+1),s=e[i];if(s)return this._getVal(s,a)}}return!0!==r&&"function"==typeof e[t]?e[t]():e[t]}},{key:"_getAllVals",value:function(e){var t=this;return Object.keys(e).map(function(r){return t._getVal(e,r)})}},{key:"_getNodeMetadata",value:function(e){var t=this._getKeyForNode(e);return null==t&&(t=this._getId(e)),{key:t}}},{key:"_getNodeForKey",value:function(e){return this._getRootDataProvider()._mapKeyToNode.get(JSON.stringify(e))}},{key:"_getKeyForNode",value:function(e){return this._getRootDataProvider()._mapNodeToKey.get(e)}},{key:"_setMapEntry",value:function(e,t){var r=this._getRootDataProvider();r._mapKeyToNode.set(JSON.stringify(e),t),r._mapNodeToKey.set(t,e)}},{key:"_incrementSequenceNum",value:function(e){var t=this._getRootDataProvider(),r=t._mapArrayToSequenceNum.get(e)||0;return t._mapArrayToSequenceNum.set(e,r+1),r}},{key:"_addData",value:function(e){var t=this,r=e.data,n=e.metadata,i=e.addBeforeKeys,a=e.indexes,s=[];if(e.keys.forEach(function(e){s.push(e)}),null!=a&&a.length>0){for(var o=a.slice(0).sort(),c=0;c<o.length;c++){var u=o[c],h=a.indexOf(u);t._treeData.splice(u,0,r[h]),t._treeMetadata.splice(u,0,n[h]),t._treeKeyMap.splice(u,0,s[h])}if(null==i||0==i.length){i=[];for(var l=0;l<a.length;l++){var d=a[l]+1<t._treeKeyMap.length?t._treeKeyMap[a[l]+1]:null;i.push(d)}}}else if(null!=i&&i.length>0)for(var _=s.slice(0),f=n.slice(0),p=r.slice(0),y=i.slice(0);y.length>0;){var v=y[0],g=_[0],m=f[0],S=p[0],k=t._treeKeyMap.indexOf(v);-1!=k?(t._treeData.splice(k,0,S),t._treeMetadata.splice(k,0,m),t._treeKeyMap.splice(k,0,g)):(_.push(g),f.push(m),p.push(S),y.push(v)),_.splice(0,1),y.splice(0,1),f.splice(0,1),p.splice(0,1)}else{var K=[],D=[],b=[],O=0,x=!1;r.forEach(function(e,r){if(x=!1,0!=K.length)for(;O<K.length&&!x;)t.sortComparator(e,K[O])?(K.splice(O,0,e),D.splice(O,0,n[r]),b.splice(O,0,s[r]),x=!0):O++;x||(K.push(e),D.push(n[r]),b.push(s[r]))}),O=t._treeData.length-1;var A={};K.forEach(function(e,r){var n=e,i=D[r],a=b[r];for(x=!1;O>=0&&!x;)t.sortComparator(n,t._treeData[O])?(O+1!=t._treeData.length?(t._treeData.splice(O+1,0,n),t._treeMetadata.splice(O+1,0,i),A[t._getId(n)]=t._treeKeyMap[O+1],t._treeKeyMap.splice(O+1,0,a)):(t._treeData.push(n),t._treeMetadata.push(i),A[t._getId(n)]=null,t._treeKeyMap.push(a)),x=!0):O--;x||(t._treeData.splice(0,0,n),t._treeMetadata.splice(0,0,i),A[t._getId(n)]=t._treeKeyMap[0],t._treeKeyMap.splice(0,0,a),O=0)}),i=[],r.forEach(function(e){i.push(A[t._getId(e)])})}return i}},{key:"_handleAdd",value:function(e){var t=this,r=[],n=t._addData(e);e.addBeforeKeys&&0!=e.addBeforeKeys.length||(e.addBeforeKeys=n),e.keys.forEach(function(t){var i=r.length,a=e.data[i],s=n[i];r.push({addBeforeKey:s,key:t,data:a})});var i=[],a=[],s=[],o=this._getIndexFromKeys(e.keys);if(e.indexes&&0!=e.indexes.length||(e.indexes=[]),e.data.forEach(function(n,c){t._processNode(n,[],r[c].key);var u,h,l=t._groupingFunction(n),d=t._getSectionKeyFromArray(l);d in t._sections&&t._sections[d].active?-1===a.indexOf(d)&&s.push(c):(0!=o[c]?(u=t._getSectionKeyFromArray(t._groupingFunction(t._treeData[o[c]-1])),h=t._sections[u].nextLeaf):u=null,o[c]+1<t._treeData.length&&null==u&&(h=t._currentFirstSection),t._createNewSection(d,!0,l,u,h),d=t._getSectionKeyFromArray(l),a.push(d));var _=t._sections[d].children,f=t._sections[d].childData,p=0;(null!=(u=t._sections[d].previousLeaf)&&(p=t._sections[u].cutoffIndex()),_.splice(o[c]-p,0,n),f.splice(o[c]-p,0,t.sectionRenderer(n)),i.push(d),e.indexes[c]=o[c]-p,null!=e.addBeforeKeys[c]&&c==e.data.length-1)&&(t._getSectionKeyFromArray(t._groupingFunction(t._treeData[t._treeKeyMap.indexOf(e.addBeforeKeys[c])]))!=d&&(e.addBeforeKeys[c]=null))}),e.parentKeys=i,a.length>0){var c=0,u=[],h=[],l=[],d=[],_=[],f=[];e.keys.forEach(function(t){-1!=s.indexOf(c)&&(h.push(t),u.push(e.data[c]),l.push(e.metadata[c]),d.push(e.parentKeys[c]),_.push(e.indexes[c]),f.push(e.addBeforeKeys[c])),c++}),e=h.length>0?{data:u,keys:new Set(h),metadata:l,parentKeys:d,indexes:_,addBeforeKeys:f}:null}return e}},{key:"_handleRemove",value:function(e){var t=this._getIndexFromKeys(e.keys);this._removeKeys(e.keys);for(var r=[],n=[],i=0;i<t.length;i++){var a=t[i],s=this._treeData[a],o=this._treeKeyMap[a],c=this._mapKeyToNode.get(JSON.stringify(o));this._mapKeyToNode.delete(JSON.stringify(o)),this._mapNodeToKey.delete(c);var u=this._getSectionKeyFromArray(this._groupingFunction(s)),h=this._sections[u].previousLeaf,l=0;null!=h&&(l=this._sections[h].cutoffIndex()),r.push({ind:a-l,sectionId:u}),n.push(a)}r.sort(function(e,t){return t.ind-e.ind}),n.sort(function(e,t){return t-e});for(var d=0;d<r.length;d++){var _=r[d].sectionId,f=this._sections[_].children;f.splice(r[d].ind,1),0===f().length&&this._removeSection(_),this._treeData.splice(n[d],1),this._treeMetadata.splice(n[d],1)}}},{key:"_handleUpdate",value:function(e){var t=this,r=this._getIndexFromKeys(e.keys);e.data.forEach(function(e,n){var i=r[n],a=t._treeData[i],s=t._treeKeyMap[i],o=t._mapKeyToNode.get(JSON.stringify(s));t._mapNodeToKey.delete(o),t._setMapEntry(s,a);var c=t._getSectionKeyFromArray(t._groupingFunction(a)),u=t._sections[c].children,h=t._sections[c].previousLeaf,l=0;null!=h&&(l=t._sections[h].cutoffIndex()),u.splice(i-l,1,e),t._treeData[i]=e})}},{key:"_getCutoffIndex",value:function(e){return null!=e?this._sections[e].cutoffIndex():0}},{key:"_getIndexFromKeys",value:function(e){var t=this,r=[];return e.forEach(function(e){r.push(t._treeKeyMap.indexOf(e))}),r}},{key:"_removeKeys",value:function(e){var t=this;e.forEach(function(e){t._treeKeyMap.splice(t._treeKeyMap.indexOf(e),1)})}},{key:"_cleanEvent",value:function(e){var t=this._getIndexFromKeys(e.keys),r=0;e.keys.forEach(function(n){-1==t[r]&&e.keys.delete(n),r++});for(var n=t.length-1;n>=0;n--)-1==t[n]&&(e.data&&e.data.splice(n,1),e.indexes&&e.indexes.splice(n,1),e.metadata&&e.metadata.splice(n,1));return e}},{key:"_cleanAddEvent",value:function(e){var t=e.addBeforeKeys,r=e.indexes,n=[],i=[];if(e.keys.forEach(function(e){n.push(e)}),null!=r)for(var a=r.slice(0).sort(),s=0;s<a.length;s++){var o=a[s],c=r.indexOf(o);this._treeData.length+s-i.length<o&&i.push(c)}else if(null!=t)for(var u=t.slice(0).sort(),h=0;h<u.length;h++){var l=u[h],d=t.indexOf(l);(-1==this._treeKeyMap.indexOf(l)&&-1==n.indexOf(l)||-1==this._treeKeyMap.indexOf(l)&&-1!=n.indexOf(l)&&-1==i.indexOf(n.indexOf(l)))&&i.push(d)}var _=0;e.keys.forEach(function(t){-1!=i.indexOf(_)&&e.keys.delete(t),_++});for(var f=i.splice(0).sort(),p=f.length-1;p>=0;p--)e.data&&e.data.splice(f[p],1),e.indexes&&e.indexes.splice(f[p],1),e.metadata&&e.metadata.splice(f[p],1),e.parentKeys&&e.parentKeys.splice(f[p],1),e.addBeforeKeys&&e.addBeforeKeys.splice(f[p],1);return e}},{key:"_addEventListeners",value:function(e){var t=this;e.addEventListener("refresh",function(e){t._initialize(),t.dispatchEvent(new u.DataProviderRefreshEvent)}),e.addEventListener("mutate",function(e){e.detail.add&&(e.detail.add=t._cleanAddEvent(e.detail.add),0!=e.detail.add.keys.size&&(e.detail.add=t._handleAdd(e.detail.add),t._storedAddSection.forEach(function(e){t.dispatchEvent(e)}),e.detail.add&&t.dispatchEvent(e),t._storedAddSection=[],t._storedAddSectionKeys=[])),(e.detail.remove||e.detail.update)&&(e.detail.remove&&(e.detail.remove=t._cleanEvent(e.detail.remove),0!=e.detail.remove.keys.size&&(t._handleRemove(e.detail.remove),t.dispatchEvent(e))),e.detail.update&&(e.detail.update=t._cleanEvent(e.detail.update),0!=e.detail.update.keys.size&&(t._handleUpdate(e.detail.update),t.dispatchEvent(e)))),t._storedRemoveSection.forEach(function(e){t.dispatchEvent(e)}),t._storedRemoveSection=[]})}}]),h}();return h.EventTargetMixin.applyMixin(_),r._registerLegacyNamespaceProp("GroupingDataProvider",_),_})}();
//# sourceMappingURL=ojgroupingdataprovider.js.map