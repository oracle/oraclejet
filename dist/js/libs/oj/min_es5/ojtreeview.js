!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||t(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["require","ojs/ojcore-base","jquery","ojs/ojcontext","ojs/ojthemeutils","ojs/ojcomponentcore","ojs/ojanimation","ojs/ojdomutils","ojs/ojlogger","ojs/ojconfig","ojs/ojkeyset","ojs/ojdatacollection-common","ojs/ojselector","ojdnd","ojs/ojcustomelement-utils"],function(n,r,a,o,l,d,h,c,u,f,_,p,m,v,g){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var y=function(){function t(e){var n=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keyAttributes:"id",childrenAttribute:"children"},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return new Map(e)},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return new Set(e)};i(this,t),this.data=e,this.createOptimizedKeyMap=r,this.createOptimizedKeySet=a,this.keyAttr=s.keyAttributes,this.childrenAttr=s.childrenAttribute;var o=function e(t,i,s){t.forEach(function(t){s.add(t[n.keyAttr]),t[n.childrenAttr]&&t[n.childrenAttr].length>0&&(i.set(t[n.keyAttr],t),e(t[n.childrenAttr],i,s))})};this.parentKeyNodeMap=this.createOptimizedKeyMap(),this.allKeys=this.createOptimizedKeySet(),o(this.data,this.parentKeyNodeMap,this.allKeys)}var n,r,a;return n=t,(r=[{key:"computeSelection",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _.KeySetImpl,s=this.normalizeKeySet(t),r=this.normalizeKeySet(i),a=s.delete(r.values()),o=r.delete(s.values()),l=this.reduceToLeaves(o.values()),d=1===s.values().size?this.reduceToLeaves(s.values()):this.createOptimizedKeySet(new Set([].concat(e(e(s.values()).filter(function(e){return!n.parentKeyNodeMap.has(e)})),e(this.reduceToLeaves(a.values()))).filter(function(e){return!l.has(e)}))),h={selectedLeaves:d,selectedParents:this.createOptimizedKeySet(),partialParents:this.createOptimizedKeySet()};return this.assignParentSelection({children:this.data},{selected:0,partial:0},h),h.selected=this.createOptimizedKeySet([].concat(e(h.selectedLeaves.values()),e(h.selectedParents.values()))),{selected:new _.KeySetImpl(h.selected),selectedLeaves:new _.KeySetImpl(h.selectedLeaves),selectedParents:new _.KeySetImpl(h.selectedParents),partialParents:new _.KeySetImpl(h.partialParents)}}},{key:"reduceToLeaves",value:function(e){var t=this,n=this.createOptimizedKeySet();return e.forEach(function(e){return t.parentKeyNodeMap.has(e)?function e(n,i){t.parentKeyNodeMap.has(n[t.keyAttr])?n[t.childrenAttr].forEach(function(t){return e(t,i)}):i.add(n[t.keyAttr])}(t.parentKeyNodeMap.get(e),n):n.add(e)},this),n}},{key:"assignParentSelection",value:function(e,t,n){var i=this;if(void 0===e[this.keyAttr]||this.parentKeyNodeMap.has(e[this.keyAttr])){var s={selected:0,partial:0};if(e[this.childrenAttr].forEach(function(e){return i.assignParentSelection(e,s,n)}),void 0===e[this.keyAttr]||s.selected+s.partial===0)return;s.selected===e[this.childrenAttr].length?(n.selectedParents.add(e[this.keyAttr]),t.selected+=1):(n.partialParents.add(e[this.keyAttr]),t.partial+=1)}else n.selectedLeaves.has(e[this.keyAttr])&&(t.selected+=1)}},{key:"normalizeKeySet",value:function(e){return e.isAddAll()?new _.KeySetImpl(this.allKeys).delete(e.deletedValues()):e}}])&&s(n.prototype,r),a&&s(n,a),t}();
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */r.__registerWidget("oj.ojTreeView",a.oj.baseComponent,{version:"1.0.0",defaultElement:"<div>",widgetEventPrefix:"oj",options:{currentItem:null,data:null,dnd:{drag:null,drop:null},expanded:new _.KeySetImpl,item:{focusable:null,renderer:null,selectable:null},scrollPolicyOptions:{maxCount:500},selected:new _.KeySetImpl,selection:[],selectionMode:"none",animateEnd:null,animateStart:null,beforeCollapse:null,beforeCurrentItem:null,beforeExpand:null,collapse:null,expand:null},classNames:{depth0:"oj-treeview-depth-0",depth1:"oj-treeview-depth-1",depth2:"oj-treeview-depth-2",depth3:"oj-treeview-depth-3",depth4:"oj-treeview-depth-4",depth5:"oj-treeview-depth-5",depth6:"oj-treeview-depth-6",depth7:"oj-treeview-depth-7",depth8:"oj-treeview-depth-8",depth9:"oj-treeview-depth-9",depth10:"oj-treeview-depth-10",depth11:"oj-treeview-depth-11",depth12:"oj-treeview-depth-12",depth13:"oj-treeview-depth-13",depth14:"oj-treeview-depth-14",depth15:"oj-treeview-depth-15"},constants:{MAX_STYLE_DEPTH:15},_ComponentCreate:function(){this._super()},_AfterCreate:function(){this._super(),this._initRender(),this._render()},_CompareOptionValues:function(e,t,n){switch(e){case"selection":return t&&void 0===t.inverted&&(t.inverted=!1),n&&void 0===n.inverted&&(n.inverted=!1),(!t||!n||t.inverted===n.inverted)&&r.Object.compareValues(t,n);case"selected":return p.areKeySetsEqual(t,n);default:return this._super(e,t,n)}},_initRender:function(){var e=this;this._on(this.element,{click:function(t){e._handleClick(t)},mouseover:function(t){e._handleMouseOver(t)},mouseout:function(t){e._handleMouseOut(t)},mousedown:function(t){e._handleMouseDown(t)},mouseup:function(t){e._handleMouseUp(t)},keydown:function(t){e._handleKeyDown(t)},dragstart:function(t){e._handleDragStart(t)},drag:function(t){e._handleDragSourceEvent(t,"drag")},dragend:function(t){e._handleDragSourceEvent(t,"dragEnd")},dragenter:function(t){e._handleDropTargetEvent(t,"dragEnter")},dragover:function(t){e._handleDropTargetEvent(t,"dragOver")},dragleave:function(t){e._handleDropTargetEvent(t,"dragLeave")},drop:function(t){e._handleDropTargetEvent(t,"drop")}}),c.isTouchSupported()&&(this.element[0].addEventListener("touchstart",function(t){e.touchStartEvent=t},{passive:!0}),this.element[0].addEventListener("touchmove",function(t){!0===e.ojTreeViewDragEvent&&t.preventDefault()},{passive:!1}),this.element[0].addEventListener("touchcancel",function(){e.touchStartEvent=null,e.ojTreeViewDragEvent=!1}),this.element[0].addEventListener("touchend",function(t){e.touchStartEvent&&t.changedTouches.length&&document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY)!==e.touchStartEvent.target&&(e.touchStartEvent=null),e.ojTreeViewDragEvent=!1,e._handleMouseOut(t)})),this._dropLine=document.createElement("div"),this._dropLine.classList.add("oj-treeview-drop-line"),this.element[0].appendChild(this._dropLine),this._dropLine.style.display="none",this._refreshId=0,this._uiExpanded=new _.KeySetImpl,this.m_fetching=new Set,this._expandedChildrenMap=new Map,this._syncSelectionState()},_syncSelectionState:function(){var e=_.KeySetUtils.toArray(this.options.selected),t=_.KeySetUtils.toKeySet(this.options.selection);e.length>0||e.inverted?this._userOptionChange("selection",e,null):(this.options.selection.length>0||this.options.selection.inverted)&&this._userOptionChange("selected",t,null)},_render:function(){var e=this;this.element[0].classList.remove("oj-complete"),this._keyList=new Set;var t,n=this.element[0].getElementsByTagName("ul");if(this.options.data){for(t=0;t<n.length;t++)n[t].parentNode.removeChild(n[t]);this._fetchChildren(null,function(t){var n=t.values[0];e._truncateIfOverMaxCount(n.value);var i={fetchListResult:n.value,parentElem:e.element[0]};e._renderItems(i).then(function(){e._resetFocus(),e.element[0].classList.add("oj-complete"),e._decorateTree(),e._lastSelectedItem=null})})}else{for(t=0;t<n.length;t++)n[t].classList.add("oj-treeview-list"),n[t].setAttribute("role","group");var i=this.element[0].getElementsByTagName("li");for(t=0;t<i.length;t++){var s=this._getItemContent(i[t]);if(s){var r=this._getItemDisclosureIcon(s);r&&s.removeChild(r)}e._decorateItem(i[t])}this._resetFocus(),this.element[0].classList.add("oj-complete"),this._decorateTree(),this._lastSelectedItem=null}},_getDataProvider:function(){var e;if(null==this.m_dataSource){if(e=this.options.data,!r.DataProviderFeatureChecker.isTreeDataProvider(e)){var t=new Promise(function(e,t){n(["ojs/ojtreedataprovideradapter"],function(t){e(function(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),t.default=e,t}(t))},t)});if(!t)throw new Error("Error adapting a TreeDataSource");return t.then(function(t){return new t.default(e)})}}else e=this.m_dataSource;return Promise.resolve(e)},_fetchChildren:function(e,t){var n=this,i=n._addBusyState("getting data provider",e),s=n._getDataProvider(),r=this._refreshId;s.then(function(s){if(i(),n._refreshId===r){n.m_dataSource=s;var a=null===e?s:s.getChildDataProvider(e);if(null!=a){var o=n._addBusyState("fetching data",e),l=n._getShowStatusDelay();n._isSkeletonSupported()&&(n._skeletonTimeout=setTimeout(function(){var t=n._expandedChildrenMap.get(null);if(null===e)n._renderInitialSkeletons();else if(!t&&!n._isParentSkeletonRendered(e)&&!n._isLeafOnlySelectionEnabled()){var i=n._getItemByKey(e);n._getSubtree(i)||n._renderChildSkeletons(e)}},l));var d=n._loadTemplateEngine();n._clientId=n._clientId||Symbol();var h={clientId:n._clientId,size:-1},c=a.fetchFirst(h)[Symbol.asyncIterator](),f=c.next();Promise.all([f,d]).then(function(t){return n._refreshId!==r?null:function t(i){if(i[0].done){if(n._clearSkeletonTimeout(),n._isLeafOnlySelectionEnabled()&&n._buildRawData(e,i[0]),n._isSkeletonSupported()){for(var s=[],a=i[0].value.data,l=0;l<a.length;l++){var d=i[0].value.metadata[l].key;n._isInitExpanded(d)&&n.m_dataSource.getChildDataProvider(d)&&s.push(d)}n._expandedChildrenMap.set(e,s);var h=n._expandedChildrenMap.get(e);if(h){var f=h.indexOf(e);f>-1&&h.splice(f,1)}if(!h||0===h.length)return{values:i,shouldRemoveSkeleton:!0}}return{values:i,shouldRemoveSkeleton:!1}}return c.next().then(function(e){return n._refreshId!==r?null:(i[0].done=e.done,i[0].value.data=i[0].value.data.concat(e.value.data),i[0].value.metadata=i[0].value.metadata.concat(e.value.metadata),t(i))},function(e){u.error("Error fetching data: "+e),o()})}(t)},function(e){u.error("Error fetching data: "+e),o()}).then(function(e){n._refreshId===r?(t(e),o()):o()})}}},function(e){u.error("Error fetching data: "+e),i(),n._expandedChildrenMap=new Map,n.m_fetching=new Set})},_clearSkeletonTimeout:function(){this._skeletonTimeout&&(clearTimeout(this._skeletonTimeout),this._skeletonTimeout=null)},_buildRawData:function(e,t){null===e?this._rawData=t.value.metadata:this._findParentAndAddChildren(this._rawData,t.value.metadata,e)},_findParentAndAddChildren:function(e,t,n){for(var i=0;i<e.length;i++){if(e[i].key===n)return void(e[i].children=t);e[i].children&&this._findParentAndAddChildren(e[i].children,t,n)}},_isParentSkeletonRendered:function(e){for(var t=this._getItemByKey(e),n=this._getParents(t,".oj-treeview-item"),i=0;i<n.length;i++){var s=this._getKey(n[i]);if(this._expandedChildrenMap.get(s))return!0}return!1},_getShowStatusDelay:function(){var e=this._getOptionDefaults(),t=parseInt(e.showIndicatorDelay,10);return isNaN(t)?0:t},_renderItems:function(e){return new Promise(function(t){var n=document.createElement("ul");n.classList.add("oj-treeview-list"),n.setAttribute("role","group");var i=this._getSkeletonContainer(this.element[0]);(i&&this._isSkeletonSupported()||this._isLeafOnlySelectionEnabled())&&(n.style.display="none"),e.parentElem.appendChild(n);for(var s=0;s<e.fetchListResult.data.length;s++)this._renderItem(n,e.fetchListResult,s);i&&this._isSkeletonSupported()&&!this._isLeafOnlySelectionEnabled()?this._toggleParentDisplay(e.parentElem,t):t()}.bind(this))},_getScrollPolicyOptions:function(){return this.options.scrollPolicyOptions},_validateScrollPolicyOptions:function(e){var t=this._getScrollPolicyOptions(),n=this._getTreeViewItemCount()+e;return t.maxCount<n&&u.error("ScrollPolicyOptions max count of ["+t.maxCount+"] has been reached."),n-t.maxCount},_truncateIfOverMaxCount:function(e){var t=e.data.length,n=this._validateScrollPolicyOptions(t);n===t?(e.data=[],e.metadata=[]):n>0&&(e.data.splice(-n,t),e.metadata.splice(-n,t))},_toggleParentDisplay:function(e,n){var i=this._getKey(e);e===this.element[0]&&(i=null);var s=this._expandedChildrenMap.get(i);if(s&&s.length>0)n();else{var r,a=null,o=function(e,n){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=t(e))||n&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw a}}}}(this._expandedChildrenMap.keys());try{for(o.s();!(r=o.n()).done;){a=r.value;var l,d,h=this._expandedChildrenMap.get(a);null===a?(l=this.element[0],d=this._getRoot()):(l=this._getItemByKey(a),d=this._getSubtree(l),this._setItemExpanded(l)),d&&0===h.length&&this._resolveNoChildren(a,l,d,n);for(var c=h.length-1;c>=0;c--)h[c]===i&&d&&(h.splice(c,1),0===h.length&&this._resolveNoChildren(a,l,d,n))}}catch(e){o.e(e)}finally{o.f()}n()}},_resolveNoChildren:function(e,t,n,i){this._expandedChildrenMap.delete(e),this._getSkeletonContainer(t)&&!this._isLeafOnlySelectionEnabled()?this._foundSkeleton(e,n,i):this._isLeafOnlySelectionEnabled()||(n&&(n.style.display="block"),this._toggleParentDisplay(t,i))},_foundSkeleton:function(e,t,n){this._removeSkeleton(e).then(function(){t&&(t.style.display="block");var e=this._getOptionDefaults();h.fadeIn(t,{duration:e.dataFadeInDuration}),n()}.bind(this))},_renderItem:function(e,t,n,i,s){var r,o,l=t.data[n],h=t.metadata[n],c=h.key;if(!s){if(this._keyList.has(c))throw new Error("JET TreeView nodes should not have duplicated keys: "+c);this._keyList.add(c)}var u=document.createElement("li");if(s){var f=this._getItemByKey(c);if(!f)return;e=f.parentNode;var _=this._getSubtree(f);f.parentNode.replaceChild(u,f)}else null==i||i>=e.children.length?e.appendChild(u):e.insertBefore(u,e.children[i]);var p={};p.parentElement=a(u),p.index=n,p.data=l,p.datasource=this.options.data,p.parentKey=this._getKey(this._getParentItem(u)),p.metadata=h,p.component=d.__GetWidgetConstructor(this.element),this._FixRendererContext&&(p=this._FixRendererContext(p));var m=this.m_dataSource.getChildDataProvider(c);h.leaf=null===m,h.depth=this._getDepth(u);var v=Object.keys(h);for(r=0;r<v.length;r++){var g=v[r];p[g]=h[g]}var y=this.options.item.renderer;y=this._WrapCustomElementRenderer(y);var S=this._getItemTemplate(),E=this._getTemplateEngine();if(null!=y){var I=y.call(this,p);null!=I&&(null===I.parentNode||I.parentNode instanceof DocumentFragment?u.appendChild(I):null!=I.parentNode||I.toString&&((o=document.createElement("span")).appendChild(document.createTextNode(I.toString())),u.appendChild(o)))}else if(null!=S&&null!=E){var b=this.element[0],C=E.execute(b,S,p,null);for(r=0;r<C.length;r++){if("LI"===C[r].tagName){u.parentNode.replaceChild(C[r],u);break}u.appendChild(C[r])}}else(o=document.createElement("span")).appendChild(document.createTextNode(null==l?"":l.toString())),u.appendChild(o);s&&_&&u.appendChild(_),u=e.children[null!=i?i:n],p.parentElement=a(u),u.hasAttribute("id")||u.setAttribute("id",this._getUniqueItemId()),u["oj-item-data"]=l,u["oj-item-metadata"]=h,this._decorateItem(u)},_getDepth:function(e){for(var t=0,n=e;n&&n!==this.element[0];)n=n.parentElement.parentElement,t+=1;return t},_loadTemplateEngine:function(){var e=this;return null!=this._getItemTemplate()&&null==e.options.item.renderer?new Promise(function(t){f.__getTemplateEngine().then(function(n){e.m_engine=n,t(n)},function(e){throw new Error("Error loading template engine: "+e)})}):Promise.resolve(null)},_getTemplateEngine:function(){return this.m_engine},_getItemTemplate:function(){if(void 0===this.m_template){this.m_template=null;var e=this._getSlotMap().itemTemplate;e&&e.length>0&&"template"===e[0].tagName.toLowerCase()&&(this.m_template=e[0])}return this.m_template},_getSlotMap:function(){return g.CustomElementUtils.getSlotMap(this.element[0])},_decorateTree:function(){var e=this,t=this._getRoot();t&&(this._focusable({element:a(t),applyHighlight:!0,setupHandlers:function(t,n){e._focusInHandler=t,e._focusOutHandler=n}}),t.setAttribute("tabIndex",0),a(t).on("focus",function(){e._focusInHandler(a(e._getItemContent(e._currentItem)))}).on("blur",function(){e._focusOutHandler(a(e._getItemContent(e._currentItem)))}),t.setAttribute("role","tree"),t.setAttribute("aria-labelledby",this.element[0].getAttribute("id")),"none"!==this.options.selectionMode?t.setAttribute("aria-multiselectable",this._isMultiSelectionEnabled()||this._isLeafOnlySelectionEnabled()?"true":"false"):t.removeAttribute("aria-multiselectable"))},_isMultiSelectionEnabled:function(){return"multiple"===this.options.selectionMode},_isLeafOnlySelectionEnabled:function(){return"leafOnly"===this.options.selectionMode},_isDefaultCheckBoxesEnabled:function(){return"selector"===this._getOptionDefaults().multipleSelectionAffordance&&(this._isMultiSelectionEnabled()||this._isLeafOnlySelectionEnabled())},_refreshSelectionItems:function(){for(var e=this._getItems(),t=0;t<e.length;t++)this._select(e[t])},_decorateItem:function(e){var t;e.classList.add("oj-treeview-item"),e.setAttribute("role","treeitem");var n=this._getKey(e),i=this._getItemContent(e);if(!i){if((i=document.createElement("div")).classList.add("oj-treeview-item-content"),this._isDefaultCheckBoxesEnabled()&&this._isActionable(e,"focus")&&this._isActionable(e,"select")){var s=document.createElement("span");s.classList.add("oj-treeview-selector");var r=document.createElement("oj-selector");r.selectedKeys=this._getSelected(),r.setAttribute("data-oj-binding-provider","none"),r.setAttribute("selection-mode","multiple"),r.addEventListener("selectedKeysChanged",function(e){if("internal"===e.detail.updatedFrom){var t=this._getItemByKey(e.target.rowKey);this._focus(t,e),this._userSelectedOptionChange(e.detail.value,e)}}.bind(this)),r.rowKey=n,s.appendChild(r),i.appendChild(s),o.getContext(r).getBusyContext().whenReady().then(function(){p.disableAllFocusableElements(r)})}if(e.firstChild)do{i.appendChild(e.firstChild)}while(e.childNodes.length>0);e.appendChild(i);var a=i.getElementsByTagName("ul")[0];a&&e.appendChild(a);var l=i.getElementsByClassName("oj-treeview-item-icon");for(t=0;t<l.length;t++)l[t].classList.add("oj-treeview-icon"),l[t].classList.add("oj-component-icon")}this._select(e),i.setAttribute("draggable",this._isDnD()?"true":"false");var d=this._getItemDisclosureIcon(i);d||(d=document.createElement("ins"),this._addTreeViewIconClass(d),i.insertBefore(d,i.children[0]));var h=this._getItemSpacer(i);h||(h=document.createElement("span"),this._addTreeviewSpacerClass(h),i.insertBefore(h,d)),this._addIndentation(e,h),this._isDnD()&&(e.classList.add("oj-draggable"),i.classList.add("oj-draggable")),this._isLeaf(e)?this._addTreeviewLeafClass(e):(this._isInitExpanded(n)?this._expand(e,!1):this._collapse(e,!1),this._addDisclosureClasses(d))},_addIndentation:function(e,t){var n=this._getDepth(e);this._isLeaf(e)||(n-=1),n<this.constants.MAX_STYLE_DEPTH?this._appendSpacerClass(n,t):(this._appendSpacerClass(1,t),t.style.width=t.offsetWidth*n+"px")},_appendSpacerClass:function(e,t){t.classList.add(this.classNames["depth"+e])},_addTreeviewSpacerClass:function(e){e.classList.add("oj-treeview-spacer")},_addTreeViewIconClass:function(e){e.classList.add("oj-treeview-icon")},_addTreeviewLeafClass:function(e){e.classList.add("oj-treeview-leaf")},_removeTreeviewLeafClass:function(e){e.classList.remove("oj-treeview-leaf")},_addDisclosureClasses:function(e){e.classList.add("oj-treeview-disclosure-icon"),e.classList.add("oj-component-icon"),e.classList.add("oj-clickable-icon-nocontext"),e.classList.add("oj-default")},_removeDisclosureClasses:function(e){e.classList.remove("oj-treeview-disclosure-icon"),e.classList.remove("oj-component-icon"),e.classList.remove("oj-clickable-icon-nocontext"),e.classList.remove("oj-default")},_getItems:function(){return this.element[0].getElementsByClassName("oj-treeview-item")},_getKey:function(e){if(!e)return null;var t=e["oj-item-metadata"];return t?t.key:e.getAttribute("id")},_getItemByKey:function(e){for(var t,n=this.element[0].getElementsByTagName("li"),i=0;i<n.length;i++){var s=n[i]["oj-item-metadata"];if(s&&r.Object.compareValues(s.key,e)){t=n[i];break}}if(t)return t;if("string"==typeof e){var a=document.getElementById(e),o=this._getRoot();if(o&&a&&o&&o.contains(a))return a}},_getItemContent:function(e){if(!e)return null;for(var t=e.children,n=0;n<t.length;n++)if(e.children[n].classList&&e.children[n].classList.contains("oj-treeview-item-content"))return e.children[n];return null},_getChildItems:function(e){var t=[],n=e.getElementsByClassName("oj-treeview-list")[0];if(n)for(var i=n.children,s=0;s<i.length;s++)t.push(i[s]);return t},_getParentItem:function(e){var t=this._getParents(e,".oj-treeview-list")[0];return this._getParents(t,".oj-treeview-item")[0]},_getSubtree:function(e){return e.getElementsByClassName("oj-treeview-list")[0]},_getRoot:function(){return this.element[0].getElementsByClassName("oj-treeview-list")[0]},_isLeaf:function(e){if(!e)return null;var t=e["oj-item-metadata"];return!(t?!t.leaf:void 0!==this._getSubtree(e))},_isInitExpanded:function(e,t){var n=null!=t?t:this.options.expanded;return!(!n||!n.has)&&n.has(e)},_isExpanded:function(e){return e.classList.contains("oj-expanded")},_isDisclosing:function(e){return!(!e||!this.m_disclosing)&&this.m_disclosing.indexOf(e)>-1},_setDisclosing:function(e,t){if(null!=e)if(null==this.m_disclosing&&(this.m_disclosing=[]),t)this.m_disclosing.push(e);else for(var n=this.m_disclosing.indexOf(e);n>-1;)this.m_disclosing.splice(n,1),n=this.m_disclosing.indexOf(e)},_expand:function(e,t,n,i){var s=this;if(!(this._isExpanded(e)||this._isLeaf(e)||t&&this._isDisclosing(this._getKey(e)))){if(t&&!this._trigger("beforeExpand",n,this._getEventPayload(e))&&!1!==i)return;this._lastSelectedItem=null;var r=this._getSubtree(e),a=s._getKey(e);if(!r)return this._uiExpanded=this._uiExpanded.add([a]),void this._fetchChildren(a,function(i){if((!s._isExpanded(e)||s._isSkeletonSupported())&&(s._isInitExpanded(a)||s._isInitExpanded(a,s._uiExpanded))){var o=i.values[0];s._truncateIfOverMaxCount(o.value);var l=e.getElementsByClassName("oj-treeview-skeleton-container").length,d={fetchListResult:o.value,parentElem:e};s._isSkeletonSupported()&&l>0&&i.shouldRemoveSkeleton&&!s._isLeafOnlySelectionEnabled()?s._renderItems(d).then(function(){var t=e.offsetHeight,i=3*t,a=t*o.value.data.length;r=s._getSubtree(e);var l={};l.startMaxHeight=i+"px",l.endMaxHeight=a+"px",a>i?s._animateSkeletonRemoval("expand",e,r,l,n):a<i?s._animateSkeletonRemoval("collapse",e,r,l,n):s._animateSkeletonRemoval("fadeIn",e,r,l,n)}):s._isSkeletonSupported()&&l>0?s._renderItems(d).then(function(){s._setExpandedState(s,e,n),s.isReady()&&s._isLeafOnlySelectionEnabled()&&s._initLeafOnlySelectionMode()}):s._renderItems(d).then(function(){s._expandAfterFetch(e,t,n),s.isReady()&&s._isLeafOnlySelectionEnabled()&&s._initLeafOnlySelectionMode()})}});s._expandAfterFetch(e,t,n)}},_initLeafOnlySelectionMode:function(){var e=this;this.treeviewSelectionManager=new y(this._rawData,{keyAttributes:"key",childrenAttribute:"children"},function(t){return e.options.data.createOptimizedKeyMap(t)},function(t){return e.options.data.createOptimizedKeySet(t)}),this._userSelectedOptionChange(this._getSelected(),null,!0);var t=this._getRoot();this._getSkeletonContainer(this.element[0])?this._removeSkeleton(null).then(function(){t&&(t.style.display="block");var e=this._getOptionDefaults();h.fadeIn(t,{duration:e.dataFadeInDuration})}.bind(this)):t&&(t.style.display="block")},_setItemExpanded:function(e){e.classList.remove("oj-collapsed"),e.classList.add("oj-expanded"),e.setAttribute("aria-expanded","true")},_animateSkeletonRemoval:function(e,t,n,i,s){var r=this._getKey(t);this._removeSkeleton(r).then(function(){this._setItemExpanded(t);var a=this,o=this._getOptionDefaults();n.style.display="block",h.fadeIn(n,{duration:o.dataFadeInDuration}).then(function(){var o=this._addBusyState("animating skeleton removal",r);t.classList.add("oj-treeview-animated"),this._setDisclosing(this._getKey(t),!0),"expand"===e?this._startAnimation(n,"expand",i).then(this._resolveAnimationPromise(a,t,s,o)):"collapse"===e?this._startAnimation(n,"collapse",i).then(this._resolveAnimationPromise(a,t,s,o)):this._resolveAnimationPromise(a,t,s,o)()}.bind(this))}.bind(this))},_expandAfterFetch:function(e,t,n){this._setItemExpanded(e);var i=this._getKey(e),s=this._getSubtree(e);if(s&&(s.style.display="block"),t){var r=this._addBusyState("animating expand",i);e.classList.add("oj-treeview-animated"),this._setDisclosing(i,!0),this._startAnimation(s,"expand").then(this._resolveAnimationPromise(this,e,n,r))}},_setExpandedState:function(e,t,n){e._setDisclosing(e._getKey(t),!1),t.classList.remove("oj-treeview-animated"),e._trigger("expand",n,e._getEventPayload(t));var i=e.options.expanded.add([e._getKey(t)]);e._userOptionChange("expanded",i,n)},_resolveAnimationPromise:function(e,t,n,i){return function(){this._setExpandedState(e,t,n),i()}.bind(this)},_collapse:function(e,t,n,i){var s=this,r=this._getKey(e);if(!(e.classList.contains("oj-collapsed")||this._isLeaf(e)||t&&this._isDisclosing(r))){if(e.contains(this._currentItem)){var a=e;this._isActionable(a,"focus")||(a=this._getPreviousActionableItem(e,"focus"))||(a=this._getNextActionableItem(e,"focus")),a?this._focus(a,n):(this.options.currentItem=null,this._resetFocus())}if(t){if(!this._trigger("beforeCollapse",n,this._getEventPayload(e))&&!1!==i)return;this._setDisclosing(r,!0)}e.classList.remove("oj-expanded"),e.classList.add("oj-collapsed"),e.setAttribute("aria-expanded","false"),this._lastSelectedItem=null;var o=this._getSubtree(e);if(t){var l=this._addBusyState("animating collapse",r);e.classList.add("oj-treeview-animated"),this._uiExpanded=this._uiExpanded.delete([r]),this._startAnimation(o,"collapse").then(function(){s._setDisclosing(r,!1),o.style.display="none",e.classList.remove("oj-treeview-animated"),s._trigger("collapse",n,s._getEventPayload(e));var t=s.options.expanded.delete([r]);s._userOptionChange("expanded",t,n),l()})}else o&&(o.style.display="none");this._isLeafOnlySelectionEnabled()&&!o&&this._fetchChildren(r,function(t){var n=t.values[0];s._truncateIfOverMaxCount(n.value);var i={fetchListResult:n.value,parentElem:e};s._renderItems(i).then(function(){s.isReady()&&s._isLeafOnlySelectionEnabled()&&s._initLeafOnlySelectionMode()})})}},_startAnimation:function(e,t,n){var i=(this._getOptionDefaults().animation||{})[t];return n&&("expand"!==i.effect&&"collapse"!==i.effect||Object.assign(i,n)),h.startAnimation(e,t,i,this)},_getEventPayload:function(e){return{key:this._getKey(e),item:e}},_isActionable:function(e,t){var n=this.options.item[t+"able"];return!1!==n&&("function"!=typeof n||n(this.getContextByNode(e)))},_isSelected:function(e){var t=this.options.selectionMode,n=this._getSelected();if("none"===t)return!1;var i=this._getKey(e);return n.has(i)},_getSelected:function(){return this._isLeafOnlySelectionEnabled()&&this._selectedKeysets?this._selectedKeysets.selected:this.options.selected},_select:function(e,t){if("none"!==this.options.selectionMode&&this._isActionable(e,"focus")&&this._isActionable(e,"select")){var n=this._isSelected(e);if(t){var i=t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents,s=c.isTouchSupported()&&(i||null!=this.touchStartEvent&&this.touchStartEvent.target===t.target),r=c.isMetaKeyPressed(t),a=40===t.keyCode||38===t.keyCode,o=this._getKey(e),l=new _.KeySetImpl;if((this._isMultiSelectionEnabled()||this._isLeafOnlySelectionEnabled())&&t.shiftKey&&!a){r?l=this._getSelected():this._clearSelection();for(var d=this._lastSelectedItem,h=d&&d.offsetTop<e.offsetTop?this._getNextActionableItem.bind(this):this._getPreviousActionableItem.bind(this);d&&d!==e;){var u=this._getKey(d);l.has(u)||(l=l.add([u]),this._setSelected(d)),d=h(d,"select")}n=!0,l=l.add([o])}else(this._isMultiSelectionEnabled()||this._isLeafOnlySelectionEnabled())&&(r||s||a)?(n=!n,l=this._getSelected(),l=n?l.add([o]):l.delete([o])):(this._clearSelection(),(s||32===t.keyCode)&&n?(n=!1,l=new _.KeySetImpl):(n=!0,l=new _.KeySetImpl([o])));this._userSelectedOptionChange(l,t),this._lastSelectedItem=e}n?this._setSelected(e):this._setUnselected(e)}},_setIndeterminateState:function(e){this._getSelectorByItemKey(e).indeterminate=!0},_getSelectorByItemKey:function(e){return this._getItemByKey(e).getElementsByTagName("oj-selector")[0]},_updateSelectors:function(e){for(var t=this._addBusyState("updating selectors",null),n=this.element[0].getElementsByClassName("oj-treeview-selector"),i=0;i<n.length;i++)n[i].firstChild.selectedKeys=e,this._isLeafOnlySelectionEnabled()&&this._selectedKeysets.partialParents.has(n[i].firstChild.rowKey)&&this._setIndeterminateState(n[i].firstChild.rowKey);t()},_setSelected:function(e){if(this._getItemContent(e).classList.add("oj-selected"),e.setAttribute("aria-selected","true"),this._isLeafOnlySelectionEnabled()&&this._isDefaultCheckBoxesEnabled()){var t=this._getKey(e);this._getSelectorByItemKey(t).indeterminate=!1}},_setUnselected:function(e){if(this._getItemContent(e).classList.remove("oj-selected"),e.setAttribute("aria-selected","false"),this._isLeafOnlySelectionEnabled()&&this._isDefaultCheckBoxesEnabled()){var t=this._getKey(e);this._selectedKeysets&&!this._selectedKeysets.partialParents.has(t)&&(this._getSelectorByItemKey(t).indeterminate=!1)}},_clearSelection:function(){for(var e=this._getItems(),t=0;t<e.length;t++)this._setUnselected(e[t])},_focus:function(e,t){if(this._isActionable(e,"focus")){if(t){var n=this._getEventPayload(e);if(this._currentItem&&(n.previousKey=this._getKey(this._currentItem),n.previousItem=this._currentItem),!this._trigger("beforeCurrentItem",t,n))return;this._userOptionChange("currentItem",this._getKey(e),t)}this._focusOutHandler(a(this._getItemContent(this._currentItem))),this._focusInHandler(a(this._getItemContent(e))),this._setCurrentItem(e)}},_resetFocus:function(){if(this.options.currentItem){var e=this._getItemByKey(this.options.currentItem);if(e)return void this._setCurrentItem(e)}var t=this._getItems()[0];this._isActionable(t,"focus")||(t=this._getNextActionableItem(t,"focus")),this._setCurrentItem(t),this._userOptionChange("currentItem",this._getKey(this._currentItem),null)},_setCurrentItem:function(e){this._currentItem=e;var t=this._getRoot();t&&e&&t.setAttribute("aria-activedescendant",this._getItemId(e))},_getItemId:function(e){return e.getAttribute("id")},_getUniqueItemId:function(){return g.ElementUtils.getUniqueId(this.element[0].getAttribute("id")).concat("_"+this._getTreeViewItemCount())},_getTreeViewItemCount:function(){return this._getItems().length},_addBusyState:function(e,t){var n=o.getContext(this.element[0]).getBusyContext(),i=this.element.attr("id"),s=n.addBusyState({description:"The component identified by '"+i+"', "+e});return this.m_fetching.add(t),function(){this.m_fetching.delete(t),s(),Promise.resolve(this._processEventQueue())}.bind(this)},_userOptionChange:function(e,t,n){this.option(e,t,{_context:{originalEvent:n,writeback:!0,internalSet:!0}}),"selected"===e&&this._isDefaultCheckBoxesEnabled()&&this._updateSelectors(t),this._refreshSelectionItems()},_userSelectedOptionChange:function(e,t,n){var i=e;if(this._isLeafOnlySelectionEnabled()){var s=this._getSelected();n&&(i=this._filterOutParentKeys(i),s=this._getEmptyKeySet(i)),this._selectedKeysets=this.treeviewSelectionManager.computeSelection(i,s),i=this._selectedKeysets.selectedLeaves}this._userOptionChange("selected",i,t),this._userOptionChange("selection",_.KeySetUtils.toArray(i),t),this._isLeafOnlySelectionEnabled()&&this._updateSelectors(this._selectedKeysets.selected)},_getEmptyKeySet:function(e){return e.isAddAll()?new _.AllKeySetImpl:new _.KeySetImpl},_filterOutParentKeys:function(t){var n=this;if(t.isAddAll()){var i=new _.AllKeySetImpl,s=e(t.deletedValues()).filter(function(e){return!n.treeviewSelectionManager.parentKeyNodeMap.has(e)});return i=i.delete(s)}return new _.KeySetImpl(e(t.values()).filter(function(e){return!n.treeviewSelectionManager.parentKeyNodeMap.has(e)}))},_getDragOptions:function(){return((this.options.dnd||{}).drag||{}).items||{}},_getDropOptions:function(){return((this.options.dnd||{}).drop||{}).items||{}},_getClosestItem:function(e){return this._closest(e,".oj-treeview-item")},_getClosestItemContent:function(e){return this._closest(e,".oj-treeview-item-content")},_getClosestDisclosureIcon:function(e){return this._closest(e,".oj-treeview-disclosure-icon")},_handleClick:function(e){var t,n=this._getClosestDisclosureIcon(e.target);if(n){t=this._getClosestItem(n);var i=this._getKey(t);if(this.m_fetching.has(i))return;return this._isExpanded(t)?this._collapse(t,!0,e):this._expand(t,!0,e),void(this.touchStartEvent=null)}var s=this._getClosestItemContent(e.target);if(s)return t=s.parentNode,this._select(t,e),this._focus(t,e),void(this.touchStartEvent=null);"none"!==this.options.selectionMode&&(this._clearSelection(),this._lastSelectedItem=null,this._userSelectedOptionChange(new _.KeySetImpl,e)),this.touchStartEvent=null},_isDnD:function(){var e=this._getDragOptions();return Object.keys(e).length>0},_handleMouseOver:function(e){if((!c.isTouchSupported()||!this.touchStartEvent)&&("none"!==this.options.selectionMode||this._isDnD())){var t=this._getClosestDisclosureIcon(e.target);t||(t=this._getClosestItemContent(e.target)),t&&(t.classList.remove("oj-default"),t.classList.add("oj-hover"))}},_handleMouseOut:function(e){var t=this._getClosestDisclosureIcon(e.target);t&&t.classList.remove("oj-selected"),t||(t=this._getClosestItemContent(e.target)),t&&(t.classList.add("oj-default"),t.classList.remove("oj-hover"))},_handleMouseDown:function(e){var t=this._getClosestDisclosureIcon(e.target);t&&t.classList.add("oj-selected")},_handleMouseUp:function(e){var t=this._getClosestDisclosureIcon(e.target);t&&t.classList.remove("oj-selected")},_handleKeyDown:function(e){var t,n=e.keyCode,i=this._currentItem;if(38===n||40===n)(t=40===n?this._getNextActionableItem(i,"focus"):this._getPreviousActionableItem(i,"focus"))&&(e.preventDefault(),this._isSelected(i)&&e.shiftKey&&this._select(this._isSelected(t)?i:t,e),this._scrollToVisible(t,n),this._focus(t,e));else if(37===n||39===n){var s="rtl"===this._GetReadingDirection(),r=!s&&39===n||s&&37===n;!r||this._isLeaf(i)||this._isExpanded(i)?r||this._isLeaf(i)||!this._isExpanded(i)?(t=r?this._getNextActionableItem(i,"focus"):this._getPreviousActionableItem(i,"focus"))&&(e.preventDefault(),this._focus(t,e)):(e.preventDefault(),this._collapse(i,!0,e)):(e.preventDefault(),this._expand(i,!0,e))}else if(13===n||32===n)e.preventDefault(),this._select(i,e);else if(65===n&&c.isMetaKeyPressed(e)&&(this._isLeafOnlySelectionEnabled()||this._isMultiSelectionEnabled())){e.preventDefault();for(var a=this._getItems(),o=new _.AllKeySetImpl,l=0;l<a.length;l++)this._isActionable(a[l],"select")&&this._setSelected(a[l]);this._userSelectedOptionChange(o,e)}},_scrollToVisible:function(e,t){var n,i=this._getItemSpacer(e).offsetHeight,s=this.element[0],r=s.scrollTop,a=i,o=r,l=r+this.element[0].offsetHeight;n=e.offsetTop-this.element[0].offsetTop,38!==t&&(n+=a),n>=o&&n<=l||(n<o?s.scrollTop=r+(n-o-1):n>l&&(s.scrollTop=r+(n-l+1)))},_getNextItem:function(e){if(!this._isLeaf(e)&&this._isExpanded(e)){var t=this._getChildItems(e)[0];if(t)return t}for(var n=e;n;){var i=this._getNextSibling(n,".oj-treeview-item");if(i)return i;n=this._getParentItem(n)}return null},_getNextActionableItem:function(e,t){for(;null!=e;)if(null!=(e=this._getNextItem(e))&&this._isActionable(e,t))return e;return null},_getPreviousItem:function(e){for(var t=this._getPreviousSibling(e,".oj-treeview-item");t;){if(this._isLeaf(t)||!this._isExpanded(t))return t;var n=this._getChildItems(t),i=n[n.length-1];if(!i)return t;t=i}var s=this._getParentItem(e);return s||null},_getPreviousActionableItem:function(e,t){for(;null!=e;)if(null!=(e=this._getPreviousItem(e))&&this._isActionable(e,t))return e;return null},_handleDragStart:function(e){c.isTouchSupported()&&(this.ojTreeViewDragEvent=!0);var t=this,n="rtl"===this._GetReadingDirection(),i=this._getClosestItem(e.target);if(i){var s,a=[];if(this._isSelected(i)){var o=this.options.selection;for(s=0;s<o.length;s++){var l=this._getItemByKey(o[s]);l&&a.push(l)}}else this._select(i,e),a.push(i);var d=this._getDragOptions(),h=e.originalEvent.dataTransfer,u=document.createElement("ul");u.classList.add("oj-treeview-drag-image"),u.classList.add("oj-treeview-list"),r.AgentUtils.getAgentInfo().browser===r.AgentUtils.BROWSER.SAFARI&&(u.style.position="absolute");var f,_=[],p=1/0,m=1/0;for(a.forEach(function(e){_.push(e["oj-item-data"]);var i=e.getBoundingClientRect(),s=i.top,r=i.left;if(n){for(var a=t._getItemContent(e).children,o=0,l=0;l<a.length;l++)o+=a[l].offsetWidth;o+=i.left,r=i.width-o-i.left}s+=document.body.scrollTop,r+=document.body.scrollLeft;var d=e.cloneNode(!0);d.style.top=s+"px",d.style.left=r+"px",e.classList.add("oj-treeview-drag-source"),d.classList.add("oj-treeview-drag-image"),d.classList.add("oj-treeview-drag-image-item");var h=t._getSubtree(d);h&&d.removeChild(h);var c=t._getItemContent(d);if(t._setUnselected(d),c.classList.remove("oj-focus"),c.classList.remove("oj-hover"),c.classList.remove("oj-focus-highlight"),c.classList.remove("oj-draggable"),t._isDefaultCheckBoxesEnabled()&&t._isActionable(e,"focus")&&t._isActionable(e,"select")){var f=d.getElementsByClassName("oj-treeview-selector")[0];f.firstChild.selectedKeys=t.options.selected,f.firstChild.rowKey=t._getKey(e)}s<p&&(p=s),r<m&&(m=r),u.appendChild(d)}),s=0;s<u.children.length;s++)(f=u.children[s]).style.top=parseFloat(f.style.top)-p+"px",f.style.left=parseFloat(f.style.left)-m+"px";var v=d.dataTypes,g="string"==typeof v?[v]:v||[];for(s=0;s<g.length;s++)h.setData(g[s],JSON.stringify(_));document.body.appendChild(u),h.setDragImage(u,e.pageX-m,e.pageY-p),setTimeout(function(){u.parentElement.removeChild(u)},0);var y=d.dragStart;y&&y(e.originalEvent,{items:_})}},_handleDragSourceEvent:function(e,t){"dragEnd"===t&&(this._removeGhostElements(),this._dropLine.style.display="none"),"dragEnd"===t&&c.isTouchSupported()&&(this.ojTreeViewDragEvent=!1);var n=this._getDragOptions()[t];n&&n(e.originalEvent)},_getTreeviewWidth:function(){return this.element[0].offsetWidth},_getItemSpacer:function(e){return e.getElementsByClassName("oj-treeview-spacer")[0]},_handleDropTargetEvent:function(e,t){var n=this._getDropOptions(),i=n.dataTypes,s="string"==typeof i?[i]:i||[],r=n[t],a=this._getClosestItem(e.target);if(a){var o=this._getItemSpacer(a),l=o.getBoundingClientRect(),d=o.offsetTop+l.height/2,h="inside",u=e.originalEvent.clientY-l.top;u<.25*l.height?h="before":u>.75*l.height&&(h=this._isExpanded(a)?"first":"after"),r&&r(e.originalEvent,{item:a,position:h});for(var f=0;f<s.length;f++){var _=e.originalEvent.dataTransfer.types;if(_&&_.indexOf(s[f])>=0){e.preventDefault();break}}if("dragEnter"!==t&&"dragOver"!==t||!e.originalEvent.defaultPrevented){if("drop"===t&&(this._removeGhostElements(),this._dropLine.style.display="none",this._removeDropClass(a)),"drop"===t&&c.isTouchSupported()&&(this.ojTreeViewDragEvent=!1),"dragLeave"===t){var p=a.offsetWidth;if("DIV"===e.target.nodeName&&e.target.classList.contains("oj-treeview-item-content")&&(e.offsetX>=p||e.offsetX<=0))this._dropLine.style.display="none",this._removeDropClass(a);else if(e.offsetY>=a.offsetHeight||e.offsetY<=0){var m=this._getItems();if(m.length>0){var v=m[0];(a===m[m.length-1]&&"after"===h||a===v&&"before"===h)&&(this._dropLine.style.display="none")}else 0===m.length&&(this._dropLine.style.display="none")}"inside"!==h&&this._removeDropClass(a)}}else{var g="rtl"===this._GetReadingDirection(),y=d;if("before"===h?y-=l.height/2:"after"!==h&&"first"!==h||(y+=l.height/2),"inside"!==h){var S,E=this._getParentItem(a);E&&this._isLeaf(a)?(S=l.width,S-=this._getItemDisclosureIcon(E).offsetHeight):E&&!this._isLeaf(a)?(S=l.width,"first"===h&&(S+=this._getItemDisclosureIcon(a).offsetHeight)):E||(S=0,"first"===h&&(S+=this._getItemDisclosureIcon(a).offsetHeight)),this._removeDropClass(a);var I=this._getTreeviewWidth()-S+"px",b=g?"0px":S+"px";this._dropLine.style.width=I,this._dropLine.style.left=b,this._dropLine.style.top=y+"px",this._dropLine.style.display=""}else this._dropLine.style.display="none",this._addDropClass(a)}}},_addDropClass:function(e){this._getItemContent(e).classList.add("oj-treeview-drop-zone")},_removeDropClass:function(e){this._getItemContent(e).classList.remove("oj-treeview-drop-zone")},_removeGhostElements:function(){for(var e=this.element[0].getElementsByClassName("oj-treeview-drag-source"),t=e.length-1;t>=0;t--)e[t].classList.remove("oj-treeview-drag-source")},_NotifyContextMenuGesture:function(e,t,n){if("keyboard"===n){var i=this._currentItem?this._getItemContent(this._currentItem):this.element,s={launcher:this._getRoot(),initialFocus:"menu",position:{my:"start top",at:"start bottom",of:i}};this._OpenContextMenu(t,n,s)}else this.ojTreeViewDragEvent||this._superApply(arguments)},refresh:function(){this._super(),this._refreshId+=1,delete this.m_template,delete this.m_engine,delete this.m_dataSource,this._expandedChildrenMap=new Map,this.m_fetching=new Set,this._render()},getNodeBySubId:function(e){if(null==e)return this.element?this.element[0]:null;var t,n=e.key,i=e.subId,s=this._getItemByKey(n);return"oj-treeview-disclosure"===i&&s?t=s.getElementsByClassName("oj-treeview-disclosure-icon")[0]:"oj-treeview-item"===i&&s&&(t=s.getElementsByClassName("oj-treeview-item-content")[0]),t||null},getSubIdByNode:function(e){if(!this.element[0].contains(e))return null;var t,n=this._getClosestDisclosureIcon(e),i=this._getClosestItem(e);if(n)t="oj-treeview-disclosure";else{if(!i)return null;t="oj-treeview-item"}return{subId:t,key:this._getKey(i)}},getContextByNode:function(e){if(!this.element[0].contains(e))return null;var t,n=this._getClosestItem(e);if(!n)return null;var i=n.parentNode.children,s=[];for(t=0;t<i.length;t++)i[t].classList.contains("oj-treeview-item")&&s.push(i[t]);var r={subId:"oj-treeview-item"};r.index=s.indexOf(n),r.parentKey=this._getKey(this._getParentItem(n)),r.component=d.__GetWidgetConstructor(this.element),this._FixRendererContext&&(r=this._FixRendererContext(r));var a=n["oj-item-metadata"];if(a){r.metadata=a,r.data=n["oj-item-data"],r.datasource=this.options.data;var o=Object.keys(a);for(t=0;t<o.length;t++){var l=o[t];r[l]=a[l]}}else r.key=this._getKey(n),r.leaf=this._isLeaf(n),r.depth=this._getParents(n,".oj-treeview-list").length;return r},_setOption:function(e,t,n){var i,s,r=this;if(this._isLeafOnlySelectionEnabled()||this._superApply(arguments),"expanded"===e)for(this._uiExpanded=r._uiExpanded.clear(),this._expandedChildrenMap=new Map,s=this._getItems(),i=0;i<s.length;i++){var a=this._getKey(s[i]);r._isInitExpanded(a)?r._expand(s[i],!0):r._collapse(s[i],!0)}else if("selected"===e){if(this._isLeafOnlySelectionEnabled()){var o=t;o=this._filterOutParentKeys(o);var l=this._getEmptyKeySet(o);this._selectedKeysets=this.treeviewSelectionManager.computeSelection(o,l),t=this._selectedKeysets.selectedLeaves,arguments[1]=t,this._superApply(arguments)}var d=_.KeySetUtils.toArray(t);this._userOptionChange("selection",d,null),this._isDefaultCheckBoxesEnabled()&&this._updateSelectors(this._getSelected()),this._refreshSelectionItems()}else if("selection"===e){var h=_.KeySetUtils.toKeySet(t);if(this._isLeafOnlySelectionEnabled()){var c=h;c=this._filterOutParentKeys(c);var u=this._getEmptyKeySet(c);this._selectedKeysets=this.treeviewSelectionManager.computeSelection(c,u),h=this._selectedKeysets.selectedLeaves,arguments[1]=_.KeySetUtils.toArray(h),this._superApply(arguments)}this._userOptionChange("selected",h,null),this._isDefaultCheckBoxesEnabled()&&this._updateSelectors(this._getSelected()),this._refreshSelectionItems()}else"currentItem"===e?this._resetFocus():"data"===e?(this._removeDataProviderEventListeners(),this.options.data=t,this._addDataProviderEventListeners(),this.refresh()):this.refresh()},_SetupResources:function(){this._super(),this._addDataProviderEventListeners()},_ReleaseResources:function(){this._super(),this._removeDataProviderEventListeners()},_destroy:function(){this._removeDataProviderEventListeners(),this._super()},_addDataProviderEventListeners:function(){var e=this.options.data;e&&r.DataProviderFeatureChecker.isTreeDataProvider(e)&&(this.m_handleModelMutateEventListener=this.handleModelMutateEvent.bind(this),this.m_handleModelRefreshEventListener=this.handleModelRefreshEvent.bind(this),e.addEventListener("mutate",this.m_handleModelMutateEventListener),e.addEventListener("refresh",this.m_handleModelRefreshEventListener))},_removeDataProviderEventListeners:function(){var e=this.options.data;e&&r.DataProviderFeatureChecker.isTreeDataProvider(e)&&(e.removeEventListener("mutate",this.m_handleModelMutateEventListener),e.removeEventListener("refresh",this.m_handleModelRefreshEventListener))},handleModelMutateEvent:function(e){this._isLeafOnlySelectionEnabled()?u.error("Mutations are not supported in selectionMode: leafOnly  "):this.isReady()?(null!=e.detail.remove&&this.handleModelRemoveEvent(e),null!=e.detail.add&&this.handleModelAddEvent(e),null!=e.detail.update&&this.handleModelChangeEvent(e),this._processEventQueue()):this._pushToEventQueue(e)},_pushToEventQueue:function(e){null==this.m_eventQueue&&(this.m_eventQueue=[]),this.m_eventQueue.push(e)},_clearEventQueue:function(){null!=this.m_eventQueue&&(this.m_eventQueue.length=0)},_processEventQueue:function(){var e;if(this.isReady()&&null!=this.m_eventQueue&&this.m_eventQueue.length>0){for(var t=0;t<this.m_eventQueue.length;t++)if("refresh"===(e=this.m_eventQueue[t]).type)return void this.handleModelRefreshEvent(e);"mutate"===(e=this.m_eventQueue.shift()).type&&this.handleModelMutateEvent(e)}},isReady:function(){return 0===this.m_fetching.size},handleModelRemoveEvent:function(e){var t=this,n=e.detail.remove.keys,i=[];if(null!=n&&0!==n.size&&(n.forEach(function(n){(!e.detail.add||e.detail.add&&!e.options.detail.add.keys.has(n))&&(i=i.concat(t._removeAllChildrenOfParentKey(n)))}),0!==i.length)){var s=this._getSelected();if(null!=s){var r=s.delete(i);s!==r&&this._userSelectedOptionChange(r,e)}var a=this.options.expanded;if(null!=a){var o=a.delete(i);this._uiExpanded.delete(i),a!==o&&this._userOptionChange("expanded",o,null)}this._resetFocus()}},_changeNodeToLeaf:function(e,t){if(e!==this.element[0]){e.removeChild(t),e["oj-item-metadata"].leaf=!0,e.classList.add("oj-treeview-leaf"),e.classList.remove("oj-expanded"),e.removeAttribute("aria-expanded"),e.classList.remove("oj-collapsed");var n=this._getKey(e),i=[];i.push(n);var s=this.options.expanded;if(null!=s){var r=s.delete(i);this._uiExpanded.delete(i),s!==r&&this._userOptionChange("expanded",r,null)}var a=this._getItemDisclosureIcon(e);this._removeDisclosureClasses(a)}},_changeNodeToParent:function(e){e["oj-item-metadata"].leaf=!1,e.classList.remove("oj-treeview-leaf"),e.classList.add("oj-collapsed"),e.setAttribute("aria-expanded",!1);var t=this._getItemDisclosureIcon(e);this._addDisclosureClasses(t)},_getItemDisclosureIcon:function(e){return e.getElementsByTagName("ins")[0]},_removeAllChildrenOfParentKey:function(e){var t=this,n=[],i=this._getItemByKey(e);if(i){this._getChildItems(i).forEach(function(e){var i=t._getKey(e),s=t._removeAllChildrenOfParentKey(i);n=n.concat(s)});var s=i.parentNode;s.removeChild(i),this._keyList.delete(e),n.push(e),0===s.getElementsByTagName("li").length&&t._changeNodeToLeaf(s.parentNode,s)}return n},_isLeafIcon:function(e){return e.classList.contains("oj-treeview-leaf")},handleModelReorder:function(e,t,n){var i=this._getItemByKey(t),s=i.parentElement,r=this._getItemByKey(e),a=r.parentElement,o=r.parentNode;a.removeChild(r),0===a.getElementsByTagName("li").length&&this._changeNodeToLeaf(o.parentNode,o),n?s.insertBefore(r,i.nextSibling):s.insertBefore(r,i)},getLastItemKey:function(e){return this._getKey(e[e.length-1])},handleModelAddEvent:function(e){var t=e.detail.add;this._truncateIfOverMaxCount(t);var n,i=t.data,s=t.metadata,r=[],a=t.parentKeys,o=t.indexes,l=0,d=this;e.detail.add.keys.forEach(function(n){if(!e.detail.remove||e.detail.remove&&!e.options.detail.remove.keys.has(n))r.push(n);else if(t.addBeforeKeys&&t.addBeforeKeys[l]&&0!==t.addBeforeKeys.length)this.handleModelReorder(n,t.addBeforeKeys[l],!1);else{var i;if(t.parentKeys&&t.parentKeys[l]&&0!==t.parentKeys.length){var s=this._getItemByKey(t.parentKeys[l]),a=this._getChildItems(s);i=this.getLastItemKey(a)}else{var o=this._getItems();i=this.getLastItemKey(o)}i&&this.handleModelReorder(n,i,!0)}l+=1}.bind(this)),a.forEach(function(e){var t=d._getItemByKey(e);t&&d._isLeafIcon(t)&&d._changeNodeToParent(t)});var h=t.addBeforeKeys?t.addBeforeKeys:t.afterKeys;if(h&&(n=[],h.forEach(function(e){n.push(e)})),null!=i&&null!=r&&r.length>0&&i.length>0&&r.length===i.length&&(null==o||o.length===i.length))for(l=0;l<i.length;l++){var c,u=null==o?this._getIndex(n,l)+1:o[l],f=a[l],_=this._getItemByKey(f);null==f?(c=this._getRoot())&&this._renderItem(c,{data:[i[l]],metadata:[s[l]]},0,u):_&&(c=this._getSubtree(_))&&this._renderItem(c,{data:[i[l]],metadata:[s[l]]},0,u)}},handleModelChangeEvent:function(e){var t=e.detail.update,n=t.data,i=t.metadata,s=[];t.keys.forEach(function(e){s.push(e)});for(var r=0;r<n.length;r++){var a=this._getItemByKey(s[r]);if(null!=a){var o=this._indexToParent(a);this._renderItem(null,{data:[n[r]],metadata:[i[r]]},0,o,!0)}}this._resetFocus()},_indexToParent:function(e){for(var t=0,n=0;n<e.parentNode.children.length;n++)if(e.parentNode.children[n]===e){t=n;break}return t},handleModelRefreshEvent:function(e){this.isReady()?(this._clearEventQueue(),this.refresh()):this._pushToEventQueue(e)},_isSkeletonSupported:function(){return"skeleton"===this._getOptionDefaults().loadIndicator},_getOptionDefaults:function(){return null==this.defaultOptions&&(this.defaultOptions=l.parseJSONFromFontFamily(this._getOptionDefaultsStyleClass())),this.defaultOptions},_getOptionDefaultsStyleClass:function(){return"oj-treeview-option-defaults"},_renderChildSkeletons:function(e){var t=this._getItemByKey(e);this._removeExistingSkeletons(t);var n=this._getItemDisclosureIcon(t).offsetWidth,i="rtl"===this._GetReadingDirection(),s=this._buildThreeItemedSkeleton(),r=this._buildSkeletonContainer(),a=n,o=this._getDepth(t);i?r.style.marginRight=a+n/o+"px":r.style.marginLeft=a+n/o+"px",r.appendChild(s),t.appendChild(r)},_renderInitialSkeletons:function(){this._removeExistingSkeletons(this.element[0]);var e=this._buildThreeItemedSkeleton(),t=this._buildTwoItemedSkeleton(),n=this._buildSkeletonContainer();n.appendChild(e),n.appendChild(t),this.element[0].classList.add("oj-complete"),this.element[0].appendChild(n);var i=n.offsetHeight,s=this.element[0].offsetHeight,r=i/5,a=0;if(i<s)do{a%2==0?(i+=3*r,n.appendChild(this._buildThreeItemedSkeleton())):(i+=2*r,n.appendChild(this._buildTwoItemedSkeleton())),a+=1}while(i<=s);if(i>s){var o=n.getElementsByClassName("oj-treeview-skeleton-content");for(a=o.length-1;a>=0&&(i-=r,n.removeChild(o[a]),!(i<=s));a--);}},_removeExistingSkeletons:function(e){for(var t=e.getElementsByClassName("oj-treeview-skeleton-container"),n=0;n<t.length;n++)e.removeChild(t[n])},_getSkeletonContainer:function(e){return e.getElementsByClassName("oj-treeview-skeleton-container")[0]},_removeSkeleton:function(e){return new Promise(function(t){var n,i=this._addBusyState("removing skeleton",e);if(n=null===e?this._getSkeletonContainer(this.element[0]):this._getSkeletonContainer(this._getItemByKey(e))){for(var s=n.getElementsByClassName("oj-animation-skeleton"),r=0;r<s.length;r++)s[r].classList.remove("oj-animation-skeleton");n.classList.add("oj-animation-skeleton-fade-out"),n.addEventListener("animationend",function(){n.parentElement&&n.parentElement.removeChild(n),i(),t()})}else i(),t()}.bind(this))},_buildThreeItemedSkeleton:function(){var e=this._buildTwoItemedSkeleton(),t=this._buildSkeletonLeafContent();return e.appendChild(t),e},_buildTwoItemedSkeleton:function(){var e=new DocumentFragment,t=this._buildSkeletonContent(!1);e.appendChild(t);var n=this._buildSkeletonContent(!0);return e.appendChild(n),e},_buildSkeletonContainer:function(){var e=document.createElement("div");return e.classList.add("oj-treeview-skeleton-container"),e.classList.add("oj-animation-skeleton-fade-in"),e},_buildSkeletonContent:function(e){var t=document.createElement("div");t.classList.add("oj-treeview-skeleton-content");var n=this._buildSkeletonCarrot();return e&&n.classList.add("oj-treeview-skeleton-child"),t.appendChild(n),t.appendChild(this._buildSkeletonItem()),t},_buildSkeletonCarrot:function(){var e=document.createElement("div");return e.classList.add("oj-treeview-skeleton-carrot"),e.classList.add("oj-animation-skeleton"),e},_buildSkeletonItem:function(){var e=document.createElement("div");return e.classList.add("oj-treeview-skeleton-item"),e.classList.add("oj-animation-skeleton"),e},_buildSkeletonLeafContent:function(){var e=document.createElement("div");return e.classList.add("oj-treeview-skeleton-content"),e.appendChild(this._buildSkeletonLeafItem()),e},_buildSkeletonLeafItem:function(){var e=document.createElement("div");return e.classList.add("oj-treeview-skeleton-leaf"),e.classList.add("oj-animation-skeleton"),e},_closest:function(e,t){if(!e)return null;if(!e.closest){do{if(this._matches(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}return e.closest(t)},_getParents:function(e,t){for(var n=[];e&&e!==document;e=e.parentNode)this._matches(e,t)&&n.push(e);return n},_getNextSibling:function(e,t){var n=e.nextElementSibling;if(!t)return n;for(;n;){if(this._matches(n,t))return n;n=n.nextElementSibling}return null},_getPreviousSibling:function(e,t){var n=e.previousElementSibling;if(!t)return n;for(;n;){if(this._matches(n,t))return n;n=n.previousElementSibling}return null},_matches:function(e,t){return e.matches||(e.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),e.matches(t)}});
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
var S={properties:{currentItem:{type:"any",writeback:!0,readOnly:!0},data:{type:"object"},dnd:{type:"object",properties:{drag:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"string|Array<string>"},drag:{type:"function"},dragEnd:{type:"function"},dragStart:{type:"function"}}}}},drop:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"string|Array<string>"},dragEnter:{type:"function"},dragLeave:{type:"function"},dragOver:{type:"function"},drop:{type:"function"}}}}}}},expanded:{type:"KeySet",writeback:!0},item:{type:"object",properties:{focusable:{type:"function"},renderer:{type:"function"},selectable:{type:"function"}}},scrollPolicyOptions:{type:"Object<number>",properties:{maxCount:{type:"number",value:500}}},selected:{type:"KeySet",writeback:!0},selection:{type:"Array<any>",writeback:!0,value:[]},selectionMode:{type:"string",enumValues:["leafOnly","multiple","none","single"],value:"none"},translations:{type:"object",value:{}}},methods:{getContextByNode:{},getProperty:{},refresh:{},setProperties:{},setProperty:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojAnimateEnd:{},ojAnimateStart:{},ojBeforeCollapse:{},ojBeforeCurrentItem:{},ojBeforeExpand:{},ojCollapse:{},ojExpand:{}},extension:{}};S.extension._WIDGET_NAME="ojTreeView",r.CustomElementBridge.register("oj-tree-view",{metadata:S})})}();
//# sourceMappingURL=ojtreeview.js.map