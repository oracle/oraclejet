!function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,i=a(t);if(e){var o=a(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return n(this,r)}}function n(e,r){return!r||"object"!==t(r)&&"function"!=typeof r?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e):r}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["exports","ojs/ojcore-base","ojs/ojeventtarget"],function(r,n,a){"use strict";var s,f,c,l;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
/**
   * @preserve Copyright 2013 jQuery Foundation and other contributors
   * Released under the MIT license.
   * http://jquery.org/license
   */
oj.DataProvider=function(){},f=r.AttributeFilterOperator||(r.AttributeFilterOperator={}),(s=f.AttributeOperator||(f.AttributeOperator={})).$co="$co",s.$eq="$eq",s.$ew="$ew",s.$pr="$pr",s.$gt="$gt",s.$ge="$ge",s.$lt="$lt",s.$le="$le",s.$ne="$ne",s.$regex="$regex",s.$sw="$sw",n._registerLegacyNamespaceProp("AttributeFilterOperator",r.AttributeFilterOperator),l=r.CompoundFilterOperator||(r.CompoundFilterOperator={}),(c=l.CompoundOperator||(l.CompoundOperator={})).$and="$and",c.$or="$or",n._registerLegacyNamespaceProp("CompoundFilterOperator",r.CompoundFilterOperator);var h=function(){function t(){o(this,t),this._handleMutationAdd=function(e){var r,i,a=this,o=e[t._BEFOREKEYS],s=e[t._KEYS],u=[];s.forEach(function(t){u.push(t)});var f=e[t._DATA],c=e[t._METADATA],l=e[t._INDEXES];if(u&&u.length>0)if(l)u.forEach(function(t,e){a._items.splice(l[e],0,new a.Item(c[e],f[e]))});else if(o){var h,p,y,v,_,m=Object.assign([],o),g=Object.assign(new Set,e[t._KEYS]),d=Object.assign([],e[t._DATA]),E=Object.assign([],e[t._METADATA]),b=[];for(h=0;h<o.length;h++){if(_=!0,null!=(y=o[h])){for(p=0;p<u.length;p++)if(n.Object.compareValues(u[p],y)){_=!1;break}if(_)for(p=0;p<a._items.length;p++)if(n.Object.compareValues(null===(i=null===(r=a._items[p])||void 0===r?void 0:r.metadata)||void 0===i?void 0:i.key,y)){_=!1;break}}else _=!1;_&&b.push(y)}for(var O=o.length;O>0;){for(h=0;h<o.length;h++)if(v=o[h],b.indexOf(v)>=0){b.push(v);break}O--}for(h=m.length-1;h>=0;h--)b.indexOf(m[h])>=0&&(delete m[h],g.delete(m[h]),delete d[h],delete E[h]);m.forEach(function(t,e){var r,i;if(null===t)a._items.push(new a.Item(c[e],f[e]));else for(h=0;h<a._items.length;h++)if(n.Object.compareValues(null===(i=null===(r=a._items[h])||void 0===r?void 0:r.metadata)||void 0===i?void 0:i.key,t)){a._items.splice(h,0,new a.Item(c[e],f[e]));break}})}else if(a._fetchParams&&null!=a._fetchParams.sortCriteria){var $=a._fetchParams.sortCriteria;if($){var S,A,x=a._getSortComparator($),w=[];f.forEach(function(t,e){for(S=0;S<a._items.length;S++)if(A=a._items[S].data,x(t,A)<0){a._items.splice(S,0,new a.Item(c[e],f[e])),w.push(e);break}}),f.forEach(function(t,e){w.indexOf(e)<0&&a._items.push(new a.Item(c[e],f[e]))})}}else f.forEach(function(t,e){a._items.push(new a.Item(c[e],f[e]))})},this._handleMutationRemove=function(e){var r,i=this,a=e[t._KEYS];a&&a.size>0&&a.forEach(function(t){for(r=i._items.length-1;r>=0;r--)if(n.Object.compareValues(i._items[r].metadata.key,t)){i._items.splice(r,1);break}})},this._handleMutationUpdate=function(e){var r=this,i=e[t._KEYS],a=e[t._DATA],o=e[t._METADATA];if(a&&a.length>0){var s,u=0;i.forEach(function(t){for(s=r._items.length-1;s>=0;s--)if(n.Object.compareValues(r._items[s].metadata.key,t)){r._items.splice(s,1,new r.Item(o[u],a[u]));break}u++})}},this.Item=function(){return function e(r,i){o(this,e),this.metadata=r,this.data=i,this[t._METADATA]=r,this[t._DATA]=i}}(),this.FetchByKeysResults=function(){return function e(r,i){o(this,e),this.fetchParameters=r,this.results=i,this[t._FETCHPARAMETERS]=r,this[t._RESULTS]=i}}(),this.FetchByOffsetResults=function(){return function e(r,i,n){o(this,e),this.fetchParameters=r,this.results=i,this.done=n,this[t._FETCHPARAMETERS]=r,this[t._RESULTS]=i,this[t._DONE]=n}}(),this._items=[]}return u(t,[{key:"addListResult",value:function(t){var e=this,r=[];t.value.data.forEach(function(i,n){r.push(new e.Item(t.value.metadata[n],i))}),this._items=this._items.concat(r),this._done=t.done}},{key:"getDataList",value:function(t,e){this._fetchParams=t;var r=25;null!=t.size&&(r=-1==t.size?this.getSize():t.size);var i=this._items.slice(e,e+r),n=[],a=[];return i.forEach(function(t){n.push(t.data),a.push(t.metadata)}),{fetchParameters:t,data:n,metadata:a}}},{key:"getDataByKeys",value:function(t){var e,r=this,i=new Map;t&&t.keys&&t.keys.forEach(function(t){for(e=0;e<r._items.length;e++)if(r._items[e].metadata.key==t){i.set(t,r._items[e]);break}});return new this.FetchByKeysResults(t,i)}},{key:"getDataByOffset",value:function(t){var e=[];return t&&(e=this._items.slice(t.offset,t.offset+t.size)),new this.FetchByOffsetResults(t,e,!0)}},{key:"processMutations",value:function(t){null!=t.remove&&this._handleMutationRemove(t.remove),null!=t.add&&this._handleMutationAdd(t.add),null!=t.update&&this._handleMutationUpdate(t.update)}},{key:"reset",value:function(){this._items=[],this._done=!1}},{key:"getSize",value:function(){return this._items.length}},{key:"isDone",value:function(){return this._done}},{key:"_getSortComparator",value:function(e){var r=this;return function(i,n){var a,o,s,u,f;for(a=0;a<e.length;a++){o=e[a][t._DIRECTION],s=e[a][t._ATTRIBUTE],null,u=r._getVal(i,s),f=r._getVal(n,s);var c=0,l="string"==typeof u?u:new String(u).toString(),h="string"==typeof f?f:new String(f).toString();if(0!=(c="ascending"==o?l.localeCompare(h,void 0,{numeric:!0,sensitivity:"base"}):h.localeCompare(l,void 0,{numeric:!0,sensitivity:"base"})))return c}return 0}}},{key:"_getVal",value:function(t,e){if("string"==typeof e){var r=e.indexOf(".");if(r>0){var i=e.substring(0,r),n=e.substring(r+1),a=t[i];if(a)return this._getVal(a,n)}}return"function"==typeof t[e]?t[e]():t[e]}}]),t}();h._DATA="data",h._METADATA="metadata",h._ITEMS="items",h._BEFOREKEYS="addBeforeKeys",h._KEYS="keys",h._INDEXES="indexes",h._FROM="from",h._OFFSET="offset",h._REFRESH="refresh",h._MUTATE="mutate",h._SIZE="size",h._FETCHPARAMETERS="fetchParameters",h._SORTCRITERIA="sortCriteria",h._DIRECTION="direction",h._ATTRIBUTE="attribute",h._VALUE="value",h._DONE="done",h._RESULTS="results",h._CONTAINSPARAMETERS="containsParameters",h._DEFAULT_SIZE=25,h._CONTAINSKEYS="containsKeys",h._FETCHBYKEYS="fetchByKeys",h._FETCHBYOFFSET="fetchByOffset",h._FETCHFIRST="fetchFirst",h._FETCHATTRIBUTES="attributes",n._registerLegacyNamespaceProp("DataCache",h);var p=function(t){e(n,t);var r=i(n);function n(t){o(this,n);var e={};return e[n._DETAIL]=t,r.call(this,"mutate",e)}return n}(a.GenericEvent);p._DETAIL="detail",n._registerLegacyNamespaceProp("DataProviderMutationEvent",p);var y=function(t){e(n,t);var r=i(n);function n(t){o(this,n);var e={};return e.detail=t,r.call(this,"refresh",e)}return n}(a.GenericEvent);n._registerLegacyNamespaceProp("DataProviderRefreshEvent",y);var v=function(){function t(){o(this,t)}return u(t,[{key:"fetchByKeys",value:function(t){var e=0,r=this.getIterationLimit?this.getIterationLimit():-1,i={size:25},n=new Map,a=this.fetchFirst(i)[Symbol.asyncIterator]();return function t(i,n,a){return n.next().then(function(o){var s=o.value,u=s.data,f=s.metadata,c=f.map(function(t){return t.key}),l=!0;return i.keys.forEach(function(t){a.has(t)||c.map(function(e,r){e==t&&a.set(e,{metadata:f[r],data:u[r]})}),a.has(t)||(l=!1)}),e+=u.length,l||o.done||-1!=r&&e>=r?a:t(i,n,a)})}(t,a,n).then(function(e){var r=new Map;return e.forEach(function(t,e){var i=[t];r.set(e,i[0])}),{fetchParameters:t,results:r}})}},{key:"containsKeys",value:function(t){return this.fetchByKeys(t).then(function(e){var r=new Set;return t.keys.forEach(function(t){null!=e.results.get(t)&&r.add(t)}),Promise.resolve({containsParameters:t,results:r})})}},{key:"getCapability",value:function(t){if("fetchByKeys"==t)return{implementation:"iteration"};var e=null;if(!0!==this._ojSkipLastCapability){this._ojSkipLastCapability=!0;for(var r=1;this["_ojLastGetCapability"+r];)++r;for(--r;r>0&&!(e=this["_ojLastGetCapability"+r](t));r--);delete this._ojSkipLastCapability}return e}}],[{key:"applyMixin",value:function(e){var r=e.prototype.getCapability;if([t].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(r){"constructor"!==r&&(e.prototype[r]=t.prototype[r])})}),r){for(var i=1;e.prototype["_ojLastGetCapability"+i];)++i;e.prototype["_ojLastGetCapability"+i]=r}}}]),t}();n._registerLegacyNamespaceProp("FetchByKeysMixin",v);var _,m=function(){function t(){o(this,t)}return u(t,[{key:"fetchByOffset",value:function(t){var e=t&&t.size>0?t.size:25,r=t?t.sortCriteria:null,i=t&&t.offset>0?t.offset:0,n=0,a=this.getIterationLimit?this.getIterationLimit():-1,o=!1,s={};s.size=e,s.sortCriteria=r;var u=new Array,f=this.fetchFirst(s)[Symbol.asyncIterator]();return function t(r,s,u){return s.next().then(function(f){o=f.done;var c=f.value,l=c.data,h=c.metadata,p=l.length;if(i<n+p)for(var y=i<=n?0:i-n;y<p&&u.length!=e;y++)u.push({metadata:h[y],data:l[y]});return n+=p,u.length<e&&!o?-1!=a&&n>=a?u:t(r,s,u):u})}(t,f,u).then(function(e){return{fetchParameters:t,results:e,done:o}})}},{key:"getCapability",value:function(t){if("fetchByOffset"==t)return{implementation:"iteration"};var e=null;if(!0!==this._ojSkipLastCapability){this._ojSkipLastCapability=!0;for(var r=1;this["_ojLastGetCapability"+r];)++r;for(--r;r>0&&!(e=this["_ojLastGetCapability"+r](t));r--);delete this._ojSkipLastCapability}return e}}],[{key:"applyMixin",value:function(e){var r=e.prototype.getCapability;if([t].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(r){"constructor"!==r&&(e.prototype[r]=t.prototype[r])})}),r){for(var i=1;e.prototype["_ojLastGetCapability"+i];)++i;e.prototype["_ojLastGetCapability"+i]=r}}}]),t}();n._registerLegacyNamespaceProp("FetchByOffsetMixin",m),function(e){function r(t,e){var r=!1;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(r||!a(i))throw new Error("parsing error "+e);t.operator=i,t.right=n,r=!0}}function i(t,e,r){var i;if("$lt"===t)return(r=(i=s(r,e))[0])<(e=i[1]);if("$gt"===t)return(r=(i=s(r,e))[0])>(e=i[1]);if("$lte"===t)return(r=(i=s(r,e))[0])<=(e=i[1]);if("$gte"===t)return(r=(i=s(r,e))[0])>=(e=i[1]);if("$eq"===t)return r===e;if("$ne"===t)return r!==e;if("$regex"===t){if(r){if("string"!=typeof r&&!(r instanceof String))if(r instanceof Object){if("[object Object]"==(r=r.toString()))return!1}else r=new String(r);return null!==r.match(e)}return!1}if("$exists"===t)return e?null!=r:null==r;throw new Error("not a valid operator! "+t)}function n(t){return"$and"===t||"$or"===t}function a(t){return"$lt"===t||"$gt"===t||"$lte"===t||"$gte"===t||"$eq"===t||"$ne"===t||"$regex"===t||"$exists"===t}function o(t){return null!=t&&(t instanceof String||"string"==typeof t)}function s(t,e){return o(t)&&null==e?e="":o(e)&&null==t&&(t=""),[t,e]}function u(t,e){for(var r=t.split("."),i=e,n=0;n<r.length;n++)i=i[r[n]];return i}e.satisfy=function(e,o){return!e||function t(e,r){var o=e.operator;if(n(o)){if(!e.left&&e.array instanceof Array){for(var s,f=e.array,c=0;c<f.length;c++){var l=t(f[c],r);if("$or"===o&&!0===l)return!0;if("$and"===o&&!1===l)return!1;s=l}return s}throw new Error("invalid expression tree!"+e)}if(a(o)){var h,p=e.right;if("*"!=e.left)return h=u(e.left,r),i(o,p,h);var y,v=Object.keys(r);for(y=0;y<v.length;y++)if(h=u(v[y],r),i(o,p,h))return!0;return!1}throw new Error("not a valid expression!"+e)}(function e(i){var o,s=[];for(var u in i)if(i.hasOwnProperty(u)){var f=i[u];if(0===u.indexOf("$")){if(n(u)){if(!(f instanceof Array))throw new Error("not a valid expression: "+i);o={operator:u,array:[]};for(var c=0;c<f.length;c++){var l=e(f[c]);o.array.push(l)}}else if(a(u))throw new Error("not a valid expression: "+i)}else if("object"!==t(f))s.push({left:u,right:f,operator:"$eq"});else{var h={left:u};r(h,f),s.push(h)}}s.length>1?o={operator:"$and",array:s}:1===s.length&&(o=s[0]);return o}(e),o)}}(_||(_={}));var g=function(){function t(e){o(this,t),e=e||{},this._textFilterAttributes=e.filterOptions?e.filterOptions.textFilterAttributes:null;var r=e.filterDef;r&&(r.op?(this.op=r.op,r.value?(this.value=r.value,r.attribute&&(this.attribute=r.attribute)):r.criteria&&(this.criteria=r.criteria)):r.text&&(this.text=r.text))}return u(t,[{key:"filter",value:function(e,r,i){return _.satisfy(t._transformFilter(this),e)}}],[{key:"_transformFilter",value:function(e){var r;if(e){var i,n=e.op;if(e.text?n="$regex":"$le"===n?n="$lte":"$ge"===n?n="$gte":"$pr"===n&&(n="$exists"),"$and"!=n&&"$or"!=n){i=e.text?new RegExp(e.text.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),"i"):e.value,r={};var a=e.attribute;if(a){var o={};"$sw"!==n&&"$ew"!==n&&"$co"!==n||(n="$regex",i=t._fixStringExpr(n,i)),o[n]=i,r[a]=o}else if(e.text){var s={};if(s[n]=i,e._textFilterAttributes&&e._textFilterAttributes.length>0){var u=[];e._textFilterAttributes.forEach(function(t){var e={};e[t]=s,u.push(e)}),r.$or=u}else r["*"]=s}else{var f=[];t._transformObjectExpr(i,n,null,f),r.$and=f}}else{var c=[];e.criteria.forEach(function(r){r&&r.text&&e._textFilterAttributes&&(r._textFilterAttributes=e._textFilterAttributes),c.push(t._transformFilter(r))}),(r={})[n]=c}}return r}},{key:"_transformObjectExpr",value:function(e,r,i,n){if(Object.keys(e).length>0)Object.keys(e).forEach(function(a){var o=e[a],s=i?i+"."+a:a;if(o instanceof Object)t._transformObjectExpr(o,r,s,n);else{var u={};"$sw"!==r&&"$ew"!==r&&"$co"!==r||(r="$regex",o=t._fixStringExpr(r,o)),u[r]=o;var f={};f[s]=u,n.push(f)}});else{var a={};a[r]=e;var o={};o[i]=a,n.push(o)}}},{key:"_fixStringExpr",value:function(t,e){return("string"==typeof e||e instanceof String)&&("$sw"===t?e="^"+e:"$ew"===t&&(e+="$")),e}}]),t}(),d=function(){function t(){o(this,t)}return u(t,null,[{key:"getFilter",value:function(t){return new g(t)}}]),t}();n._registerLegacyNamespaceProp("FilterFactory",d),r.DataCache=h,r.DataProviderMutationEvent=p,r.DataProviderRefreshEvent=y,r.FetchByKeysMixin=v,r.FetchByOffsetMixin=m,r.FilterFactory=d,Object.defineProperty(r,"__esModule",{value:!0})})}();
//# sourceMappingURL=ojdataprovider.js.map