!function(){function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function i(t,e,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var i,o=r(e);if(n){var a=r(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(this,i)}}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}define(["exports","ojs/ojcore-base","ojs/ojdatacollection-common","ojs/ojanimation","ojs/ojthemeutils","ojs/ojvcomponent","ojs/ojcontext","ojs/ojlogger","ojs/ojvcollection"],function(n,a,u,h,f,d,y,v,m){"use strict";
/**
   * @license
   * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */var p,g=function(){function t(e,n,i,o){l(this,t),this.fullWidth=e,this.gutterWidth=n,this.itemWidth=i,this.cache=o,this.columns=0,this.margin=0,this.columnsInfo=[],this.bottom=0,this.keys=[],null==this.cache&&(this.cache=new Map)}return c(t,[{key:"_initializeColumnsInfo",value:function(){this.columns=Math.max(1,Math.floor(this.fullWidth/(this.itemWidth+this.gutterWidth))),this.margin=Math.max(this.gutterWidth,(this.fullWidth-this.columns*(this.itemWidth+this.gutterWidth))/2),this.columnsInfo.length=this.columns;for(var t=0;t<this.columns;t++)this.columnsInfo[t]=0}},{key:"_populatePositions",value:function(t,e,n,i,o,a){for(var s=0;s<t.length;s++){var r=n(t[s]);if(null!=r){var l=s+e,u=l%this.columnsInfo.length,c=void 0,h=this.cache.get(r);if(h&&!isNaN(h.height)){if(c=h.height,!1!==h.valid&&!isNaN(h.top)&&!isNaN(h.left)){i(l,r,u,h);continue}}else c=o(t[s]);if(isNaN(c))return;var f=this.margin,d=void 0;if(l<this.columnsInfo.length)f+=u*(this.itemWidth+this.gutterWidth),d={top:this.gutterWidth,left:f,height:c,valid:!0},this.columnsInfo[u]=c+2*this.gutterWidth,this.bottom=Math.max(this.bottom,c);else{var y=this.columnsInfo.reduce(function(t,e){return Math.min(t,e)}),v=this.columnsInfo.indexOf(y);d={top:y,left:f+=v*(this.itemWidth+this.gutterWidth),height:c,valid:!0},this.columnsInfo[v]=this.columnsInfo[v]+c+this.gutterWidth,this.bottom=Math.max(this.bottom,y+c)}d&&(-1===this.keys.indexOf(r)&&this.keys.push(r),this.cache.set(r,d),a&&a(r,d))}}}},{key:"setWidth",value:function(t){this.fullWidth=t,this.columnsInfo.length>0&&(this._initializeColumnsInfo(),this._invalidatePositions(0))}},{key:"getPositionForItems",value:function(t,e){var n=new Map;isNaN(this.itemWidth)&&t.length>0&&(this.itemWidth=t[0].element.offsetWidth),0===this.columnsInfo.length&&this._initializeColumnsInfo(),this._populatePositions(t,e,function(t){return t.key},function(t,e,i,o){n.set(e,o)},function(t){return t.element.offsetHeight},function(t,e){n.set(t,e)});for(var i=0,o=new Set,a=Array.from(n.values()),s=0;s<a.length;s++){var r=a[s].left;if(o.has(r)||o.add(r),i=Math.max(i,a[s].top),o.size===this.columnsInfo.length)break}o.clear();for(var l=Number.MAX_VALUE,u=a.length-1;u>=0;u--){var c=a[u].left;if(o.has(c)||o.add(c),l=Math.min(l,a[u].top+a[u].height),o.size===this.columnsInfo.length)break}return{start:i,end:l,positions:n}}},{key:"getItemWidth",value:function(){return this.itemWidth}},{key:"getPositions",value:function(){return this.cache}},{key:"getPosition",value:function(t){return this.cache.get(t)}},{key:"getLastItemPosition",value:function(){return this.bottom}},{key:"getColumnsInfo",value:function(){var t=this;return this.columnsInfo.map(function(e,n){return{top:e,left:t.margin+n*(t.itemWidth+t.gutterWidth)}})}},{key:"insert",value:function(t,e){var n=this,i=Number.MAX_VALUE;t.forEach(function(t,o){var a=n.keys.indexOf(t),s=e[o];a>-1&&(i=Math.min(i,a),n.keys.splice(a,0,s),n.cache.set(s,{top:void 0,left:void 0,height:void 0,valid:!1}))}),this._invalidatePositions(i)}},{key:"remove",value:function(t){var e=this,n=Number.MAX_VALUE;t.forEach(function(t){e.cache.delete(t);var i=e.keys.indexOf(t);i>-1&&(n=Math.min(n,i),e.keys.splice(i,1))}),this._invalidatePositions(n)}},{key:"update",value:function(t){var e=this;t.forEach(function(t){var n=e.getPosition(t);n&&(n.height=void 0)})}},{key:"_invalidatePositions",value:function(t){for(var e=t;e<this.keys.length;e++){var n=this.cache.get(this.keys[e]);null!=n&&(n.valid=!1)}for(var i=0;i<this.columns;i++)this.columnsInfo[i]=0;this.recalculatePositions()}},{key:"recalculatePositions",value:function(){var t=this;this._populatePositions(this.keys,0,function(t){return t},function(e,n,i,o){var a=o.height;if(e<t.columnsInfo.length)t.columnsInfo[i]=a+2*t.gutterWidth,t.bottom=Math.max(t.bottom,a);else{var s=t.columnsInfo.reduce(function(t,e){return Math.min(t,e)}),r=t.columnsInfo.indexOf(s);t.columnsInfo[r]=t.columnsInfo[r]+a+t.gutterWidth,t.bottom=Math.max(t.bottom,s+a)}},function(t){})}}]),t}(),k=function(t){o(a,m.IteratingDataProviderContentHandler);var n=s(a);function a(t,e,i,o,s,r){var u;return l(this,a),(u=n.call(this,t,e,i,o)).root=t,u.dataProvider=e,u.callback=i,u.scrollPolicyOptions=o,u.itemDimension=s,u.gutterWidth=r,u.postRender=function(){var t=u.root.lastElementChild.firstElementChild;t&&null==u.adjustPositionsResolveFunc&&(u.adjustPositionsResolveFunc=u._addComponentBusyState("adjusting item positions"),y.getContext(t).getBusyContext().whenReady().then(function(){if(u.adjustPositionsResolveFunc&&(u.adjustPositionsResolveFunc(),u.adjustPositionsResolveFunc=null),u.callback){var t=u._handleOutOfRangeItems(),e=u._adjustAllItems(t);if(e.done){if(u.domScroller&&!u.domScroller.checkViewport())return;u.callback.renderComplete(e.items)}}}))},u.newItemsTracker=new Set,u.vnodesCache=new Map,u}return c(a,[{key:"getLayout",value:function(){var t;null==this.layout&&(this.itemDimension&&(t=this.itemDimension.width),this.layout=new g(this.root.clientWidth,this.gutterWidth,t,new Map));return this.layout}},{key:"_handleOutOfRangeItems",value:function(){var t=this,e=!1,n=this.getLayout();return this.root.querySelectorAll(".oj-waterfalllayout-position-only").forEach(function(i){var o=t.getKey(i),a=n.getPosition(o);a&&(a.height=i.offsetHeight,e=!0)}),e&&n.recalculatePositions(),e}},{key:"_adjustAllItems",value:function(t){var e=this,n=!0,i=Array.from(this.root.querySelectorAll(".oj-waterfalllayout-item")).map(function(t){return"false"===t.getAttribute("data-oj-positioned")&&(n=!1),{key:e.getKey(t),element:t}});if(n&&!t)return{done:!0,items:i};var o=this.callback.getData().startIndex,a=this.getLayout().getPositionForItems(i,isNaN(o)?0:o);return this.callback.setPositions(a.positions),this.callback.setContentHeight(this.getLayout().getLastItemPosition()),this.domScroller&&this.domScroller.setViewportRange(a.start,a.end),{done:!1,items:i}}},{key:"handleResizeWidth",value:function(t){this.initialFetch=!1,this.getLayout().setWidth(t),this.newItemsTracker.clear()}},{key:"_addComponentBusyState",value:function(t){return y.getContext(this.root).getBusyContext().addBusyState({description:t})}},{key:"handleBeforeFetchNext",value:function(t){var e=this.callback.getPositions();if(null==e)return-1;var n=this.callback.getData().startIndex;isNaN(n)&&(n=0);for(var i=e.values(),o=i.next();!o.done;){if(o.value.top+o.value.height>t)break;o=i.next(),n++}return n}},{key:"_isRenderingViewportOnly",value:function(){return!1}},{key:"handleBeforeFetchByOffset",value:function(t,e){if(this._isRenderingViewportOnly()){var n=this.getLayout().getPositions(),i=Array.from(n.values()).slice(t,e);i.length>0&&this.callback.setSkeletonPositions({startIndex:t,endIndex:e,positions:i})}}},{key:"handleFetchSuccess",value:function(t){null!=t&&this.newItemsTracker.clear(),this.initialFetch=!1,i(r(a.prototype),"handleFetchSuccess",this).call(this,t)}},{key:"renderFetchedData",value:function(){var t=this.callback.getSkeletonPositions();if(null==t||isNaN(t.startIndex)||isNaN(t.endIndex))return i(r(a.prototype),"renderFetchedData",this).call(this);var e=t.startIndex,n=t.endIndex,o=t.positions,s=this.callback.getData(),l=isNaN(s.startIndex)?0:s.startIndex,u=l+s.value.data.length;if(u<e||l>n)return this._log("no data within range, rendering all items as skeletons"),this.callback.renderSkeletons(o);var c=s.value.data.slice(0),h=s.value.metadata.slice(0);l>=e?o=o.slice(0,l-e):(c=c.slice(e-l),h=h.slice(e-l),this._log("rendering data from: "+e+" to "+(e+c.length))),u>=n&&(c=c.slice(0,n-u),h=h.slice(0,n-u),this._log("rendering data from: "+l+" to "+(l+c.length)));var f=this.callback.renderSkeletons(o);return this.renderData(c,h).concat(f)}},{key:"addItem",value:function(t,e,n,i){var o=-1,a=-1,s=this.getLayout().getPosition(t);null!=s?isNaN(s.left)||isNaN(s.top)||(o=s.left,a=s.top):this.newItemsTracker.add(t);var r=this.isInitialFetch();null==this.callback.getCurrentItem()&&r&&0==e&&this.callback.setCurrentItem(t);var l=this.renderItem(t,e,n);return this.decorateItem(l,t,e,o,a,r,i),l}},{key:"renderItem",value:function(t,e,n){var i=this.vnodesCache.get(t);if(i){if(i.index===e)return i.vnodes;this.vnodesCache.clear()}var o=this.callback.getItemRenderer()({data:n,index:e,key:t});return this.vnodesCache.set(t,{index:e,vnodes:o}),o}},{key:"decorateItem",value:function(t,e,n,i,o,a,s){for(var r,l=0;l<t.length;l++){var u=t[l]._node;if(1===u.nodeType){r=u;break}}if(null!=r&&!r.classList.contains("oj-waterfalllayout-exit-animation")){r.key=e,r.setAttribute("key",JSON.stringify(e)),r.setAttribute("role","gridcell"),r.setAttribute("tabIndex","-1"),r.setAttribute("data-oj-positioned",-1!=i&&-1!=o?"true":"false"),this.getItemStyleClass(s,i,o,this.newItemsTracker.has(e),a).forEach(function(t){r.classList.add(t)});var c=this.getItemInlineStyle(s,i,o,n,a);Object.keys(c).forEach(function(t){r.style[t]=c[t]})}}},{key:"getItemInlineStyle",value:function(t,e,n,i,o){var a={};return-1===e||-1===n?(a.top=0,a.left=0):(a.left=e+"px",a.top=n+"px"),t&&-1!=e&&-1!=n&&(o?(a.opacity=0,isNaN(i)||(a.animationDelay=50*i+"ms")):a.visibility="visible"),a}},{key:"getItemStyleClass",value:function(t,e,n,i,o){var a=[];return t?(a.push("oj-waterfalllayout-item"),-1!=e&&-1!=n&&(o?a.push("oj-waterfalllayout-entrance-animation"):i&&a.push("oj-waterfalllayout-item-fadein-animation"))):a.push("oj-waterfalllayout-position-only"),a}},{key:"renderSkeletonsForLoadMore",value:function(){var t=this.getLayout(),n=t.getColumnsInfo(),i=t.getItemWidth(),o=[],a=Math.max.apply(Math,e(n.map(function(t){return t.top})));if(a>0){var s=a+100;this.callback.setContentHeight(s);var r=n.map(function(t){return{left:t.left,top:t.top,height:s-t.top,width:i}});o=this.callback.renderSkeletons(r)}return o}},{key:"handleItemsAdded",value:function(t){var e=t.addBeforeKeys;if(null!=e){var n=Array.from(t.keys);this.getLayout().insert(e,n)}i(r(a.prototype),"handleItemsAdded",this).call(this,t)}},{key:"handleItemsRemoved",value:function(t){var e=Array.from(t.keys);this.getLayout().remove(e),i(r(a.prototype),"handleItemsRemoved",this).call(this,t)}},{key:"handleCurrentRangeItemUpdated",value:function(t){var e=this.getLayout().getPosition(t);e&&(e.top=void 0,e.left=void 0),i(r(a.prototype),"handleCurrentRangeItemUpdated",this).call(this,t)}},{key:"handleItemsUpdated",value:function(t){var e=Array.from(t.keys);this.getLayout().update(e),i(r(a.prototype),"handleItemsUpdated",this).call(this,t)}},{key:"_log",value:function(t){v.info("[WaterfallLayoutContentHandler]=> "+t)}}]),a}(),b=function(e,n,i,o){var a,s=arguments.length,r=s<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,n,i,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(s<3?a(r):s>3?a(n,i,r):a(n,i))||r);return s>3&&r&&Object.defineProperty(n,i,r),r};n.WaterfallLayout=p=function(t){o(i,d.VComponent);var n=s(i);function i(t){var e;return l(this,i),(e=n.call(this,t)).restoreFocus=!1,e.actionableMode=!1,e.ticking=!1,e.setRootElement=function(t){e.root=t},e.state={renderedData:null,outOfRangeData:null,positions:null,skeletonPositions:null,width:0,height:0,contentHeight:0},e}return c(i,[{key:"_handleFocusIn",value:function(t){this.currentItem&&this.currentItem.classList.add("oj-focus")}},{key:"_handleFocusOut",value:function(t){this.currentItem&&(this.currentItem.classList.remove("oj-focus"),this.currentItem.classList.remove("oj-waterfalllayout-item-suppress-focus"))}},{key:"_handleClick",value:function(t){this._handleTouchOrClickEvent(t)}},{key:"_handlePointerDown",value:function(t){var e=t.target.closest("."+this.getItemStyleClass());null!=e&&e.classList.add("oj-waterfalllayout-item-suppress-focus")}},{key:"_handleKeyDown",value:function(t){if(this.currentItem){var e;switch(t.key){case"ArrowLeft":case"Left":e=this.currentItem.previousElementSibling;break;case"ArrowRight":case"Right":e=this.currentItem.nextElementSibling;break;case"F2":!1===this.actionableMode&&this._enterActionableMode();break;case"Escape":case"Esc":!0===this.actionableMode&&this._exitActionableMode();break;case"Tab":!0===this.actionableMode&&this.currentItem&&(t.shiftKey?u.handleActionablePrevTab(t,this.currentItem):u.handleActionableTab(t,this.currentItem))}!1===this.actionableMode&&null!=e&&e.classList.contains(this.getItemStyleClass())&&(this.currentItem.classList.remove("oj-waterfalllayout-item-suppress-focus"),this._updateCurrentItem(e))}}},{key:"_touchStartHandler",value:function(t){this._handleTouchOrClickEvent(t)}},{key:"render",value:function(){var t;if(null==this.contentHandler)t=this._renderInitialSkeletons(null);else{var e=this.getData(),n=this.state.skeletonPositions;e?null!=n&&this.contentHandler.isInitialFetch()?t=this._renderInitialSkeletons(n.positions):(t=this.contentHandler.render(),this.currentItem&&this.currentItem.contains(document.activeElement)&&(this.restoreFocus=!0)):null!=n&&(t=this._renderInitialSkeletons(n.positions))}return d.h("oj-waterfall-layout",{ref:this.setRootElement,style:this._getRootElementStyle()},d.h("div",{onClick:this._handleClick,onKeydown:this._handleKeyDown,onTouchstart:this._touchStartHandler,onFocusin:this._handleFocusIn,onFocusout:this._handleFocusOut,onPointerdown:this._handlePointerDown,role:"grid"},d.h("div",{role:"row",style:this._getContentDivStyle(),"data-oj-context":!0},t)))}},{key:"mounted",value:function(){var t=this,e=this.getRootElement();this.contentHandler=new k(e,this.props.data,this,this.props.scrollPolicyOptions,null,p.gutterWidth),this.contentHandler.fetchRows();var n=e.clientWidth,i=e.clientHeight;this.updateState({width:n,height:i});var o=e.querySelector(".oj-waterfalllayout-skeleton");if(o&&(this.skeletonWidth=o.clientWidth,this._delayShowSkeletons()),window.ResizeObserver){var a=new window.ResizeObserver(function(n){n.forEach(function(n){if(n.target===e&&n.contentRect){var i=t.state.width,o=Math.round(n.contentRect.width);Math.abs(o-i)>1&&(t.contentHandler.handleResizeWidth(o),t.updateState({width:o}));var a=t.state.height,s=Math.round(n.contentRect.height);Math.abs(s-a)>1&&s!==t.state.contentHeight&&t.updateState({height:s})}})});a.observe(e),this.resizeObserver=a}this._getScroller().addEventListener("scroll",this.scrollListener)}},{key:"updated",value:function(t,e){var n=this;if(null!=this.getData()){var i=this.getRootElement();if(null==e.renderedData){var o=this._findSkeletons();o.length>0?this._applySkeletonExitAnimation(o).then(function(){n.updateState({skeletonPositions:null})}):(this.updateState({skeletonPositions:null}),this.contentHandler.postRender())}else this.props.data!=t.data?this._applyExitAnimation().then(function(){n.updateState({renderedData:null}),n.contentHandler&&n.contentHandler.destroy(),n.contentHandler=new k(i,n.props.data,n,n.props.scrollPolicyOptions,null,p.gutterWidth),n.contentHandler.fetchRows(),n._delayShowSkeletons()}):this.contentHandler.postRender();this.props.scrollPosition!=t.scrollPosition&&this._syncScrollTopWithProps()}}},{key:"unmounted",value:function(){this.contentHandler&&this.contentHandler.destroy(),this.contentHandler=null,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null,this.scrollListener&&null!=this._getScroller()&&this._getScroller().removeEventListener("scroll",this.scrollListener)}},{key:"_delayShowSkeletons",value:function(){var t=this;window.setTimeout(function(){if(null==t.getData()){var e=t._getPositionsForSkeletons(50,t.state.width,t.skeletonWidth);t.updateState({skeletonPositions:e})}},this._getShowSkeletonsDelay())}},{key:"_getOptionDefaults",value:function(){return null==this.defaultOptions&&(this.defaultOptions=f.parseJSONFromFontFamily("oj-waterfalllayout-option-defaults")),this.defaultOptions}},{key:"_getShowSkeletonsDelay",value:function(){var t=this._getOptionDefaults();if(null==t)return 0;var e=parseInt(t.showIndicatorDelay,10);return isNaN(e)?0:e}},{key:"_addBusyState",value:function(t){var e=this.getRootElement();return y.getContext(e).getBusyContext().addBusyState({description:t})}},{key:"_findSkeletons",value:function(){var t=this.getRootElement().querySelectorAll(".oj-waterfalllayout-skeleton");return t.length>1?t:[]}},{key:"getRootElement",value:function(){return this.root}},{key:"isAvailable",value:function(){return null!=this.contentHandler}},{key:"getCurrentItem",value:function(){return this.currentKey}},{key:"setCurrentItem",value:function(t){this.currentKey=t}},{key:"getData",value:function(){return this.state.renderedData}},{key:"setData",value:function(t){this.updateState({renderedData:t});var e=this._findSkeletons();null!=t&&0!==e.length||this.updateState({skeletonPositions:null})}},{key:"updateData",value:function(t){this.updateState(function(e){var n=e.renderedData;return t(n)}.bind(this))}},{key:"getOutOfRangeData",value:function(){return this.state.outOfRangeData}},{key:"setOutOfRangeData",value:function(t){this.updateState({outOfRangeData:t})}},{key:"getSkeletonPositions",value:function(){return this.state.skeletonPositions}},{key:"setSkeletonPositions",value:function(t){this.updateState({skeletonPositions:t})}},{key:"getPositions",value:function(){return this.state.positions}},{key:"setPositions",value:function(t){this.updateState({positions:t,outOfRangeData:null})}},{key:"setContentHeight",value:function(t){null!=this.props.scrollPolicyOptions.scroller&&this.updateState({contentHeight:t})}},{key:"getItemRenderer",value:function(){return this.props.itemTemplate}},{key:"getItemStyleClass",value:function(){return"oj-waterfalllayout-item"}},{key:"getItemElementStyleClass",value:function(){return"oj-waterfalllayout-item-element"}},{key:"getExpanded",value:function(){}},{key:"_applySkeletonExitAnimation",value:function(t){var e=this._addBusyState("apply skeleton exit animations");return new Promise(function(n,i){var o;t.forEach(function(t){o=h.fadeOut(t)}),o&&o.then(function(){e(),n(!0)})})}},{key:"_applyExitAnimation",value:function(){var t=this,e=this._addBusyState("apply exit animations on existing items");return new Promise(function(n,i){var o=t.getRootElement(),a=o.querySelectorAll("."+t.getItemStyleClass());if(0===a.length)e(),n(!0);else{o.addEventListener("animationend",function t(i){o.removeEventListener("animationend",t),a.forEach(function(t){t.classList.remove("oj-waterfalllayout-exit-animation")}),e(),n(!0)}),a.forEach(function(t){t.style.animationDelay="0ms",t.classList.remove("oj-waterfalllayout-item-fadein-animation"),t.classList.remove("oj-waterfalllayout-entrance-animation"),t.classList.add("oj-waterfalllayout-exit-animation")})}})}},{key:"scrollListener",value:function(t){var e=this;this.ticking||(window.requestAnimationFrame(function(){e._updateScrollPosition(),e.ticking=!1}),this.ticking=!0)}},{key:"_updateScrollPosition",value:function(){for(var t,e=this._getScroller().scrollTop,n=this.contentHandler.getLayout().getPositions().entries(),i=n.next(),o=0;!i.done;){var a=i.value;i=n.next();var s=a[1].top;if(s>e){void 0===t&&(t=a[0]);break}s>o&&(t=a[0],o=s)}var r={y:e,key:t,offsetY:Math.abs(e-o)};this._updateProperty("scrollPosition",r)}},{key:"_syncScrollTopWithProps",value:function(){var t,e=this.props.scrollPosition,n=e.key;if(n){var i=this.contentHandler.getLayout().getPosition(n);if(null==i)return;t=i.top;var o=e.offsetY;isNaN(o)||(t+=o)}else{var a=e.y;if(isNaN(a))return;t=a}t>this._getScroller().scrollHeight||(this._getScroller().scrollTop=t)}},{key:"_handleTouchOrClickEvent",value:function(t){var e=t.target.closest("."+this.getItemStyleClass());this._updateCurrentItem(e)}},{key:"_resetFocus",value:function(t){t.classList.remove("oj-focus"),t.tabIndex=-1}},{key:"_setFocus",value:function(t,e){t.tabIndex=0,e&&(t.classList.add("oj-focus"),t.focus())}},{key:"_updateCurrentItem",value:function(t){var e=this.currentItem;this._resetFocus(e),this.currentItem=t;var n=t;this.currentKey=n.key,this._setFocus(n,!0),this._scrollToVisible(n)}},{key:"_scrollToVisible",value:function(t){var e=t.offsetTop,n=t.offsetHeight,i=this._getScroller(),o=i.scrollTop,a=i.offsetHeight;if(!(e>=o&&e+n<=o+a)){var s=Math.max(0,Math.min(e,Math.abs(e+n-a)));i.scrollTop=s}}},{key:"_getScroller",value:function(){var t=this.props.scrollPolicyOptions.scroller;return null!=t?t:this.getRootElement()}},{key:"_getContentDivStyle",value:function(){return{height:this.state.contentHeight+"px"}}},{key:"_getRootElementStyle",value:function(){return null!=this.props.scrollPolicyOptions.scroller?{overflow:"hidden"}:null}},{key:"_renderInitialSkeletons",value:function(t){var e=this._getScroller();if(null!=e&&(e.scrollTop=0),null==t)return this._renderSkeleton(null);for(var n=t.size,i=[],o=0;o<n;o++){var a=t.get(o);i.push(this._renderSkeleton(a))}return d.h("div",{role:"row"},i)}},{key:"_getPositionsForSkeletons",value:function(t,e,n){for(var i=[],o=new Map,a=0;a<t;a++){var s=150+a%3*100;o.set(a,{height:s}),i.push({key:a})}return new g(e,p.gutterWidth,n,o).getPositionForItems(i,0)}},{key:"_isInViewport",value:function(t){var e=parseInt(t.style.top,10),n=this._getScroller().scrollTop;return e>=n&&e<=n+this.state.height}},{key:"_restoreCurrentItem",value:function(t){if(null!=this.currentKey)for(var e=0;e<t.length;e++)if(a.KeyUtils.equals(t[e].key,this.currentKey)){var n=t[e].element;this.restoreFocus&&this._isInViewport(n)?this._updateCurrentItem(n):(this._setFocus(n,!1),this.currentItem=n);break}this.restoreFocus=!1}},{key:"_disableAllTabbableElements",value:function(t){t.forEach(function(t){u.disableAllFocusableElements(t.element,!0)})}},{key:"_enterActionableMode",value:function(){if(this.actionableMode=!0,this.currentItem){var t=u.enableAllFocusableElements(this.currentItem,!0);t&&t.length>0&&t[0].focus()}}},{key:"_exitActionableMode",value:function(){this.actionableMode=!1,this.currentItem&&(u.disableAllFocusableElements(this.currentItem,!0),this._setFocus(this.currentItem,!0))}},{key:"renderComplete",value:function(t){this.actionableMode=!1,this._disableAllTabbableElements(t),this._restoreCurrentItem(t)}},{key:"renderSkeletons",value:function(t){var e=this,n=[];return t.forEach(function(t){n.push(e._renderSkeleton(t))}),n}},{key:"renderSkeletonsForLoadMore",value:function(t,n){var i=this,o=[],a=Math.max.apply(Math,e(t.map(function(t){return t.top})));if(a>0){var s=a+100;t.forEach(function(t){var e={left:t.left,top:t.top,height:s-t.top,width:n};o.push(i._renderSkeleton(e))})}return o}},{key:"_renderSkeleton",value:function(t){var e;return null==t?e={visibility:"hidden"}:(e={top:t.top+"px",left:t.left+"px",height:t.height+"px"},isNaN(t.width)||(e.width=t.width+"px")),d.h("div",{class:"oj-waterfalllayout-skeleton",style:e},d.h("div",{class:"oj-waterfalllayout-skeleton-content oj-animation-skeleton"}))}}]),i}(),n.WaterfallLayout.gutterWidth=20,n.WaterfallLayout.metadata={extension:{_DEFAULTS:function t(){l(this,t),this.data=null,this.scrollPolicy="loadMoreOnScroll",this.scrollPolicyOptions={fetchSize:25,maxCount:500,scroller:null},this.scrollPosition={y:0}}},properties:{data:{type:"object|null",value:null},scrollPolicy:{type:"string",enumValues:["loadAll","loadMoreOnScroll"],value:"loadMoreOnScroll"},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number",value:25},maxCount:{type:"number",value:500},scroller:{type:"Element|null",value:null}}},scrollPosition:{type:"object",properties:{y:{type:"number",value:0},key:{type:"any"},offsetY:{type:"number"}},writeback:!0,readOnly:!1}},slots:{itemTemplate:{}}},b([d.listener()],n.WaterfallLayout.prototype,"_handleFocusIn",null),b([d.listener()],n.WaterfallLayout.prototype,"_handleFocusOut",null),b([d.listener()],n.WaterfallLayout.prototype,"_handleClick",null),b([d.listener()],n.WaterfallLayout.prototype,"_handlePointerDown",null),b([d.listener()],n.WaterfallLayout.prototype,"_handleKeyDown",null),b([d.listener({passive:!0})],n.WaterfallLayout.prototype,"_touchStartHandler",null),b([d.listener()],n.WaterfallLayout.prototype,"scrollListener",null),n.WaterfallLayout=p=b([d.customElement("oj-waterfall-layout")],n.WaterfallLayout),Object.defineProperty(n,"__esModule",{value:!0})})}();