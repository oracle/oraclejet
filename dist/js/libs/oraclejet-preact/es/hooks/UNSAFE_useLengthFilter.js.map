{"version":3,"file":"UNSAFE_useLengthFilter.js","sources":["../../../src/hooks/UNSAFE_useLengthFilter/useLengthFilter.ts"],"sourcesContent":["import { ComponentProps } from 'preact';\nimport { useCallback, useEffect, useState } from 'preact/hooks';\nimport { TextFieldInput } from '../../UNSAFE_TextField';\nimport { calcLength, CountUnit as _CountUnit, filter } from '../../utils/UNSAFE_lengthFilter';\n\nexport type CountUnit = _CountUnit;\n\ntype PickedPropsFromTextFieldInput = Pick<\n  ComponentProps<typeof TextFieldInput>,\n  'onCommit' | 'onInput' | 'value'\n>;\ntype UseLengthFilterProps = PickedPropsFromTextFieldInput & {\n  maxLength?: number;\n  maxLengthUnit?: CountUnit;\n};\n\n/**\n * A custom hook that applies the length filter to text field input\n * @param param0 The props for the useLengthFilter hook\n * @returns The filtered event handlers\n */\nexport function useLengthFilter({\n  maxLength,\n  maxLengthUnit,\n  onCommit,\n  onInput,\n  value\n}: UseLengthFilterProps) {\n  const [isMaxLengthExceeded, setMaxLengthExceeded] = useState(false);\n  const parse = useCallback(\n    (value: string) => filter(value, maxLength, maxLengthUnit),\n    [maxLength, maxLengthUnit]\n  );\n  // Reapply maxLength filter when the value is changed\n  useEffect(() => {\n    if (value === undefined) {\n      return;\n    }\n\n    const filteredValue = parse(value);\n    if (filteredValue !== value) {\n      onInput?.({ previousValue: value, value: filteredValue });\n      onCommit?.({ previousValue: value, value: filteredValue });\n\n      // Value is filtered, means that the max length is exceeded\n      setMaxLengthExceeded(true);\n    } else {\n      // Value is not filtered, means that the max length is not exceeded\n      setMaxLengthExceeded(false);\n    }\n  }, [value, onCommit, onInput, parse]);\n\n  const onFilteredInput = useCallback(\n    (...args: Parameters<Exclude<typeof onInput, undefined>>) => {\n      const { previousValue, value } = args[0];\n      const filteredValue = parse(value ?? '');\n\n      // Call the onInput event only when the value is changed\n      if (previousValue !== filteredValue) {\n        onInput?.({ ...args[0], value: filteredValue });\n        // value is not filtered, so the max length is not exceeded\n        setMaxLengthExceeded(false);\n      } else {\n        // value is changed but then filtered to previous value\n        // meaning that the max length was exceeded\n        setMaxLengthExceeded(true);\n      }\n    },\n    [onInput, parse]\n  );\n\n  return {\n    isMaxLengthExceeded,\n    valueLength: value === undefined ? undefined : calcLength(value, maxLengthUnit),\n    onFilteredInput\n  };\n}\n"],"names":[],"mappings":";;;;AAgBA;;;;AAIG;AACa,SAAA,eAAe,CAAC,EAC9B,SAAS,EACT,aAAa,EACb,QAAQ,EACR,OAAO,EACP,KAAK,EACgB,EAAA;IACrB,MAAM,CAAC,mBAAmB,EAAE,oBAAoB,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IACpE,MAAM,KAAK,GAAG,WAAW,CACvB,CAAC,KAAa,KAAK,MAAM,CAAC,KAAK,EAAE,SAAS,EAAE,aAAa,CAAC,EAC1D,CAAC,SAAS,EAAE,aAAa,CAAC,CAC3B,CAAC;;IAEF,SAAS,CAAC,MAAK;QACb,IAAI,KAAK,KAAK,SAAS,EAAE;YACvB,OAAO;AACR,SAAA;AAED,QAAA,MAAM,aAAa,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,aAAa,KAAK,KAAK,EAAE;AAC3B,YAAA,OAAO,KAAP,IAAA,IAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,CAAG,EAAE,aAAa,EAAE,KAAK,EAAE,KAAK,EAAE,aAAa,EAAE,CAAC,CAAC;AAC1D,YAAA,QAAQ,KAAR,IAAA,IAAA,QAAQ,KAAR,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,QAAQ,CAAG,EAAE,aAAa,EAAE,KAAK,EAAE,KAAK,EAAE,aAAa,EAAE,CAAC,CAAC;;YAG3D,oBAAoB,CAAC,IAAI,CAAC,CAAC;AAC5B,SAAA;AAAM,aAAA;;YAEL,oBAAoB,CAAC,KAAK,CAAC,CAAC;AAC7B,SAAA;KACF,EAAE,CAAC,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;IAEtC,MAAM,eAAe,GAAG,WAAW,CACjC,CAAC,GAAG,IAAoD,KAAI;QAC1D,MAAM,EAAE,aAAa,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AACzC,QAAA,MAAM,aAAa,GAAG,KAAK,CAAC,KAAK,KAAA,IAAA,IAAL,KAAK,KAAA,KAAA,CAAA,GAAL,KAAK,GAAI,EAAE,CAAC,CAAC;;QAGzC,IAAI,aAAa,KAAK,aAAa,EAAE;AACnC,YAAA,OAAO,KAAP,IAAA,IAAA,OAAO,KAAP,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAO,iCAAQ,IAAI,CAAC,CAAC,CAAC,CAAE,EAAA,EAAA,KAAK,EAAE,aAAa,IAAG,CAAC;;YAEhD,oBAAoB,CAAC,KAAK,CAAC,CAAC;AAC7B,SAAA;AAAM,aAAA;;;YAGL,oBAAoB,CAAC,IAAI,CAAC,CAAC;AAC5B,SAAA;AACH,KAAC,EACD,CAAC,OAAO,EAAE,KAAK,CAAC,CACjB,CAAC;IAEF,OAAO;QACL,mBAAmB;AACnB,QAAA,WAAW,EAAE,KAAK,KAAK,SAAS,GAAG,SAAS,GAAG,UAAU,CAAC,KAAK,EAAE,aAAa,CAAC;QAC/E,eAAe;KAChB,CAAC;AACJ;;;;;;;"}