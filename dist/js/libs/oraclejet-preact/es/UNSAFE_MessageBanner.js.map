{"version":3,"file":"UNSAFE_MessageBanner.js","sources":["../../src/UNSAFE_MessageBanner/MessageBanner.tsx","../../src/UNSAFE_MessageBanner/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport {\n  FocusableComponentHandle,\n  useMessageFocusManager\n} from '../hooks/UNSAFE_useMessagesFocusManager';\nimport { LiveRegion } from '../UNSAFE_LiveRegion';\nimport {\n  getRenderer,\n  Message,\n  MessageItem,\n  MessagesManager,\n  MessageTemplateItem\n} from '../UNSAFE_Message';\nimport { Item } from '../utils/UNSAFE_dataProvider';\nimport { Handle } from '../utils/UNSAFE_typeUtils';\nimport { ComponentChildren, ComponentProps, VNode } from 'preact';\nimport { useCallback, useEffect, useImperativeHandle, useRef, useState } from 'preact/hooks';\nimport { Flex } from '../UNSAFE_Flex';\n\n/**\n * Animation config for banner messages.\n * TODO: Get this from theme context provider\n */\nconst DEFAULT_ANIMATIONS = {\n  enter: [{ effect: 'expand', duration: '0.25s', direction: 'height' }],\n  exit: [{ effect: 'collapse', duration: '0.25s', direction: 'height' }]\n};\n\n/**\n * Default translations for banner messages.\n * TODO: Replace this with preact translations\n */\nconst DEFAULT_TRANSLATIONS = {\n  close: 'Close',\n  navigationFromMessagesRegion:\n    'Entering messages region. Press F6 to navigate back to prior focused element.',\n  navigationToMessagesRegion:\n    'Messages region has new messages. Press F6 to navigate to the most recent message region.',\n  error: 'Error',\n  warning: 'Warning',\n  info: 'Info',\n  confirmation: 'Confirmation'\n};\n\ntype MessageRef = Handle<typeof Message, 'messageRef'>;\n\ntype IntrinsicProps = Pick<ComponentProps<typeof MessagesManager>, 'startAnimation'>;\n/**\n * Props for the MessageBanner Component\n */\ntype Props<Key, Data> = IntrinsicProps & {\n  /**\n   * Data for the MessageBanner component. This data is used for rendering each banner message.\n   * The key for the each message will be configured using the key of the corresponding item. This way,\n   * the component will know whether a new message is being or an existing message is being updated\n   * when the new data comes in.\n   */\n  data: Item<Key, Data>[];\n\n  /**\n   * A Banner message can have a different look and feel. For example, when using page-level\n   * messaging the messages need to be rendered from edge to edge without any outline. On the other\n   * hand, when they are being used in a section of a page or a dialog, they need to be rendered\n   * with an outline. This attribute can be used to specify where the component is being used so that\n   * it will render the messages accordingly.\n   */\n  type?: 'page' | 'section';\n\n  /**\n   * Triggered when a user tries to close a message through UI interaction. The application\n   * should listen to this event and remove the corresponding message item from the data\n   * which would then result in the message closed. If the application\n   * fails to remove the message item from the data, then no change will be done in the\n   * UI by the component and the message will stay in the UI opened.\n   */\n  onClose?: (item: Item<Key, Data>) => void;\n\n  /**\n   * Applications can use this property to provide the name of a template or a function that\n   * returns the name of a template to use for rendering the detail content.\n   *\n   * When a template name is provided as a value for this property, the corresponding template\n   * will be used for rendering the detail content for all the messages. If applications want\n   * to use a different template for different messages, they can provide a function that\n   * returns a template name instead.\n   *\n   * The provided function should accept an Item and return a key to a template for\n   * rendering the corresponding message's detail content. The value returned from this function\n   * should be a key to one of the dynamic template slots provided. If the returned value is not\n   * one of the keys of the provided dynamic template slots, the component will throw an Error.\n   *\n   * If the function returns null or undefined, the component then will perform default rendering\n   * of the detail content using the detail property of the corresponding message.\n   *\n   * If an application specifies both detail and a valid detail-template, the detail-template will\n   * take precedence and the corresponding template will be used for rendering the detail content.\n   */\n  detailRendererKey?: string | ((item: Item<Key, Data>) => string | null);\n\n  /**\n   * A set of available renderers for rendering the message content. Which renderer is used\n   * for rendering which content will be decided by specific properties in the row data.\n   */\n  renderers?: Record<string, (data: MessageTemplateItem<Key, Data>) => ComponentChildren>;\n\n  /**\n   * A renderer that renders the close button in the message.\n   */\n  closeButtonRenderer?: (title: string, onAction: (event?: Event) => void) => VNode;\n\n  /**\n   * Translations resources\n   * TODO: Replace with preact translations when it is available\n   */\n  translations?: {\n    /**\n     * Label for the message close button\n     */\n    close?: string;\n\n    /**\n     * Text to guide keyboard users navigate to prior focussed element when the messages\n     * region gains focus\n     */\n    navigationFromMessagesRegion?: string;\n\n    /**\n     * Text to guide keyboard users navigate to new displayed messages when focus is outside\n     * the messages region\n     */\n    navigationToMessagesRegion?: string;\n\n    /**\n     * Text for 'error' severity level\n     */\n    error?: string;\n\n    /**\n     * Text for 'warning' severity level\n     */\n    warning?: string;\n\n    /**\n     * Text for 'info' severity level\n     */\n    info?: string;\n\n    /**\n     * Text for 'confirmation' severity level\n     */\n    confirmation?: string;\n  };\n};\n\n/**\n * Renders individual messages based on the provided data\n */\nfunction MessageBanner<\n  K extends string | number = string | number,\n  D extends MessageItem = MessageItem\n>({\n  closeButtonRenderer,\n  detailRendererKey,\n  data,\n  onClose,\n  renderers,\n  startAnimation,\n  translations = DEFAULT_TRANSLATIONS,\n  type = 'section'\n}: Props<K, D>) {\n  // Keyboard Navigation and Focus Management\n  const messagesRef = useRef(new Map<K, MessageRef | null>());\n  const containerDivRef = useRef<HTMLDivElement>(null);\n  const focusHandleRef = useRef<FocusableComponentHandle>(null);\n  const [liveRegionText, setLiveRegionText] = useState<string>();\n  const [shouldRender, setShouldRender] = useState(data.length > 0);\n  // We need a ref that holds the current & previous data length, as the exiting\n  // node will always call handleNextFocus with previous data.\n  // As in TransitionGroup, when an item is removed from the data, a new vnode\n  // will not be created instead previous vnode will be used. So, the new handleNextFocus\n  // will not be called when the old vnode exits. Thus, we will be using a ref\n  // to always get the correct current data length.\n  const dataLengthRef = useRef(data.length);\n  const prevDataLengthRef = useRef(0);\n  // Update the data length ref\n  dataLengthRef.current = data.length;\n\n  // We will be using a function based ref to store the refs in the Map\n  const setMessageRef = useCallback(\n    // TODO: use ramda.curry here (currently it is throwing ts error when used with generics)\n    (key: K) => {\n      return (ref: MessageRef | null) => messagesRef.current.set(key, ref);\n    },\n    []\n  );\n\n  // Update the focusHandleRef\n  useImperativeHandle(\n    focusHandleRef,\n    () => ({\n      focus: () => {\n        // Only trigger focus if the component is rendering messages\n        if (data.length) {\n          const firstItemKey = data[0].key;\n          messagesRef.current.get(firstItemKey)?.focus();\n          return true;\n        }\n        return false;\n      },\n      contains: (element: Element) => {\n        // Only invoke method if the component is rendering messages\n        if (data.length && element) {\n          return containerDivRef.current?.contains(element) ?? false;\n        }\n        return false;\n      }\n    }),\n    [data, messagesRef]\n  );\n\n  // Register handlers for focus management\n  const { controller, handlers } = useMessageFocusManager(focusHandleRef, {\n    onFocus: useCallback(() => {\n      setLiveRegionText(translations.navigationFromMessagesRegion);\n    }, [setLiveRegionText])\n  });\n\n  /**\n   * Emits onClose event for the provided message.\n   * @param item The message which the user tried to close\n   */\n  const handleClose = useCallback(\n    (item: Item<K, D>) => {\n      onClose?.(item);\n    },\n    [onClose]\n  );\n\n  /**\n   * Handles focus when a message is closed and animated away from the DOM\n   * @param key The key of the message\n   * @param index The index of the message\n   */\n  const handleNextFocus = useCallback(\n    (_key: K, index: number, closedMessageNode?: Element) => {\n      const isClosedMessageFocused = closedMessageNode?.contains(document.activeElement);\n\n      // If there are no messages, do not render anything. As the old messages\n      // are still in the DOM, use the data count to determine what to do next as it\n      // represents the next state.\n      if (dataLengthRef.current === 0) {\n        setShouldRender(false);\n        // If the current message holds focus, then restore previous focus\n        if (isClosedMessageFocused) {\n          controller.restorePriorFocus();\n        }\n        return;\n      }\n\n      // In TransitionGroup, when an item is removed from the data, a new vnode\n      // will not be created instead previous vnode will be used. So, the new handleNextFocus\n      // will not be called when the old vnode exits. Thus, all the deps will not be pointing to\n      // the current references, rather they will be pointing to the ones where this vnode\n      // last existed in the data.\n      // This means, the data will contain the closing message as well. But, all the ref objects\n      // still point to the most up-to-date values. With that in mind, we will be evaluating the\n      // following values.\n      const renderedMessagesCount = data.length;\n\n      // Now that this message is closed, focus the next message that will take this index. If no\n      // message will take this message's index, then it means that this is the last message. If\n      // that is the case, focus the message at the previous index.\n      // Use the count of the messages that are currently shown in the UI (current state including\n      // the message that will be removed). This way we can get the correct item from the data\n      // as it will contain the closing message as well.\n      const nextMessageIndexToFocus = index + 1 < renderedMessagesCount ? index + 1 : index - 1;\n\n      // if next message is available then transfer the focus to the next element\n      if (nextMessageIndexToFocus > -1 && isClosedMessageFocused) {\n        const nextMessageKey = data[nextMessageIndexToFocus].key;\n        messagesRef.current.get(nextMessageKey)?.focus();\n      }\n    },\n    [controller, data]\n  );\n\n  // Prioritize this component whenever the data changes and\n  // the new data has at least one message\n  useEffect(() => {\n    if (data.length) {\n      // set state to render content whenever the data is not empty\n      setShouldRender(true);\n      if (data.length > prevDataLengthRef.current) {\n        // Only when having a new message, update the aria-live area with the\n        // text to indicate how to get the focus to the new message.\n        setLiveRegionText(translations.navigationToMessagesRegion);\n      }\n      controller.prioritize();\n    } else {\n      // When there are no messages, clear the live region so that\n      // the navigation text will be read when a new message appear\n      setLiveRegionText('');\n    }\n    prevDataLengthRef.current = data.length;\n  }, [data, controller]);\n\n  // When both shouldRender flag is false and no data to render, do not render\n  // anything\n  if (!shouldRender && data.length === 0) {\n    return null;\n  }\n\n  return (\n    <div\n      ref={containerDivRef}\n      class=\"oj-c-messagebanner\"\n      tabIndex={-1} // Need to add tabindex to make the container receive the focus events\n      {...handlers}>\n      <Flex direction=\"column\" gap={type === 'section' ? '1x' : undefined}>\n        <MessagesManager\n          animations={DEFAULT_ANIMATIONS}\n          data={data}\n          startAnimation={startAnimation}\n          onMessageWillRemove={handleNextFocus}>\n          {({ index, item }) => {\n            return (\n              <Message\n                messageRef={setMessageRef(item.key)}\n                item={item}\n                closeButtonRenderer={closeButtonRenderer}\n                detailRenderer={getRenderer(item, detailRendererKey, renderers)}\n                index={index}\n                key={item.key}\n                translations={translations}\n                type={type}\n                onClose={handleClose}\n              />\n            );\n          }}\n        </MessagesManager>\n        <LiveRegion>{liveRegionText}</LiveRegion>\n      </Flex>\n    </div>\n  );\n}\n\nexport { MessageBanner };\n\nexport type { MessageItem as MessageBannerItem, MessageTemplateItem as MessageBannerTemplateItem };\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nexport { MessageBanner } from './MessageBanner';\nexport type { MessageBannerItem, MessageBannerTemplateItem } from './MessageBanner';\n"],"names":["_jsx","_jsxs"],"mappings":"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"}